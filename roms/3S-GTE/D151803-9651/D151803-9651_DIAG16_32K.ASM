

;
; ษอออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออป
; บ	This file is generated by The Interactive Disassembler (IDA)	    บ
; บ	Copyright (c) 2006 by DataRescue sa/nv,	<ida@datarescue.com>	    บ
; บ			 Licensed to: Freeware version			    บ
; ศอออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผ
;

; ; Processor:	      D8X
; ; Target assembler: Table Driven Assembler (TASM) by Speech Technology Inc.

; อออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออ

				.locallabelchar "."

; Segment type:	Pure data
				;.segment FSR
DDRA:				.block 1			; DATA XREF: ROM:C636w
								; sub_C59B+1B5w
								; Port A i/o config
DDRB:				.block 1			; Port B i/o config
WDC:				.block 1			; watch	dog timer
TIMER3:				.block 1			; DATA XREF: ROM:C613r
								; sub_C59B+1E1r ...
								; Timer	LSB (bit0~bit2)
TIMER:				.block 1			; DATA XREF: sub_C59B+2FFr
								; drive_dout1+Ar ...
								; Timer	MSB (bit11~bit18)
TIMERL:				.block 1			; Timer	LSB (bit3~bit10)
SIDR_SODR:			.block 1			; DATA XREF: ROM:C652r
								; ROM:C658r ...
								; Serial Input/Output Data Register
SMRC_SIR:			.block 1			; DATA XREF: ROM:C623r
								; sub_C59B+1BCr ...
								; Serial Master	Register Control
CPR0:				.block 1			; DATA XREF: sub_C59B+301w
								; ignition_timing_calc+7Br ...
								; Timer	comparison #0 MSB
CPR0L:				.block 1			; Timer	comparison #0 LSB
CPR1:				.block 1			; DATA XREF: drive_dout1+Cw
								; Timer	comparison #1 MSB
CPR1L:				.block 1			; Timer	comparison #1 LSB
CPR2:				.block 1			; Timer	comparison #2 MSB
CPR2L:				.block 1			; Timer	comparison #2 LSB
CPR3:				.block 1			; Timer	comparison #3 MSB
CPR3L:				.block 1			; Timer	comparison #3 LSB
ASR0P:				.block 1			; DATA XREF: ROM:C607r
								; sub_C59B+1EDr
								; ASR0 pos edge	counter	value MSB
ASR0PL:				.block 1			; DATA XREF: ROM:C638r
								; sub_C59B+1EAr
								; ASR0 pos edge	counter	value LSB
ASR0N:				.block 1			; DATA XREF: ROM:C610r
								; sub_C59B+1DFw ...
								; ASR0 neg edge	counter	value MSB
ASR0NL:				.block 1			; DATA XREF: ROM:C60Dr
								; sub_C59B+1F3r
								; ASR0 neg edge	counter	value LSB
ASR1P:				.block 1			; DATA XREF: ROM:C620r
								; sub_C59B+1F0r
								; ASR1 pos edge	counter	value MSB
ASR1PL:				.block 1			; ASR1 pos edge	counter	value LSB
ASR1N:				.block 1			; ASR1 neg edge	counter	value MSB
ASR1NL:				.block 1			; ASR1 neg edge	counter	value LSB
ASR2:				.block 1			; DATA XREF: ROM:C619w
								; sub_C59B+1FCw ...
								; ASR2 edge counter value MSB
ASR2L:				.block 1			; ASR2 edge counter value LSB
ASR3:				.block 1			; DATA XREF: ROM:C61Ew
								; sub_C59B+201w ...
								; ASR3 edge counter value MSB
ASR3L:				.block 1			; ASR3 edge counter value LSB
unk_1C:				.block 1			; DATA XREF: IV0+29r
unk_1D:				.block 1			; DATA XREF: ROM:C60Ar
								; sub_C59B+1F6r
				.block 1
OMODE:				.block 1			; DATA XREF: ROM:__RESETr
								; Mode control Register
PORTA:				.block 1			; DATA XREF: ROM:C626r
								; sub_C59B+9C7r ...
								; Port A Data Register
PORTAL:				.block 1			; DATA XREF: ROM:C629w
								; sub_C59B+30Bw
								; Port A Latch
PORTB:				.block 1			; DATA XREF: ROM:C62Br
								; sub_E115:loc_E16Dr ...
								; PORTB.0 - Some signal	to knock MCU
								; PORTB.1 - Cylinder 1 signal to knock MCU
								; PORTB.2 -
								; PORTB.3 - Knock input	LSB
								; PORTB.4 - Knock input
								; PORTB.5 - Knock input	MSB
								; PORTB.6 -
								; PORTB.7 -
								;
PBCS:				.block 1			; DATA XREF: ROM:C62Ew
								; sub_C59B+1B0w ...
								; Port B Control Register
TAIT:				.block 1			; DATA XREF: ROM:C63Br
								; ROM:C644r ...
								; Timer	ASR Control
LDOUT:				.block 1			; DATA XREF: injector_drive+Br
								; int_vector_9_ignition+4r
								; Latch	DOUT
DOUT:				.block 1			; DATA XREF: ROM:C648r
								; sub_E115+4Cr	...
								; DOUT Data Register
								; DOUT.0 - Ignition IGT	(o/p)
								; DOUT.1 - ISCV
								; DOUT.2 - Knock MCU reset???
								; DOUT.3
								; DOUT.4 - Injector #10	(o/p)
								; DOUT.5 - Injector #20	(o/p)
								; DOUT.6 - Injector #30	(o/p)
								; DOUT.7 - Injector #40	(o/p)
DOM:				.block 1			; DATA XREF: ROM:C64Br
								; sub_C59B+1BFr ...
								; DOUT Control Register
PORTC:				.block 1			; DATA XREF: check_io_inputs:loc_FB54r
								; check_io_inputs:loc_FB59r ...
								; Port C Data Register
PORTD_ASRIN:			.block 1			; DATA XREF: ROM:C630r
								; ROM:C63Er ...
								; Port D Data Register / ASR Input Data
								; PORTD.0
								; PORTD.1 - Malfunction	indicator lamp (0 = LED	on)
								; PORTD.2
								; PORTD.3
								; PORTD.4
								; PORTD.5
								; PORTD.6
								; PORTD.7
RAMST:				.block 1			; DATA XREF: sub_C59B+214r
								; sub_C59B:loc_C7C8r ...
								; Built-in RAM status
SSD:				.block 1			; DATA XREF: ROM:C650r
								; ROM:FA0Cr ...
								; Serial Status	Data Register
IRQL:				.block 1			; DATA XREF: ROM:C65Dw
								; sub_C59B+16Cw ...
								; Interrupt Request Flag MSB
IRQLL:				.block 1			; DATA XREF: sub_C59B:loc_C7B9r
								; ROM:loc_DF3Fr ...
								; Interrupt Request Flag LSB
IMASK:				.block 1			; DATA XREF: ROM:C65Fw
								; sub_C59B+171w ...
								; Interrupt Request Mask MSB
IMASKL:				.block 1			; DATA XREF: sub_C59B+1C3r
								; Interrupt Request Mask LSB
				.block 1
				.block 1
				.block 1
				.block 1
unk_34:				.block 1			; DATA XREF: int_vector_4_kph:loc_F9CEr
				.block 1
				.block 1
				.block 1
CPR4:				.block 1			; DATA XREF: ROM:F371o
								; Timer	comparison #0 MSB
CPR4L:				.block 1			; Timer	comparison #0 LSB
CPR5:				.block 1			; DATA XREF: ROM:F371o
								; Timer	comparison #5 MSB
CPR5L:				.block 1			; Timer	comparison #1 LSB
CPR6:				.block 1			; DATA XREF: ROM:F371o
								; Timer	comparison #2 MSB
CPR6L:				.block 1			; Timer	comparison #2 LSB
CPR7:				.block 1			; DATA XREF: ROM:F371o
								; Timer	comparison #3 MSB
CPR7L:				.block 1			; Timer	comparison #3 LSB
; end of 'FSR'

; อออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออ

; Segment type:	Pure data
				;.segment RAM
				.org 40h
unk_40:				.block 1			; DATA XREF: sub_C59B+CDo
								; sub_C59B+206r ...
								; 40.0 -
								; 40.1 -
								; 40.2 -
								; 40.3 - Transient throttle injection
								; 40.4 -
								; 40.5 -
								; 40.6 -
								; 40.7 -
unk_41:				.block 1			; DATA XREF: sub_C59B+F5r
								; sub_C59B+2DBr ...
var_flags_42:			.block 1			; DATA XREF: sub_C59B:loc_C718r
								; sub_C59B+651r ...
								; 42.0 - Trim valid flag, set when valid
								; 42.1 - ADC flag, set when using ADC table, cleared when scanning sequentially.
								; 42.2 -
								; 42.3 -
								; 42.4 -
								; 42.5 -
								; 42.6 -
								; 42.7 - ADC flag
var_limiter_flags:		.block 1			; DATA XREF: sub_C59B+49Cr
								; sub_C59B:loc_CA5Cr ...
								; 43.1 - ** related to var_cnt_EB **
								; 43.3 - Set if	speed limiter active
								; 43.4 - Set if	4 IGF pulses missing
								; 43.5 - Set if	throttle shut
								; 43.6 - Set if	rev limit active
								; 43.7 - Set if	boost limit exceeded
unk_44:				.block 1			; DATA XREF: sub_C59B+3C5r
								; sub_C59B+4C4r ...
var_ignition_flags:		.block 1			; DATA XREF: sub_C59B+44Er
								; ignition_timing_calc+52r ...
								; 45.7 - Set when injector pulse widths	updated
var_flags_46:			.block 1			; DATA XREF: sub_C59B+203r
								; sub_C59B:loc_C957r ...
								; 46.0 -
								; 46.1 -
								; 46.2 -
								; 46.3 - Some TPS flag
								; 46.4 - Set if	diagnostic error code
								; 46.5 - Knock sensor error
								; 46.6 -
								; 46.7 - Set on	sub-CPU	error
								;
unk_47:				.block 1			; DATA XREF: sub_C996+3r
								; sub_E551+1Br	...
var_diag_errors_5:		.block 1			; DATA XREF: check_knock_sensor_err_flagr
								; sub_C91A+12r	...
								; 48.0 - Knock signal error
								; 48.1 -
								; 48.2 -
								; 48.3 - Sensor	error
								; 48.4 - Knock management error
								; 48.5 - Air-con switch	signal
								; 48.6 -
								; 48.7 -
								;
var_io_input1:			.block 1			; DATA XREF: sub_C59B+199r
								; sub_C59B+19Cr ...
								; 49.0 - Set if	STA signal high	(starter running)
								; 49.1 - Set if	IDL signal low (throttle closed)
								; 49.2 -
								; 49.3 -
								; 49.4 -
								; 49.5 - Set if	TE1 signal low (diagnostic check)
								; 49.6 - Set if	TE2 signal low (OBD stream enabled)
								; 49.7
var_io_input2:			.block 1			; DATA XREF: sub_C59B+D47r
								; sub_C59B+D57r ...
var_error_flags1:		.block 1			; DATA XREF: clear_nv_ram+Bw
								; sub_C59B+60Br ...
								; 4B.0 - STA signal error?
								; 4B.1 - G1 or G2 signal error
								; 4B.2 - Too many IGF signals not received error
								; 4B.3 - ECT sensor error
								; 4B.4 - THA sensor error
								; 4B.5 - PIM sensor error
								; 4B.6 -
								; 4B.7 -
var_error_flags2:		.block 1			; DATA XREF: clear_nv_ram+Dw
								; sub_C59B+968r ...
								; 4C.0 - Knock sensor error
								; 4C.1 - TPS error
								; 4C.2 -
								; 4C.3 - TRAC TPS error
								; 4C.4 - THAM sensor error
								; 4C.5 -
								; 4C.6 -
								; 4C.7 -
								;
var_flags_4D:			.block 1			; DATA XREF: sub_C59B+84Ar
								; sub_C59B+9AEr ...
								; 4D.0 -
								; 4D.1 -
								; 4D.2 -
								; 4D.3 - Using default PIM value
								; 4D.4 - Set on	too many IGF missing error
								; 4D.5 -
								; 4D.6 -
								; 4D.7 - Starter running during	ignition
var_flags_4E:			.block 1			; DATA XREF: sub_C59B+456w
								; sub_C59B+486r ...
								; 4E.0 -
								; 4E.1 - O2 sensor heater?
								; 4E.2 - ECT greater than 75c
								; 4E.3 -
								; 4E.4 -
								; 4E.5 -
								; 4E.6 -
								; 4E.7 - Boost limit exceeded error
var_flags_4F:			.block 1			; DATA XREF: sub_C59B+95Dw
								; sub_C59B+9B3r ...
								; 4F.0 -
								; 4F.1 -
								; 4F.2 -
								; 4F.3 -
								; 4F.4 -
								; 4F.5 -
								; 4F.6 -
								; 4F.7
var_pim_2:			.block 1			; DATA XREF: sub_C59B+61Er
								; check_boost_limit:loc_CCE3r ...
				.block 1
var_tps:			.block 1			; DATA XREF: transient_throttle_inject+Fr
								; sub_C59B+845r ...
				.block 1
var_tha:			.block 1			; DATA XREF: injector_cold_start:loc_CD50r
								; calc_iscv+Fr	...
var_tham:			.block 1			; DATA XREF: sub_E115+238r
								; ROM:FF50w
var_adc_battery:		.block 1			; DATA XREF: sub_C59B+785r
								; sub_C59B+B4Ar ...
var_ect:			.block 2			; DATA XREF: table_ect_pair_interpolater
								; table_ect_fixed4_interpolater ...
								; Engine coolant temperature
var_rpm_x_5p12:			.block 2			; DATA XREF: table_rA_pair_interpolate:table_rpm_pair_interpolater
								; sub_C59B:loc_C8B7w ...
								; Engine speed x 5.12
var_rpm_div_25:			.block 1			; DATA XREF: sub_C59B+321w
								; sub_C59B:loc_C93Dr ...
								; Engine speed / 25
unk_5C:				.block 1			; DATA XREF: sub_C91A+18w
								; sub_C59B+531r ...
var_speed_kph:			.block 1			; DATA XREF: sub_C59B+4B7r
								; sub_C59B+4CFr ...
								; Road speed in	Km/h
var_tps_delta:			.block 1			; DATA XREF: transient_throttle_injectr
								; sub_CE3Cr ...
var_adc_lambda:			.block 1			; DATA XREF: sub_C59B+95Fr
								; sub_C59B+9BEr ...
								; Lambda sensor	voltage	(signed	value)
unk_60:				.block 1			; DATA XREF: sub_C59B+110r
								; sub_C59B+35Er ...
unk_61:				.block 1			; DATA XREF: sub_C59B+BE0w
								; sub_D187r ...
unk_62:				.block 1			; DATA XREF: sub_C59B:loc_D026r
								; sub_C59B+AB0w ...
				.block 1
unk_64:				.block 1			; DATA XREF: sub_C59B+B73r
								; sub_C59B+B79r ...
				.block 1
				.block 1
unk_67:				.block 1			; DATA XREF: sub_C59B+B25r
								; sub_C59B:loc_D16Dr
unk_68:				.block 1			; DATA XREF: sub_C59B+655w
								; sub_C59B+65Er ...
var_cnt_69:			.block 1			; DATA XREF: sub_C59B+B29w
								; sub_C59B:loc_D108r ...
var_cnt_6A:			.block 1			; DATA XREF: sub_C59B:loc_D954w
								; ROM:DB3Ar
unk_6B:				.block 1			; DATA XREF: sub_C59B+10Ew
								; sub_C59B:loc_D22Ar ...
var_lambda_count_unk_6C:	.block 1			; DATA XREF: sub_C59B:loc_D28Fr
								; sub_C59B+CF6w ...
var_error_flags_6D:		.block 1			; DATA XREF: ROM:DF59r
								; ROM:DF5Dw ...
var_speed_limiter_cnt:		.block 1			; DATA XREF: check_speed_limiter+6r
								; check_speed_limiter:loc_CCC3w
var_kph_table:			.block 2			; DATA XREF: int_vector_4_kph+20r
								; int_vector_4_kph+25w	...
unk_71:				.block 1			; DATA XREF: int_vector_4_kph+14r
								; int_vector_4_kph+1Br	...
				.block 1
var_speed_kph_2:		.block 1			; DATA XREF: calc_speed_kph+15w
unk_74:				.block 1			; DATA XREF: sub_C59B+2F0w
								; sub_C59B+36Ar ...
				.block 1
unk_76:				.block 1			; DATA XREF: start_dma:loc_F8ABr
								; IV0+4r ...
unk_77:				.block 1			; DATA XREF: start_dma+65r
								; start_dma:loc_F8E7w ...
var_temp_w:			.block 1			; DATA XREF: map_2d_interpolate+3w
								; map_2d_interpolate+1Ar ...
var_temp_b:			.block 1			; DATA XREF: sub_C59B+670r
								; sub_C59B:loc_CC68r ...
unk_7A:				.block 1			; DATA XREF: map_2d_interpolate+14w
								; map_2d_interpolate+16r ...
unk_7B:				.block 1			; DATA XREF: map_2d_interpolate+27w
								; sub_C59B:loc_CFC9w ...
unk_7C:				.block 1			; DATA XREF: sub_E865+178w
								; sub_EA22+248w
serial_diag_address:		.block 2
serial_diag_mode:		.block 1			; DATA XREF: sub_C59B+D1o
var_diag_errors_1:		.block 1			; DATA XREF: sub_C59B:loc_C7E6o
								; clear_nv_ram+5o ...
								; 80.0 - RPM G1	or G2 signal
								; 80.1 - RPM NE	signal
								; 80.2 - IGT or	IGF signal
								; 80.3 - Coolant temperature sensor
								; 80.4 - Intake	air temperature	sensor
								; 80.5 - Turbo pressure	sensor
								; 80.6 - Speed sensor signal
								; 80.7 - RPM G1	or G2 signal
								;
				.block 1
var_diag_errors_2:		.block 1			; DATA XREF: ROM:DDECr
								; ROM:DF75o ...
								; 82.0 - Knock signal
								; 82.1 - Primary throttle position sensor
								; 82.2 - O2 Sensor
								; 82.3 - Secondary throttle position
								; 82.4 - Manifold air temperature sensor
								; 82.5 - O2 Sensor
								; 82.6 - Lean error
								; 82.7 - Chargecooler pump/level
								;
				.block 1
var_diag_errors_3:		.block 1			; DATA XREF: ROM:DDD4r
								; ROM:DF94r ...
								; 84.0 - Boost pressure
								; 84.1 -
								; 84.2 -
								; 84.3 -
								; 84.4 -
								; 84.5 -
								; 84.6 -
								; 84.7 -
unk_85:				.block 1			; DATA XREF: sub_C59B:loc_D064o
var_unk_knock_86:		.block 1			; DATA XREF: clear_nv_ram+22o
								; sub_C59B:loc_D0BAo ...
				.block 1
unk_88:				.block 1			; DATA XREF: sub_D1A1+29o
				.block 1
				.block 1
				.block 1
				.block 1
				.block 1
				.block 1
				.block 1
				.block 1
				.block 1
unk_92:				.block 1
unk_93:				.block 1
unk_94:				.block 1			; DATA XREF: clear_nv_ram+26o
								; sub_C59B+B9Eo
unk_95:				.block 1			; DATA XREF: sub_C59B+AD9o
var_trim_unk_96:		.block 1			; DATA XREF: clear_nv_ram+2Ew
								; sub_C59B+D00r ...
				.block 1
var_trim_unk_98:		.block 1			; DATA XREF: clear_nv_ram:loc_C841w
								; sub_C59B+1E6Er ...
				.block 1
var_nv_idle_trim:		.block 1			; DATA XREF: sub_C59B+165r
								; clear_nv_ram+3Ew ...
				.block 1
var_nv_valid:			.block 2			; DATA XREF: sub_C59B+237r
								; clear_nv_ramw ...
								; 5AA5 if data storage block valid
unk_9E:				.block 1			; DATA XREF: sub_C59B:loc_C7E9o
								; clear_nv_ram+43r ...
unk_9F:				.block 1			; DATA XREF: clear_nv_ram+4Aw
								; sub_C59B+1E36r ...
var_diag_errors_4:		.block 1			; DATA XREF: sub_C59B+D6o
								; sub_C59B+1A1r ...
								; A0.0 -
								; A0.1 -
								; A0.2 - Speed sensor error
								; A0.3 - Starter signal	error
								; A0.4 -
								; A0.5 -
								; A0.6 -
								; A0.7 -
var_ne_count:			.block 1			; DATA XREF: sub_EA22+37Er
								; ROM:EFB5r ...
								; NE counter
								; Bits 0-3: Counter 0->5, corresponds crank position
								; Bits 4-7: Counter 0->3, corresponds to cylinder
va_ne_count_2:			.block 1			; DATA XREF: sub_DD2A:loc_DD2Fr
								; ROM:EDD3r ...
								; Copy of var_ne_count
unk_A3:				.block 1			; DATA XREF: sub_EA22+4Aw
								; sub_EA22+6Fw	...
var_ign_timing_temp_A4:		.block 1			; DATA XREF: ignition_timing_calc+62w
								; ignition_timing_calc+69r ...
				.block 1
unk_A6:				.block 1			; DATA XREF: sub_C59B+13Bw
								; sub_EA22+443r ...
var_cnt_knock_signal:		.block 1			; DATA XREF: knock_mcu_update+4Fr
								; knock_mcu_update+54w	...
unk_A8:				.block 1			; DATA XREF: ROM:DFDFr
								; ROM:loc_DFF2w ...
unk_A9:				.block 1			; DATA XREF: sub_C59B+14Dw
								; ROM:loc_DFD4r ...
unk_AA:				.block 1			; DATA XREF: sub_C59B+113r
								; sub_E865+25r	...
unk_AB:				.block 1			; DATA XREF: sub_F7C7+9r
								; sub_F7C7:loc_F81Bw
unk_AC:				.block 1			; DATA XREF: sub_F7C7:loc_F7E9w
								; sub_F7C7:loc_F7FDw ...
var_revcnt_AD:			.block 1			; DATA XREF: sub_C59B:loc_C749w
								; sub_F7C7t ...
var_revcnt_sta:			.block 1			; DATA XREF: init_ne_on_start+7r
								; init_ne_on_start+19w
var_revcnt_AF:			.block 1			; DATA XREF: sub_C59B+45Bw
								; sub_C59B+46Cr ...
var_revcnt_B0:			.block 1
var_revcnt_B1:			.block 1			; DATA XREF: sub_C59B+E6r
								; sub_C59B:loc_C985r ...
var_revcnt_speed_update:	.block 1			; DATA XREF: sub_F7C7+6Dr
								; sub_F7C7+72w
var_revcnt_B3:			.block 1			; DATA XREF: sub_C59B+FDr
								; int_vector_4_kph+Fr ...
var_revcnt_B4:			.block 1			; DATA XREF: sub_C59B+13F5r
								; sub_C59B:loc_D998w
var_revcnt_B5:			.block 1			; DATA XREF: sub_C59B:loc_DA10r
								; sub_C59B:loc_DA17w
var_revcnt_B6:			.block 1			; DATA XREF: sub_C59B+100r
								; sub_C59B+503r ...
var_revcnt_B7:			.block 1			; DATA XREF: sub_C59B+103r
								; sub_C59B+508r ...
var_revcnt_B8:			.block 1			; DATA XREF: sub_C59B+442w
								; sub_C59B:loc_C9DFr
unk_B9:				.block 1			; DATA XREF: sub_C59B+451w
								; ROM:FE1Br
var_revcnt_starter:		.block 1			; DATA XREF: sub_C59B:loc_CD13w
								; sub_C59B+78Ar ...
var_revcnt_lambda:		.block 1			; DATA XREF: sub_C59B+963w
								; sub_C59B+96Er
var_revcnt_BC:			.block 1			; DATA XREF: check_boost_limit+11w
								; check_boost_limit+1Br
var_revcnt_BD:			.block 1			; DATA XREF: sub_EA22+E5w
								; sub_EA22+F1r
var_revcnt_BE:			.block 1			; DATA XREF: sub_C59B+226w
								; ROM:DF45r ...
var_revcnt_BF:			.block 1			; DATA XREF: sub_C59B+218w
								; ROM:DF35r
var_revstarter_cnt_C0:		.block 1			; DATA XREF: sub_C59B+22Bw
								; ROM:DF4Dr ...
var_revcnt_igf_timer:		.block 1			; DATA XREF: int_vector_9_ignition+4Bw
								; int_vector_9_ignition+55r
var_revcnt_ne_C2:		.block 1			; DATA XREF: sub_C59B+17C6w
								; ROM:EFB9r ...
								; Something to do with dwell
var_revcnt_C3:			.block 1			; DATA XREF: sub_C59B+763r
								; sub_C59B:loc_CD07w
var_revcnt_C4:			.block 1			; DATA XREF: sub_C59B+127r
								; start_dma+4Ar ...
var_revcnt_C5:			.block 1			; DATA XREF: sub_C59B+12Ar
								; start_dmar ...
var_cnt_C6:			.block 1			; DATA XREF: sub_F7C7+5Fw
								; sub_F7C7+63r
var_cnt_C7:			.block 1			; DATA XREF: sub_C59B+F0r
								; sub_C59B+2E9r ...
var_cnt_C8:			.block 1			; DATA XREF: sub_C59B:loc_D1FDr
								; sub_C59B+C67w
var_cnt_C9:			.block 1			; DATA XREF: sub_C59B:loc_DC8Fr
								; sub_C59B+1701w
var_cnt_CA:			.block 1			; DATA XREF: sub_C59B:loc_DCCDr
								; sub_C59B+1742w ...
var_cnt_CB:			.block 1			; DATA XREF: ROM:F644r
								; ROM:loc_F64Cw
var_cnt_CC:			.block 1			; DATA XREF: sub_F6C5:loc_F6E5w
								; sub_F6C5:loc_F6E7r
var_cnt_CD:			.block 1			; DATA XREF: sub_C59B+67Aw
								; sub_C59B+6A9r ...
var_cnt_CE:			.block 1			; DATA XREF: sub_C59B+53Cw
var_cnt_CF:			.block 1			; DATA XREF: sub_C59B:loc_CBBDw
								; sub_C59B:loc_CBC1r
var_cnt_startup:		.block 1			; DATA XREF: sub_C59B:loc_C967w
								; sub_C59B:loc_C9FAr ...
var_cnt_D1:			.block 1			; DATA XREF: sub_C59B+3BFw
var_cnt_D2:			.block 1			; DATA XREF: sub_C59B+980w
								; sub_EA22+283r
var_cnt_D3:			.block 1			; DATA XREF: sub_C59B:loc_CF1Ew
								; sub_C59B+992r ...
var_cnt_D4:			.block 1			; DATA XREF: sub_C59B+862r
								; sub_C59B+88Aw ...
var_cnt_D5:			.block 1			; DATA XREF: sub_C59B:loc_D228w
								; sub_C59B+CD1r
var_cnt_D6:			.block 1			; DATA XREF: sub_C59B+58Ew
								; sub_C59B+5DCr
var_cnt_D7:			.block 1			; DATA XREF: sub_C59B+E9r
								; sub_C59B+8E3w ...
var_cnt_D8:			.block 1			; DATA XREF: sub_EA22:loc_ED09w
								; sub_EA22:loc_ED6Er ...
var_cnt_D9:			.block 1			; DATA XREF: sub_EA22+C9w
								; sub_EA22+105r ...
var_cnt_DA:			.block 1			; DATA XREF: sub_EA22+128w
								; sub_EB57+5Aw	...
var_cnt_DB:			.block 1			; DATA XREF: sub_C59B:loc_D34Bw
								; calc_iscv+14Fr ...
var_cnt_DC:			.block 1			; DATA XREF: sub_C59B+D7Aw
								; calc_iscv:loc_D900r
var_cnt_DD:			.block 1			; DATA XREF: sub_C59B+DB5w
								; calc_iscv+170w ...
var_cnt_DE:			.block 1			; DATA XREF: calc_iscv+12Bw
								; calc_iscv:loc_D637w ...
var_cnt_sensor_error:		.block 1			; DATA XREF: adc_handler_pim+1Aw
								; adc_handler_pim:loc_FBA8r ...
unk_E0:				.block 1
var_cnt_E1:			.block 1			; DATA XREF: sub_C59B+70Cr
								; sub_C59B:loc_CCB3w
unk_E2:				.block 1			; DATA XREF: calc_iscv:loc_D784w
								; calc_iscv:loc_D791r
unk_E3:				.block 1			; DATA XREF: ROM:loc_F577w
unk_E4:				.block 1			; DATA XREF: ROM:loc_DA70w
								; ROM:DA75r
unk_E5:				.block 1			; DATA XREF: sub_C59B+1781w
								; sub_C59B:loc_DD1Er ...
unk_E6:				.block 1			; DATA XREF: ROM:loc_DEADw
								; ROM:loc_DEAFr
var_igt_time:			.block 1			; DATA XREF: check_IGF_error+3w
								; check_IGF_error+7r
								; Number of ticks since	last IGT/IGF
unk_E8:				.block 1			; DATA XREF: sub_C59B+1DD5r
								; sub_C59B+1DD8w
var_cnt_E9:			.block 1			; DATA XREF: sub_C59B:loc_D3B1w
								; sub_C59B+E3Fr ...
var_cnt_EA:			.block 1			; DATA XREF: sub_C59B+3CEw
								; calc_iscv:loc_D55Er ...
var_cnt_EB:			.block 1			; DATA XREF: sub_C59B:loc_CB45w
								; sub_C59B:loc_CB63w ...
var_cnt_EC:			.block 1			; DATA XREF: ROM:loc_DE08w
								; ROM:loc_DE0Ar
var_cnt_ED:			.block 1			; DATA XREF: ROM:DE22r
								; ROM:DE56w
var_cnt_EE:			.block 1			; DATA XREF: ROM:loc_DEE3w
								; ROM:loc_DEE5r
unk_EF:				.block 1			; DATA XREF: sub_C59B+C6Fw
								; ROM:FCF6w ...
var_ne_0:			.block 2			; DATA XREF: init_ne_counters+3o
								; ignition_timing_calc+21o ...
var_ne_1:			.block 2			; DATA XREF: ignition_timing_calc+3Ar
var_ne_2:			.block 2			; DATA XREF: ignition_timing_calc+3Cr
								; ignition_timing_calc+64r ...
var_ne_sum3:			.block 1			; DATA XREF: calc_rpmr
								; sub_C59B+1FFBo ...
unk_F7:				.block 1			; DATA XREF: sub_F263+5r
var_rpm_avg:			.block 1			; DATA XREF: sub_C59B+2F2w
								; sub_C91A+2r ...
				.block 1
unk_FA:				.block 1			; DATA XREF: adc_handler_pim+63w
								; adc_handler_pim+79r ...
var_gearing:			.block 1			; DATA XREF: sub_EA22+9Cr
								; sub_EA22+ECr	...
unk_FC:				.block 1			; DATA XREF: sub_C59B+20D7w
var_dac_command:		.block 1			; DATA XREF: sub_C59B+175w
								; int_watchdog+12w ...
var_adc_index:			.block 1			; DATA XREF: int_watchdog+4r
								; int_watchdog:loc_F7B4w ...
var_tps_2:			.block 1			; DATA XREF: ROM:loc_FDAAr
								; ROM:FE07w
unk_100:			.block 1			; DATA XREF: sub_E115:loc_E208o
unk_101:			.block 1			; DATA XREF: sub_C59B+FAw
								; sub_C996+10r	...
var_adc_o2_sensor:		.block 1			; DATA XREF: sub_E115+231r
								; adc_handler_o2_heater+15r ...
var_io_input1_tmp:		.block 1			; DATA XREF: check_io_inputs+2Co
var_io_input2_tmp:		.block 1			; DATA XREF: check_io_inputs+5Do
var_asr2_time:			.block 1			; DATA XREF: ignition_timing_calc+8w
								; ignition_timing_calc+187r ...
				.block 1
var_prev_asr2_time:		.block 1			; DATA XREF: ignition_timing_calc+2Ar
								; ignition_timing_calc:loc_F08Ew ...
				.block 1
unk_109:			.block 1			; DATA XREF: sub_E551+31r
								; sub_F375+26w
var_inj_pw_inj1:		.block 2			; DATA XREF: sub_C59B+586r
								; sub_C59B+5A2r ...
var_inj_pw_inj2:		.block 2			; DATA XREF: sub_C59B+1E8Cw
								; sub_C59B+21A1w
var_inj_pw_inj3:		.block 2			; DATA XREF: sub_C59B+1E8Fw
								; sub_C59B+21A4w
var_inj_pw_inj4:		.block 2			; DATA XREF: sub_C59B+1E92w
								; sub_C59B+21A7w ...
var_inj_pw_array:		.block 8			; DATA XREF: sub_C59B:loc_E6F6o
								; sub_C59B+21B2o ...
var_inj_battery_adjust:		.block 2			; DATA XREF: ROM:DDA6r
								; injector_drive+13r ...
								; Calculated injector dead-time	for battery voltage. In	4uS units.
var_fuel_enrich_rpm:		.block 1			; DATA XREF: sub_C59B+118w
								; sub_C59B+83Bw ...
unk_11D:			.block 1			; DATA XREF: sub_CE3C+10r
								; sub_CE3C+1Fw
unk_11E:			.block 1			; DATA XREF: sub_CE3C:loc_CE58w
unk_11F:			.block 1			; DATA XREF: sub_C59B:loc_CECAw
								; sub_C59B+93Ar ...
unk_120:			.block 1			; DATA XREF: sub_C59B+93Dw
								; sub_C59B+1F3Er
unk_121:			.block 1			; DATA XREF: sub_C59B+9E8o
								; sub_C59B+9EEw ...
				.block 1
unk_123:			.block 1			; DATA XREF: sub_C59B+A0Ew
								; sub_C59B:loc_CFBDo ...
unk_124:			.block 1			; DATA XREF: sub_C59B+A1Aw
unk_125:			.block 1			; DATA XREF: adc_handler_pim+46w
								; adc_handler_pim+4Er
				.block 1
unk_127:			.block 1			; DATA XREF: sub_C59B+C7Er
								; sub_C59B+211Fr ...
				.block 1
unk_129:			.block 1			; DATA XREF: sub_C59B+2235r
								; sub_E865+1Fw	...
				.block 1
var_unk_knock_12B:		.block 1			; DATA XREF: sub_E865+14w
								; sub_E865+3Fr	...
				.block 1
unk_12D:			.block 1			; DATA XREF: sub_E865+17w
								; sub_E865+85r	...
				.block 1
unk_12F:			.block 1			; DATA XREF: sub_E865+1Aw
								; sub_E865+2Cr	...
				.block 1
unk_131:			.block 1			; DATA XREF: sub_E551+10w
								; sub_C59B+208Fr ...
				.block 1
var_unk_knk_133:		.block 1			; DATA XREF: sub_C59B+2044r
								; sub_C59B+20A4r ...
				.block 1
var_unk_knk_135:		.block 1			; DATA XREF: sub_C59B+2059r
								; sub_C59B+2092r ...
				.block 1
unk_137:			.block 1			; DATA XREF: sub_E551+3w
								; knock_unk_E79E+Cr
unk_138:			.block 1			; DATA XREF: sub_E454+61w
								; sub_C59B+2111r
				.block 1
var_scaled_ve_tham:		.block 1			; DATA XREF: sub_E454r
								; sub_C59B+1F65w
				.block 1
unk_13C:			.block 1			; DATA XREF: sub_C59B+2242w
								; sub_E865+115r
unk_13D:			.block 1			; DATA XREF: sub_C59B:loc_E7FAw
								; sub_C59B+2272r ...
				.block 1
unk_13F:			.block 1			; DATA XREF: sub_C59B+227Cw
								; sub_E865+175r ...
				.block 1
unk_141:			.block 1			; DATA XREF: sub_C59B+2291w
								; sub_E865+170r ...
				.block 1
unk_143:			.block 1			; DATA XREF: sub_C59B:loc_E534w
								; sub_E539+8r
unk_144:			.block 1			; DATA XREF: sub_C59B+E83r
								; sub_E551+Ar ...
unk_145:			.block 1			; DATA XREF: sub_E551+7w
unk_146:			.block 1			; DATA XREF: sub_C59B:loc_E63Cw
								; ROM:loc_FDDBr
unk_147:			.block 1			; DATA XREF: sub_C59B:loc_D237r
								; sub_C59B+CC5r ...
unk_148:			.block 1			; DATA XREF: sub_C59B+108w
								; sub_C59B:loc_CA64r ...
var_unk_rpm_limit:		.block 1			; DATA XREF: sub_C59B:loc_CC1Br
								; sub_C59B:loc_CC2Aw ...
unk_14A:			.block 1			; DATA XREF: sub_C59B+695r
var_inj_active:			.block 1			; DATA XREF: ignition_timing_calc+26Fw
								; ignition_timing_calc+28Br ...
unk_14C:			.block 1			; DATA XREF: ignition_timing_calc+2A7r
								; sub_F375+36w
unk_14D:			.block 1			; DATA XREF: ignition_timing_calc+274w
								; ignition_timing_calc+2CAw ...
unk_14E:			.block 1			; DATA XREF: ignition_timing_calc:loc_F2D2r
								; ignition_timing_calc+2E9w ...
var_tps_raw:			.block 1			; DATA XREF: sub_E115+13r
								; sub_E115+217r ...
unk_150:			.block 1			; DATA XREF: sub_C996+9r
								; sub_C996+35r	...
				.block 1
unk_152:			.block 1			; DATA XREF: ROM:FD7Ar
								; ROM:FE39w ...
				.block 1
var_adc_unk_154:		.block 1			; DATA XREF: sub_E115+Cr
								; sub_E115+23Er ...
unk_155:			.block 1			; DATA XREF: sub_EA22:loc_EE5Fw
								; sub_EA22+52Cr
unk_156:			.block 1			; DATA XREF: sub_C59B+14Aw
								; sub_EA22:loc_EC4Dr ...
var_knock_unk_157:		.block 1			; DATA XREF: sub_EB57+3r
								; sub_EB57+79r	...
var_ign_timing_unk_158:		.block 1			; DATA XREF: sub_EA22+3A4w
								; sub_EA22+40Cr ...
unk_159:			.block 1			; DATA XREF: sub_EA22:loc_EF8Fw
								; sub_EA22:loc_EF95r ...
var_ign_timing_unk_15A:		.block 1			; DATA XREF: sub_C59B+136w
								; sub_EA22:loc_EEFEr ...
				.block 1
unk_15C:			.block 1			; DATA XREF: sub_EA22+440r
								; sub_EA22:loc_EE8Ew ...
var_min_ign_timing:		.block 1			; DATA XREF: sub_C59B+13Fw
								; sub_EB57:loc_EBEFw ...
unk_15E:			.block 1			; DATA XREF: sub_C59B+142w
								; sub_EA22+112w ...
unk_15F:			.block 1			; DATA XREF: sub_C59B+145w
								; sub_EB57+80w
unk_160:			.block 1			; DATA XREF: sub_EB57:loc_EBE2r
								; sub_EC1A+6w
unk_161:			.block 1			; DATA XREF: sub_EB57:loc_EB84w
								; sub_EB57:loc_EBB3r
unk_162:			.block 1			; DATA XREF: sub_EA22+12Aw
								; sub_EB57+57w	...
unk_163:			.block 1			; DATA XREF: sub_EB57:loc_EB70w
				.block 1
unk_165:			.block 1			; DATA XREF: sub_EB57+1Dr
								; sub_EB57+30w
				.block 1
unk_167:			.block 1			; DATA XREF: sub_EA22+12Fw
								; sub_EB57+2Aw	...
unk_168:			.block 1			; DATA XREF: sub_C59B+314w
								; sub_C59B+176Dw ...
var_ign_next_time:		.block 1			; DATA XREF: sub_F229w
								; sub_F240w ...
				.block 1
var_ign_timing_unk_16B:		.block 1			; DATA XREF: ignition_timing_calc+16Bw
								; ignition_timing_calc:loc_F1E7r ...
				.block 1
				.block 1
				.block 1
var_ign_timing_div_2:		.block 1			; DATA XREF: ignition_timing_calc+95w
								; ignition_timing_calc:loc_F11Er ...
var_ign_on_time_from_CPR0:	.block 1			; DATA XREF: ignition_update_off_time+9r
								; ignition_update_off_time+1Cr	...
				.block 1
var_ign_unk_172:		.block 1			; DATA XREF: sub_EA22+2Aw
								; ignition_update_off_time+12r	...
var_ign_unk_173:		.block 1			; DATA XREF: sub_EA22+21w
								; ignition_timing_calc+76r ...
				.block 1
var_ign_timing_unk_175:		.block 1			; DATA XREF: ignition_timing_calc+5Er
								; ignition_timing_calc:loc_F1A1w ...
				.block 1
				.block 1
unk_178:			.block 1			; DATA XREF: sub_ED12+2w
								; sub_EA22:loc_ED23r ...
unk_179:			.block 1			; DATA XREF: ROM:EDE3r
								; ROM:EE12w
				.block 1
unk_17B:			.block 1			; DATA XREF: sub_ED19+3w
								; sub_EA22+30Ao ...
				.block 1
unk_17D:			.block 1			; DATA XREF: sub_ED19+6w
				.block 1
unk_17F:			.block 1			; DATA XREF: sub_EA22+2E1w
								; sub_EA22+310o ...
				.block 1
unk_181:			.block 1			; DATA XREF: sub_EA22+2E4w
				.block 1
unk_183:			.block 1			; DATA XREF: ROM:DFD9r
								; ROM:E016w ...
				.block 1
unk_185:			.block 1			; DATA XREF: ROM:DE1Fr
								; ROM:loc_DE3Bw ...
var_adc_o2_heater:		.block 1			; DATA XREF: ROM:DDFDr
								; ROM:DE27r ...
								; Value	indicating O2 sensor heater current
unk_187:			.block 1			; DATA XREF: sub_C59B+151w
								; ROM:DDF5r ...
				.block 1
unk_189:			.block 1			; DATA XREF: ROM:EFBEr
								; ROM:loc_EFD9w
var_igf_counter:		.block 2			; DATA XREF: int_vector_9_ignition+28r
								; int_vector_9_ignition:igf_store_counterw
								; MSB is number	of IGF signals missing
								; LSB is number	of IGF signals missing when RPM	< 3000 and voltage > 8.9v
var_flags_18C:			.block 1			; DATA XREF: adc_handler_pim+5r
								; adc_handler_pim:loc_FBBFw ...
								; 18C.0	- PIM read error
								; 18C.1	- ECT read error
								; 18C.2	- THA read error
								; 18C.3	- TPS read error
								; 18C.4	-
								; 18C.5	-
								; 18C.6	-
								; 18C.7	-
								;
var_flags_18D:			.block 1			; DATA XREF: ROM:FF26r
								; ROM:loc_FF4Bw
								; 18D.0	- THAM read error
								; 18D.1	-
								; 18D.2	-
								; 18D.3	-
								; 18D.4	-
								; 18D.5	-
								; 18D.6	-
								; 18D.7	-
								;
var_idle_trim:			.block 1			; DATA XREF: sub_C59B+167w
								; clear_nv_ram+40w ...
var_iscv_startup_flare:		.block 1			; DATA XREF: calc_iscv:loc_D4EAr
								; calc_iscv:loc_D4F4w ...
				.block 1
var_iscv_unk_191:		.block 1			; DATA XREF: sub_D376+6w
								; calc_iscv+413r
var_iscv_pim_flare:		.block 1			; DATA XREF: calc_iscv+54w
								; calc_iscv+5Er ...
				.block 1
unk_194:			.block 1			; DATA XREF: sub_C59B+156w
								; sub_D4A1+Ar ...
var_iscv_unk_195:		.block 1			; DATA XREF: calc_iscv+126r
								; calc_iscv:loc_D5F6w ...
				.block 1
var_iscv_rpm_cmp_197:		.block 1			; DATA XREF: calc_iscv+13Cw
								; calc_iscv+157r ...
var_iscv_unk_198:		.block 1			; DATA XREF: drive_dout1+3r
								; sub_C59B:loc_D483w ...
				.block 1
unk_19A:			.block 1			; DATA XREF: calc_iscv+22Cr
								; calc_iscv+230w ...
var_iscv_unk_19B:		.block 1			; DATA XREF: sub_C59B+DC3w
								; calc_iscv+162r ...
				.block 1
var_iscv_19D:			.block 1			; DATA XREF: sub_C59B+EB5r
								; sub_C59B+EC6r ...
				.block 1
var_iscv_unk_19F:		.block 1			; DATA XREF: calc_iscv:loc_D891w
								; calc_iscv+422r
unk_1A0:			.block 1			; DATA XREF: calc_iscv:loc_D6A2w
								; calc_iscv+206r ...
unk_1A1:			.block 1			; DATA XREF: sub_C59B+15Cw
								; sub_C59B+DD6w ...
				.block 1
unk_1A3:			.block 1			; DATA XREF: calc_iscv+38Ar
								; calc_iscv:loc_D863w
				.block 1
unk_1A5:			.block 1			; DATA XREF: sub_C59B+2F4w
								; calc_iscv+34Er ...
				.block 1
unk_1A7:			.block 1			; DATA XREF: calc_iscv:loc_D5C9w
								; calc_iscv+1C6r
				.block 1
var_iscv_unk_1A9:		.block 1			; DATA XREF: calc_iscv:loc_D540r
								; calc_iscv:loc_D54Aw ...
				.block 1
var_iscv_unk_1AB:		.block 1			; DATA XREF: calc_iscv:loc_D565w
								; calc_iscv+10Dr ...
				.block 1
var_iscv_unk_1AD:		.block 1			; DATA XREF: calc_iscv+B0r
								; calc_iscv:loc_D59Bw ...
				.block 1
unk_1AF:			.block 1			; DATA XREF: sub_C59B+162w
				.block 1
				.block 1
				.block 1
var_knock_unk_1B3:		.block 1			; DATA XREF: ROM:F56Dr
								; ROM:loc_F59Dr ...
				.block 1
unk_1B5:			.block 1			; DATA XREF: ROM:F570w
								; ROM:F629r
				.block 1
var_knock_info:			.block 1			; DATA XREF: knock_mcu_update+2r
								; knock_mcu_update:loc_F526w ...
var_knock_unk_1B8:		.block 1			; DATA XREF: ROM:loc_F53Er
								; ROM:F544w ...
var_knock_unk_1B9:		.block 1			; DATA XREF: ROM:F565r
								; ROM:loc_F5BDr ...
var_knock_unk_1BA:		.block 1			; DATA XREF: ROM:F5ABr
								; ROM:F5B3r ...
var_knock_unk_1BB:		.block 1			; DATA XREF: ROM:F5C1r
								; ROM:F60Bw
var_knock_unk_1BC:		.block 1			; DATA XREF: ROM:F67Ar
								; ROM:F69Dr ...
unk_1BD:			.block 1			; DATA XREF: sub_C59B+1460w
								; sub_C59B+1491r ...
unk_1BE:			.block 1			; DATA XREF: sub_C59B+1409r
								; sub_C59B+1443r ...
				.block 1
unk_1C0:			.block 1			; DATA XREF: sub_C59B+1412r
								; sub_C59B:loc_D9F6w ...
				.block 1
unk_1C2:			.block 1			; DATA XREF: sub_DB79+3w
								; sub_DBA3:loc_DBB5r ...
				.block 1
unk_1C4:			.block 1			; DATA XREF: sub_C59B+1472w
								; ROM:DAC1r ...
				.block 1
unk_1C6:			.block 1			; DATA XREF: sub_C59B+11Ew
								; sub_DB92+Dw ...
				.block 1
unk_1C8:			.block 1			; DATA XREF: sub_C59B+124w
								; sub_DBA3:loc_DBDEr ...
				.block 1
unk_1CA:			.block 1			; DATA XREF: sub_E454+3Ew
								; sub_C59B+20F4r
var_adc_idle_unk_1CB:		.block 1			; DATA XREF: sub_E115+204r
								; adc_handler_unk_1CBw
var_adc_idle_unk_1CC:		.block 1			; DATA XREF: sub_E115+1FEr
								; adc_handler_unk_1CCw
var_adc_idle_unk_1CD:		.block 1			; DATA XREF: sub_E115+1F8r
								; adc_handler_unk_1CDw
var_adc_idle_unk_1CE:		.block 1			; DATA XREF: sub_E115+1F2r
								; adc_handler_unk_1CEw
unk_1CF:			.block 1			; DATA XREF: sub_C59B+1770r
								; sub_C59B+179Fw ...
unk_1D0:			.block 1			; DATA XREF: sub_C59B:loc_CDCAr
								; sub_C59B+C44w
unk_1D1:			.block 1			; DATA XREF: sub_C59B+B52r
								; sub_C59B+CD9r ...
unk_1D2:			.block 1			; DATA XREF: sub_EA22+2Dr
								; sub_EA22+8Cw
unk_1D3:			.block 1			; DATA XREF: sub_EA22+8Fr
								; sub_EBF3r ...
unk_1D4:			.block 1			; DATA XREF: sub_EA22+274r
								; sub_EA22+3FDw
unk_1D5:			.block 1			; DATA XREF: sub_C59B+497r
								; sub_C59B+772w ...
unk_1D6:			.block 1			; DATA XREF: sub_C59B+20BFr
								; sub_C59B+21C5w
unk_1D7:			.block 1			; DATA XREF: sub_C59B:loc_C9EEr
								; sub_C59B+488w ...
unk_1D8:			.block 1			; DATA XREF: sub_C59B+D42r
								; sub_C59B+13A1w
unk_1D9:			.block 1			; DATA XREF: sub_C59B:loc_CEF5r
								; sub_C59B+C49w ...
unk_1DA:			.block 1			; DATA XREF: sub_C59B+16E1r
								; sub_C59B+171Cw
unk_1DB:			.block 1			; DATA XREF: sub_C59B+171Fr
								; sub_C59B+1769w
unk_1DC:			.block 1			; DATA XREF: sub_C59B:loc_C873r
								; sub_C59B:loc_C880w ...
unk_1DD:			.block 1			; DATA XREF: sub_C59B+12Fw
								; sub_C59B+1D5r ...
var_dma_rx_buffer:		.block 22h			; DATA XREF: copy_dma_rx+3o
;Start of serial bux transmit buffer
dmatx_map:			.block 2			; DATA XREF: adc_handler_pim+A8w
dmatx_tps:			.block 2			; DATA XREF: ROM:FCFDw
								; ROM:FD8Cw
dmatx_ect:			.block 2			; DATA XREF: ROM:FFB2w
dmatx_unk_206:			.block 2			; DATA XREF: copy_dma_tx+26w
dmatx_pim:			.block 2			; DATA XREF: sub_C59B+91Dr
								; sub_C59B:loc_E627w ...
dmatx_tha:			.block 1			; DATA XREF: ROM:FF1Bw
dmatx_tham:			.block 1			; DATA XREF: ROM:FF52w
dmatx_battery:			.block 1			; DATA XREF: adc_handler_battery+2w
dmatx_trim_unk_20D:		.block 1			; DATA XREF: copy_dma_tx:loc_F929w
dmatx_cmd_startup_20E:		.block 1			; DATA XREF: copy_dma_tx+16w
dmatx_cnt_unk_20F:		.block 1			; DATA XREF: copy_dma_tx+1Bw
dmatx_trim_unk_210:		.block 1			; DATA XREF: copy_dma_tx:loc_F933w
dmatx_unk_211:			.block 1			; DATA XREF: copy_dma_tx+20w
dmatx_adc_lambda:		.block 1			; DATA XREF: adc_handler_o2_heater+38w
dmatx_knock_info:		.block 3			; DATA XREF: copy_dma_tx+2Cw
								; copy_dma_tx+32w
dmatx_unk_216:			.block 1			; DATA XREF: sub_EA22+49Er
								; ROM:F596r ...
dmatx_obd_inj:			.block 1			; DATA XREF: ROM:DDACw
dmatx_obd_ign:			.block 1			; DATA XREF: ignition_timing_calc+9Aw
								; ignition_timing_calc+13Dw
dmatx_obd_iscv:			.block 1			; DATA XREF: ROM:DDB5w
dmatx_trim:			.block 1			; DATA XREF: sub_C59B:loc_D17Fw
dmatx_knock_ign_retard:		.block 1			; DATA XREF: sub_EA22:loc_EEDBw
								; ignition_timing_calc+FAr
dmatx_unk_21C:			.block 2			; DATA XREF: copy_dma_tx+38w
dmatx_error_flags1:		.block 1			; DATA XREF: copy_dma_tx+3Dw
dmatx_error_flags2:		.block 1
dmatx_flags_46:			.block 1			; DATA XREF: copy_dma_tx+42w
dmatx_flags_1:			.block 1			; DATA XREF: copy_dma_tx:loc_F992w
dmatx_limiter_flags:		.block 1			; DATA XREF: copy_dma_tx+75w
unk_223:			.block 1			; DATA XREF: sub_E115+3Fw
								; sub_E115:loc_E172w
word_224:			.block 2			; DATA XREF: sub_E115+46w
								; sub_E115:loc_E183w ...
dmarx_unk_226:			.block 2			; DATA XREF: sub_C59B+13FFr
								; copy_dma_rxo
dmarx_word_228:			.block 2			; DATA XREF: sub_C59B+1404r
dmarx_word_22A:			.block 2			; DATA XREF: sub_C59B+141Br
								; sub_C59B+144Dr
dmarx_scaled_ve:		.block 2			; DATA XREF: sub_C59B:loc_E4EBr
dmarx_rpm_x_5p12:		.block 2			; DATA XREF: sub_E115+210r
dmarx_unk_230:			.block 1			; DATA XREF: sub_C59B+B42r
								; sub_C59B+13D1r ...
dmarx_unk_231:			.block 1			; DATA XREF: sub_C59B+B39r
								; sub_C59B+CB5r ...
dmarx_unk_232:			.block 1			; DATA XREF: sub_C59B+B3Cr
dmarx_unk_233:			.block 1			; DATA XREF: sub_C59B+B3Fr
								; sub_C59B+1F34r
dmarx_unk_234:			.block 1			; DATA XREF: sub_C59B+1F2Ar
dmarx_tham_enrich_unk:		.block 1			; DATA XREF: sub_C59B:loc_E4FAr
dmarx_unk_236:			.block 1			; DATA XREF: sub_C59B+B45r
								; sub_C59B+CB8r ...
dmarx_fuel_enrich:		.block 1			; DATA XREF: sub_C59B+866r
								; sub_E454+3r
				.block 1
dmarx_unk_239:			.block 1			; DATA XREF: sub_EA22+533r
dmarx_knock_unk_23A:		.block 1			; DATA XREF: ROM:F554r
								; ROM:F5DDr ...
dmarx_max_retard_23B_unk:	.block 1			; DATA XREF: sub_C59B+1F45r
dmarx_unk_23C:			.block 1			; DATA XREF: sub_EA22+400r
dmarx_ign_timing:		.block 1			; DATA XREF: sub_E865+BDr
dmarx_ign_timing_fallback1:	.block 1			; DATA XREF: sub_E865+C3r
dmarx_ign_timing_unk:		.block 1			; DATA XREF: sub_E865+5Cr
								; sub_E865+D3r
dmarx_unk_240:			.block 1			; DATA XREF: sub_E865+56r
								; sub_E865+D9r
dmarx_unk_241:			.block 1			; DATA XREF: sub_E84F+8r
dmarx_unk_242:			.block 1			; DATA XREF: sub_C59B+98Br
								; sub_C59B+C86r ...
dmarx_unk_243:			.block 1			; DATA XREF: sub_EA22:loc_EEC7r
damrx_unk_244:			.block 1			; DATA XREF: sub_E115+1EBr
dmarx_unk_245:			.block 1			; DATA XREF: sub_E115+1E4r
dmarx_ign_timing_unk_246:	.block 1			; DATA XREF: ignition_timing_calc+123r
dmarx_ign_timing_unk_247:	.block 1			; DATA XREF: sub_C59B+DAo
								; ignition_timing_calc+12Br
unk_248:			.block 0B7h
stack_top:			.block 1			; DATA XREF: watchdog_kick+2Do
								; watchdog_kick+32o
var_nv_tps:			.block 1			; DATA XREF: sub_C59B+23Co
								; sub_C59B:loc_C7F5r ...
				.block 1
unk_302:			.block 1			; DATA XREF: clear_nv_ram+55w
								; ROM:FEA2r ...
				.block 1
table_knock_info:		.block 3			; DATA XREF: sub_C59B:loc_C7DAo
								; clear_nv_ram+5Cw ...
								; Some kind of table that stores knock values
				.block 0F8h
; end of 'RAM'

				.org 08000h
; *************************************************
; Extended serial diagnostics
; *************************************************
serial_diag_extended:                
                        
; Flush any stale data in UART receive buffer
.diag_flush:
				ld      a, SIDR_SODR
				tbbs    bit7, SSD, .diag_flush          ; Loop back if SSD.7 set (data in receive buffer)
                        
; Send sync byte                        
				clrb    bit1, SSD                       ; Clear SSD.1 which sets parity bit to space (DIAG)
				ld      a, serial_diag_mode             ; Copy mode value...
				;clrb    bit1, PORTD_ASRIN
				st      a, SIDR_SODR                    ; ...to serial Tx buffer

				ld      y, #.diag_mode_table            ; Load table base for diag mode table
				sub     a, #0DAh                        ; Convert mode into index and...
				shl     a                               ; ...multiply by 2
				add     y, a                            ; Compute address in table
				ld      y, y + 00h                      ; Load jump address into y for selected mode

				ld      b, #10h                         ; Initialise loop counter (16 iterations)
				;setb    bit1, PORTD_ASRIN

; Wait for MSB of command/address to be received
.diag_msb_wait:
				tbbs    bit7, SSD, .diag_msb_found      ; Exit loop if SSD.7 set (data in receive buffer)
				dec     b                               ; Repeat for 14 iterations...
				bne     .diag_msb_wait                  ; ...loop back if more iterations
				ret					; Timed out waiting for data

; MSB of command/address received
.diag_msb_found:                                              
				tbbs    bit6, SSD, .diag_drop           ; Jump if SSD.6 (buffer overflow) set
				ld      a, SIDR_SODR                    ; Store MSB in A

; Wait for LSB of command/address to be received                        
.diag_lsb_wait:
				tbbs    bit7, SSD, .diag_lsb_found      ; Exit loop if SSD.7 set (data in receive buffer)
				dec     b                               ; Repeat for 14 iterations...
				bne     .diag_lsb_wait                  ; ...loop back if more iterations
				ret		                      	; Timed out waiting for data

; LSB of command/address received
.diag_lsb_found:        	tbbs    bit6, SSD, .diag_drop           ; Jump if SSD.6 (buffer overflow) set
				ld      b, SIDR_SODR                    ; Store LSB in B, 16 bit value now in D

				tbbs    bit0, SSD, .diag_command        ; Read Serial Status Register, jump if parity bit is set (command selection bit)
				jmp     y + 00h                         ; Not command, so jump to mode handler routine

; Handler for read 16 mode
.diag_data_read16_mode:
				mov     d, y                            ; Move address to Y
				ld      d, [y]                          ; Read 2 bytes and increment address                        

; Transmit word in D
.diag_tx_word:
				clrb    bit1, SSD                       ; Clear SSD.1 which sets parity bit to space (DIAG)
				st      a, SIDR_SODR                    ; Write 1st byte to serial Tx buffer
				div     d, #00h                         ; Wait for a bit...                        
				clrb    bit1, SSD                       ; Clear SSD.1 which sets parity bit to space (DIAG)
				st      b, SIDR_SODR                    ; Write 2nd byte to serial Tx buffer
				ret
				
; Handler for write 16 bits mode, address phase
.diag_addr_write16_mode:
				st      d, serial_diag_address          ; Store write address
				ld      #0DCh, serial_diag_mode         ; Move to data_write16 mode
				bra     .diag_tx_word                   ; Echo back address
                        
; Handler for write 16 bits mode, data phase
.diag_data_write16_mode:
				ld      y, serial_diag_address          ; Retrieve write address
				st      d, [y]                          ; Write 16 bit value in D, increment write address
				st      y, serial_diag_address          ; Store write address
				bra     .diag_tx_word                   ; Echo back address
                        
; Handler for write 8 bits mode, address phase
.diag_addr_write8_mode:
				st      d, serial_diag_address          ; Store write address
				ld      #0DEh, serial_diag_mode         ; Move to data_write8 mode    
				bra     .diag_tx_word                   ; Echo back address
                        
; Handler for write 16 bits mode, data phase
.diag_data_write8_mode:
				ld      y, serial_diag_address          ; Retrieve write address
				st      a, [y]                          ; Write 8 bit value in A, increment write address
				st      y, serial_diag_address          ; Store write address
				bra     .diag_tx_word                   ; Echo back address

; Command received, store and echo back              
.diag_command:
				cmp     b, #0DAh                        ; Check if command < 0DAh...
				bcs     .diag_drop                      ; Jump if it is, command is invalid
				cmp     b, #0DEh                        ; Check if command > 0DEh
				bgt     .diag_drop                      ; Jump if it is, command is invalid                                
				st      b, serial_diag_mode             ; Store new diagnostic mode                        
				bra     .diag_tx_word                   ; Echo back command  
                        
; Drop any data in buffer                        
.diag_drop:
				ld      a, SIDR_SODR
				tbbs    bit7, SSD, .diag_drop            ; Loop back if SSD.7 set (data in receive buffer)
				ret

.diag_mode_table:
				.dw     .diag_data_read16_mode          ; 0DAh
				.dw     .diag_addr_write16_mode         ; 0DBh
				.dw     .diag_data_write16_mode         ; 0DCh
				.dw     .diag_addr_write8_mode          ; 0DDh
				.dw     .diag_data_write8_mode          ; 0DEh

serial_diag_init:		ld	a, #0DAh
				st	a, serial_diag_mode
				jmp	init_ne_counters
				
; File Name   :	C:\Documents and Settings\js01.EUROPE\My Documents\Visual Studio 2008\Projects\ecu_conv\ecu_conv\D151803-9651.BIN
; Format      :	Binary file
; Base Address:	0000h Range: C000h - 10000h Loaded length: 4000h
; อออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออ

; Segment type:	Pure code
				;.segment ROM
				.org 0C000h
unk_C000:			.db  5Fh ; _			; DATA XREF: sub_E115+EEo
				.db  5Fh ; _
				.db  5Fh ; _

;  S U B	R O U T	I N E 


				; public IVf
IVf:								; CODE XREF: IVfj
								; DATA XREF: ROM:FFE2o	...
				bra	IVf			; IV2
								; IV3
								; IV5
								; IV7
								; IV8
								; IVa
								; IVb
								; IVd

; End of function IVf

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  00h
map_c006:			.dw 0200h			; DATA XREF: sub_E76D:loc_E787o
				.db 10h				; 17 columns
				.dw 0000h
				.db  0Ah			; 11 rows
				.db 043, 039, 030, 024,	022, 018, 018, 015, 014, 014, 013, 012,	012, 012, 012, 012, 012
				.db 076, 073, 069, 058,	047, 039, 033, 026, 022, 022, 021, 018,	018, 018, 018, 018, 018
				.db 091, 088, 088, 080,	074, 064, 053, 045, 039, 037, 034, 029,	029, 029, 029, 029, 029
				.db 093, 092, 091, 088,	086, 078, 071, 063, 056, 053, 049, 042,	042, 042, 042, 042, 042
				.db 094, 094, 094, 092,	091, 087, 082, 076, 070, 067, 062, 056,	056, 056, 056, 056, 056
				.db 094, 094, 095, 094,	094, 090, 087, 083, 079, 075, 073, 067,	067, 067, 067, 067, 067
				.db 096, 096, 096, 096,	095, 094, 093, 091, 090, 088, 086, 083,	083, 083, 083, 083, 083
				.db 097, 096, 096, 096,	096, 096, 095, 094, 094, 093, 092, 091,	091, 091, 091, 091, 091
				.db 097, 097, 097, 097,	097, 097, 096, 095, 095, 095, 095, 094,	094, 094, 094, 094, 094
				.db 097, 097, 097, 097,	097, 097, 097, 097, 097, 096, 097, 097,	097, 097, 097, 097, 097
				.db 097, 097, 097, 097,	097, 097, 097, 097, 097, 097, 097, 097,	097, 097, 097, 097, 097
map_c0c7:			.dw 0080h			; DATA XREF: sub_E76D+27o
				.db 02h				; 3 columns
				.dw 0225h
				.db 0Ah				; 11 rows
				.db 003, 017, 026
				.db 004, 019, 031
				.db 004, 020, 038
				.db 005, 021, 040
				.db 005, 022, 043
				.db 006, 023, 046
				.db 006, 025, 048
				.db 010, 034, 050
				.db 013, 032, 053
				.db 015, 038, 061
				.db 048, 062, 076
map_fuel_enrich_rpm:		.dw 0280h			; DATA XREF: sub_C59B+86Fo
				.db 05h				; 6 columns
				.dw 0100h
				.db 04h				; 5 rows
				.db 128, 128, 090, 090,	090, 090
				.db 128, 128, 077, 077,	077, 077
				.db 128, 128, 051, 051,	051, 051
				.db 128, 128, 051, 051,	051, 051
				.db 128, 128, 051, 051,	051, 051
table_C112:			.db  18h			; DATA XREF: sub_C59B:loc_E3B2o
								; (18h + 2) / 2	= 13 entries
				.dw 1067h
				.dw 205Ch
				.dw 2F4Bh
				.dw 3F3Bh
				.dw 4E35h
				.dw 5E29h
				.dw 6D1Eh
				.dw 7D17h
				.dw 8D0Fh
				.dw 9D0Eh
				.dw 0AD0Dh
				.dw 0BD0Ah
				.dw 0CD09h
table_C12D:			.db  02h			; DATA XREF: sub_C59B+1E21o
				.db  80h ; 
				.db  06h
				.db 0FFh
				.db  92h ; 
				.db  72h ; r
				.db  5Dh ; ]
				.db  4Fh ; O
				.db  44h ; D
				.db  3Ch ; <
table_C137:			.db  9Ch ; 			; DATA XREF: sub_C59B+1E28o
				.db  40h ; @
				.db 0FFh
				.db 0A0h ; 
				.db  40h ; @
table_battery_unk_C13C:		.db  46h ; F			; DATA XREF: sub_C59B+1E48o
				.db  10h
				.db 0A9h ; ฉ
				.db  94h ; 
table_inj_battery_adjust:	.db 53h, 80h			; DATA XREF: adc_handler_battery+14o
				.db 0A9h			; 6.48v	 =
				.db 4Eh				; 8.95v	 =
				.db 2Ah				; 11.44v =
				.db 1Eh				; 13.92v =
				.db 11h				; 16.40v =
table_ect_unk_C147:		.db  26h ; &			; DATA XREF: sub_CB0Bo
				.db 0C0h ; ภ
				.db  60h ; `
				.db  50h ; P
				.db  44h ; D
				.db  2Ah ; *
table_rpm_unk_C14D:		.db  60h ; `			; DATA XREF: sub_C59B+5D6o
				.db  80h ; 
				.db  0Fh
				.db  06h
				.db  06h
				.db  06h
				.db  06h
table_pim_unk_C154:		.db  01h			; DATA XREF: sub_E865+Ao
				.db  13h
				.db  0Bh
				.db  00h
				.db  07h
				.db  09h
				.db  13h
				.db  19h
				.db  20h
				.db  25h ; %
				.db  2Bh ; +
				.db  3Bh ; ;
				.db  4Eh ; N
				.db  69h ; i
				.db  80h ; 
table_C163:			.db  01h			; DATA XREF: sub_E865+CBo
				.db  00h
				.db  01h
				.db  1Ah
				.db  80h ; 
table_C168:			.db  00h			; DATA XREF: sub_C59B:loc_E7CDo
				.db  80h ; 
				.db  06h
				.db  47h ; G
				.db  47h ; G
				.db  49h ; I
				.db  56h ; V
				.db  30h ; 0
				.db  30h ; 0
				.db  30h ; 0
table_C172:			.db  00h			; DATA XREF: sub_C59B+223Ao
				.db  80h ; 
				.db  06h
				.db  42h ; B
				.db  42h ; B
				.db  57h ; W
				.db  43h ; C
				.db  45h ; E
				.db  45h ; E
				.db  45h ; E
table_C17C:			.db  1Fh			; DATA XREF: sub_C59B+2252o
				.db 0C0h ; ภ
				.db  30h ; 0
				.db  30h ; 0
				.db  64h ; d
				.db  3Fh ; ?
				.db  20h
				.db  06h
				.db  00h
unk_C185:			.db  1Fh			; DATA XREF: sub_C59B+2248o
				.db 0C0h ; ภ
				.db  00h
				.db  00h
				.db  00h
				.db  00h
				.db  00h
				.db  00h
				.db  00h
table_C18E:			.db  0Eh			; DATA XREF: sub_C59B:loc_E7FDo
				.db  1Fh
				.db  80h ; 
				.db  3Eh ; >
				.db  80h ; 
				.db  5Dh ; ]
				.db  60h ; `
				.db  7Ch ; |
				.db  40h ; @
				.db  9Ch ; 
				.db  28h ; (
				.db 0BCh ; ผ
				.db  14h
				.db 0DCh ; 
				.db  06h
				.db 0E8h ; ่
				.db  00h
table_C19F:			.db  0Eh			; DATA XREF: sub_C59B+227Fo
				.db  1Fh
				.db  6Ch ; l
				.db  3Eh ; >
				.db  6Ah ; j
				.db  5Dh ; ]
				.db  54h ; T
				.db  7Ch ; |
				.db  48h ; H
				.db  9Ch ; 
				.db  1Ch
				.db 0BCh ; ผ
				.db  12h
				.db 0DCh ; 
				.db  07h
				.db 0E8h ; ่
				.db  00h
table_C1B0:			.db  0Eh			; DATA XREF: sub_C59B+226Ao
				.db  1Fh
				.db  00h
				.db  3Eh ; >
				.db  00h
				.db  5Dh ; ]
				.db  00h
				.db  7Ch ; |
				.db  00h
				.db  9Ch ; 
				.db  00h
				.db 0BCh ; ผ
				.db  00h
				.db 0DCh ; 
				.db  00h
				.db 0E8h ; ่
				.db  00h
;2-D Map
table_C1C1:			.db 0Eh				; DATA XREF: sub_C59B+2287o
								; (0Eh + 2) / 2	= 8 entries
				.db 031, 000
				.db 062, 000
				.db 093, 000
				.db 124, 000
				.db 156, 000
				.db 188, 000
				.db 220, 000
				.db 232, 000
table_rpm_unk_C1D2:		.db 38h				; DATA XREF: sub_CD68+Co
				.db  60h ; `
				.db  7Dh ; }
				.db  7Dh ; }
				.db  7Dh ; }
				.db  7Dh ; }
;2-D Map
table_ect_unk_C1D8:		.db 06h				; DATA XREF: sub_CD68:loc_CD7Eo
								; (06h + 2) / 2	= 4 entries
				.db 038, 000
				.db 081, 000
				.db 134, 000
				.db 179, 000
table_rpm_unk_C1E1:		.db 18h				; DATA XREF: sub_C59B+618o
				.db 60h
				.db 66h
				.db 2Ah
				.db 28h
				.db 33h
table_rpm_unk_C1E7:		.db 38h				; DATA XREF: sub_C59B:loc_CC75o
				.db 50h
				.db  02h
				.db  03h
				.db  05h
				.db  09h
				.db  0Bh
				.db  1Ah


table_boost_limit:		.dw 0200h			; DATA XREF: check_boost_limito
								; Boost	cut lookup table
				.db 02h
				.db 0DAh, 0DAh,	0DAh		; FF on	TechTom	ECUs


table_boost_limit_time:		.dw 0200h			; DATA XREF: check_boost_limit:loc_CCE9o
								; Boost	cut time limit table
				.db 02h
				.db 62h, 62h, 62h


table_ect_inj_throttle_pump:	.db 02h				; DATA XREF: transient_throttle_inject+1Bo
				.db 51h, 26h
				.db 0E4h, 26h
table_tps_unk_C200:		.db 06h				; DATA XREF: sub_C59B+85Ao
				.db 29h, 7Ah
				.db 52h, 5Ch
				.db 7Bh, 3Dh
				.db 0A4h, 3Dh
table_rpm_unk_C209:		.db 08h				; DATA XREF: sub_C59B+928o
				.db 28h, 40h
				.db 3Ch, 73h
				.db 50h, 7Fh
				.db 64h, 7Fh
				.db 78h, 7Fh
table_rpm_unk_C214:		.db 12h				; DATA XREF: sub_C59B+934o
				.db 0Ah, 0FDh
				.db 14h, 0FDh
				.db 1Fh, 0FDh
				.db 29h, 0FDh
				.db 33h, 1Ah
				.db 3Dh, 00h
				.db 48h, 00h
				.db 52h, 00h
				.db 5Ch, 00h
				.db 66h, 00h
table_unk_c229:			.dw 0A05h, 0A05h		; DATA XREF: sub_C59B:loc_CF78o
								; sub_C59B+A4Bo
table_unk_C22D:			.dw 1A1Ah, 1A1Ah		; DATA XREF: sub_C59B+9CCo
table_rpm_unk_C231:		.db 2Bh, 16h			; DATA XREF: sub_C59B+9F8o
								; sub_C59B+A67o
				.db 10h, 40h, 41h, 61h
				.db 97h, 10h, 40h, 41h
				.db 61h, 6Ch
table_rpm_unk_C23D:		.db 2Bh, 16h			; DATA XREF: sub_C59B+A00o
				.db 10h, 40h, 41h
table_rpm_unk_C242:		.db 6Ch, 0A1h
				.db 10h, 40h, 41h, 56h
				.db  61h ; a
table_adc_unk_C249:		.db 09h, 09h, 06h, 10h		; DATA XREF: adc_handler_o2_heater+Eo
				.db 0Bh, 0FEh, 0FEh, 0FEh
				.db 0FEh, 0FEh
table_rpm_unk_C253:		.db 40h, 50h			; DATA XREF: sub_C59B+3E4o
				.db 7Ah, 7Ah, 7Ah, 31h
				.db 31h, 31h
table_unk_C25B:			.db 00h, 00h, 00h, 00h		; DATA XREF: sub_C59B+215Eo
table_unk_C25F:			.db 08h, 00h, 00h, 00h		; DATA XREF: sub_C59B+2164o
table_unk_C263:			.db  0Dh			; DATA XREF: sub_F375+16o
				.db  0Dh
				.db  0Dh
				.db  0Dh


table_battery_unk_C267:		.db 08h				; DATA XREF: sub_EA22:loc_EA2Do
				.db 80h, 0FFh
				.db 9Ah, 0D7h
				.db 0B3h, 0BBh
				.db 0CDh, 0AAh
				.db 0E6h, 8Fh


table_rpm_unk_C272:		.db 08h				; DATA XREF: sub_EA22+16o
				.db 0Ah, 0FFh
				.db 20h, 0CBh
				.db 3Ch, 0A1h
				.db 5Ah, 0A1h
				.db 0A0h, 7Eh


table_rpm_unk_C27D:		.db 04h				; DATA XREF: sub_EA22+24o
				.db 28h, 0FAh
				.db 50h, 7Dh
				.db 0A0h, 5Eh


table_unk_C284:			.db 0Eh				; DATA XREF: sub_EA22+242o
				.db 1Fh, 0ABh
				.db 3Eh, 9Eh
				.db 5Dh, 95h
				.db 7Ch, 80h
				.db 9Ch, 80h
				.db 0BCh, 80h
				.db 0D2h, 80h
				.db 0E4h, 80h


table_unk_C295:			.db 0Eh				; DATA XREF: sub_EA22+24Co
				.db 1Fh, 0ABh
				.db 3Eh, 9Eh
				.db 5Dh, 95h
				.db 7Ch, 80h
				.db 9Ch, 6Bh
				.db 0BCh, 6Fh
				.db 0D2h, 80h
				.db 0E4h, 80h


table_unk_C2A6:			.db 0Eh				; DATA XREF: sub_EA22:loc_EC8Ao
				.db 1Fh, 0ABh
				.db 3Eh, 9Eh
				.db 5Dh, 95h
				.db 7Ch, 80h
				.db 9Ch, 80h
				.db 0BCh, 80h
				.db 0D2h, 80h
				.db 0E4h, 80h
table_unk_C2B7:			.db 00h, 0C0h			; DATA XREF: sub_EA22+296o
				.db 33h
				.db 40h
				.db 48h
				.db 55h
				.db 73h
				.db 7Bh
				.db 88h
table_rpm_unk_C2C0:		.db 08h, 60h			; DATA XREF: sub_EA22+41Ao
				.db 05h, 56h, 56h, 6Bh
				.db 80h, 96h, 0CDh
table_unk_C2C9:			.db 05h, 11h, 05h, 11h		; DATA XREF: sub_EA22+422o
table_gearing_unk_C2CD:		.db 1Ah, 80h			; DATA XREF: sub_EA22+9Eo
				.db 0C8h, 0C8h,	0C8h, 0C8h
				.db 0C8h
table_knock_unk_C2D4:		.db 56h, 80h			; DATA XREF: sub_EB57+6o
				.db 00h, 0Ch, 2Ah, 40h
				.db 95h
table_unk_C2DB:			.db 00h, 80h			; DATA XREF: sub_EB57:loc_EBBCo
				.db 00h, 1Eh, 33h, 40h
				.db 40h
;2-D Table
table_C2E2:			.db 02h				; DATA XREF: sub_EC1Ao
								; (02h + 2) / 2	= 2 entries
				.dw 0D240h
				.dw 0E400h
table_gearing_unk_C2E7:		.db 1Ah, 80h			; DATA XREF: sub_EA22:loc_EB0Bo
				.db 06h, 0Ah, 19h, 25h,	25h
unk_C2EE:			.db  4Fh ; O			; DATA XREF: sub_EB57+6Co
				.db  40h ; @
				.db  80h ; 
				.db  00h
unk_C2F2:			.db  20h			; DATA XREF: sub_EA22+32o
				.db  40h ; @
				.db  29h ; )
				.db  3Ah ; :
				.db  4Dh ; M
;2-D Table
unk_C2F7:			.db  04h			; DATA XREF: sub_EA22+69o
								; (04h + 2) / 2	= 3 entries
				.db  28h ; (
				.db  44h ; D
				.db  50h ; P
				.db  44h ; D
				.db  78h ; x
				.db  44h ; D
table_C2FE:			.dw 0600h			; DATA XREF: calc_iscv:loc_D87Fo
				.db  04h
				.dw 0200h
				.db  04h
				.db 0D0h, 0D0h,	0D0h, 0D0h, 0D0h
				.db 0B6h, 6Ah, 64h, 5Fh, 79h
				.db 5Ah, 5Ah, 50h, 46h,	46h
				.db 50h, 50h, 50h, 46h,	31h
				.db 46h, 31h, 31h, 31h,	31h
table_rpm_c31d:			.db 50h, 30h			; DATA XREF: calc_iscv+454o
				.db 00h, 66h, 9Ah, 0CDh
;2-D Table
table_C323:			.db 12h				; DATA XREF: sub_D376o
								; (12h + 2) / 2	= 10 entries
				.db 038, 122
				.db 058, 095
				.db 081, 079
				.db 107, 072
				.db 134, 061
				.db 179, 051
				.db 210, 041
				.db 220, 022
				.db 225, 017
				.db 228, 000
;2-D Table
table_ect_idle_flare:		.db 0Ah				; DATA XREF: calc_iscv+5o
								; (0Ah + 2) / 2	= 6 entries
				.db 26h, 14h
				.db 3Ah, 14h
				.db 51h, 14h
				.db 86h, 14h
				.db 0DCh, 14h
				.db 0E8h, 1Ah
;2-D Table
table_tha_idle_flare:		.db 02h				; DATA XREF: calc_iscv+Co
								; (02h + 2) / 2	= 2 entries
				.db 0B3h, 0Ah
				.db 0D2h, 33h
table_unk_C34A:			.db  1Fh			; DATA XREF: calc_iscv:loc_D8C4o
				.db  0Ah
table_idle_pim:			.db 21h, 30h			; DATA XREF: calc_iscv+4Bo
				.db 00h, 26h, 26h, 26h
unk_C352:			.db  1Ah			; DATA XREF: calc_iscv+1C1o
				.db  20h
unk_C354:			.db  92h ; 			; DATA XREF: calc_iscv+1B9o
				.db  40h ; @
				.db  00h
table_iscv_rpm_C357:		.db 00h, 6Ah, 7Ah, 85h,	95h	; DATA XREF: calc_iscv+154o
				.db 0FFh, 83h, 81h, 80h, 7Fh
table_iscv_rpm_C361:		.db 7Dh, 6Ah, 7Ah, 85h,	95h	; DATA XREF: calc_iscv+1E7o
				.db 0FFh, 83h, 81h, 80h, 7Fh
				.db  7Dh ; }
unk_C36C:			.db  70h ; p			; DATA XREF: calc_iscv+D5o
				.db  90h ; 
unk_C36E:			.db 0A0h ; 			; DATA XREF: calc_iscv+E1o
				.db 0B0h ; ฐ
unk_C370:			.db  70h ; p			; DATA XREF: calc_iscv+E7o
				.db  90h ; 
unk_C372:			.db  10h			; DATA XREF: calc_iscv+A4o
				.db  00h
unk_C374:			.db  00h			; DATA XREF: calc_iscv+AAo
				.db  00h
table_C376:			.db  0Ch			; DATA XREF: sub_D4BCo
				.db  26h ; &
				.db 0F3h ; ๓
				.db  51h ; Q
				.db 0F1h ; ๑
				.db  6Bh ; k
				.db 0E8h ; ่
				.db  86h ; 
				.db 0D7h ; ื
				.db 0B3h ; ณ
				.db 0ACh ; ฌ
				.db 0D2h ; า
				.db  94h ; 
				.db 0E4h ; ไ
				.db  8Dh ; 
table_iscv_adc_1:		.db 73h, 60h, 19h, 27h,	33h, 3Bh
								; DATA XREF: calc_idle_batt1+2o
table_iscv_adc_2:		.db 73h, 60h, 36h, 33h,	31h, 2Ch
								; DATA XREF: calc_idle_batt2+2o
table_iscv_C391:		.db 00h, 08h, 10h, 20h		; DATA XREF: calc_iscv+112o
table_knock_C395:		.db 02h, 04h, 06h		; DATA XREF: ROM:F583t
table_C398:			.db  01h			; DATA XREF: ROM:F67Do
				.db  01h
				.db  02h
table_C39B:			.db 70h, 0C0h			; DATA XREF: ROM:loc_F6A3o
				.db 68h, 0C0h			; 2800,	4800
				.db 68h, 0B8h			; 2600,	4800
								; 2600,	4600
unk_C3A1:			.db 0E6h ; ๆ			; DATA XREF: sub_C59B:loc_D046o
				.db  00h
				.db  1Ah
				.db  00h
unk_C3A5:			.db 0E6h ; ๆ			; DATA XREF: sub_C59B+ACCo
				.db  1Ah
				.db 0E6h ; ๆ
				.db  1Ah
				.db 0E6h ; ๆ
				.db  1Ah
				.db 0E6h ; ๆ
				.db  1Ah
				.db 0E6h ; ๆ
				.db  1Ah
				.db 0E6h ; ๆ
				.db  1Ah
				.db 0E6h ; ๆ
				.db  1Ah
				.db 0E6h ; ๆ
				.db  1Ah
				.db 0AEh ; ฎ
				.db  52h ; R
unk_C3B7:			.db  80h ; 			; DATA XREF: sub_D2C5+2o
				.db  00h
unk_C3B9:			.db  75h ; u			; DATA XREF: sub_C59B:loc_E719o
				.db  30h ; 0
				.db  00h
				.db 0AFh ; ฏ
unk_C3BD:			.db  64h ; d			; DATA XREF: adc_handler_pim+98o
								; adc_handler_pim+B0o
				.db  37h ; 7
unk_C3BF:			.db  88h ; 			; DATA XREF: sub_EA22:loc_EDC1o
				.db  2Ah ; *
unk_C3C1:			.db  05h			; DATA XREF: sub_C59B:loc_DA45o
								; sub_DBA3+6Co
				.db  00h
				.db  00h
				.db  00h
unk_C3C5:			.db  78h ; x			; DATA XREF: sub_C59B+D7Eo
								; calc_iscv+2EAo ...
				.db  45h ; E
byte_C3C7:			.db 0E6h, 1Ah			; DATA XREF: adc_handler_pimo
								; FF
byte_C3C9:			.db 0FCh			; DATA XREF: ROM:adc_handler_thao
				.db  07h
byte_C3CB:			.db 0FCh			; DATA XREF: ROM:adc_handler_thamo
				.db  07h
byte_C3CD:			.db 0FCh			; DATA XREF: ROM:adc_handler_ecto
				.db  07h
				.db 0FBh
				.db  0Dh
				.db  31h ; 1
				.db  05h
byte_C3D3:			.db 0C3h, 14h			; DATA XREF: sub_C59B+25Do
								; ROM:FD58o
byte_C3D5:			.db 0C3h, 14h			; DATA XREF: ROM:loc_FEC4o

;  S U B	R O U T	I N E 


sub_C3D7:							; CODE XREF: sub_C59B+AD3p
								; sub_C59B+B87p ...
				dec	y
				cmp	b, y + 01h
				bgt	loc_C3EA

				ld	a, y + 01h
				bra	loc_C3E5

; End of function sub_C3D7


;  S U B	R O U T	I N E 


clamp_rD:							; CODE XREF: sub_E865+42p
								; sub_E865+88p
				cmp	d, y + 00h
				bgt	loc_C3EA

				inc	y

loc_C3E5:							; CODE XREF: sub_C3D7+7j
				inc	y
				cmp	d, y + 00h
				bcc	locret_C3ED


loc_C3EA:							; CODE XREF: sub_C3D7+3j
								; clamp_rD+2j
				ld	d, y + 00h
				setc

locret_C3ED:							; CODE XREF: clamp_rD+8j
				ret

; End of function clamp_rD


;  S U B	R O U T	I N E 


table_ect_pair_interpolate:					; CODE XREF: sub_CD68+19p
								; transient_throttle_inject+1Ep ...
				ld	a, var_ect
; End of function table_ect_pair_interpolate


;  S U B	R O U T	I N E 


table_rA_pair_interpolate:					; CODE XREF: sub_C59B+937p
								; calc_iscv+11p ...
				clr	b
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db 8Ch				; Skip next instruction
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

table_rpm_pair_interpolate:					; CODE XREF: sub_C59B+92Bp
								; sub_EA22+19p	...
				ld	d, var_rpm_x_5p12
; End of function table_rA_pair_interpolate


;  S U B	R O U T	I N E 

; ***********************************************************************
; Performs table lookup	with interpolation
;
; D = Lookup value (x).
; Y = Pointer to map.
;
; First	byte of	map is offset to last entry.
; Map consist of byte pairs (x,y).
; ***********************************************************************

table_pair_interpolate:						; CODE XREF: sub_C59B+85Fp
								; sub_E865+186p ...
				mov	d, x			; Store	A & B for use later
				ld	a, [y]			; Get offset to	last entry in map
				push	y			; Save Y on stack for later
				add	y, a			; Y = &Map[max]
				mov	x, d			; Restore A & B
				cmp	a, y + 00h		; Check	if A < Map[max]...
				bcs	loc_C400		; ...jump forward if so

				pull	x			; Clean	up stack
				bra	loc_C405		; A > Map[max],	so jump	forward	to clip	to max value

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C400:							; CODE XREF: table_pair_interpolate+7j
				pull	y			; Y = &Map[0]
				cmp	a, y + 00h		; If A >= Map[Y] then...
				bcc	loc_C40B		; ...keep searching map


loc_C405:							; CODE XREF: table_pair_interpolate+Aj
								; table_pair_interpolate+2Fj
				ld	a, y + 01h		; A < Map[0] or	A > Map[max] or	B = 0, so get appropriate min or max value in map
				clr	b			; Nothing to the right of the decimal place
				ret				; Finished

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C409:							; CODE XREF: table_pair_interpolate+19j
				inc	y
				inc	y			; Advance Y to next entry in map

loc_C40B:							; CODE XREF: table_pair_interpolate+Fj
				cmp	a, y + 02h		; Check	if A >=	Map[Y+2]...
				bcc	loc_C409		; ...jump back to move to next entry in	map

				ld	a, y + 02h		; Map[Y] <= A <	Map[Y+2]
				sub	a, y + 00h		; A = Map[Y+2] - Map[Y]
				push	a			; Save Map[Y+2]	- Map[Y] on stack
				mov	x, d			; Restore A & B
				sub	a, y + 00h		; A = A	- Map[Y]
				mov	s, x			; X now	points to Map[Y+2] - Map[Y] on the stack
				div	d, x + 00h		; B = (A * 256)	/ (Map[Y+2] - Map[Y])
				inc	s			; Clean	up stack
				ld	a, y + 03h		; A = Map[Y+3]
				sub	a, y + 01h		; A = Map[Y+3] - Map[Y+1]
				bcc	loc_C427		; Jump forward if Map[Y+1] <= Map[Y+2]

				neg	a			; A = Map[Y+1] - Map[Y+3]
				neg	b			; B = (A * 256)	/ (Map[Y] - Map[Y+2])
				beq	loc_C405		; If B is 0 then jump back to set A = Map[Y+1]

				inc	y
				inc	y			; Advance Y to next entry in map

loc_C427:							; CODE XREF: table_pair_interpolate+2Bj
				push	b			; Save B on stack
				mov	s, x			; X now	points to B
				mul	a, x + 00h		; A = (A * B) /	256
								; B = (A * B) &	0xFF
				add	a, y + 01h		; A = A	+ Map[Y+1]
				inc	s			; Clean	up stack
				ret				; Finished

; End of function table_pair_interpolate


;  S U B	R O U T	I N E 

; Attributes: noreturn

sub_C42F:							; CODE XREF: check_boost_limit+5p
								; check_boost_limit+18p
				shr	d
; End of function sub_C42F


;  S U B	R O U T	I N E 

; Attributes: noreturn

sub_C430:							; CODE XREF: sub_C59B+223Fp
								; sub_E865+Dp
				shr	d
				shr	d
				shr	d
				shr	d
; End of function sub_C430


;  S U B	R O U T	I N E 

; Attributes: noreturn thunk

sub_C434:							; CODE XREF: sub_C59B+1E24p
				bra	loc_C438

; End of function sub_C434

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				shl	d

;  S U B	R O U T	I N E 


sub_C437:							; CODE XREF: sub_E865+CEp
				shl	d

loc_C438:							; CODE XREF: sub_C434j
				bsr	sub_C476

				bra	sub_C459

; End of function sub_C437


;  S U B	R O U T	I N E 


table_ect_fixed4_interpolate:					; CODE XREF: sub_CB0B+3p
								; calc_iscv+1BCp
				ld	b, var_ect
; End of function table_ect_fixed4_interpolate


;  S U B	R O U T	I N E 


table_rB_fixed4_interpolate:					; CODE XREF: sub_EB57+71p
				ld	a, #04h
				bra	table_fixed_interpolate

; End of function table_rB_fixed4_interpolate


;  S U B	R O U T	I N E 


table_ect_fixed_32_interpolate:					; CODE XREF: sub_C59B+1E2Bp
								; sub_C59B+224Bp ...
				ld	b, var_ect
; End of function table_ect_fixed_32_interpolate


table_rB_fixed_32_interpolate:					; CODE XREF: sub_C59B+5D9p
								; sub_C59B+61Bp ...
				ld	a, #08h
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db 8Ch				; Skip next instruction

;  S U B	R O U T	I N E 


table_rB_fixed_16_interpolate:					; CODE XREF: sub_C59B+3E7p
								; sub_C59B+6DFp ...

; FUNCTION CHUNK AT C472 SIZE 00000004 BYTES

				ld	a, #10h
;Some kind of table lookup
;
;A = Number of entries in table?
;B = Input value

table_fixed_interpolate:					; CODE XREF: table_rB_fixed4_interpolate+2j
				sub	b, y + 00h		; B = B	- Table[Y]
				bcs	loc_C472		; Jump if now B	< 0

				push	a
				cmp	b, y + 01h		; Check	if B < Table[Y+1]...
				ble	loc_C454		; ...jump forward if so

				ld	b, y + 01h		; Clamp	B to Table[Y+1]

loc_C454:							; CODE XREF: table_rB_fixed_16_interpolate+9j
				mov	s, x
				mov	b, a
				mul	a, x + 00h
				inc	s
; End of function table_rB_fixed_16_interpolate


;  S U B	R O U T	I N E 


sub_C459:							; CODE XREF: sub_C437+3j
								; map_2d_interpolate+1Cp ...
				add	a, #02h
				add	y, a
; End of function sub_C459


;  S U B	R O U T	I N E 


sub_C45C:							; CODE XREF: map_2d_interpolate+2Dj
								; sub_D1A1+36p	...
				mov	b, a
				beq	loc_C46F

				push	b
				mov	s, x
				ld	a, y + 01h
				sub	a, y + 00h
				bcc	loc_C46C

				neg	a
				neg	b
				xch	b, x + 00h
				inc	y

loc_C46C:							; CODE XREF: sub_C45C+9j
				mul	a, x + 00h
				inc	s

loc_C46F:							; CODE XREF: sub_C45C+1j
				add	a, y + 00h
				ret

; End of function sub_C45C

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR table_rB_fixed_16_interpolate

loc_C472:							; CODE XREF: table_rB_fixed_16_interpolate+4j
				ld	a, y + 02h
				clr	b
				ret

; END OF FUNCTION CHUNK	FOR table_rB_fixed_16_interpolate

;  S U B	R O U T	I N E 


sub_C476:							; CODE XREF: sub_C437:loc_C438p
								; map_2d_interpolatep ...
				sub	d, y + 00h
				bcc	loc_C47C

				clr	a
				clr	b

loc_C47C:							; CODE XREF: sub_C476+2j
				cmp	a, y + 02h
				bcs	loc_C483

				ld	a, y + 02h
				clr	b

loc_C483:							; CODE XREF: sub_C476+8j
				inc	y
				ret

; End of function sub_C476


;  S U B	R O U T	I N E 


sub_C485:							; CODE XREF: sub_E76D+2Ap
				shr	d
; End of function sub_C485


;  S U B	R O U T	I N E 


d_div_16_map_2d_interpolate:					; CODE XREF: sub_C59B+877p
				shr	d
				shr	d
				shr	d
				shr	d
; End of function d_div_16_map_2d_interpolate


;  S U B	R O U T	I N E 


map_2d_interpolate:						; CODE XREF: calc_iscv+3B9p
								; sub_E76D+1Dp
				bsr	sub_C476

				push	x
				st	d, var_temp_w
				mov	y, d
				mov	d, x
				inc	y
				inc	y
				pull	d
				bsr	sub_C476

				push	b
				ld	b, x + 01h
				inc	b
				push	b
				mov	s, x
				mul	a, x + 00h
				st	y, unk_7A
				add	d, unk_7A
				mov	d, y
				push	y
				ld	d, var_temp_w
				bsr	sub_C459

				st	a, unk_7A
				pull	y
				pull	b
				add	y, b
				ld	d, var_temp_w
				bsr	sub_C459

				st	a, unk_7B
				ld	y, #unk_7A
				pull	b
				bra	sub_C45C

; End of function map_2d_interpolate


;  S U B	R O U T	I N E 


increment_counters:						; CODE XREF: sub_D187+Dp
								; sub_C59B+C53p ...
				ld	x, #0000h
				add	x, a

loc_C4BD:							; CODE XREF: increment_counters+Dj
				ld	a, x + 00h
				inc	a
				beq	loc_C4C4

				inc	x + 00h

loc_C4C4:							; CODE XREF: increment_counters+7j
				inc	x
				dec	b
				bne	loc_C4BD

				ret

; End of function increment_counters


;  S U B	R O U T	I N E 


divide_rD_128:							; CODE XREF: sub_E454+51p
				shr	d
; End of function divide_rD_128


;  S U B	R O U T	I N E 


divide_rD_64:							; CODE XREF: sub_CD68:loc_CD84p
								; calc_idle_batt1+8p ...
				shr	d
; End of function divide_rD_64


;  S U B	R O U T	I N E 


divide_rD_32:							; CODE XREF: sub_EA22+1Ep
				shr	d
; End of function divide_rD_32


;  S U B	R O U T	I N E 


divide_rD_16:							; CODE XREF: calc_rpm:loc_C8DCp
								; calc_iscv+1Cp ...
				shr	d
; End of function divide_rD_16


;  S U B	R O U T	I N E 


divide_rD_8:							; CODE XREF: sub_C59B+B17p
								; sub_D1A1:loc_D1B9p ...
				shr	d

divide_rD_4:
				shr	d

divide_rD_2:
				shr	d
				ret

; End of function divide_rD_8


;  S U B	R O U T	I N E 


divide_rD_16_signed:						; CODE XREF: sub_C59B+370p
				shra	a
				rorc	b

divide_rD_8_signed:
				shra	a
				rorc	b
; End of function divide_rD_16_signed


;  S U B	R O U T	I N E 


divide_rD_4_signed:						; CODE XREF: calc_iscv+355p
				shra	a
				rorc	b

divide_rD_2_signed:						; CODE XREF: adc_handler_pim+70p
				shra	a
				rorc	b
				ret

; End of function divide_rD_4_signed


;  S U B	R O U T	I N E 


divide_rD_128_saturate:						; CODE XREF: sub_C59B+31Ep
				shr	d
; End of function divide_rD_128_saturate


;  S U B	R O U T	I N E 


divide_rD_64_saturate:						; CODE XREF: sub_C996+Cp
								; sub_C59B+20D4p ...
				shr	d
; End of function divide_rD_64_saturate


;  S U B	R O U T	I N E 


divide_rD_32_saturate:						; CODE XREF: ROM:DDA9p
								; sub_E454+3Bp	...
				shr	d
; End of function divide_rD_32_saturate


;  S U B	R O U T	I N E 


divide_rD_16_saturate:						; CODE XREF: sub_C91A:loc_C928p
								; calc_iscv+C5p ...
				shr	d
; End of function divide_rD_16_saturate


;  S U B	R O U T	I N E 


divide_rD_8_saturate:						; CODE XREF: ROM:loc_EDEEp
								; ROM:EE0Bp
				shr	d
; End of function divide_rD_8_saturate


;  S U B	R O U T	I N E 


divide_rD_4_saturate:						; CODE XREF: ROM:DDB2p
								; sub_EA22+379p
				shr	d
; End of function divide_rD_4_saturate


;  S U B	R O U T	I N E 


divide_rD_2_saturate:						; CODE XREF: sub_EB57+22p
								; sub_EA22:loc_ECB5p ...
				shr	d
; End of function divide_rD_2_saturate


;  S U B	R O U T	I N E 


clamp_rD_FF:							; CODE XREF: sub_C59B+BBEp
				cmpz	a
				beq	locret_C4E6

				ld	b, #0FFh

locret_C4E6:							; CODE XREF: clamp_rD_FF+1j
				ret

; End of function clamp_rD_FF


;  S U B	R O U T	I N E 


set_knock_sensor_err_flag:					; CODE XREF: sub_DBA3+1Ap
								; sub_DC3D+Ap ...
				setb	bit0, var_diag_errors_5
; End of function set_knock_sensor_err_flag


;  S U B	R O U T	I N E 


check_knock_sensor_err_flag:					; CODE XREF: calc_iscv+F6p
								; sub_C59B+1F85p ...
				tbbc	bit0, var_diag_errors_5, locret_C4F0

; End of function check_knock_sensor_err_flag


;  S U B	R O U T	I N E 


negate_rD:							; CODE XREF: sub_C59B+BAFp
								; sub_C59B:loc_D409p ...
				neg	a
				neg	b
				subc	a, #00h

locret_C4F0:							; CODE XREF: check_knock_sensor_err_flagj
				ret

; End of function negate_rD


;  S U B	R O U T	I N E 


sub_C4F1:							; CODE XREF: sub_C59B+1F4Cp
								; sub_C59B+1F62p
				clr	a
				add	d, #0180h
; End of function sub_C4F1


;  S U B	R O U T	I N E 


sub_C4F5:							; CODE XREF: sub_E454+38p
								; sub_E454+5Ep
				bsr	mult_rDrX

				mov	y, d
				push	a
				mov	x, d
				shr	d
				and	a, #0FFh
				pull	a
				beq	loc_C504

				ld	d, #0FFFFh
				setc

loc_C504:							; CODE XREF: sub_C4F5+9j
				xch	a, b
				rorc	b
				ret

; End of function sub_C4F5


;  S U B	R O U T	I N E 

; Computes (rX * rD), MSW of result stored in rX and LSW in rY.
;
; Also the value in rD is rD*rX/100h.  It is clamped at	FFFFh when the product exceeds FFFFFFh

mult_rDrX:							; CODE XREF: sub_C4F5p
								; sub_C59B+1418p ...
				push	d
				push	x
				mov	s, x
				mul	a, x + 00h
				mov	d, y
				ld	a, x + 00h
				mul	a, x + 03h
				add	y, a
				st	b, x + 00h
				ld	a, x + 01h
				mul	a, x + 03h
				st	b, x + 03h
				xch	a, x + 02h
				mul	a, x + 01h
				add	b, x + 00h
				addc	a, #00h
				add	y, a
				clr	a
				add	b, x + 02h
				rolc	a
				add	y, a
				st	b, x + 02h
				st	y, x + 00h
				ld	a, x + 00h
				beq	loc_C534

				ld	d, #0FFFFh
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db 8Ch
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C534:							; CODE XREF: mult_rDrX+27j
				ld	d, x + 01h
				pull	x
				pull	y
				ret

; End of function mult_rDrX


;  S U B	R O U T	I N E 


sub_C539:							; CODE XREF: sub_E865+19Ap
				mov	x, d
				cmpb	a, #0F8h
				beq	loc_C542

				ld	d, #7FFFh
				ret

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C542:							; CODE XREF: sub_C539+3j
				shl	d
				shl	d
				shl	d
				shl	d
				shl	d
				mov	d, x
				mov	y, d
				mul	a, #20h
				add	x, a
				mov	x, d
				shr	d
				ret

; End of function sub_C539


;  S U B	R O U T	I N E 


mult_rBrX2:							; CODE XREF: sub_C59B+E86p
								; sub_C59B+1E51p ...
				bsr	mult_rBrX

				rolc	b
				rolc	a
				bcc	loc_C558

				ld	d, #0FFFFh

loc_C558:							; CODE XREF: mult_rBrX2+4j
				mov	d, x
				ret

; End of function mult_rBrX2


;  S U B	R O U T	I N E 


mult_rBrX:							; CODE XREF: mult_rBrX2p
								; sub_C59B+1E7Dp ...
				mov	b, a
; End of function mult_rBrX


;  S U B	R O U T	I N E 

; Compute (rA *	rX)/100h, result in rD and rX
; Used to scale	a variable by some fraction
;  80h = 50%, 40h = 25%, and so	on

mult_rArX:							; CODE XREF: sub_C56D+Ep
								; sub_C56D+1Ep	...
				push	x
				mov	s, x
				xch	a, x + 01h
				mul	a, x + 01h
				push	b
				xch	a, x + 01h
				mul	a, x + 00h
				mov	d, x
				pull	d
				pull	b
				add	x, b
				shl	a
				mov	x, d
				ret

; End of function mult_rArX


;  S U B	R O U T	I N E 


sub_C56D:							; CODE XREF: sub_C59B+204Fp
								; knock_unk_E79E+Fp
				push	b
				mov	x, d
				sub	d, y + 00h
				beq	loc_C598

				bcc	loc_C589

				neg	a
				neg	b
				subc	a, #00h
				mov	d, x
				pull	a
				bsr	mult_rArX

				cmp	d, #0000h
				bne	loc_C583

				inc	b

loc_C583:							; CODE XREF: sub_C56D+13j
				neg	a
				neg	b
				subc	a, #00h
				bra	loc_C593

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C589:							; CODE XREF: sub_C56D+6j
				mov	d, x
				pull	a
				bsr	mult_rArX

				cmp	d, #0000h
				bne	loc_C593

				inc	b

loc_C593:							; CODE XREF: sub_C56D+1Aj
								; sub_C56D+23j
				add	d, y + 00h
				st	d, y + 00h
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C598:							; CODE XREF: sub_C56D+4j
				inc	s
				mov	x, d
				ret

; End of function sub_C56D


;  S U B	R O U T	I N E 


sub_C59B:							; CODE XREF: sub_C59B+142Ep
								; sub_C59B+1458p ...

; FUNCTION CHUNK AT C667 SIZE 000001A1 BYTES
; FUNCTION CHUNK AT C873 SIZE 0000004D BYTES
; FUNCTION CHUNK AT C8EE SIZE 0000002C BYTES
; FUNCTION CHUNK AT C93D SIZE 00000059 BYTES
; FUNCTION CHUNK AT C9DA SIZE 00000126 BYTES
; FUNCTION CHUNK AT CB1E SIZE 00000175 BYTES
; FUNCTION CHUNK AT CC9C SIZE 0000001B BYTES
; FUNCTION CHUNK AT CCD1 SIZE 00000005 BYTES
; FUNCTION CHUNK AT CCFB SIZE 0000003A BYTES
; FUNCTION CHUNK AT CD66 SIZE 00000002 BYTES
; FUNCTION CHUNK AT CD8B SIZE 00000002 BYTES
; FUNCTION CHUNK AT CDB7 SIZE 00000002 BYTES
; FUNCTION CHUNK AT CDCA SIZE 0000005F BYTES
; FUNCTION CHUNK AT CE6C SIZE 00000240 BYTES
; FUNCTION CHUNK AT D0AF SIZE 000000D8 BYTES
; FUNCTION CHUNK AT D1DD SIZE 000000E8 BYTES
; FUNCTION CHUNK AT D2D2 SIZE 000000A4 BYTES
; FUNCTION CHUNK AT D380 SIZE 00000009 BYTES
; FUNCTION CHUNK AT D3A5 SIZE 000000E4 BYTES
; FUNCTION CHUNK AT D4C6 SIZE 00000003 BYTES
; FUNCTION CHUNK AT D931 SIZE 00000132 BYTES
; FUNCTION CHUNK AT DC77 SIZE 000000B3 BYTES
; FUNCTION CHUNK AT DD38 SIZE 0000001B BYTES
; FUNCTION CHUNK AT DD59 SIZE 00000010 BYTES
; FUNCTION CHUNK AT E112 SIZE 00000003 BYTES
; FUNCTION CHUNK AT E363 SIZE 000000D2 BYTES
; FUNCTION CHUNK AT E452 SIZE 00000002 BYTES
; FUNCTION CHUNK AT E4B9 SIZE 00000080 BYTES
; FUNCTION CHUNK AT E54E SIZE 00000003 BYTES
; FUNCTION CHUNK AT E587 SIZE 000001E0 BYTES
; FUNCTION CHUNK AT E7CD SIZE 00000065 BYTES
; FUNCTION CHUNK AT EA17 SIZE 0000000B BYTES

				ld	y, #0FFF8h
				push	d
				mov	x, d
				cmp	d, #0000h
				bne	loc_C5AA

				pull	x
				bra	loc_C601

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C5A8:							; CODE XREF: sub_C59B:loc_C5AAj
				dec	y
				shl	d

loc_C5AA:							; CODE XREF: sub_C59B+8j
				bpz	loc_C5A8

				inc	y
				shr	d
				mov	d, x
				pull	d
				cmp	d, #0000h
				beq	loc_C5FC

				bmi	loc_C5BB


loc_C5B7:							; CODE XREF: sub_C59B+1Ej
				inc	y
				shl	d
				bpz	loc_C5B7


loc_C5BB:							; CODE XREF: sub_C59B+1Aj
				push	y
				xch	x, y
				inc	a
				push	d
				push	y
				mov	s, x
				beq	loc_C5CD

				mov	y, d
				div	d, x + 02h
				st	b, x + 00h
				clr	b
				div	d, x + 02h
				st	b, x + 01h

loc_C5CD:							; CODE XREF: sub_C59B+26j
				mov	y, d
				dec	x + 02h
				div	d, x + 02h
				push	b
				clr	b
				div	d, x + 02h
				pull	a
				neg	x + 03h
				beq	loc_C5E8

				sub	d, x + 00h
				push	b
				mul	a, x + 03h
				mov	d, y
				pull	a
				mul	a, x + 03h
				add	y, a
				mov	y, d
				add	d, x + 00h

loc_C5E8:							; CODE XREF: sub_C59B+3Ej
				pull	x
				pull	x
				pull	y
				cmp	y, #0000h
				bpz	loc_C5F4


loc_C5F0:							; CODE XREF: sub_C59B+57j
				shr	d
				inc	y
				bmi	loc_C5F0


loc_C5F4:							; CODE XREF: sub_C59B+53j
								; sub_C59B+5Fj
				beq	loc_C601

				shl	d
				bcs	loc_C5FC

				dec	y
				bra	loc_C5F4

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C5FC:							; CODE XREF: sub_C59B+18j
								; sub_C59B+5Cj
				ld	d, #0FFFFh
				setc
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  41h ; A
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C601:							; CODE XREF: sub_C59B+Bj
								; sub_C59B:loc_C5F4j
				clrc
				ret

; End of function sub_C59B

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

				; public __RESET
__RESET:							; DATA XREF: ROM:FFFEo
				ld	#02h, OMODE		; ld #02h,$1Fh
				di
				ld	#18h, ASR0P		; ASR0 pos edge	counter	value MSB
				ld	#00h, unk_1D
				ld	#30h, ASR0NL		; ASR0 neg edge	counter	value LSB
				ld	#0F4h, ASR0N		; ASR0 neg edge	counter	value MSB
				ld	#0F9h, TIMER3		; Timer	LSB (bit0~bit2)
				ld	d, #81DEh		; Load address of inter-mcu serial receive buffer
				st	d, ASR2			; ASR2 edge counter value MSB
				ld	d, #9200h		; Load address of inter-mcu serial transmit buffer
				st	d, ASR3			; ASR3 edge counter value MSB
				ld	#0FCh, ASR1P		; ASR1 pos edge	counter	value MSB
				ld	#30h, SMRC_SIR		; Serial Master	Register Control
				ld	#0DDh, PORTA		; Port A Data Register
				clr	PORTAL			; Port A Latch
				ld	#0D9h, PORTB		; Port B Data Register
				clr	PBCS			; Port B Control Register
				ld	#03h, PORTD_ASRIN	; Port D Data Register / ASR Input Data
				ld	d, #0000000100000111b
				st	d, DDRA			; Port A i/o config
				ld	#0E3h, ASR0PL		; ASR0 pos edge	counter	value LSB
				ld	#3Fh, TAIT		; Timer	ASR Control
				ld	a, PORTD_ASRIN		; Port D Data Register / ASR Input Data
				and	a, #80h			; Get current state of ASR3...
				shr	a			; ...in	bit 6...
				shr	a			; ...in	bit 5...
				xor	a, TAIT			; Timer	ASR Control
				st	a, TAIT			; Timer	ASR Control
				ld	#00h, DOUT		; DOUT Data Register
				ld	#00h, DOM		; DOUT Control Register
				setb	bit2, SSD
				ld	a, SSD			; Serial Status	Data Register
				ld	a, SIDR_SODR		; Serial Input/Output Data Register
				clrb	bit3, SSD
				setb	bit1, SSD
				ld	#90h, SIDR_SODR		; Serial Input/Output Data Register
				clr	a
				clr	b
				st	d, IRQL			; Interrupt Request Flag MSB
				st	d, IMASK		; Interrupt Request Mask MSB
				setb	bit3, DOUT
				ld	s, #02FFh
				clr	a
; START	OF FUNCTION CHUNK FOR sub_C59B
				clr	b
				ld	y, #unk_40

loc_C66B:							; CODE XREF: sub_C59B+D4j
				st	a, [y]
				cmp	y, #serial_diag_mode
				ble	loc_C66B

				ld	y, #var_diag_errors_4

loc_C674:							; CODE XREF: sub_C59B+DDj
				st	d, [y]
				cmp	y, #dmarx_ign_timing_unk_247
				ble	loc_C674


loc_C67A:							; CODE XREF: watchdog_kick+43j
				jsr	serial_diag_init

				setb	bit0, var_flags_46
				setb	bit5, unk_40
				ld	#0FFh, var_revcnt_B1
				ld	#0FFh, var_cnt_D7
				setb	bit3, var_flags_42
				setb	bit2, var_flags_42
				ld	#0FFh, var_cnt_C7
				setb	bit6, var_flags_42
				ld	#00h, unk_41
				ld	a, #10h
				st	a, unk_101
				ld	#0FFh, var_revcnt_B3
				ld	#0FFh, var_revcnt_B6
				ld	#0FFh, var_revcnt_B7
				ld	a, #78h
				st	a, unk_148
				ld	d, #0080h
				st	d, unk_6B
				ld	#80h, unk_60
				ld	#0FFh, unk_AA
				ld	a, #80h
				st	a, var_fuel_enrich_rpm
				ld	d, #0CCCDh
				st	d, unk_1C6
				ld	d, #0000h
				st	d, unk_1C8
				ld	#0FEh, var_revcnt_C4
				ld	#0FEh, var_revcnt_C5
				ld	a, #0F4h
				st	a, unk_1DD
				setb	bit2, var_ignition_flags
				ld	a, #0FEh
				st	a, var_ign_timing_unk_15A
				ld	a, #0FFh
				st	a, unk_A6
				ld	a, #0FFh
				st	a, var_min_ign_timing
				st	a, unk_15E
				st	a, unk_15F
				ld	a, #80h
				st	a, unk_156
				dec	unk_A9
				ld	a, #0FFh
				st	a, unk_187
				ld	a, #0F3h
				st	a, unk_194
				ld	d, #08A4h
				st	d, unk_1A1
				ld	d, #0400h
				st	d, unk_1AF
				ld	a, var_nv_idle_trim
				st	a, var_idle_trim
				clr	a

loc_C706:
				clr	b
				st	d, IRQL			; Interrupt Request Flag MSB
				ld	d, #0008h
				st	d, IMASK		; Interrupt Request Mask MSB
				ei
				clr	a
				st	a, var_dac_command
				setb	bit1, SSD
				setc
				rolc	a
				st	a, SIDR_SODR		; Serial Input/Output Data Register

loc_C718:							; CODE XREF: sub_C59B:loc_C718j
				tbbc	bit1, var_flags_42, loc_C718 ; Wait initial ADC	reads to complete

				jsr	check_io_inputs		; Read inputs

				jsr	check_io_inputs		; Read inputs

				jsr	copy_dma_tx

				clr	a
				clr	b
				st	d, IRQL			; Interrupt Request Flag MSB
				ld	d, #0004h
				st	d, IMASK		; Interrupt Request Mask MSB
				ei
				jsr	start_dma

				jsr	copy_diag_errors_3_to_4

				tbbs	bit5, var_io_input1, loc_C742

				tbbc	bit6, var_io_input1, loc_C742

				setb	bit2, unk_40
				ld	a, var_diag_errors_4
				or	a, #0Ch
				st	a, var_diag_errors_4

loc_C742:							; CODE XREF: sub_C59B+199j
								; sub_C59B+19Cj
				nop
				nop
				nop
				clr	a
				clr	b
				st	d, IRQL			; Interrupt Request Flag MSB

loc_C749:							; CODE XREF: sub_C59B+2484j
				clr	var_revcnt_AD
				clr	PBCS			; Port B Control Register
				ld	d, #0107h
				st	d, DDRA			; Port A i/o config
				ld	s, #02FFh
				clrb	bit3, SSD
				ld	#30h, SMRC_SIR		; Serial Master	Register Control
				ld	#0F3h, DOM		; DOUT Control Register
				di
				ld	b, IMASKL		; Interrupt Request Mask LSB
				and	b, #0CEh
				or	b, #0CAh
				ld	a, #11h
				st	d, IMASK		; Interrupt Request Mask MSB
				ld	a, TAIT			; Timer	ASR Control
				and	a, #3Fh
				or	a, #1Fh
				st	a, TAIT			; Timer	ASR Control
				ld	a, unk_1DD
				and	a, #0F4h
				or	a, #74h
				st	a, unk_1DD
				st	a, ASR0N		; ASR0 neg edge	counter	value MSB
				ld	a, TIMER3		; Timer	LSB (bit0~bit2)
				and	a, #0F9h
				or	a, #79h
				st	a, TIMER3		; Timer	LSB (bit0~bit2)
				ei
				ld	#0E3h, ASR0PL		; ASR0 pos edge	counter	value LSB
				ld	#18h, ASR0P		; ASR0 pos edge	counter	value MSB
				ld	#0FCh, ASR1P		; ASR1 pos edge	counter	value MSB
				ld	#30h, ASR0NL		; ASR0 neg edge	counter	value LSB
				ld	#00h, unk_1D
				ld	d, #81DEh
				st	d, ASR2			; ASR2 edge counter value MSB
				ld	d, #9200h
				st	d, ASR3			; ASR3 edge counter value MSB
				tbbs	bit7, var_flags_46, loc_C7AD

				tbbc	bit0, unk_40, loc_C7AA

				tbbc	bit0, var_io_input1, loc_C7AA ;	Jump if	STA low	(starter not running)

				tbbs	bit1, var_io_input1, loc_C7AD


loc_C7AA:							; CODE XREF: sub_C59B+206j
								; sub_C59B+209j
				setb	bit2, SSD
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C7AD:							; CODE XREF: sub_C59B+203j
								; sub_C59B+20Cj
								; DATA XREF: ...
				clrb	bit2, SSD
				tbs	bit5, RAMST		; Built-in RAM status
				bne	loc_C7B9

				clr	var_revcnt_BF
				clrb	bit2, DOUT
				clrb	bit6, unk_44

loc_C7B9:							; CODE XREF: sub_C59B+216j
				tbbs	bit5, IRQLL, loc_C7BF	; Interrupt Request Flag LSB

				tbbc	bit5, PORTD_ASRIN, loc_C7C3 ; Port D Data Register / ASR Input Data


loc_C7BF:							; CODE XREF: sub_C59B:loc_C7B9j
				clrb	bit5, IRQLL
				clr	var_revcnt_BE

loc_C7C3:							; CODE XREF: sub_C59B+221j
				tbbc	bit0, var_io_input1, loc_C7C8 ;	Jump if	STA low	(starter not running)

				clr	var_revstarter_cnt_C0

loc_C7C8:							; CODE XREF: sub_C59B:loc_C7C3j
				tbbs	bit5, RAMST, loc_C7CE	; Built-in RAM status

				jmp	loc_C873

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C7CE:							; CODE XREF: sub_C59B:loc_C7C8j
				tbs	bit7, RAMST		; Check	if RAMST.7 set...
				beq	loc_C7FF		; ...jump forward to reset data	storage	block

				cmp	#5Ah, var_nv_valid	; Check	if $9C = 0x5A...
				bne	loc_C7FF		; ...if	not, data storage invalid, jump	to reset it

				ld	y, #var_nv_tps		; Check	two's complement pairs at 0x300 - 0x303

loc_C7DA:							; CODE XREF: sub_C59B+247j
				cmp	y, #table_knock_info	; Check	if reached end of block...
				bcc	loc_C7E6		; ...exit loop if so

				ld	d, [y]			; Load two's complement pair
				add	a, b			; Check	pair is	correct
				inc	a
				beq	loc_C7DA		; Loop back if pair is correct

				bra	loc_C7FF		; Jump to reset	data storage block

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C7E6:							; CODE XREF: sub_C59B+242j
				ld	y, #var_diag_errors_1	; Check	two's complement pairs at 0x80 - 0x9D

loc_C7E9:							; CODE XREF: sub_C59B+256j
				cmp	y, #unk_9E		; Check	if reached end of block...
				bcc	loc_C7F5		; ...exit loop if so

				ld	d, [y]			; Load two's complement pair
				add	a, b			; Check	if pair	is correct
				inc	a
				beq	loc_C7E9		; Loop back if pair is correct

				bra	loc_C7FF		; Jump to reset	data storage block

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C7F5:							; CODE XREF: sub_C59B+251j
				ld	b, var_nv_tps
				ld	y, #byte_C3D3
				jsr	y + 04h

				bcc	loc_C801


loc_C7FF:							; CODE XREF: sub_C59B+235j
								; sub_C59B+23Aj ...
				bsr	clear_nv_ram


loc_C801:							; CODE XREF: sub_C59B+262j
				tbbc	bit5, RAMST, loc_C806	; Built-in RAM status

				setb	bit0, var_flags_42	; Set trim valid flag

loc_C806:							; CODE XREF: sub_C59B:loc_C801j
				bra	loc_C873

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


clear_nv_ram:							; CODE XREF: sub_C59B:loc_C7FFp
								; sub_C59B:loc_D07Bp ...
				clr	var_nv_valid
				ld	d, #00FFh
				ld	y, #var_diag_errors_1
				st	d, [y]
				st	d, [y]
				st	d, [y]
				clr	var_error_flags1
				clr	var_error_flags2
				ld	a, var_diag_errors_4
				and	a, #0Ch
				st	a, var_diag_errors_4
				clrb	bit4, var_flags_4D	; Clear	IGT/IGF	flag
				clrb	bit3, var_diag_errors_5
				clrb	bit1, var_flags_4D
				clrb	bit4, var_diag_errors_5
				clrb	bit5, var_diag_errors_5
				ld	d, #807Fh
				ld	y, #var_unk_knock_86

loc_C82D:							; CODE XREF: clear_nv_ram+29j
				st	d, [y]
				cmp	y, #unk_94
				ble	loc_C82D

				ld	d, #00FFh
				st	d, var_trim_unk_96
				ld	d, #619Eh
				tbbs	bit0, unk_40, loc_C841

				ld	d, #50AFh

loc_C841:							; CODE XREF: clear_nv_ram+33j
				st	d, var_trim_unk_98
				ld	d, #6699h		; 99h =	66h ^ 0FFh
				st	d, var_nv_idle_trim
				st	a, var_idle_trim
				ld	a, unk_9E
				or	a, #01h
				st	a, unk_9E
				clr	a
				st	a, unk_9F
				ld	d, #0AE51h
				st	d, var_nv_tps
				ld	d, #0AE51h
				st	d, unk_302
				di
				ld	d, #9A9Ah
				st	d, table_knock_info
				st	a, table_knock_info+2
				ei
				ld	d, #5AA5h
				st	d, var_nv_valid
				clrb	bit0, var_flags_42	; Clear	trim valid flag
				ret

; End of function clear_nv_ram

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_C873:							; CODE XREF: sub_C59B+230j
								; sub_C59B:loc_C806j
				ld	a, unk_1DC
				tbs	bit0, unk_41
				bne	loc_C87E

				or	a, #01h
				bra	loc_C880

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C87E:							; CODE XREF: sub_C59B+2DDj
				and	a, #0FEh

loc_C880:							; CODE XREF: sub_C59B+2E1j
				st	a, unk_1DC
				di
				cmp	#3Dh, var_cnt_C7
				bcs	loc_C8B4

				clr	a
				clr	b
				st	d, unk_74
				st	d, var_rpm_avg
				st	d, unk_1A5
				jsr	init_ne_counters

				clrb	bit0, DOUT
				ld	d, #0002h
				add	d, TIMER		; Timer	MSB (bit11~bit18)
				st	d, CPR0			; Timer	comparison #0 MSB
				clrb	bit4, DOUT
				clrb	bit5, DOUT
				clrb	bit6, DOUT
				clrb	bit7, DOUT
				clr	PORTAL			; Port A Latch
				clrb	bit4, var_limiter_flags
				clrb	bit5, unk_44
				ei
				clr	a
				clr	b
				st	a, unk_168
				bra	loc_C8B7

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C8B4:							; CODE XREF: sub_C59B+2ECj
				ei
				bsr	calc_rpm


loc_C8B7:							; CODE XREF: sub_C59B+317j
				st	d, var_rpm_x_5p12
				jsr	divide_rD_128_saturate

				st	b, var_rpm_div_25
				bra	loc_C8EE

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


calc_rpm:							; CODE XREF: sub_C59B+31Ap
								; sub_EB57+16p
				ld	d, var_ne_sum3
				cmp	a, #03h
				bcc	loc_C8C9

				ld	d, #0300h

loc_C8C9:							; CODE XREF: calc_rpm+4j
								; DATA XREF: calc_rpm+1Fo
				ld	x, #divide_rD_64

loc_C8CC:							; CODE XREF: calc_rpm+11j
				cmpz	a
				bmi	loc_C8DC

				inc	x
				shl	d
				bra	loc_C8CC

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db 0A4h, 84h, 6Ah, 55h, 43h, 34h, 27h,	1Ch, 12h
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C8DC:							; CODE XREF: calc_rpm+Dj
				jsr	divide_rD_16

				ld	y, #loc_C8C9
				push	x
				jsr	sub_C459

				shr	d
				add	a, #40h
				pull	x
				jsr	x + 00h

				shl	d
				ret

; End of function calc_rpm

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_C8EE:							; CODE XREF: sub_C59B+323j
				ld	a, unk_1DC
				cmpb	a, #01h
				bne	loc_C8F7

				bra	loc_C918

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C8F7:							; CODE XREF: sub_C59B+358j
				ld	d, var_rpm_x_5p12
				ld	x, unk_60
				bpz	loc_C916

				cmp	a, #09h
				bcs	loc_C916

				cmp	a, #19h
				bcc	loc_C916

				sub	d, unk_74
				beq	loc_C918

				rorc	a
				rorc	b
				jsr	divide_rD_16_signed

				cmp	d, #0000h
				bne	loc_C914

				inc	b

loc_C914:							; CODE XREF: sub_C59B+376j
				add	d, unk_74

loc_C916:							; CODE XREF: sub_C59B+360j
								; sub_C59B+364j ...
				st	d, unk_74

loc_C918:							; CODE XREF: sub_C59B+35Aj
								; sub_C59B+36Cj
				bra	loc_C93D

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_C91A:							; CODE XREF: sub_C59B+C56p
				clrb	bit0, var_diag_errors_5
				ld	d, var_rpm_avg
				sub	d, var_rpm_x_5p12
				bcc	loc_C928

				setb	bit0, var_diag_errors_5
				neg	a
				neg	b
				subc	a, #00h

loc_C928:							; CODE XREF: sub_C91A+6j
				jsr	divide_rD_16_saturate

				shr	b
				tbbc	bit0, var_diag_errors_5, loc_C930

				neg	b

loc_C930:							; CODE XREF: sub_C91A+12j
				add	b, #80h
				st	b, unk_5C
				ld	d, var_rpm_x_5p12
				add	d, var_rpm_avg
				rorc	a
				rorc	b
				st	d, var_rpm_avg
				ret

; End of function sub_C91A

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_C93D:							; CODE XREF: sub_C59B:loc_C918j
				ld	a, var_rpm_div_25
				cmp	a, #08h
				bcc	loc_C945

				setb	bit0, var_flags_46

loc_C945:							; CODE XREF: sub_C59B+3A6j
				cmp	a, #10h
				bcs	loc_C94B

				clrb	bit0, var_flags_46

loc_C94B:							; CODE XREF: sub_C59B+3ACj
				cmp	a, #0Ch
				bcc	loc_C951

				setb	bit5, unk_40

loc_C951:							; CODE XREF: sub_C59B+3B2j
				cmp	a, #14h
				bcs	loc_C957

				clrb	bit5, unk_40

loc_C957:							; CODE XREF: sub_C59B+3B8j
				tbbc	bit0, var_flags_46, loc_C95C

				clr	var_cnt_D1

loc_C95C:							; CODE XREF: sub_C59B:loc_C957j
				cmp	a, #08h
				bcs	loc_C967

				tbbs	bit5, unk_44, loc_C96B

				cmp	a, #10h
				bcc	loc_C96B


loc_C967:							; CODE XREF: sub_C59B+3C3j
				clr	var_cnt_startup
				clr	var_cnt_EA

loc_C96B:							; CODE XREF: sub_C59B+3C5j
								; sub_C59B+3CAj
				tbbc	bit2, var_flags_46, loc_C971

				setb	bit0, unk_44
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C971:							; CODE XREF: sub_C59B:loc_C96Bj
				clrb	bit0, unk_44
				tbbc	bit1, var_io_input1, loc_C990 ;	Jump if	not idle

				ld	a, #18h
				cmp	#92h, var_ect		; 25 deg
				bcs	loc_C985

				ld	b, var_rpm_div_25
				ld	y, #table_rpm_unk_C253
				jsr	table_rB_fixed_16_interpolate


loc_C985:							; CODE XREF: sub_C59B+3E0j
				cmp	a, var_revcnt_B1
				bgt	loc_C992

				setb	bit2, var_flags_46
				ld	#0FEh, var_revcnt_B1
				bra	loc_C994

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C990:							; CODE XREF: sub_C59B+3D8j
				clr	var_revcnt_B1

loc_C992:							; CODE XREF: sub_C59B+3ECj
				clrb	bit2, var_flags_46

loc_C994:							; CODE XREF: sub_C59B+3F3j
				bra	loc_C9DA

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_C996:							; CODE XREF: ROM:FE09p
				tbbc	bit1, var_io_input1, loc_C9BD

				tbbs	bit4, unk_47, loc_C9BF

				tbbs	bit7, unk_40, loc_C9BA

				ld	d, unk_150
				jsr	divide_rD_64_saturate

				mov	b, a
				ld	b, unk_101
				sub	a, b
				ble	loc_C9AE

				inc	b
				dec	a

loc_C9AE:							; CODE XREF: sub_C996+14j
				rorc	a
				shra	a
				add	a, b
				cmp	a, #10h
				ble	loc_C9B7

				ld	a, #10h

loc_C9B7:							; CODE XREF: sub_C996+1Dj
				st	a, unk_101

loc_C9BA:							; CODE XREF: sub_C996+6j
				setb	bit4, unk_47
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C9BD:							; CODE XREF: sub_C996j
				clrb	bit4, unk_47

loc_C9BF:							; CODE XREF: sub_C996+3j
				ld	b, unk_101
				shr	b
				cmp	b, #04h
				bcc	loc_C9C9

				ld	b, #04h

loc_C9C9:							; CODE XREF: sub_C996+2Fj
				shr	b
				shr	b
				cmp	b, unk_150
				bgt	loc_C9D7

				tbs	bit4, unk_40
				beq	locret_C9D9

				clr	var_revcnt_B1
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C9D7:							; CODE XREF: sub_C996+38j
				clrb	bit4, unk_40

locret_C9D9:							; CODE XREF: sub_C996+3Cj
				ret

; End of function sub_C996

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_C9DA:							; CODE XREF: sub_C59B:loc_C994j
				tbbs	bit2, var_io_input1, loc_C9DF

				clr	var_revcnt_B8

loc_C9DF:							; CODE XREF: sub_C59B:loc_C9DAj
				cmp	#31h, var_revcnt_B8
				bcs	loc_C9E7

				setb	bit6, var_ignition_flags
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C9E7:							; CODE XREF: sub_C59B+447j
				clrb	bit6, var_ignition_flags
				tbbs	bit6, var_ignition_flags, loc_C9EE

				clr	unk_B9

loc_C9EE:							; CODE XREF: sub_C59B+44Ej
				ld	a, unk_1D7
				st	a, var_flags_4E
				tbbs	bit3, var_io_input1, loc_C9FA

				clr	var_revcnt_AF
				bra	loc_C9FF

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_C9FA:							; CODE XREF: sub_C59B+458j
				cmp	#5Ch, var_cnt_startup
				bcc	loc_CA04


loc_C9FF:							; CODE XREF: sub_C59B+45Dj
				tbbc	bit6, var_flags_46, loc_CA1B

				bra	loc_CA11

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CA04:							; CODE XREF: sub_C59B+462j
				tbbs	bit6, var_flags_46, loc_CA19

				cmp	#31h, var_revcnt_AF
				bcs	loc_CA1B

				cmp	#5Ch, var_cnt_startup
				bcs	loc_CA1B


loc_CA11:							; CODE XREF: sub_C59B+467j
				tbs	bit6, var_flags_46
				beq	loc_CA17

				clrb	bit6, var_flags_46

loc_CA17:							; CODE XREF: sub_C59B+478j
				setb	bit7, var_flags_4E

loc_CA19:							; CODE XREF: sub_C59B:loc_CA04j
				clr	var_revcnt_AF

loc_CA1B:							; CODE XREF: sub_C59B:loc_C9FFj
								; sub_C59B+46Fj ...
				clrb	bit6, unk_40
				setb	bit6, var_flags_42
				clrb	bit1, var_flags_4E
				ld	a, var_flags_4E
				st	a, unk_1D7
				jsr	sub_E454

				jsr	sub_E551

				jsr	loc_FC38

				jsr	sub_D2C5

				ld	a, unk_1D5
				st	a, var_flags_4E
				tbbc	bit0, var_limiter_flags, loc_CA3D

				setb	bit3, unk_44
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CA3D:							; CODE XREF: sub_C59B+49Cj
				clrb	bit3, unk_44
				clrb	bit5, var_flags_4E
				clrb	bit0, var_flags_4E
				ld	b, #0Ch
				cmp	#5Ch, var_cnt_startup
				bcc	loc_CA5C

				tbbc	bit2, var_flags_46, loc_CA64

				cmp	#0E1h, var_ect		; 77 deg
				bcs	loc_CA64

				cmp	#02h, var_speed_kph
				bgt	loc_CA64

				clr	b
				setb	bit0, var_flags_4E
				bra	loc_CA64

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CA5C:							; CODE XREF: sub_C59B+4ADj
				tbbs	bit0, var_limiter_flags, loc_CA62

				tbbs	bit0, unk_44, loc_CA64


loc_CA62:							; CODE XREF: sub_C59B:loc_CA5Cj
				ld	b, #0Ch

loc_CA64:							; CODE XREF: sub_C59B+4AFj
								; sub_C59B+4B5j ...
				ld	a, unk_148
				tbbs	bit0, var_flags_4E, loc_CA72

				cmp	#19h, var_speed_kph
				bcc	loc_CA78

				tbbs	bit4, var_io_input1, loc_CA78


loc_CA72:							; CODE XREF: sub_C59B+4CCj
				cmp	a, #44h
				bcc	loc_CA78

				ld	a, #44h

loc_CA78:							; CODE XREF: sub_C59B+4D2j
								; sub_C59B+4D4j ...
				tbbs	bit0, var_limiter_flags, loc_CAAA

				add	a, b
				ld	b, #44h
				tbbs	bit0, var_flags_4E, loc_CA93

				ld	b, #50h
				cmp	#11h, var_speed_kph
				bcs	loc_CA93

				cmp	#1Eh, var_speed_kph
				bcc	loc_CA97

				tbbs	bit6, var_flags_46, loc_CA93

				tbbs	bit4, var_io_input1, loc_CA97


loc_CA93:							; CODE XREF: sub_C59B+4E3j
								; sub_C59B+4EBj ...
				cmp	a, b
				bcc	loc_CA97

				mov	b, a

loc_CA97:							; CODE XREF: sub_C59B+4F0j
								; sub_C59B+4F5j ...
				tbbc	bit2, var_flags_46, loc_CAD4

				cmp	a, var_rpm_div_25
				bgt	loc_CAD4

				cmp	#18h, var_revcnt_B6
				bcs	loc_CAD4

				cmp	#18h, var_revcnt_B7
				bcs	loc_CAD4

				bra	loc_CADD

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CAAA:							; CODE XREF: sub_C59B:loc_CA78j
				tbbc	bit2, var_flags_46, loc_CAD4

				cmp	#18h, var_revcnt_B6
				bcs	loc_CAD4

				cmp	#18h, var_revcnt_B7
				bcs	loc_CAD4

				cmp	a, var_rpm_div_25
				ble	loc_CAC2

				setb	bit5, var_flags_4E
				ld	#66h, unk_60
				bra	loc_CAD4

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CAC2:							; CODE XREF: sub_C59B+51Ej
				cmp	#2Ch, var_rpm_div_25
				bcc	loc_CADD

				cmp	#23h, var_speed_kph
				bcc	loc_CADD

				cmp	#8Bh, unk_5C
				bcs	loc_CADD

				jsr	sub_CDB9


loc_CAD4:							; CODE XREF: sub_C59B:loc_CA97j
								; sub_C59B+501j ...
				jsr	sub_CD68

				clr	var_cnt_CE
				clrb	bit0, var_limiter_flags
				bra	loc_CAE2

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CADD:							; CODE XREF: sub_C59B+50Dj
								; sub_C59B+52Aj ...
				setb	bit0, var_limiter_flags
				ld	#80h, unk_60

loc_CAE2:							; CODE XREF: sub_C59B+540j
				ld	a, unk_60
				bmi	loc_CAFB

				tbbc	bit2, var_flags_46, loc_CAFB

				cmp	#0DCh, var_ect		; 71 deg
				bcs	loc_CAFB

				cmp	#05h, var_speed_kph
				bcs	loc_CAFB

				cmp	#87h, unk_5C
				ble	loc_CAFE

				jsr	sub_CDBE


loc_CAFB:							; CODE XREF: sub_C59B+549j
								; sub_C59B+54Bj ...
				ld	#80h, unk_60

loc_CAFE:							; CODE XREF: sub_C59B+55Bj
				bra	loc_CB1E

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_CB00:							; CODE XREF: sub_C59B+C59p
				ld	a, unk_60
				add	a, #02h
				bpz	loc_CB08

				ld	a, #80h

loc_CB08:							; CODE XREF: sub_CB00+4j
				st	a, unk_60
				ret

; End of function sub_CB00


;  S U B	R O U T	I N E 


sub_CB0B:							; CODE XREF: sub_C59B+1DE7p
				ld	y, #table_ect_unk_C147
				jsr	table_ect_fixed4_interpolate

				tbbc	bit6, var_flags_46, loc_CB1A

				cmp	a, #3Ch
				bcc	loc_CB1A

				ld	a, #3Ch

loc_CB1A:							; CODE XREF: sub_CB0B+6j
								; sub_CB0B+Bj
				st	a, unk_148
				ret

; End of function sub_CB0B

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_CB1E:							; CODE XREF: sub_C59B:loc_CAFEj
				jsr	sub_EF2C

				ld	d, var_inj_pw_inj1
				cmp	d, #00AFh
				ble	loc_CB2B

				clr	var_cnt_D6

loc_CB2B:							; CODE XREF: sub_C59B+58Cj
				ld	a, #60h
				tbbc	bit1, var_limiter_flags, loc_CB32

				ld	a, #5Ch

loc_CB32:							; CODE XREF: sub_C59B+592j
				cmp	a, var_rpm_div_25
				bgt	loc_CB45

				ld	a, unk_60
				bpz	loc_CB45

				tbbs	bit0, var_limiter_flags, loc_CB45

				ld	x, var_inj_pw_inj1
				cmp	x, #0120h
				bcs	loc_CB4D


loc_CB45:							; CODE XREF: sub_C59B+599j
								; sub_C59B+59Dj ...
				clr	var_cnt_EB
				clrb	bit1, var_flags_4E

loc_CB49:							; CODE XREF: sub_C59B+5CDj
								; sub_C59B+5D2j
				clrb	bit1, var_limiter_flags
				bra	loc_CB8A

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CB4D:							; CODE XREF: sub_C59B+5A8j
				cmp	x, #00E1h
				bcc	loc_CB54

				setb	bit1, var_flags_4E

loc_CB54:							; CODE XREF: sub_C59B+5B5j
				cmp	x, #0120h
				bcs	loc_CB5B

				clrb	bit1, var_flags_4E

loc_CB5B:							; CODE XREF: sub_C59B+5BCj
				cmp	#0Ah, var_speed_kph
				bcs	loc_CB63

				tbbs	bit1, var_flags_4E, loc_CB65


loc_CB63:							; CODE XREF: sub_C59B+5C3j
				clr	var_cnt_EB

loc_CB65:							; CODE XREF: sub_C59B+5C5j
				cmp	#18h, var_revcnt_B6
				bcs	loc_CB49

				cmp	#18h, var_revcnt_B7
				bcs	loc_CB49

				ld	b, var_rpm_div_25
				ld	y, #table_rpm_unk_C14D
				jsr	table_rB_fixed_32_interpolate

				cmp	a, var_cnt_D6
				ble	loc_CB88

				ld	a, #05h
				cmp	#78h, var_rpm_div_25
				bcc	loc_CB84

				ld	a, #14h

loc_CB84:							; CODE XREF: sub_C59B+5E5j
				cmp	a, var_cnt_EB
				bgt	loc_CB8A


loc_CB88:							; CODE XREF: sub_C59B+5DEj
				setb	bit1, var_limiter_flags

loc_CB8A:							; CODE XREF: sub_C59B+5B0j
								; sub_C59B+5EBj
				cmp	#0Ah, var_speed_kph
				bcc	loc_CB95

				cmp	#3Ch, var_rpm_div_25
				bcc	loc_CB99

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CB95:							; CODE XREF: sub_C59B+5F2j
				clrb	bit3, var_flags_4E
				clrb	bit4, var_flags_4E

loc_CB99:							; CODE XREF: sub_C59B+5F7j
				tbbs	bit6, var_limiter_flags, loc_CBBD

				cmp	#0DCh, var_ect		; 71 deg
				bcs	loc_CBBD

				cmp	#00h, var_speed_kph
				bne	loc_CBBD

				tbbs	bit3, var_error_flags1,	loc_CBBD

				ld	b, var_rpm_x_5p12
				cmp	b, #18h
				bcs	loc_CBBD

				cmp	b, #64h
				bcc	loc_CBBD

				ld	y, #table_rpm_unk_C1E1
				jsr	table_rB_fixed_32_interpolate

				cmp	a, var_pim_2
				ble	loc_CBC1


loc_CBBD:							; CODE XREF: sub_C59B:loc_CB99j
								; sub_C59B+604j ...
				clr	var_cnt_CF
				bra	loc_CBCA

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CBC1:							; CODE XREF: sub_C59B+620j
				cmp	#0F4h, var_cnt_CF
				bcs	loc_CBCA

				setb	bit4, var_flags_4E
				setb	bit3, var_flags_4E

loc_CBCA:							; CODE XREF: sub_C59B+624j
								; sub_C59B+629j
				tbbs	bit0, unk_40, loc_CBEF

				ld	d, #3C46h
				ld	x, var_ect
				cmp	x, #0F300h		; 113 deg
				bcs	loc_CBDA

				ld	d, #2832h

loc_CBDA:							; CODE XREF: sub_C59B+63Aj
				st	d, var_temp_w
				cmp	#0DCh, var_ect		; 71 deg
				bcs	loc_CBEF

				tbbs	bit2, var_flags_46, loc_CBEF

				cmp	#0Ah, var_speed_kph
				bcc	loc_CBEF

				tbbs	bit4, var_flags_4E, loc_CBEF

				tbbs	bit6, var_flags_42, loc_CBF7


loc_CBEF:							; CODE XREF: sub_C59B:loc_CBCAj
								; sub_C59B+644j ...
				clr	a
				st	a, unk_68

loc_CBF2:							; CODE XREF: sub_C59B+669j
				jsr	sub_CC93

				bra	loc_CC2D

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CBF7:							; CODE XREF: sub_C59B+651j
				ld	b, var_rpm_x_5p12
				ld	a, unk_68
				cmp	a, #0FFh
				bcc	loc_CC09

				ld	a, #94h			; ld a,#9Eh - Marf
								; ld a,#A5h - Jon
				cmp	a, b
				ble	loc_CC11

				tbbc	bit6, var_limiter_flags, loc_CBF2

				bra	loc_CC1B

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CC09:							; CODE XREF: sub_C59B+662j
				ld	a, var_rpm_avg
				cmp	b, var_temp_b
				bcs	loc_CC11

				setb	bit2, var_flags_4E

loc_CC11:							; CODE XREF: sub_C59B+667j
								; sub_C59B+672j
				tbs	bit6, var_limiter_flags
				bne	loc_CC1B

				clr	var_cnt_CD
				ld	b, #00h
				bra	loc_CC1E

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CC1B:							; CODE XREF: sub_C59B+66Cj
								; sub_C59B+678j
				ld	d, var_unk_rpm_limit

loc_CC1E:							; CODE XREF: sub_C59B+67Ej
				cmp	a, var_temp_w
				bcc	loc_CC24

				ld	a, var_temp_w

loc_CC24:							; CODE XREF: sub_C59B+685j
				cmp	b, #1Eh
				ble	loc_CC2A

				ld	b, #1Eh

loc_CC2A:							; CODE XREF: sub_C59B+68Bj
				st	d, var_unk_rpm_limit

loc_CC2D:							; CODE XREF: sub_C59B+65Aj
				tbbc	bit2, var_limiter_flags, loc_CC39

				sub	a, unk_14A
				cmp	a, #1Eh
				bcc	loc_CC39

				ld	a, #1Eh

loc_CC39:							; CODE XREF: sub_C59B:loc_CC2Dj
								; sub_C59B+69Aj
				cmp	a, var_rpm_x_5p12
				bgt	loc_CC42

				setb	bit2, var_limiter_flags
				setb	bit2, var_flags_4E
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CC42:							; CODE XREF: sub_C59B+6A0j
				clrb	bit2, var_limiter_flags
				cmp	#3Dh, var_cnt_CD
				bcs	loc_CC91

				clr	var_cnt_CD
				tbbc	bit2, var_flags_4E, loc_CC65

				tbbc	bit6, var_limiter_flags, loc_CC68

				ld	d, var_unk_rpm_limit
				sub	a, #01h
				bcc	loc_CC5A

				ld	a, var_temp_w

loc_CC5A:							; CODE XREF: sub_C59B+6BBj
				add	b, #01h
				bcc	loc_CC60

				ld	b, #1Eh

loc_CC60:							; CODE XREF: sub_C59B+6C1j
				st	d, var_unk_rpm_limit
				bra	loc_CC8F

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CC65:							; CODE XREF: sub_C59B+6B0j
				jsr	sub_CC93


loc_CC68:							; CODE XREF: sub_C59B+6B3j
				ld	a, var_temp_b
				cmp	a, var_rpm_x_5p12
				ble	loc_CC75

				ld	a, unk_68
				beq	loc_CC73

				dec	a

loc_CC73:							; CODE XREF: sub_C59B+6D5j
				bra	loc_CC8D

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CC75:							; CODE XREF: sub_C59B+6D1j
				ld	y, #table_rpm_unk_C1E7
				ld	b, var_rpm_x_5p12
				jsr	table_rB_fixed_16_interpolate

				ld	x, var_ect
				cmp	x, #0F5C0h		; 120 deg
				bcs	loc_CC87

				shl	a
				bcs	loc_CC8B


loc_CC87:							; CODE XREF: sub_C59B+6E7j
				add	a, unk_68
				bcc	loc_CC8D


loc_CC8B:							; CODE XREF: sub_C59B+6EAj
				ld	a, #0FFh

loc_CC8D:							; CODE XREF: sub_C59B:loc_CC73j
								; sub_C59B+6EEj
				st	a, unk_68

loc_CC8F:							; CODE XREF: sub_C59B+6C8j
				clrb	bit2, var_flags_4E

loc_CC91:							; CODE XREF: sub_C59B+6ACj
				bra	loc_CC9C

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_CC93:							; CODE XREF: sub_C59B:loc_CBF2p
								; sub_C59B:loc_CC65p
				clrb	bit6, var_limiter_flags
				ld	d, #9400h		; ld d,#9e00h
				st	d, var_unk_rpm_limit
				ret

; End of function sub_CC93

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_CC9C:							; CODE XREF: sub_C59B:loc_CC91j
				jsr	sub_EEA8

				tbbc	bit3, var_limiter_flags, loc_CCB3 ; Jump if speed limiter not active

				cmp	#0B4h, var_speed_kph	; Check	speed against 180kph
				bcc	loc_CCAC		; Jump if greater

				cmp	#08h, var_cnt_E1	; Check	if speed limter	counter	has reached limit
				bcc	loc_CCB1		; Jump if it hasn't


loc_CCAC:							; CODE XREF: sub_C59B+70Aj
				cmp	#28h, var_rpm_x_5p12
				bcc	loc_CCB5


loc_CCB1:							; CODE XREF: sub_C59B+70Fj
				clrb	bit3, var_limiter_flags	; Clear	speed limiter active flag

loc_CCB3:							; CODE XREF: sub_C59B+704j
				clr	var_cnt_E1

loc_CCB5:							; CODE XREF: sub_C59B+714j
				bra	loc_CCD1

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


check_speed_limiter:						; CODE XREF: sub_F7C7+74p
				clr	a
				cmp	#180, var_speed_kph	; cmp #0FFh,$5Dh
				bcs	loc_CCC3		; 0x40

				ld	a, var_speed_limiter_cnt
				inc	a
				bne	loc_CCC3

				dec	a

loc_CCC3:							; CODE XREF: check_speed_limiter+4j
								; check_speed_limiter+9j
				st	a, var_speed_limiter_cnt
				cmp	a, #06h
				bcs	locret_CCD0

				cmp	#50h, var_rpm_x_5p12

loc_CCCC:
				bcs	locret_CCD0

				setb	bit3, var_limiter_flags	; Set speed cut	flag

locret_CCD0:							; CODE XREF: check_speed_limiter+10j
								; check_speed_limiter:loc_CCCCj
				ret

; End of function check_speed_limiter

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_CCD1:							; CODE XREF: sub_C59B:loc_CCB5j
				jsr	sub_EE93

				bra	loc_CCFB

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


check_boost_limit:						; CODE XREF: adc_handler_pim:loc_FC57p
				ld	y, #table_boost_limit
				ld	d, var_rpm_x_5p12
				jsr	sub_C42F

				tbbc	bit7, var_limiter_flags, loc_CCE3 ; Jump if boost limit	exceeded flag set

				sub	a, #0Dh			; Reduce boost limit threshold if we've already exceeded boost limit

loc_CCE3:							; CODE XREF: check_boost_limit+8j
				cmp	a, var_pim_2		; Check	if MAP is decreasing...
				ble	loc_CCE9		; ...jump if so

				clr	var_revcnt_BC		; Reset	boost exceeded limit counter

loc_CCE9:							; CODE XREF: check_boost_limit+Fj
				ld	y, #table_boost_limit_time
				ld	d, var_rpm_x_5p12
				jsr	sub_C42F

				cmp	a, var_revcnt_BC	; Check	if exceeded boot limit time
				bgt	loc_CCF8		; Jump if not exceeded

				setb	bit7, var_limiter_flags	; Set boost limit exceeded flag
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CCF8:							; CODE XREF: check_boost_limit+1Dj
				clrb	bit7, var_limiter_flags	; Clear	boost limit exceeded flag
				ret

; End of function check_boost_limit

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_CCFB:							; CODE XREF: sub_C59B+739j
				tbbc	bit7, var_limiter_flags, loc_CD07 ; Jump if boost limit	exceeded flag isn't set

				cmp	#18h, var_revcnt_C3	; Check	if boost limit exceeded	counter	has reached limit
				bcs	loc_CD09		; Jump if not reached limit

				setb	bit7, var_flags_4E	; Set boost limit error	flag
				bra	loc_CD0B

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CD07:							; CODE XREF: sub_C59B:loc_CCFBj
				clr	var_revcnt_C3		; Clear	boost limit exceeded counter

loc_CD09:							; CODE XREF: sub_C59B+766j
				clrb	bit7, var_flags_4E	; Clear	boost limit error flag

loc_CD0B:							; CODE XREF: sub_C59B+76Aj
				ld	a, var_flags_4E
				st	a, unk_1D5
				tbbs	bit0, var_io_input1, loc_CD15 ;	Jump if	STA high (starter running)


loc_CD13:							; Clear	engine start counter
				clr	var_revcnt_starter

loc_CD15:							; CODE XREF: sub_C59B+775j
				tbbc	bit0, var_flags_46, loc_CD31

				tbbs	bit1, unk_40, loc_CD31

				cmp	#0C4h, var_ect		; 51 deg
				bcc	loc_CD33

				cmp	#46h, var_adc_battery	; Check	if battery voltage is less than	6.5v
				bcs	loc_CD33		; Jump if it is

				cmp	#0Ch, var_revcnt_starter
				bcs	loc_CD33

				ld	d, var_inj_pw_inj1
				shr	d
				jsr	injectors_batch_update


loc_CD31:							; CODE XREF: sub_C59B:loc_CD15j
								; sub_C59B+77Dj
				setb	bit1, unk_40

loc_CD33:							; CODE XREF: sub_C59B+783j
								; sub_C59B+788j ...
				bra	loc_CD66

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


injector_cold_start:						; CODE XREF: ignition_timing_calcp
				tbs	bit4, var_flags_42
				bne	locret_CD65

				tbbc	bit0, var_flags_46, loc_CD63

				tbbs	bit1, unk_40, loc_CD63

				cmp	#0B3h, var_ect		; 41 deg
				bcs	locret_CD65

				ld	d, var_ect
				cmp	d, #0F5C0h		; 120 deg
				bcs	loc_CD50

				cmp	#3Dh, var_revcnt_starter
				bcs	locret_CD65


loc_CD50:							; CODE XREF: injector_cold_start+14j
				cmp	#0E0h, var_tha		; 76 deg
				bcc	locret_CD65

				ld	d, #04E2h		; Start	injector pulse
				cmp	#0DCh, var_ect		; 71 deg
				bcc	loc_CD60

				ld	d, #09C4h		; Cold start injector pulse

loc_CD60:							; CODE XREF: injector_cold_start+26j
				jsr	injectors_batch_update


loc_CD63:							; CODE XREF: injector_cold_start+4j
								; injector_cold_start+7j
				setb	bit1, unk_40

locret_CD65:							; CODE XREF: injector_cold_start+2j
								; injector_cold_start+Dj ...
				ret

; End of function injector_cold_start

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_CD66:							; CODE XREF: sub_C59B:loc_CD33j
				bra	loc_CD8B

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_CD68:							; CODE XREF: sub_C59B:loc_CAD4p
				tbbs	bit0, var_flags_46, locret_CD8A

				tbbc	bit0, unk_44, locret_CD8A

				tbbs	bit2, var_flags_46, locret_CD8A

				tbbc	bit0, var_limiter_flags, loc_CD7E

				ld	y, #table_rpm_unk_C1D2
				ld	b, var_rpm_div_25
				jsr	table_rB_fixed_32_interpolate

				bra	loc_CD84

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CD7E:							; CODE XREF: sub_CD68+9j
				ld	y, #table_ect_unk_C1D8
				jsr	table_ect_pair_interpolate


loc_CD84:							; CODE XREF: sub_CD68+14j
				jsr	divide_rD_64

				jsr	injectors_batch_update


locret_CD8A:							; CODE XREF: sub_CD68j
								; sub_CD68+3j ...
				ret

; End of function sub_CD68

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_CD8B:							; CODE XREF: sub_C59B:loc_CD66j
				bra	loc_CDB7

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


transient_throttle_inject:					; CODE XREF: ROM:FE0Fp
				ld	a, var_tps_delta	; Get TPS delta
				bpz	loc_CD93		; Jump if positive or 0

				clrb	bit3, unk_40		; Clear	transient throttle flag

loc_CD93:							; CODE XREF: transient_throttle_inject+2j
				cmp	a, #0Eh			; Check	if delta is less than 14
				blta	locret_CDB6		; Jump if so, it's not worth injecting fuel

				cmp	#0A0h, var_rpm_div_25	; Check	if RPM is greater than 4000rpm
				bcc	locret_CDB6		; Jump is so, not worth	injecting fuel

				cmp	#0Eh, var_tps		; Check	if TPS is not open enough
				bcs	locret_CDB6		; Jump is so, not worth	injecting fuel

				tbbs	bit0, var_flags_46, locret_CDB6

				tbs	bit3, unk_40		; Test and set transient throttle flag
				bne	locret_CDB6		; Jump if flag already set

				ld	y, #table_ect_inj_throttle_pump
				jsr	table_ect_pair_interpolate

				shr	d
				shr	d
				shr	d
				shr	d
				shr	d
				jsr	injectors_batch_update


locret_CDB6:							; CODE XREF: transient_throttle_inject+8j
								; transient_throttle_inject+Dj	...
				ret

; End of function transient_throttle_inject

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_CDB7:							; CODE XREF: sub_C59B:loc_CD8Bj
				bra	loc_CDCA

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_CDB9:							; CODE XREF: sub_C59B+536p
				ld	d, #00FAh
				bra	loc_CDC6

; End of function sub_CDB9


;  S U B	R O U T	I N E 


sub_CDBE:							; CODE XREF: sub_C59B+55Dp
				cmp	#8Bh, unk_5C
				bcs	locret_CDC9

				ld	d, #00FAh

loc_CDC6:							; CODE XREF: sub_CDB9+3j
				jsr	injectors_batch_update


locret_CDC9:							; CODE XREF: sub_CDBE+3j
				ret

; End of function sub_CDBE

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_CDCA:							; CODE XREF: sub_C59B:loc_CDB7j
				ld	a, unk_1D0
				st	a, var_flags_4E
				ld	a, #80h
				tbbs	bit2, unk_44, loc_CDDB

				clrb	bit0, var_flags_4E
				st	a, var_fuel_enrich_rpm
				bra	loc_CE1A

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CDDB:							; CODE XREF: sub_C59B+836j
				cmp	#8Ch, var_rpm_x_5p12
				bcc	loc_CE15

				cmp	#0Ah, var_tps
				bcs	loc_CE15

				tbbc	bit2, var_flags_4D, loc_CE15

				cmp	#0E4h, var_ect		; 81 deg
				ble	loc_CE18

				cmp	#50h, var_rpm_x_5p12
				bcs	loc_CE18

				tbbs	bit0, var_flags_4E, loc_CE18

				ld	y, #table_tps_unk_C200
				ld	d, var_tps
				jsr	table_pair_interpolate

				cmp	a, var_cnt_D4
				bcc	loc_CE18

				ld	a, dmarx_fuel_enrich
				cmp	a, #04h
				bcs	loc_CE18

				clrb	bit1, var_flags_4E
				ld	y, #map_fuel_enrich_rpm
				mul	a, #14h
				mov	d, x
				ld	d, var_rpm_x_5p12
				jsr	d_div_16_map_2d_interpolate


loc_CE15:							; CODE XREF: sub_C59B+843j
								; sub_C59B+848j ...
				st	a, var_fuel_enrich_rpm

loc_CE18:							; CODE XREF: sub_C59B+850j
								; sub_C59B+855j ...
				setb	bit0, var_flags_4E

loc_CE1A:							; CODE XREF: sub_C59B+83Ej
				ld	a, var_fuel_enrich_rpm
				cmp	a, #80h
				bne	loc_CE27

				tbs	bit1, var_flags_4E
				bne	loc_CE27

				clr	var_cnt_D4

loc_CE27:							; CODE XREF: sub_C59B+884j
								; sub_C59B+888j
				bra	loc_CE6C

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_CE29:							; CODE XREF: ignition_timing_calc+370p
				ld	a, var_fuel_enrich_rpm
				bmi	locret_CE3B

				add	a, #13h
				cmp	a, #80h
				bcs	loc_CE38

				ld	a, #80h
				clr	var_cnt_D4

loc_CE38:							; CODE XREF: sub_CE29+9j
				st	a, var_fuel_enrich_rpm

locret_CE3B:							; CODE XREF: sub_CE29+3j
				ret

; End of function sub_CE29


;  S U B	R O U T	I N E 


sub_CE3C:							; CODE XREF: ROM:FE0Cp
				ld	a, var_tps_delta
				cmp	a, #0F0h
				blta	loc_CE49

				cmp	a, #0F4h
				blta	loc_CE4B

				clrb	bit2, unk_44
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CE49:							; CODE XREF: sub_CE3C+4j
				setb	bit2, unk_44

loc_CE4B:							; CODE XREF: sub_CE3C+8j
				mov	a, b
				sub	a, unk_11D
				bvc	loc_CE58

				bcs	loc_CE56

				ld	a, #80h
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CE56:							; CODE XREF: sub_CE3C+15j
				ld	a, #7Fh

loc_CE58:							; CODE XREF: sub_CE3C+13j
				st	a, unk_11E
				st	b, unk_11D
				cmp	a, #0F4h
				blta	loc_CE69

				cmp	a, #0F8h
				blta	locret_CE6B

				clrb	bit2, var_flags_4D
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CE69:							; CODE XREF: sub_CE3C+24j
				setb	bit2, var_flags_4D

locret_CE6B:							; CODE XREF: sub_CE3C+28j
				ret

; End of function sub_CE3C

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_CE6C:							; CODE XREF: sub_C59B:loc_CE27j
				cmp	#0DFh, var_ect		; Check	ECT against 75c
				bcc	loc_CE79		; Jump if greater than 75c

				cmp	#0DAh, var_ect		; Check	ECT against 69c
				bcc	loc_CE7B		; Jump if greater then 69c

				clrb	bit2, var_flags_4E	; Clear	flag indicating	ECT greater than 75c
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CE79:							; CODE XREF: sub_C59B+8D4j
				setb	bit2, var_flags_4E	; Set flag indicating ECT greater than 75c

loc_CE7B:							; CODE XREF: sub_C59B+8D9j
				tbbs	bit2, var_flags_46, loc_CE80

				clr	var_cnt_D7

loc_CE80:							; CODE XREF: sub_C59B:loc_CE7Bj
				cmp	#1Fh, var_cnt_D7
				bcc	loc_CE8A

				cmp	#52h, var_tps
				bcs	loc_CE8C


loc_CE8A:							; CODE XREF: sub_C59B+8E8j
				clrb	bit3, var_flags_4E

loc_CE8C:							; CODE XREF: sub_C59B+8EDj
				clr	b
				tbbs	bit0, var_io_input1, loc_CECA ;	Jump if	STA high (starter running)

				tbbs	bit0, var_flags_46, loc_CECA

				tbbc	bit2, var_flags_4E, loc_CECA

				tbbs	bit2, var_flags_46, loc_CECA

				cmp	#19h, var_speed_kph
				bcs	loc_CECA

				ld	a, var_limiter_flags
				cmpb	a, #9Fh
				bne	loc_CECA

				cmp	#0FAh, var_speed_kph
				bcs	loc_CECD

				cmp	#2Ch, var_rpm_x_5p12
				bcs	loc_CECD

				cmp	#0F6h, var_tps_delta
				bgta	loc_CECD

				cmp	#48h, var_tps
				bgt	loc_CECD

				ld	a, dmatx_pim
				cmp	a, #61h
				ble	loc_CECD

				tbs	bit3, var_flags_4E
				bne	loc_CECD

				ld	y, #table_rpm_unk_C209
				jsr	table_rpm_pair_interpolate

				mov	a, b

loc_CECA:							; CODE XREF: sub_C59B+8F2j
								; sub_C59B+8F5j ...
				st	b, unk_11F

loc_CECD:							; CODE XREF: sub_C59B+90Cj
								; sub_C59B+911j ...
				ld	a, var_tps
				ld	y, #table_rpm_unk_C214
				jsr	table_rA_pair_interpolate

				mul	a, unk_11F
				st	a, unk_120
				di
				ld	a, unk_1DC
				mov	a, b
				and	b, #0FDh
				st	b, unk_1DC
				ei
				cmpb	a, #02h
				beq	loc_CEF5

				ld	b, unk_11F
				sub	b, #13h
				bcc	loc_CEF2

				clr	b

loc_CEF2:							; CODE XREF: sub_C59B+954j
				st	b, unk_11F

loc_CEF5:							; CODE XREF: sub_C59B+94Dj
				ld	a, unk_1D9
				st	a, var_flags_4F
				ld	a, var_adc_lambda
				bmi	loc_CF00

				clr	var_revcnt_lambda

loc_CF00:							; CODE XREF: sub_C59B+961j
				tbbs	bit0, var_flags_46, loc_CF11

				tbbs	bit5, var_error_flags2,	loc_CF11

				tbbs	bit6, var_error_flags2,	loc_CF11

				cmp	#31h, var_revcnt_lambda
				bcs	loc_CF13

				setb	bit0, var_flags_4F
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CF11:							; CODE XREF: sub_C59B:loc_CF00j
								; sub_C59B+968j ...
				clrb	bit0, var_flags_4F

loc_CF13:							; CODE XREF: sub_C59B+971j
				clrb	bit5, var_flags_4F
				ld	a, var_limiter_flags
				and	a, #9Fh
				beq	loc_CF1E

				clr	var_cnt_D2
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CF1E:							; CODE XREF: sub_C59B+97Ej
				clr	var_cnt_D3
				tbbs	bit7, var_flags_46, loc_CF51

				tbbs	bit0, var_flags_46, loc_CF51

				ld	a, dmarx_unk_242
				cmpb	a, #40h
				bne	loc_CF51

				cmp	#1Fh, var_cnt_D3
				bcc	loc_CF51

				cmp	#0C4h, var_ect
				bcs	loc_CF51

				ld	d, var_inj_pw_inj1
				cmp	d, #00AFh
				ble	loc_CF51

				ld	a, unk_60
				bpz	loc_CF51

				tbbs	bit6, var_limiter_flags, loc_CF51

				tbbs	bit2, var_diag_errors_5, loc_CF51

				tbbs	bit3, var_flags_4D, loc_CF51

				setb	bit5, var_flags_4F
				tbbs	bit0, var_flags_4F, loc_CF56


loc_CF51:							; CODE XREF: sub_C59B+985j
								; sub_C59B+988j ...
				clrb	bit1, var_flags_46
				jmp	loc_D04F

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CF56:							; CODE XREF: sub_C59B+9B3j
				setb	bit1, var_flags_46
				di
				ld	a, var_adc_lambda
				ld	b, unk_44
				st	d, var_temp_w
				clrb	bit4, unk_44
				ei
				tbbc	bit2, PORTA, loc_CF78	; Port A Data Register

				clrb	bit4, var_flags_4F
				ld	y, #table_unk_C22D
				cmp	#1Eh, var_speed_kph
				bcc	loc_CF74

				cmp	#2Fh, var_pim_2
				bcs	loc_CF88


loc_CF74:							; CODE XREF: sub_C59B+9D2j
				inc	y
				inc	y
				bra	loc_CF88

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CF78:							; CODE XREF: sub_C59B+9C7j
				ld	y, #table_unk_c229
				tbbc	bit3, var_flags_4F, loc_CF86

				inc	y
				inc	y
				tbbc	bit4, var_flags_4F, loc_CF86

				ld	y, #unk_121

loc_CF86:							; CODE XREF: sub_C59B+9E0j
								; sub_C59B+9E5j
				setb	bit4, var_flags_4F

loc_CF88:							; CODE XREF: sub_C59B+9D7j
								; sub_C59B+9DBj
				ld	d, [y]
				st	d, unk_121
				ld	x, var_temp_w
				bpz	loc_CF91

				mov	b, a

loc_CF91:							; CODE XREF: sub_C59B+9F3j
				st	a, unk_7A
				ld	y, #table_rpm_unk_C231
				cmp	#39h, var_pim_2
				bcs	loc_CF9E

				ld	y, #table_rpm_unk_C23D

loc_CF9E:							; CODE XREF: sub_C59B+9FEj
				tbbs	bit4, var_flags_4F, loc_CFBA

				inc	y
				inc	y
				push	y
				ld	b, var_rpm_div_25
				jsr	table_rB_fixed_32_interpolate

				st	a, unk_123
				ld	a, #05h
				pull	y
				add	y, a
				ld	b, var_rpm_div_25
				jsr	table_rB_fixed_32_interpolate

				st	a, unk_124
				bra	loc_CFBD

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_CFBA:							; CODE XREF: sub_C59B:loc_CF9Ej
				tbbc	bit3, var_flags_4F, loc_CFC0


loc_CFBD:							; CODE XREF: sub_C59B+A1Dj
				ld	y, #unk_123

loc_CFC0:							; CODE XREF: sub_C59B:loc_CFBAj
				ld	d, [y]
				st	d, unk_123
				ld	x, var_temp_w
				bpz	loc_CFC9

				mov	b, a

loc_CFC9:							; CODE XREF: sub_C59B+A2Bj
				st	a, unk_7B
				setb	bit3, var_flags_4F
				ld	a, #10h
				cmpb	a, var_temp_b
				beq	loc_D020

				jsr	sub_DE5A

				jsr	sub_D187

				ld	a, unk_1D7
				or	a, #01h
				st	a, unk_1D7
				clr	unk_7B
				tbbc	bit4, var_flags_4F, loc_D026

				ld	x, #table_unk_c229
				ld	y, #unk_121
				ld	b, #05h
				ld	a, var_temp_w
				bpz	loc_CFF6

				ld	b, #05h
				inc	x
				inc	y

loc_CFF6:							; CODE XREF: sub_C59B+A55j
				ld	a, y + 00h
				sub	a, b
				bcs	loc_CFFF

				cmp	a, x + 00h
				bcc	loc_D001


loc_CFFF:							; CODE XREF: sub_C59B+A5Ej
				ld	a, x + 00h

loc_D001:							; CODE XREF: sub_C59B+A62j
				st	a, [y]
				ld	y, #table_rpm_unk_C231
				ld	x, #unk_123
				ld	b, #0A1h
				ld	a, var_temp_w
				bpz	loc_D012

				ld	b, #0A1h
				inc	x
				inc	y

loc_D012:							; CODE XREF: sub_C59B+A71j
				ld	a, x + 00h
				sub	a, b
				bcs	loc_D01B

				cmp	a, y + 00h
				bcc	loc_D01C


loc_D01B:							; CODE XREF: sub_C59B+A7Aj
				ld	a, [y]

loc_D01C:							; CODE XREF: sub_C59B+A7Ej
				st	a, x + 00h
				bra	loc_D026

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D020:							; CODE XREF: sub_C59B+A36j
				clr	unk_7A
				tbs	bit5, unk_41
				bne	loc_D04D


loc_D026:							; CODE XREF: sub_C59B+A48j
								; sub_C59B+A83j
				ld	d, unk_62
				ld	x, var_temp_w
				bpz	loc_D034

				sub	d, unk_7A
				bcc	loc_D03B

				clr	a
				clr	b
				bra	loc_D03B

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D034:							; CODE XREF: sub_C59B+A8Fj
				add	d, unk_7A
				bcc	loc_D03B

				ld	d, #0FFFFh

loc_D03B:							; CODE XREF: sub_C59B+A93j
								; sub_C59B+A97j ...
				tbbs	bit0, var_limiter_flags, loc_D041

				tbbc	bit1, var_limiter_flags, loc_D046


loc_D041:							; CODE XREF: sub_C59B:loc_D03Bj
				cmp	#1Fh, var_cnt_D3
				bcs	loc_D062


loc_D046:							; CODE XREF: sub_C59B+AA3j
				ld	y, #unk_C3A1
				jsr	y + 3Fh

				st	d, unk_62

loc_D04D:							; CODE XREF: sub_C59B+A89j
				bra	loc_D064

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D04F:							; CODE XREF: sub_C59B+9B8j
				ld	d, #8000h
				st	d, unk_62
				clrb	bit4, unk_44
				setb	bit5, unk_41
				ld	a, unk_1D7
				and	a, #0FEh
				st	a, unk_1D7
				clrb	bit4, var_flags_4F

loc_D062:							; CODE XREF: sub_C59B+AA9j
				clrb	bit3, var_flags_4F

loc_D064:							; CODE XREF: sub_C59B:loc_D04Dj
				ld	y, #unk_85
				ld	x, #unk_C3A5

loc_D06A:							; CODE XREF: sub_C59B+ADCj
				ld	d, [y]
				inc	x
				inc	x
				xch	x, y
				jsr	sub_C3D7

				xch	x, y
				bcs	loc_D07B

				cmp	y, #unk_95
				bcs	loc_D06A

				bra	loc_D07E

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D07B:							; CODE XREF: sub_C59B+AD7j
				jsr	clear_nv_ram


loc_D07E:							; CODE XREF: sub_C59B+ADEj
				clrb	bit2, var_flags_4F
				tbbc	bit2, var_flags_46, loc_D095

				cmp	#28h, var_rpm_div_25
				bcc	loc_D0A9

				cmp	#14h, var_rpm_div_25
				bcs	loc_D0A9

				cmp	#18h, var_pim_2
				bcs	loc_D0A9

				clr	a
				bra	loc_D0BA

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D095:							; CODE XREF: sub_C59B+AE5j
				cmp	#80h, var_rpm_div_25
				bcc	loc_D0A9

				cmp	#1Eh, var_rpm_div_25
				bcs	loc_D0A9

				ld	d, var_pim_2
				cmp	a, #61h
				bcc	loc_D0A9

				cmp	a, #18h
				bcc	loc_D0AF


loc_D0A9:							; CODE XREF: sub_C59B+AEBj
								; sub_C59B+AF0j ...
				jmp	loc_D16D

; END OF FUNCTION CHUNK	FOR sub_C59B
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
byte_D0AC:			.db 03h				; DATA XREF: sub_C59B:loc_D0AFo
								; sub_D1A1:loc_D1ADo
				.db 1Fh
				.db 06h
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_D0AF:							; CODE XREF: sub_C59B+B0Cj
				ld	y, #byte_D0AC
				jsr	divide_rD_8

				jsr	sub_C476

				inc	a
				shl	a

loc_D0BA:							; CODE XREF: sub_C59B+AF8j
				ld	x, #var_unk_knock_86
				add	x, a
				xch	a, unk_67
				cmp	a, unk_67
				beq	loc_D0C6

				clr	var_cnt_69

loc_D0C6:							; CODE XREF: sub_C59B+B27j
				tbbs	bit0, unk_40, loc_D0A9

				tbbc	bit1, var_flags_46, loc_D0A9

				cmp	#0E3h, var_ect		; 80 deg
				ble	loc_D0A9

				tbbs	bit3, var_error_flags1,	loc_D0A9

				ld	a, dmarx_unk_231
				or	a, dmarx_unk_232
				or	a, dmarx_unk_233
				or	a, dmarx_unk_230
				or	a, dmarx_unk_236
				bne	loc_D0A9

				cmp	#93h, var_adc_battery	; 11.4v
				bcs	loc_D0A9

				tbbs	bit5, var_io_input1, loc_D0A9 ;	Jump if	in diagnostic check mode

				ld	a, unk_1D1
				cmpb	a, #04h
				bne	loc_D0A9

				cmpb	a, #20h
				beq	loc_D0FC

				cmpb	a, #01h
				beq	loc_D0A9


loc_D0FC:							; CODE XREF: sub_C59B+B5Bj
				setb	bit2, var_flags_4F
				tbbc	bit1, var_flags_4F, loc_D169

				ld	a, #06h
				tbbs	bit2, var_flags_46, loc_D108

				ld	a, #03h

loc_D108:							; CODE XREF: sub_C59B+B68j
				cmp	a, var_cnt_69
				bgt	loc_D169

				ld	b, #01h
				cmp	#8Ah, unk_64
				bcc	loc_D119

				neg	b
				cmp	#76h, unk_64
				bgt	loc_D169


loc_D119:							; CODE XREF: sub_C59B+B76j
				add	b, x + 00h
				push	b
				mov	x, d
				add	d, #0C321h
				mov	d, y
				pull	b
				jsr	sub_C3D7

				jsr	write_rB_nv_ram

				clrb	bit0, var_diag_errors_5
				ld	b, var_unk_knock_86
				sub	b, #5Ch
				bcc	loc_D133

				neg	b
				setb	bit0, var_diag_errors_5

loc_D133:							; CODE XREF: sub_C59B+B93j
				clr	a
				div	d, #05h
				st	b, var_temp_w
				xch	x, y
				ld	x, #unk_94
				ld	#06h, var_temp_b

loc_D13F:							; CODE XREF: sub_C59B+BCBj
				ld	a, var_temp_b
				mul	a, var_temp_w
				sub	b, var_temp_w
				subc	a, #00h
				tbbc	bit0, var_diag_errors_5, loc_D14D

				jsr	negate_rD


loc_D14D:							; CODE XREF: sub_C59B+BACj
				add	d, #0023h
				st	d, unk_7A
				ld	b, var_unk_knock_86
				clr	a
				sub	d, unk_7A
				bmi	loc_D162

				jsr	clamp_rD_FF

				cmp	b, x + 00h
				ble	loc_D162

				bsr	write_rB_nv_ram


loc_D162:							; CODE XREF: sub_C59B+BBCj
								; sub_C59B+BC3j
				dec	x
				dec	x
				dec	var_temp_b
				bpz	loc_D13F

				xch	x, y

loc_D169:							; CODE XREF: sub_C59B+B63j
								; sub_C59B+B6Fj ...
				ld	a, x + 00h
				bra	loc_D174

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D16D:							; CODE XREF: sub_C59B:loc_D0A9j
				ld	#0FFh, unk_67
				clr	var_cnt_69
				ld	a, #80h

loc_D174:							; CODE XREF: sub_C59B+BD0j
				tbbs	bit1, var_flags_46, loc_D17F

				ld	a, #80h
				st	a, unk_64
				st	a, unk_61
				ld	a, #00h

loc_D17F:							; CODE XREF: sub_C59B:loc_D174j
				st	a, dmatx_trim
				clrb	bit1, var_flags_4F
				jmp	loc_D1DD

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_D187:							; CODE XREF: sub_C59B+A3Bp
				ld	d, unk_61
				st	b, unk_61
				add	a, b
				rorc	a
				st	a, unk_64
				setb	bit1, var_flags_4F
				ld	d, #6902h		; Increment counters at	69h - 6Ah
				jsr	increment_counters

				ret

; End of function sub_D187


;  S U B	R O U T	I N E 


write_rB_nv_ram:						; CODE XREF: sub_C59B+B8Ap
								; sub_C59B+BC5p ...
				ld	a, x + 00h
				sub	a, b
				add	a, x + 01h
				xch	a, b
				st	d, x + 00h
				ret

; End of function write_rB_nv_ram


;  S U B	R O U T	I N E 


sub_D1A1:							; CODE XREF: sub_E454+28p
				ld	b, #80h
				tbbc	bit0, var_flags_42, locret_D1DC	; Jump if trims	are not	valid

				tbbc	bit2, var_flags_46, loc_D1AD

				ld	b, var_unk_knock_86
				bra	locret_D1DC

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D1AD:							; CODE XREF: sub_D1A1+5j
				ld	y, #byte_D0AC
				ld	d, var_pim_2
				sub	d, #0409h
				bcc	loc_D1B9

				clr	a
				clr	b

loc_D1B9:							; CODE XREF: sub_D1A1+14j
				jsr	divide_rD_8

				cmp	d, #081Fh
				ble	loc_D1C5

				add	d, #081Fh
				shr	d

loc_D1C5:							; CODE XREF: sub_D1A1+1Ej
				jsr	sub_C476

				push	b
				shl	a
				ld	y, #unk_88
				add	y, a
				ld	a, y + 00h
				ld	b, y + 02h
				mov	d, y
				pull	b
				push	y
				mov	s, x
				xch	x, y
				jsr	sub_C45C

				pull	y
				mov	a, b

locret_D1DC:							; CODE XREF: sub_D1A1+2j
								; sub_D1A1+Aj
				ret

; End of function sub_D1A1

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_D1DD:							; CODE XREF: sub_C59B+BE9j
				ld	a, var_flags_4E
				st	a, unk_1D0
				ld	a, var_flags_4F
				st	a, unk_1D9
				tbs	bit6, unk_41
				bne	loc_D1FD

				ld	d, #0CD14h		; Increment counters at	0CDh - 0E0h
				jsr	increment_counters

				jsr	sub_C91A

				jsr	sub_CB00

				jsr	sub_EC07

				jsr	sub_DE71


loc_D1FD:							; CODE XREF: sub_C59B+C4Ej
				cmp	#7Ah, var_cnt_C8
				bcs	loc_D20C

				clr	var_cnt_C8
				ld	d, #0EA05h		; Increment counters at	0EAh - 0EEh
				jsr	increment_counters

				inc	unk_EF

loc_D20C:							; CODE XREF: sub_C59B+C65j
				tbs	bit2, unk_41
				beq	loc_D213

				jmp	loc_D2D2

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D213:							; CODE XREF: sub_C59B+C73j
				ld	a, var_limiter_flags
				and	a, #9Fh
				bne	loc_D228

				ld	d, unk_127
				cmp	d, #0FFE7h
				blta	loc_D228

				ld	a, dmarx_unk_242
				cmpb	a, #40h
				beq	loc_D22A


loc_D228:							; CODE XREF: sub_C59B+C7Cj
								; sub_C59B+C84j
				clr	var_cnt_D5

loc_D22A:							; CODE XREF: sub_C59B+C8Bj
				ld	a, unk_6B
				bne	loc_D23C

				ld	d, #0F0Ch
				cmp	#1Eh, var_rpm_div_25
				bcs	loc_D237

				mov	b, a

loc_D237:							; CODE XREF: sub_C59B+C99j
				cmp	a, unk_147
				bgta	loc_D23E


loc_D23C:							; CODE XREF: sub_C59B+C91j
				inc	unk_6B

loc_D23E:							; CODE XREF: sub_C59B+C9Fj
				tbbs	bit1, var_flags_46, closed_loop_control

				jmp	loc_D2BC

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

closed_loop_control:						; CODE XREF: sub_C59B:loc_D23Ej
				ld	d, var_ect
				cmp	d, #0E4C0h		; 82.9 deg
				bcs	loc_D2BC		; Jump if engine temperature too low

				cmp	d, #0EF80h		; 103.8	deg
				bcc	loc_D2BC		; Jump if coolant temperature too high

				ld	a, dmarx_unk_231
				or	a, dmarx_unk_236
				bne	loc_D2BC

				cmp	#80h, var_rpm_div_25	; Check	RPM is greater than 3200rpm...
				bcc	loc_D2BC		; ...jump if it	is

				tbbs	bit1, var_io_input1, loc_D2BC ;	Jump if	throttle closed

				ld	a, unk_147
				cmp	a, #0FEh
				blta	loc_D2BC

				cmp	#93h, var_adc_battery	; 11.4v
				bcs	loc_D2BC		; Jump if battery voltage too low

				cmp	#3Dh, var_cnt_D5
				bcs	loc_D2BC

				tbbs	bit2, var_error_flags2,	loc_D2BC ; Jump	if ??? error flag set

				ld	a, unk_1D1
				cmpb	a, #04h
				bne	loc_D2BC

				cmpb	a, #20h
				beq	loc_D283

				cmpb	a, #01h
				beq	loc_D2BC


loc_D283:							; CODE XREF: sub_C59B+CE2j
				cmp	#06h, unk_6B
				ble	loc_D2D2

				ld	a, #01h			; Set rA to 1
				ld	b, var_adc_lambda
				bpz	loc_D28F

				neg	a			; Negate rA to make it -1

loc_D28F:							; CODE XREF: sub_C59B+CF1j
				add	a, var_lambda_count_unk_6C
				st	a, var_lambda_count_unk_6C
				cmp	#11h, unk_6B
				bcs	loc_D2D2

				tbbs	bit5, var_limiter_flags, loc_D2BC

				ld	d, var_trim_unk_96
				tbbs	bit0, var_flags_42, loc_D2A3 ; Jump if idle trim valid

				ld	d, #00FFh

loc_D2A3:							; CODE XREF: sub_C59B+D02j
				cmp	#84h, var_lambda_count_unk_6C
				bcc	loc_D2B4

				cmp	#7Ch, var_lambda_count_unk_6C
				bgt	loc_D2BC

				cmpz	a
				beq	loc_D2BC

				dec	a
				inc	b
				bra	loc_D2BA

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D2B4:							; CODE XREF: sub_C59B+D0Bj
				cmp	a, #80h
				beq	loc_D2BC

				inc	a
				dec	b

loc_D2BA:							; CODE XREF: sub_C59B+D17j
				st	d, var_trim_unk_96

loc_D2BC:							; CODE XREF: sub_C59B+CA6j
								; sub_C59B+CAEj ...
				ld	d, #0080h
				st	d, unk_6B
				clrb	bit5, var_limiter_flags
				bra	loc_D2D2

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_D2C5:							; CODE XREF: sub_C59B+494p
				ld	b, var_trim_unk_96
				ld	y, #unk_C3B7
				jsr	y + 20h

				bcc	locret_D2D1

				jsr	clear_nv_ram


locret_D2D1:							; CODE XREF: sub_D2C5+7j
				ret

; End of function sub_D2C5

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_D2D2:							; CODE XREF: sub_C59B+C75j
								; sub_C59B+CEBj ...
				jsr	sub_EA22

				jsr	sub_E865

				ld	a, unk_1D7
				st	a, var_flags_4E
				ld	a, unk_1D8
				st	a, var_flags_4F
				tbbs	bit3, var_io_input2, loc_D2E8

				clrb	bit2, var_flags_4F
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D2E8:							; CODE XREF: sub_C59B+D47j
				setb	bit2, var_flags_4F
				tbbs	bit7, var_io_input1, loc_D2F0

				clrb	bit3, var_flags_4F
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D2F0:							; CODE XREF: sub_C59B+D4Fj
				setb	bit3, var_flags_4F
				tbbs	bit0, var_io_input2, loc_D2F8

				clrb	bit1, var_flags_4F
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D2F8:							; CODE XREF: sub_C59B+D57j
				setb	bit1, var_flags_4F
				tbbs	bit5, var_io_input1, loc_D300

				clrb	bit5, var_flags_4F
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D300:							; CODE XREF: sub_C59B+D5Fj
				setb	bit5, var_flags_4F
				tbbs	bit1, var_io_input2, loc_D308

				clrb	bit4, var_flags_4F
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D308:							; CODE XREF: sub_C59B+D67j
				setb	bit4, var_flags_4F
				tbbs	bit0, var_io_input1, loc_D310 ;	Jump if	STA high (starter running)

				clrb	bit0, var_flags_4F
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D310:							; CODE XREF: sub_C59B+D6Fj
				setb	bit0, var_flags_4F
				tbbs	bit0, var_limiter_flags, loc_D317

				clr	var_cnt_DC

loc_D317:							; CODE XREF: sub_C59B+D77j
				ld	b, var_nv_idle_trim
				ld	y, #unk_C3C5
				jsr	y + 12h

				bcc	loc_D323

				jsr	clear_nv_ram


loc_D323:							; CODE XREF: sub_C59B+D83j
				tbbs	bit0, var_flags_46, loc_D33D

				cmp	#0E4h, var_ect
				ble	loc_D33D

				cmp	#02h, var_speed_kph
				bcc	loc_D33D

				ld	a, unk_1D5
				cmpb	a, #08h
				bne	loc_D33D

				tbbs	bit5, var_flags_4F, loc_D33D

				setb	bit2, var_flags_4E
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D33D:							; CODE XREF: sub_C59B:loc_D323j
								; sub_C59B+D8Ej ...
				clrb	bit2, var_flags_4E
				tbbc	bit2, var_flags_46, loc_D34B

				tbbs	bit1, var_flags_4E, loc_D34B

				tbbs	bit7, var_flags_4E, loc_D34B

				tbbc	bit0, var_flags_4F, loc_D34D


loc_D34B:							; CODE XREF: sub_C59B+DA4j
								; sub_C59B+DA7j ...
				clr	var_cnt_DB

loc_D34D:							; CODE XREF: sub_C59B+DADj
				tbbc	bit0, var_flags_46, loc_D361

				clr	var_cnt_DD
				ld	a, var_nv_idle_trim
				tbbs	bit0, var_flags_42, loc_D359 ; Jump if idle trim valid

				ld	a, #66h

loc_D359:							; CODE XREF: sub_C59B+DB9j
				mul	a, #10h
				add	d, #00A4h
				st	d, var_iscv_unk_19B

loc_D361:							; CODE XREF: sub_C59B:loc_D34Dj
				tbbs	bit0, var_flags_46, loc_D36E

				cmp	#28h, var_speed_kph
				bcc	loc_D36E

				cmp	#0A0h, var_rpm_div_25
				bcs	loc_D374


loc_D36E:							; CODE XREF: sub_C59B:loc_D361j
								; sub_C59B+DCCj
				ld	d, #08A4h
				st	d, unk_1A1

loc_D374:							; CODE XREF: sub_C59B+DD1j
				bra	loc_D380

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_D376:							; CODE XREF: sub_C59B+1DEDp
				ld	y, #table_C323
				jsr	table_ect_pair_interpolate

				st	a, var_iscv_unk_191
				ret

; End of function sub_D376

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_D380:							; CODE XREF: sub_C59B:loc_D374j
				tbs	bit1, unk_44
				bne	loc_D3A5

				jsr	calc_iscv

				bra	loc_D3A5

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


drive_dout1:							; CODE XREF: int_watchdog+1Cp
				di
				clrb	bit1, DOM
				ld	d, var_iscv_unk_198
				beq	loc_D399

				setb	bit1, DOUT
				add	d, TIMER		; Timer	MSB (bit11~bit18)
				st	d, CPR1			; Timer	comparison #1 MSB
				setb	bit1, DOM

loc_D399:							; CODE XREF: drive_dout1+6j
				clrb	bit1, DOUT
				ei
				tbbs	bit1, var_diag_errors_5, loc_D3A2

				setb	bit0, PORTD_ASRIN
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D3A2:							; CODE XREF: drive_dout1+13j
				clrb	bit0, PORTD_ASRIN
				ret

; End of function drive_dout1

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_D3A5:							; CODE XREF: sub_C59B+DE7j
								; sub_C59B+DECj
				tbbc	bit0, unk_40, loc_D3AB

				jmp	loc_D4C6

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D3AB:							; CODE XREF: sub_C59B:loc_D3A5j
				tbbs	bit7, var_flags_4E, loc_D3B1

				tbbs	bit5, var_flags_4F, loc_D3B3


loc_D3B1:							; CODE XREF: sub_C59B:loc_D3ABj
				clr	var_cnt_E9

loc_D3B3:							; CODE XREF: sub_C59B+E13j
				clr	a
				clr	b
				cmp	#3Dh, var_cnt_C7
				bcs	loc_D3BD

				jmp	loc_D475

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D3BD:							; CODE XREF: sub_C59B+E1Dj
				tbbc	bit7, var_flags_46, loc_D3C6

				ld	d, #0200h
				jmp	loc_D475

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D3C6:							; CODE XREF: sub_C59B:loc_D3BDj
				tbbc	bit5, var_flags_4F, loc_D40E

				cmp	#0D2h, var_ect
				bcs	loc_D40E

				tbbc	bit2, var_flags_46, loc_D40E

				ld	d, #0200h
				tbbs	bit6, var_flags_46, loc_D3EF

				ld	d, #0200h
				cmp	#26h, var_cnt_E9
				bcc	loc_D3E2

				jmp	loc_D475

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D3E2:							; CODE XREF: sub_C59B+E42j
				ld	b, var_nv_idle_trim
				tbbs	bit0, var_flags_42, loc_D3E9 ; Jump if idle trim valid

				ld	b, #66h

loc_D3E9:							; CODE XREF: sub_C59B+E49j
				clr	a
				shl	d
				shl	d
				jmp	loc_D475

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D3EF:							; CODE XREF: sub_C59B+E39j
				cmp	#17h, var_cnt_E9
				bcc	loc_D3FA

				jsr	calc_idle_batt1

				jmp	loc_D480

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D3FA:							; CODE XREF: sub_C59B+E57j
				cmp	#99h, var_cnt_E9
				bcs	loc_D475

				jsr	calc_idle_batt2

				sub	d, #0200h
				bcs	loc_D409

				clr	a
				clr	b

loc_D409:							; CODE XREF: sub_C59B+E6Aj
				jsr	negate_rD

				bra	loc_D480

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D40E:							; CODE XREF: sub_C59B:loc_D3C6j
								; sub_C59B+E31j ...
				cmp	#3Dh, var_cnt_startup
				bcs	loc_D434

				tbbs	bit2, var_flags_46, loc_D434

				cmp	#0D2h, var_ect
				bcs	loc_D434

				ld	x, #6150h
				ld	b, unk_144
				jsr	mult_rBrX2

				tbbc	bit7, var_flags_4F, loc_D42A

				sub	d, #0A3Eh

loc_D42A:							; CODE XREF: sub_C59B+E89j
				cmp	d, var_pim_2
				bgt	loc_D434

				setb	bit7, var_flags_4F
				clr	a
				clr	b
				bra	loc_D475

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D434:							; CODE XREF: sub_C59B+E76j
								; sub_C59B+E78j ...
				clrb	bit7, var_flags_4F
				ld	d, #0300h
				cmp	#18h, var_revcnt_B6
				bcs	loc_D446

				ld	d, #0300h
				cmp	#18h, var_revcnt_B7
				bcc	loc_D44B


loc_D446:							; CODE XREF: sub_C59B+EA1j
				tbbs	bit6, var_flags_46, loc_D480

				bra	loc_D475

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D44B:							; CODE XREF: sub_C59B+EA9j
				bsr	calc_idle_batt1

				push	d
				bsr	calc_idle_batt2

				sub	d, var_iscv_19D
				bcs	loc_D457

				clr	a
				clr	b

loc_D457:							; CODE XREF: sub_C59B+EB8j
				jsr	negate_rD

				mov	s, x
				tbbc	bit6, var_flags_46, loc_D46F

				tbbs	bit1, var_diag_errors_5, loc_D46B

				ld	y, var_iscv_19D
				cmp	y, #0200h
				bgt	loc_D47D

				bra	loc_D46F

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D46B:							; CODE XREF: sub_C59B+EC3j
				cmp	d, x + 00h
				bcc	loc_D47D


loc_D46F:							; CODE XREF: sub_C59B+EC0j
								; sub_C59B+ECEj
				ld	d, var_iscv_19D
				bsr	sub_D4A1

				pull	x

loc_D475:							; CODE XREF: sub_C59B+E1Fj
								; sub_C59B+E28j ...
				di
				tbbs	bit6, var_flags_4F, loc_D481

				clrb	bit1, var_diag_errors_5
				bra	loc_D483

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D47D:							; CODE XREF: sub_C59B+ECCj
								; sub_C59B+ED2j
				bsr	sub_D4A1

				pull	x

loc_D480:							; CODE XREF: sub_C59B+E5Cj
								; sub_C59B+E71j ...
				di

loc_D481:							; CODE XREF: sub_C59B+EDBj
				setb	bit1, var_diag_errors_5

loc_D483:							; CODE XREF: sub_C59B+EE0j
				st	d, var_iscv_unk_198
				ei
				bra	loc_D4C6

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


calc_idle_batt1:						; CODE XREF: sub_C59B+E59p
								; sub_C59B:loc_D44Bp
				ld	b, var_adc_battery
				ld	y, #table_iscv_adc_1
				jsr	table_rB_fixed_32_interpolate

				jsr	divide_rD_64

				ret

; End of function calc_idle_batt1


;  S U B	R O U T	I N E 


calc_idle_batt2:						; CODE XREF: sub_C59B+E64p
								; sub_C59B+EB3p
				ld	b, var_adc_battery
				ld	y, #table_iscv_adc_2
				jsr	table_rB_fixed_32_interpolate

				jsr	divide_rD_64

				ret

; End of function calc_idle_batt2


;  S U B	R O U T	I N E 


sub_D4A1:							; CODE XREF: sub_C59B+ED7p
								; sub_C59B:loc_D47Dp
				cmp	d, x + 00h
				bcs	loc_D4B9

				mov	d, x
				shr	d
				shr	d
				cmpz	a
				bne	loc_D4B0

				cmp	b, unk_194
				bcs	loc_D4B7


loc_D4B0:							; CODE XREF: sub_D4A1+8j
				ld	b, unk_194
				clr	a
				shl	d
				shl	d
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  41h ; A
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D4B7:							; CODE XREF: sub_D4A1+Dj
				mov	x, d
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D4B9:							; CODE XREF: sub_D4A1+2j
				ld	d, x + 00h
				ret

; End of function sub_D4A1


;  S U B	R O U T	I N E 


sub_D4BC:							; CODE XREF: sub_C59B+1DF5p
				ld	y, #table_C376
				jsr	table_ect_pair_interpolate

				st	a, unk_194
				ret

; End of function sub_D4BC

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_D4C6:							; CODE XREF: sub_C59B+E0Dj
								; sub_C59B+EECj
				jmp	loc_D931

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


calc_iscv:							; CODE XREF: sub_C59B+DE9p

; FUNCTION CHUNK AT D612 SIZE 0000031F BYTES

				cmp	#3Dh, var_cnt_startup
				bcc	loc_D4EA		; Jump if startup idle flare time has been exceeded

				ld	y, #table_ect_idle_flare
				jsr	table_ect_pair_interpolate ; rD	= val_ECT

				push	d			; Save rD on stack
				ld	y, #table_tha_idle_flare
				ld	a, var_tha
				jsr	table_rA_pair_interpolate ; rD = val_THA

				mov	s, x			; rX = rS
				cmp	d, x + 00h		; Compare val_THA with val_ECT
				bcc	loc_D4E4		; Jump if val_THA is >=	than val_ECT

				ld	d, x + 00h		; rD = val_ECT

loc_D4E4:							; CODE XREF: calc_iscv+17j
				pull	x			; Clean	up stack
								; rD = max(val_THA, val_ECT)
				jsr	divide_rD_16		; rD = rD / 16

				bra	loc_D4F4

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D4EA:							; CODE XREF: calc_iscv+3j
				ld	d, var_iscv_startup_flare ; Get	current	startup	flare value
				sub	d, #0001h		; Decrement it by 1
				bcc	loc_D4F4		; Jump if not underflowed

				clr	a			; Reset	rD to 0
				clr	b

loc_D4F4:							; CODE XREF: calc_iscv+1Fj
								; calc_iscv+27j
				st	d, var_iscv_startup_flare ; Store modified startup flare value


				cmp	#0Ch, var_revcnt_B1
				bcc	loc_D522

				cmp	#05h, var_speed_kph
				bcs	loc_D522

				cmp	#50h, var_rpm_div_25
				bcc	loc_D522

				cmp	#8Ah, unk_5C
				bcs	loc_D522

				setb	bit4, var_flags_4E
				cmp	#0DCh, var_ect
				bcs	loc_D524

				ld	b, var_pim_2
				ld	y, #table_idle_pim
				jsr	table_rB_fixed_16_interpolate

				jsr	divide_rD_64

				st	d, var_iscv_pim_flare
				bra	loc_D536

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D522:							; CODE XREF: calc_iscv+31j
								; calc_iscv+36j ...
				clrb	bit4, var_flags_4E

loc_D524:							; CODE XREF: calc_iscv+47j
				tbbs	bit4, var_flags_4E, loc_D536

				ld	d, var_iscv_pim_flare
				beq	loc_D536

				sub	d, #0008h
				bcc	loc_D533

				clr	a
				clr	b

loc_D533:							; CODE XREF: calc_iscv+66j
				st	d, var_iscv_pim_flare

loc_D536:							; CODE XREF: calc_iscv+57j
								; calc_iscv:loc_D524j ...
				cmp	#3Dh, var_cnt_startup
				bcc	loc_D540

				ld	d, #0300h
				bra	loc_D54A

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D540:							; CODE XREF: calc_iscv+70j
				ld	d, var_iscv_unk_1A9
				sub	d, #0004h
				bcc	loc_D54A

				clr	a
				clr	b

loc_D54A:							; CODE XREF: calc_iscv+75j
								; calc_iscv+7Dj
				st	d, var_iscv_unk_1A9
				cmp	#0Fh, var_cnt_startup
				bgt	loc_D55E

				ld	a, dmarx_unk_236
				cmp	a, #0Dh
				bcs	loc_D55E

				ld	d, #0200h
				bra	loc_D565

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D55E:							; CODE XREF: calc_iscv+87j
								; calc_iscv+8Ej
				cmp	#3Ch, var_cnt_EA
				bcs	loc_D568

				clr	a
				clr	b

loc_D565:							; CODE XREF: calc_iscv+93j
				st	d, var_iscv_unk_1AB

loc_D568:							; CODE XREF: calc_iscv+98j
				clr	a
				clr	b
				tbbc	bit6, var_flags_46, loc_D59B

				ld	x, #unk_C372
				tbbc	bit1, var_flags_4F, loc_D576

				ld	x, #unk_C374

loc_D576:							; CODE XREF: calc_iscv+A7j
				jsr	inc_rX_if

				ld	d, var_iscv_unk_1AD
				tbbc	bit4, var_flags_4F, loc_D586

				add	d, #0002h
				bcs	loc_D595

				bra	loc_D58D

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D586:							; CODE XREF: calc_iscv+B3j
				sub	d, #0002h
				bcc	loc_D58D

				clr	a
				clr	b

loc_D58D:							; CODE XREF: calc_iscv+BBj
								; calc_iscv+C0j
				mov	d, y
				jsr	divide_rD_16_saturate

				cmp	b, x + 00h
				bcs	loc_D59A


loc_D595:							; CODE XREF: calc_iscv+B9j
				ld	a, #10h
				mul	a, x + 00h
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  41h ; A
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D59A:							; CODE XREF: calc_iscv+CAj
				mov	y, d

loc_D59B:							; CODE XREF: calc_iscv+A1j
				st	d, var_iscv_unk_1AD
				ld	x, #unk_C36C
				bsr	inc_rX_if

				ld	a, x + 00h
				tbbc	bit6, var_flags_46, loc_D5CE

				clrb	bit0, var_diag_errors_5
				ld	x, #unk_C36E
				tbbc	bit1, var_flags_4F, loc_D5B3

				ld	x, #unk_C370

loc_D5B3:							; CODE XREF: calc_iscv+E4j
				bsr	inc_rX_if

				sub	a, x + 00h
				bcs	loc_D5BC

				setb	bit0, var_diag_errors_5
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  41h ; A
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D5BC:							; CODE XREF: calc_iscv+EEj
				neg	a
				mul	a, #10h
				jsr	check_knock_sensor_err_flag

				add	d, var_iscv_unk_1AD
				bpz	loc_D5C9

				clr	a
				clr	b

loc_D5C9:							; CODE XREF: calc_iscv+FCj
				st	d, unk_1A7
				ld	a, x + 00h

loc_D5CE:							; CODE XREF: calc_iscv+DCj
				mul	a, #10h
				add	d, var_iscv_unk_1AD
				add	d, var_iscv_unk_1A9
				add	d, var_iscv_unk_1AB
				st	d, var_temp_w
				ld	y, #table_iscv_C391
				tbbc	bit6, var_io_input2, loc_D5E2

				inc	y

loc_D5E2:							; CODE XREF: calc_iscv+115j
				tbbc	bit7, var_io_input2, loc_D5E7

				inc	y
				inc	y

loc_D5E7:							; CODE XREF: calc_iscv:loc_D5E2j
				ld	a, y + 00h
				mul	a, #10h
				add	d, var_temp_w
				st	d, var_temp_w
				cmp	d, var_iscv_unk_195
				beq	loc_D5F6

				clr	var_cnt_DE

loc_D5F6:							; CODE XREF: calc_iscv+129j
				st	d, var_iscv_unk_195
				ld	d, var_rpm_x_5p12
				sub	d, var_iscv_unk_195
				bcc	loc_D602

				clr	a
				clr	b

loc_D602:							; CODE XREF: calc_iscv+135j
				jsr	divide_rD_16_saturate

				st	b, var_iscv_rpm_cmp_197
				bra	loc_D612

; End of function calc_iscv


;  S U B	R O U T	I N E 


inc_rX_if:							; CODE XREF: calc_iscv:loc_D576p
								; calc_iscv+D8p ...
				tbbs	bit2, var_flags_4F, loc_D610

				tbbc	bit3, var_flags_4F, locret_D611


loc_D610:							; CODE XREF: inc_rX_ifj
				inc	x

locret_D611:							; CODE XREF: inc_rX_if+3j
				ret

; End of function inc_rX_if

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR calc_iscv

loc_D612:							; CODE XREF: calc_iscv+13Fj
				tbbs	bit6, var_flags_46, loc_D637

				tbbc	bit2, var_flags_4E, loc_D637

				cmp	#5Ch, var_cnt_DB
				bcs	loc_D637

				ld	y, #table_iscv_rpm_C357
				ld	b, var_iscv_rpm_cmp_197

loc_D623:							; CODE XREF: calc_iscv+15Dj
				inc	y
				cmp	b, y + 00h
				bgt	loc_D623

				ld	b, y + 05h
				clr	a
				add	d, var_iscv_unk_19B
				sub	d, #0080h
				bcc	loc_D651

				clr	a
				clr	b
				bra	loc_D651

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D637:							; CODE XREF: calc_iscv:loc_D612j
								; calc_iscv+14Cj ...
				clr	var_cnt_DE
				clr	var_cnt_DD
				tbbs	bit0, var_flags_46, loc_D64F

				ld	a, var_nv_idle_trim
				tbbs	bit0, var_flags_42, loc_D645 ; Jump if idle trim valid

				ld	a, #66h

loc_D645:							; CODE XREF: calc_iscv+177j
				mul	a, #10h
				cmp	d, var_iscv_unk_19B
				ble	loc_D64F

				st	d, var_iscv_unk_19B

loc_D64F:							; CODE XREF: calc_iscv+172j
								; calc_iscv+181j
				bra	loc_D67F

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D651:							; CODE XREF: calc_iscv+168j
								; calc_iscv+16Cj
				st	d, var_temp_w
				ld	a, var_nv_idle_trim	; Get idle trim	value from NV
				tbbs	bit0, var_flags_42, loc_D65A ; Jump if idle learned flag set

				ld	a, #66h			; Use default idle trim

loc_D65A:							; CODE XREF: calc_iscv+18Cj
				mul	a, #10h
				tbbc	bit2, var_flags_4F, loc_D668

				sub	d, #0000h
				mov	d, x
				add	d, #0148h
				bra	loc_D66F

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D668:							; CODE XREF: calc_iscv+193j
				sub	d, #0033h
				mov	d, x
				add	d, #017Bh

loc_D66F:							; CODE XREF: calc_iscv+19Dj
				cmp	d, var_temp_w
				ble	loc_D67C

				clr	var_cnt_DD
				mov	x, d
				cmp	d, var_temp_w
				bcc	loc_D67C

				ld	d, var_temp_w

loc_D67C:							; CODE XREF: calc_iscv+1A8j
								; calc_iscv+1AFj
				st	d, var_iscv_unk_19B

loc_D67F:							; CODE XREF: calc_iscv:loc_D64Fj
				tbbc	bit6, var_flags_46, loc_D6A5

				ld	y, #unk_C354
				jsr	table_ect_fixed4_interpolate

				st	a, var_temp_w
				ld	y, #unk_C352
				clr	a
				add	y, a
				ld	d, unk_1A7
				shr	d
				shr	d
				cmpz	a
				bne	loc_D69B

				jsr	sub_C45C

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D69B:							; CODE XREF: calc_iscv+1CCj
				ld	a, y + 01h
				sub	a, var_temp_w
				bcc	loc_D6A2

				clr	a

loc_D6A2:							; CODE XREF: calc_iscv+1D6j
				st	a, unk_1A0

loc_D6A5:							; CODE XREF: calc_iscv:loc_D67Fj
				tbbc	bit6, var_flags_46, loc_D6C6

				tbbc	bit2, var_flags_4E, loc_D6C6

				cmp	#5Ch, var_cnt_DB
				bcs	loc_D6C6

				ld	y, #table_iscv_rpm_C361
				ld	b, var_iscv_rpm_cmp_197

loc_D6B6:							; CODE XREF: calc_iscv+1F0j
				inc	y
				cmp	b, y + 00h
				bgt	loc_D6B6

				ld	b, y + 05h
				clr	a
				add	d, unk_1A1
				sub	d, #0080h
				bra	loc_D6C9

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D6C6:							; CODE XREF: calc_iscv:loc_D6A5j
								; calc_iscv+1DFj ...
				ld	d, unk_1A1

loc_D6C9:							; CODE XREF: calc_iscv+1FBj
				cmp	d, #0A66h
				bcc	loc_D6EF

				mov	d, x
				ld	a, unk_1A0
				mul	a, #10h
				sub	d, #08A4h
				bcs	loc_D6DB

				clr	a
				clr	b

loc_D6DB:							; CODE XREF: calc_iscv+20Ej
				jsr	negate_rD

				cmp	d, #0400h
				bcc	loc_D6E6

				ld	d, #0400h

loc_D6E6:							; CODE XREF: calc_iscv+218j
				st	d, var_temp_w
				cmp	x, var_temp_w
				ble	loc_D6F2

				mov	x, d
				bra	loc_D6F2

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D6EF:							; CODE XREF: calc_iscv+203j
				ld	d, #0A66h

loc_D6F2:							; CODE XREF: calc_iscv+221j
								; calc_iscv+224j
				st	d, unk_1A1
				ld	a, unk_19A
				inc	a
				st	a, unk_19A
				tbbc	bit0, var_flags_42, loc_D716 ; Jump if idle trim not valid

				cmp	#66h, var_nv_idle_trim
				bcc	loc_D716

				ld	d, var_iscv_unk_195
				add	d, #0700h
				tbbc	bit6, var_flags_42, loc_D712

				sub	d, #0100h
				bcs	loc_D716


loc_D712:							; CODE XREF: calc_iscv+241j
				cmp	d, unk_74
				bgt	loc_D718


loc_D716:							; CODE XREF: calc_iscv+233j
								; calc_iscv+239j ...
				clr	var_cnt_DD

loc_D718:							; CODE XREF: calc_iscv+24Bj
				cmp	#5Ch, var_cnt_DD
				bcs	loc_D730

				ld	a, unk_9E
				or	a, #01h
				st	a, unk_9E
				ld	b, #66h
				st	b, var_idle_trim
				ld	x, #var_nv_idle_trim
				jsr	write_rB_nv_ram		; Update idle trim value

				clr	var_cnt_DD

loc_D730:							; CODE XREF: calc_iscv+252j
				tbbs	bit7, var_flags_46, loc_D752

				cmp	#0E8h, var_ect
				bcs	loc_D752

				ld	a, dmarx_unk_231
				or	a, dmarx_unk_236
				bne	loc_D752

				cmp	#93h, var_adc_battery
				bcs	loc_D752

				tbbs	bit2, var_flags_4F, loc_D752

				ld	d, var_iscv_unk_1AB
				bne	loc_D752

				ld	d, var_iscv_startup_flare
				beq	loc_D754


loc_D752:							; CODE XREF: calc_iscv:loc_D730j
								; calc_iscv+26Dj ...
				clr	var_cnt_DE

loc_D754:							; CODE XREF: calc_iscv+287j
				cmp	#5Ch, var_cnt_DE
				bcs	loc_D784

				ld	d, var_iscv_unk_195
				add	d, #0800h
				sub	d, unk_74
				bcc	loc_D766

				jsr	negate_rD


loc_D766:							; CODE XREF: calc_iscv+298j
				cmp	d, #0060h
				bgt	loc_D784

				ld	a, var_nv_idle_trim
				tbbs	bit0, var_flags_42, loc_D772 ; Jump if idle trim valid

				ld	a, #66h

loc_D772:							; CODE XREF: calc_iscv+2A4j
				mul	a, #10h
				add	d, #007Bh
				cmp	d, var_iscv_unk_19B
				bcs	loc_D784

				sub	d, #0048h
				cmp	d, var_iscv_unk_19B
				ble	loc_D786


loc_D784:							; CODE XREF: calc_iscv+28Ej
								; calc_iscv+2A0j ...
				clr	unk_E2

loc_D786:							; CODE XREF: calc_iscv+2B9j
				tbbc	bit5, var_flags_4F, loc_D791

				ld	a, unk_9E
				or	a, #01h
				st	a, unk_9E
				bra	loc_D79C

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D791:							; CODE XREF: calc_iscv:loc_D786j
				cmp	#99h, unk_E2
				bcs	loc_D79C

				ld	a, unk_9E
				and	a, #0FEh
				st	a, unk_9E

loc_D79C:							; CODE XREF: calc_iscv+2C6j
								; calc_iscv+2CBj
				ld	a, unk_9E
				ld	b, var_nv_idle_trim
				tbbs	bit0, var_flags_42, loc_D7A7 ; Jump if idle trim valid

				and	a, #0FEh
				ld	b, #66h

loc_D7A7:							; CODE XREF: calc_iscv+2D7j
				cmp	#11h, var_speed_kph	; Check	if road	speed >= 11kph
				bcc	loc_D7BC		; Jump if so

				cmpb	a, #01h			; Check	a flag
				bne	loc_D7BC		; Jump if it's set

				ld	b, var_idle_trim	; Get current idle trim
				ld	y, #unk_C3C5
				jsr	y + 12h

				bcc	loc_D7BF

				ld	b, #66h

loc_D7BC:							; CODE XREF: calc_iscv+2E1j
								; calc_iscv+2E5j
				st	b, var_idle_trim	; Update idle trim value

loc_D7BF:							; CODE XREF: calc_iscv+2EFj
				cmp	#5Ch, var_cnt_DE
				bcs	loc_D815

				ld	b, unk_19A
				beq	loc_D7D3

				shl	b
				shl	b
				bne	loc_D815

				ld	a, unk_9E
				cmpb	a, #01h
				beq	loc_D815


loc_D7D3:							; CODE XREF: calc_iscv+2FEj
				ld	a, var_nv_idle_trim
				mul	a, #10h
				mov	d, x
				ld	a, var_iscv_rpm_cmp_197
				ld	b, var_nv_idle_trim
				cmp	x, var_iscv_unk_19B
				beq	loc_D7F9

				bcs	loc_D7EF

				cmp	a, #7Ah
				bcs	loc_D7F9

				sub	b, #01h
				bcc	loc_D7F9

				clr	b
				bra	loc_D7F9

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D7EF:							; CODE XREF: calc_iscv+319j
				cmp	a, #86h
				bgt	loc_D7F9

				add	b, #01h
				bcc	loc_D7F9

				ld	b, #0FFh

loc_D7F9:							; CODE XREF: calc_iscv+317j
								; calc_iscv+31Dj ...
				ld	a, var_idle_trim
				add	a, #08h
				st	a, var_temp_w
				sub	a, #0Bh
				st	a, var_temp_b
				ld	y, #var_temp_w
				jsr	sub_C3D7

				ld	y, #unk_C3C5
				jsr	y + 12h

				ld	x, #var_nv_idle_trim
				jsr	write_rB_nv_ram		; Update idle trim value in NV


loc_D815:							; CODE XREF: calc_iscv+2F9j
								; calc_iscv+302j ...
				ld	d, var_rpm_x_5p12
				sub	d, unk_1A5
				beq	loc_D82D

				rorc	a
				rorc	b
				jsr	divide_rD_4_signed

				cmp	d, #0000h
				bne	loc_D827

				inc	b

loc_D827:							; CODE XREF: calc_iscv+35Bj
				add	d, unk_1A5
				st	d, unk_1A5

loc_D82D:							; CODE XREF: calc_iscv+351j
				ld	x, var_rpm_x_5p12
				cmp	#02h, var_speed_kph
				bcs	loc_D84F

				cmp	#14h, var_rpm_x_5p12
				bcc	loc_D84A

				cmp	#0Dh, var_rpm_x_5p12
				bcs	loc_D84F

				ld	d, unk_1A5
				sub	d, var_rpm_x_5p12
				bcs	loc_D84A

				cmp	d, #0200h
				bcc	loc_D84F


loc_D84A:							; CODE XREF: calc_iscv+36Ej
								; calc_iscv+37Aj
				ld	d, #0400h
				bra	loc_D863

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D84F:							; CODE XREF: calc_iscv+369j
								; calc_iscv+373j ...
				mov	x, d
				add	d, #0100h
				sub	d, unk_1A3
				bcc	loc_D85A

				clr	a
				clr	b

loc_D85A:							; CODE XREF: calc_iscv+38Dj
				shl	d
				bcs	loc_D860

				shl	d
				bcc	loc_D863


loc_D860:							; CODE XREF: calc_iscv+392j
				ld	d, #0FFFFh

loc_D863:							; CODE XREF: calc_iscv+384j
								; calc_iscv+395j
				st	x, unk_1A3
				mov	d, x
				ld	a, #50h
				cmp	#3Dh, var_cnt_startup
				bcs	loc_D891

				tbbc	bit2, var_flags_46, loc_D891

				ld	d, #0800h
				tbbc	bit2, var_flags_4E, loc_D87F

				tbbc	bit0, var_flags_4E, loc_D87F

				ld	a, var_iscv_rpm_cmp_197
				mul	a, #10h

loc_D87F:							; CODE XREF: calc_iscv+3ABj
								; calc_iscv+3AEj
				ld	y, #table_C2FE
				jsr	map_2d_interpolate

				tbbc	bit2, var_flags_4E, loc_D88B

				tbbs	bit0, var_flags_4E, loc_D891


loc_D88B:							; CODE XREF: calc_iscv+3BCj
				cmp	a, #50h
				bcc	loc_D891

				ld	a, #50h

loc_D891:							; CODE XREF: calc_iscv+3A3j
								; calc_iscv+3A5j ...
				st	a, var_iscv_unk_19F
				tbbc	bit6, var_flags_46, loc_D8B0

				ld	b, var_nv_idle_trim
				tbbs	bit0, var_flags_42, loc_D89E ; Jump if idle trim valid

				ld	b, #66h

loc_D89E:							; CODE XREF: calc_iscv+3D0j
				clr	a
				add	b, unk_1A0
				addc	a, #00h
				shl	d
				shl	d
				shl	d
				shl	d
				add	d, unk_1A1
				sub	d, #0800h
				bra	loc_D8B3

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D8B0:							; CODE XREF: calc_iscv+3CBj
				ld	d, var_iscv_unk_19B

loc_D8B3:							; CODE XREF: calc_iscv+3E5j
				add	d, var_iscv_startup_flare
				shr	d
				st	d, var_temp_w
				clr	a
				clr	b
				tbbs	bit4, var_flags_4F, loc_D8C4

				tbbs	bit2, var_flags_4F, loc_D8C4

				tbbc	bit3, var_flags_4F, loc_D8D8


loc_D8C4:							; CODE XREF: calc_iscv+3F2j
								; calc_iscv+3F5j
				ld	y, #table_unk_C34A
				tbbc	bit6, var_flags_46, loc_D8CB

				inc	y

loc_D8CB:							; CODE XREF: calc_iscv+3FEj
				tbbc	bit6, unk_40, loc_D8D5

				inc	y
				inc	y
				tbbs	bit6, var_flags_42, loc_D8D5

				inc	y
				inc	y

loc_D8D5:							; CODE XREF: calc_iscv:loc_D8CBj
								; calc_iscv+407j
				ld	b, y + 00h
				shl	d

loc_D8D8:							; CODE XREF: calc_iscv+3F8j
				add	d, var_temp_w
				st	d, var_temp_w
				ld	b, var_iscv_unk_191
				clr	a
				shl	d
				shl	d
				add	d, var_iscv_pim_flare
				shl	d
				add	d, var_temp_w
				mov	d, x
				mov	x, d
				shr	d
				add	b, var_iscv_unk_19F
				addc	a, #00h
				sub	d, #0050h
				cmp	#0E4h, var_ect
				bcc	loc_D900

				tbbc	bit3, var_flags_4E, loc_D905

				cmp	#0DFh, var_ect
				bcs	loc_D905


loc_D900:							; CODE XREF: calc_iscv+42Dj
				cmp	#1Fh, var_cnt_DC
				bcc	loc_D908


loc_D905:							; CODE XREF: calc_iscv+42Fj
								; calc_iscv+435j
				jmp	loc_D929

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D908:							; CODE XREF: calc_iscv+43Aj
				setb	bit3, var_flags_4E
				st	d, var_temp_w
				cmp	#78h, var_rpm_div_25	; 3000 rpm
				bcc	loc_D919

				cmp	#70h, var_rpm_div_25	; 2800 rpm
				bcc	loc_D91B

				clrb	bit6, var_flags_4F
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D919:							; CODE XREF: calc_iscv+446j
				setb	bit6, var_flags_4F

loc_D91B:							; CODE XREF: calc_iscv+44Bj
				ld	b, var_rpm_div_25
				ld	y, #table_rpm_c31d
				jsr	table_rB_fixed_16_interpolate

				mov	a, b
				clr	a
				add	d, var_temp_w
				bra	loc_D92D

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D929:							; CODE XREF: calc_iscv:loc_D905j
				clrb	bit3, var_flags_4E
				clrb	bit6, var_flags_4F

loc_D92D:							; CODE XREF: calc_iscv+45Ej
				st	d, var_iscv_19D
				ret

; END OF FUNCTION CHUNK	FOR calc_iscv
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_D931:							; CODE XREF: sub_C59B:loc_D4C6j
				clrb	bit1, var_flags_4E
				clrb	bit7, var_flags_4E
				ld	a, var_flags_4E
				st	a, unk_1D7
				ld	a, var_flags_4F
				st	a, unk_1D8
				ld	a, unk_1D1
				st	a, var_flags_4E
				tbbc	bit6, var_flags_4E, loc_D954

				tbbs	bit5, var_flags_4E, loc_D954

				cmp	#8Ah, unk_64
				bgt	loc_D954

				cmp	#76h, unk_64
				bcc	loc_D956


loc_D954:							; CODE XREF: sub_C59B+13A9j
								; sub_C59B+13ACj ...
				clr	var_cnt_6A

loc_D956:							; CODE XREF: sub_C59B+13B7j
				cmp	#1Eh, var_cnt_EA
				bcs	loc_D986

				tbbs	bit5, var_io_input1, loc_D986

				ld	a, #0E3h
				tbbc	bit1, var_flags_4E, loc_D965

				ld	a, #0E1h

loc_D965:							; CODE XREF: sub_C59B+13C5j
				cmp	a, var_ect
				bgt	loc_D986

				ld	a, dmarx_unk_231
				or	a, dmarx_unk_230
				or	a, dmarx_unk_236
				bne	loc_D986

				tbbs	bit7, unk_40, loc_D986

				tbbs	bit1, var_flags_46, loc_D98E

				ld	a, dmarx_unk_242
				cmpb	a, #40h
				beq	loc_D986

				jsr	sub_DB92

				bra	loc_D989

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D986:							; CODE XREF: sub_C59B+13BEj
								; sub_C59B+13C0j ...
				jsr	sub_DB8C


loc_D989:							; CODE XREF: sub_C59B+13E9j
				clrb	bit1, var_flags_4E
				jmp	loc_DC77

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D98E:							; CODE XREF: sub_C59B+13DCj
				setb	bit1, var_flags_4E
				cmp	#18h, var_revcnt_B4
				bcc	loc_D998

				jmp	loc_DA10

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D998:							; CODE XREF: sub_C59B+13F8j
				clr	var_revcnt_B4
				ld	d, dmarx_unk_226
				st	d, var_temp_w
				ld	d, dmarx_word_228
				st	d, unk_7A
				ld	d, unk_1BE
				tbbc	bit0, var_flags_4E, loc_D9B0

				tbbc	bit3, var_flags_4E, loc_D9B0

				ld	d, unk_1C0

loc_D9B0:							; CODE XREF: sub_C59B+140Cj
								; sub_C59B+140Fj
				ld	x, #1EB8h
				jsr	mult_rDrX

				ld	x, dmarx_word_22A
				jsr	mult_rDrX

				mov	x, d
				sub	d, unk_7A
				ble	loc_D9E3

				mov	d, x
				ld	a, #0C8h
				jsr	mult_rArX

				ld	d, var_temp_w
				jsr	sub_C59B

				cmp	d, #00C8h
				bcs	loc_D9DA

				ld	d, var_temp_w
				add	d, unk_7A
				mov	d, x
				ld	b, #0C8h
				bra	loc_D9E6

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D9DA:							; CODE XREF: sub_C59B+1434j
				push	b
				tbbs	bit0, var_flags_4E, loc_D9FA

				ld	d, unk_1BE
				bra	loc_D9F6

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_D9E3:							; CODE XREF: sub_C59B+1424j
				clr	b
				ld	x, unk_7A

loc_D9E6:							; CODE XREF: sub_C59B+143Dj
				push	b
				push	x
				ld	d, dmarx_word_22A
				ld	x, #1EB8h
				jsr	mult_rDrX

				mov	x, d
				pull	x
				jsr	sub_C59B


loc_D9F6:							; CODE XREF: sub_C59B+1446j
				st	d, unk_1C0
				mov	d, x

loc_D9FA:							; CODE XREF: sub_C59B+1440j
				pull	a
				st	a, unk_1BD
				cmp	a, #0C8h
				bcs	loc_DA10

				tbbs	bit0, var_flags_4E, loc_DA10

				st	x, unk_1BE
				setb	bit4, var_flags_4E
				jsr	sub_DBA3

				st	d, unk_1C4

loc_DA10:							; CODE XREF: sub_C59B+13FAj
								; sub_C59B+1465j ...
				cmp	#7Ah, var_revcnt_B5
				bcc	loc_DA17

				bra	loc_DA60

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DA17:							; CODE XREF: sub_C59B+1478j
				clr	var_revcnt_B5
				tbbs	bit0, var_flags_4E, loc_DA60

				tbbc	bit5, var_flags_4E, loc_DA60

				ld	d, unk_1BE
				ld	x, var_adc_lambda
				bmi	loc_DA39

				cmp	#76h, unk_62
				ble	loc_DA4D

				mov	d, x
				ld	a, unk_1BD
				cmp	a, #0C8h
				bcc	loc_DA4E

				mov	x, d
				add	d, #000Ch
				bra	loc_DA45

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DA39:							; CODE XREF: sub_C59B+1489j
				cmp	#66h, unk_62
				bcc	loc_DA4D

				sub	d, #0002h
				bcc	loc_DA45

				clr	a
				clr	b

loc_DA45:							; CODE XREF: sub_C59B+149Cj
								; sub_C59B+14A6j
				ld	y, #unk_C3C1
				jsr	y + 1Fh

				st	d, unk_1BE

loc_DA4D:							; CODE XREF: sub_C59B+148Ej
								; sub_C59B+14A1j
				mov	d, x

loc_DA4E:							; CODE XREF: sub_C59B+1496j
				ld	a, unk_1BD
				cmp	a, #0C8h
				bcc	loc_DA58

				st	x, unk_1C0

loc_DA58:							; CODE XREF: sub_C59B+14B8j
				cmp	x, #004Dh
				bcs	loc_DA60

				jsr	sub_DC3D


loc_DA60:							; CODE XREF: sub_C59B+147Aj
								; sub_C59B+147Ej ...
				jmp	loc_DC77

; END OF FUNCTION CHUNK	FOR sub_C59B
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DA63:							; CODE XREF: sub_C59B+1DFDp
				cmp	#14h, var_rpm_x_5p12
				bcc	loc_DA70

				cmp	#16h, var_pim_2
				bcs	loc_DA70

				tbbs	bit2, var_flags_46, loc_DA72


loc_DA70:							; CODE XREF: ROM:DA66j
								; ROM:DA6Bj
				clr	unk_E4

loc_DA72:							; CODE XREF: ROM:DA6Dj
				tbbc	bit2, var_flags_4E, loc_DA7C

				cmp	#40h, unk_E4
				bcs	loc_DA7C

				clrb	bit0, var_flags_4E

loc_DA7C:							; CODE XREF: ROM:loc_DA72j
								; ROM:DA78j
				tbbs	bit0, var_flags_4E, loc_DABF

				tbbc	bit1, var_flags_4E, loc_DAA1

				cmp	#14h, var_rpm_x_5p12
				bcc	loc_DA94

				cmp	#16h, var_pim_2
				bcs	loc_DA94

				tbbc	bit2, var_flags_46, loc_DA94

				setb	bit6, var_flags_4E
				jmp	loc_DB34

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DA94:							; CODE XREF: ROM:DA85j
								; ROM:DA8Aj ...
				ld	d, unk_1BE
				cmp	d, #0080h
				bcc	loc_DAAD

				tbbs	bit5, var_flags_4E, loc_DAA8

				bra	loc_DABA

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DAA1:							; CODE XREF: ROM:DA7Fj
				ld	a, dmarx_unk_242
				cmpb	a, #40h
				bne	loc_DABA


loc_DAA8:							; CODE XREF: ROM:DA9Cj
				jsr	sub_DB79

				bra	loc_DABA

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DAAD:							; CODE XREF: ROM:DA9Aj
				setb	bit0, var_flags_4E
				jsr	sub_DC3D

				cmp	d, #(loc_C7AD+1)
				ble	loc_DABA

				jsr	sub_DB77


loc_DABA:							; CODE XREF: ROM:DA9Fj
								; ROM:DAA6j ...
				clrb	bit6, var_flags_4E
				jmp	locret_DB74

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DABF:							; CODE XREF: ROM:loc_DA7Cj
				clrb	bit6, var_flags_4E
				ld	d, unk_1C4
				clrb	bit7, var_flags_4E
				cmp	#0B3h, unk_64
				bcc	loc_DADB

				cmp	#4Dh, unk_64
				bgt	loc_DABA

				setb	bit7, var_flags_4E
				sub	d, #07AEh
				bcc	loc_DAE3

				clr	a
				clr	b
				bra	loc_DAE3

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DADB:							; CODE XREF: ROM:DAC9j
				add	d, #07AEh
				bcc	loc_DAE3

				ld	d, #0FFFFh

loc_DAE3:							; CODE XREF: ROM:DAD5j
								; ROM:DAD9j ...
				st	d, unk_1C4
				ld	d, unk_62
				tbbs	bit7, var_flags_4E, loc_DB07

				cmp	d, #295Ch
				bcc	loc_DAF5

				ld	d, #1A00h
				bra	loc_DAF8

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DAF5:							; CODE XREF: ROM:DAEEj
				sub	d, #0F5Ch

loc_DAF8:							; CODE XREF: ROM:DAF3j
				st	d, unk_62
				ld	a, unk_64
				cmp	a, #29h
				bcc	loc_DB03

				ld	a, #1Ah
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DB03:							; CODE XREF: ROM:DAFEj
				sub	a, #0Fh
				bra	loc_DB21

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DB07:							; CODE XREF: ROM:DAE8j
				cmp	d, #0D6A4h
				bcs	loc_DB11

				ld	d, #0E600h
				bra	loc_DB14

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DB11:							; CODE XREF: ROM:DB0Aj
				add	d, #0F5Ch

loc_DB14:							; CODE XREF: ROM:DB0Fj
				st	d, unk_62
				ld	a, unk_64
				cmp	a, #0D7h
				bcs	loc_DB1F

				ld	a, #0E6h
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DB1F:							; CODE XREF: ROM:DB1Aj
				add	a, #0Fh

loc_DB21:							; CODE XREF: ROM:DB05j
				st	a, unk_64
				jsr	sub_DC3D

				tbbs	bit7, var_flags_4E, loc_DB31

				cmp	d, #0C7AEh
				ble	loc_DB31

				jsr	sub_DB77


loc_DB31:							; CODE XREF: ROM:DB26j
								; ROM:DB2Cj
				jmp	locret_DB74

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DB34:							; CODE XREF: ROM:DA91j
				tbbs	bit5, var_flags_4E, loc_DB41

				jsr	sub_DB75

				cmp	#03h, var_cnt_6A
				bcs	locret_DB74

				setb	bit5, var_flags_4E

loc_DB41:							; CODE XREF: ROM:loc_DB34j
				ld	d, unk_1C4
				ld	x, var_adc_lambda
				bmi	loc_DB57

				cmp	#85h, unk_62
				ble	loc_DB66

				add	d, #0010h
				bcc	loc_DB66

				ld	d, #0FFFFh
				bra	loc_DB66

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DB57:							; CODE XREF: ROM:DB46j
				cmp	#76h, unk_62
				bcc	loc_DB66

				tbbs	bit3, var_flags_4E, loc_DB66

				sub	d, #0010h
				bcc	loc_DB66

				clr	a
				clr	b

loc_DB66:							; CODE XREF: ROM:DB4Bj
								; ROM:DB50j ...
				st	d, unk_1C4
				ld	d, unk_1BE
				cmp	d, #004Dh
				bcs	locret_DB74

				jsr	sub_DC3D


locret_DB74:							; CODE XREF: ROM:DABCj
								; ROM:loc_DB31j ...
				ret


;  S U B	R O U T	I N E 


sub_DB75:							; CODE XREF: ROM:DB37p
				clrb	bit2, var_flags_4E
; End of function sub_DB75


;  S U B	R O U T	I N E 


sub_DB77:							; CODE XREF: ROM:DAB7p
								; ROM:DB2Ep
				clrb	bit0, var_flags_4E
; End of function sub_DB77


;  S U B	R O U T	I N E 


sub_DB79:							; CODE XREF: ROM:loc_DAA8p
				ld	d, #0CCCDh
				st	d, unk_1C2
				clrb	bit5, var_flags_4E
				clr	a
				clr	b
				st	d, unk_1BE
				ld	d, #0CCCDh
				st	d, unk_1C4
; End of function sub_DB79


;  S U B	R O U T	I N E 


sub_DB8C:							; CODE XREF: sub_C59B:loc_D986p
				clr	a
				st	a, unk_1BD
				bra	loc_DB97

; End of function sub_DB8C


;  S U B	R O U T	I N E 


sub_DB92:							; CODE XREF: sub_C59B+13E6p
				ld	a, #0C8h
				st	a, unk_1BD

loc_DB97:							; CODE XREF: sub_DB8C+4j
				clr	a
				clr	b
				st	d, unk_1C0
				ld	d, #0CCCDh
				st	d, unk_1C6
				ret

; End of function sub_DB92


;  S U B	R O U T	I N E 


sub_DBA3:							; CODE XREF: sub_C59B+146Fp
								; sub_E454+46p
				clrb	bit0, var_diag_errors_5
				ld	x, unk_1C0
				tbbs	bit4, var_flags_4E, loc_DBB5

				cmp	x, unk_1BE
				bne	loc_DBB5

				ld	d, unk_1C4
				bra	loc_DBDE

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DBB5:							; CODE XREF: sub_DBA3+5j
								; sub_DBA3+Bj
				ld	d, unk_1C2
				sub	d, #0CCCDh
				bcc	loc_DBC0

				jsr	set_knock_sensor_err_flag


loc_DBC0:							; CODE XREF: sub_DBA3+18j
				jsr	mult_rDrX

				tbbs	bit0, var_diag_errors_5, loc_DBD0

				add	d, #0CCCDh
				bcc	loc_DBDB

				ld	d, #0FFFFh
				bra	loc_DBDB

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DBD0:							; CODE XREF: sub_DBA3+20j
				sub	d, #0CCCDh
				bcs	loc_DBD7

				clr	a
				clr	b

loc_DBD7:							; CODE XREF: sub_DBA3+30j
				neg	a
				neg	b
				subc	a, #00h

loc_DBDB:							; CODE XREF: sub_DBA3+26j
								; sub_DBA3+2Bj
				tbbs	bit4, var_flags_4E, loc_DC3A


loc_DBDE:							; CODE XREF: sub_DBA3+10j
				cmp	d, unk_1C8
				ble	loc_DBF1

				tbbc	bit0, var_flags_4E, loc_DC35

				tbbc	bit1, var_flags_4E, loc_DC35

				ld	x, unk_1C4
				cmp	x, unk_1C8
				bgt	loc_DC24


loc_DBF1:							; CODE XREF: sub_DBA3+3Ej
				setb	bit3, var_flags_4E
				ld	d, unk_1C8
				push	d
				sub	d, #0CCCDh
				neg	a
				neg	b
				subc	a, #00h
				mov	d, x
				ld	d, #0CCCDh
				sub	d, unk_1C2
				bgt	loc_DC0C

				ld	d, unk_1BE
				bra	loc_DC17

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DC0C:							; CODE XREF: sub_DBA3+62j
				jsr	sub_C59B

				ld	y, #unk_C3C1
				jsr	y + 1Fh

				st	d, unk_1C0

loc_DC17:							; CODE XREF: sub_DBA3+67j
				pull	x
				tbbs	bit0, var_flags_4E, loc_DC21

				st	d, unk_1BE
				st	x, unk_1C4

loc_DC21:							; CODE XREF: sub_DBA3+75j
				mov	x, d
				bra	loc_DC37

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DC24:							; CODE XREF: sub_DBA3+4Cj
				mov	d, x
				ld	a, unk_1BD
				beq	loc_DC34

				cmp	a, #0C8h
				bcc	loc_DC34

				ld	d, unk_1BE
				st	d, unk_1C0

loc_DC34:							; CODE XREF: sub_DBA3+85j
								; sub_DBA3+89j
				mov	x, d

loc_DC35:							; CODE XREF: sub_DBA3+40j
								; sub_DBA3+43j
				clrb	bit3, var_flags_4E

loc_DC37:							; CODE XREF: sub_DBA3+7Fj
				st	d, unk_1C6

loc_DC3A:							; CODE XREF: sub_DBA3:loc_DBDBj
				clrb	bit4, var_flags_4E
				ret

; End of function sub_DBA3


;  S U B	R O U T	I N E 


sub_DC3D:							; CODE XREF: sub_C59B+14C2p
								; ROM:DAAFp ...
				clrb	bit0, var_diag_errors_5
				ld	d, unk_1C4
				sub	d, #0CCCDh
				bcc	loc_DC4A

				jsr	set_knock_sensor_err_flag


loc_DC4A:							; CODE XREF: sub_DC3D+8j
				mov	d, x
				ld	d, unk_1BE
				jsr	sub_C59B

				tbbs	bit0, var_diag_errors_5, loc_DC5E

				add	d, #0CCCDh
				bcc	loc_DC69

				ld	d, #0FFFFh
				bra	loc_DC69

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DC5E:							; CODE XREF: sub_DC3D+14j
				sub	d, #0CCCDh
				bcs	loc_DC65

				clr	a
				clr	b

loc_DC65:							; CODE XREF: sub_DC3D+24j
				neg	a
				neg	b
				subc	a, #00h

loc_DC69:							; CODE XREF: sub_DC3D+1Aj
								; sub_DC3D+1Fj
				st	d, unk_1C2
				cmp	d, #0C7AEh
				bgt	loc_DC74

				setb	bit2, var_flags_4E
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DC74:							; CODE XREF: sub_DC3D+32j
				clrb	bit2, var_flags_4E
				ret

; End of function sub_DC3D

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_DC77:							; CODE XREF: sub_C59B+13F0j
								; sub_C59B:loc_DA60j
				ld	a, var_flags_4E
				st	a, unk_1D1
				ld	a, unk_1DA
				st	a, var_flags_4F
				cmp	#34h, var_rpm_x_5p12
				bcc	loc_DC88

				clrb	bit0, var_flags_4F

loc_DC88:							; CODE XREF: sub_C59B+16E9j
				cmp	#3Ch, var_rpm_x_5p12
				bcs	loc_DC8F

				setb	bit0, var_flags_4F

loc_DC8F:							; CODE XREF: sub_C59B+16F0j
				ld	a, var_cnt_C9
				tbbs	bit4, var_io_input1, loc_DC97

				tbbs	bit2, var_io_input2, loc_DC9E


loc_DC97:							; CODE XREF: sub_C59B+16F6j
				cmp	a, #18h
				bcc	loc_DC9E

				clr	a
				st	a, var_cnt_C9

loc_DC9E:							; CODE XREF: sub_C59B+16F9j
								; sub_C59B+16FEj
				tbbc	bit2, var_io_input2, loc_DCB5

				tbbs	bit0, var_flags_4F, loc_DCB5

				tbbc	bit2, var_flags_46, loc_DCB5

				tbbc	bit4, var_io_input1, loc_DCB5

				cmp	#0Ah, var_speed_kph
				bcs	loc_DCB5

				cmp	a, #18h
				bcc	loc_DCB5

				clr	var_revcnt_B6

loc_DCB5:							; CODE XREF: sub_C59B:loc_DC9Ej
								; sub_C59B+1706j ...
				ld	a, var_flags_4F
				st	a, unk_1DA
				ld	a, unk_1DB
				st	a, var_flags_4F
				cmp	#34h, var_rpm_x_5p12
				bcc	loc_DCC6

				clrb	bit0, var_flags_4F

loc_DCC6:							; CODE XREF: sub_C59B+1727j
				cmp	#3Ch, var_rpm_x_5p12
				bcs	loc_DCCD

				setb	bit0, var_flags_4F

loc_DCCD:							; CODE XREF: sub_C59B+172Ej
				ld	a, var_cnt_CA
				tbbc	bit4, var_io_input2, loc_DCD8

				tbbc	bit5, var_io_input2, loc_DCDF

				tbbc	bit1, var_io_input1, loc_DCDF


loc_DCD8:							; CODE XREF: sub_C59B+1734j
				cmp	a, #18h
				bcc	loc_DCDF

				clr	a
				st	a, var_cnt_CA

loc_DCDF:							; CODE XREF: sub_C59B+1737j
								; sub_C59B+173Aj ...
				ld	b, unk_1DC
				cmpb	b, #04h
				bne	loc_DD02

				ld	a, var_cnt_CA
				cmp	a, #18h
				bcc	loc_DD02

				tbbc	bit1, var_io_input1, loc_DD02

				tbbc	bit4, var_io_input2, loc_DD02

				tbbc	bit5, var_io_input2, loc_DD02

				tbbs	bit4, var_io_input1, loc_DD02

				cmp	#19h, var_speed_kph
				bcs	loc_DD02

				tbbs	bit0, var_flags_4F, loc_DD02

				clr	var_revcnt_B7

loc_DD02:							; CODE XREF: sub_C59B+1749j
								; sub_C59B+174Fj ...
				ld	a, var_flags_4F
				st	a, unk_1DB
				clr	a
				st	a, unk_168
				ld	a, unk_1CF
				st	a, var_flags_4E
				cmp	#8Dh, var_adc_battery
				bgt	loc_DD17

				setb	bit0, var_flags_4E

loc_DD17:							; CODE XREF: sub_C59B+1778j
				tbbs	bit0, var_io_input1, loc_DD1E ;	Junp if	STA high (starter running)

				clrb	bit0, var_flags_4E
				clr	unk_E5

loc_DD1E:							; CODE XREF: sub_C59B:loc_DD17j
				cmp	#1Fh, unk_E5
				bcs	loc_DD28

				tbbc	bit0, var_flags_4E, loc_DD28

				setb	bit0, var_error_flags1	; Set STA signal error flag

loc_DD28:							; CODE XREF: sub_C59B+1786j
								; sub_C59B+1788j
				bra	loc_DD38

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_DD2A:							; CODE XREF: ignition_timing_calc+3p
				tbbs	bit2, unk_40, loc_DD2F

				clrb	bit1, var_error_flags1

loc_DD2F:							; CODE XREF: sub_DD2Aj
				ld	b, va_ne_count_2
				bmi	locret_DD37

				clr	unk_E5
				clrb	bit0, var_error_flags1	; Clear	STA signal error flag

locret_DD37:							; CODE XREF: sub_DD2A+7j
				ret

; End of function sub_DD2A

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_DD38:							; CODE XREF: sub_C59B:loc_DD28j
				ld	a, var_flags_4E
				st	a, unk_1CF
				tbbc	bit0, var_io_input1, loc_DD42 ;	Jump if	STA low	(starter not running)

				clrb	bit7, var_flags_4D

loc_DD42:							; CODE XREF: sub_C59B+17A2j
				cmp	#14h, var_rpm_x_5p12
				bcs	loc_DD51

				cmp	#07h, var_cnt_C7
				bcs	loc_DD51

				tbbc	bit7, var_flags_4D, loc_DD51

				setb	bit1, var_error_flags1

loc_DD51:							; CODE XREF: sub_C59B+17AAj
								; sub_C59B+17AFj ...
				bra	loc_DD59

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


check_starter_and_set_flag:					; CODE XREF: int_vector_9_ignition+22p
				tbbs	bit0, var_io_input1, locret_DD58 ; Jump	if STA high (starter running)

				setb	bit7, var_flags_4D

locret_DD58:							; CODE XREF: check_starter_and_set_flagj
				ret

; End of function check_starter_and_set_flag

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_DD59:							; CODE XREF: sub_C59B:loc_DD51j
				tbbc	bit1, PORTA, loc_DD64	; Port A Data Register

				tbbs	bit6, var_flags_4D, loc_DD66

				setb	bit6, var_flags_4D
				clr	var_revcnt_ne_C2
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DD64:							; CODE XREF: sub_C59B:loc_DD59j
				clrb	bit6, var_flags_4D

loc_DD66:							; CODE XREF: sub_C59B+17C1j
				jmp	loc_E112

; END OF FUNCTION CHUNK	FOR sub_C59B
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DD69:							; CODE XREF: sub_C59B+1E05p
				ld	a, dmarx_unk_242
				cmpb	a, #08h
				beq	loc_DD73

				setb	bit7, var_error_flags2
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DD73:							; CODE XREF: ROM:DD6Ej
				clrb	bit7, var_error_flags2
				cmpb	a, #10h
				beq	loc_DD7C

				setb	bit2, var_error_flags2
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DD7C:							; CODE XREF: ROM:DD77j
				clrb	bit2, var_error_flags2
				tbbs	bit6, var_io_input1, loc_DDA0

				tbbc	bit2, unk_40, loc_DD96

				clrb	bit2, unk_40
				tbbs	bit3, var_diag_errors_5, loc_DD8C

				tbbc	bit1, var_flags_4D, loc_DD96


loc_DD8C:							; CODE XREF: ROM:DD86j
				clrb	bit1, var_flags_4D
				ld	d, var_error_flags1
				and	a, #0C5h
				and	b, #05h
				st	d, var_error_flags1

loc_DD96:							; CODE XREF: ROM:DD81j
								; ROM:DD89j
				clrb	bit3, var_diag_errors_5
				ld	a, var_diag_errors_4
				and	a, #70h
				st	a, var_diag_errors_4
				clrb	bit5, var_diag_errors_5

loc_DDA0:							; CODE XREF: ROM:DD7Ej
				tbbc	bit6, var_io_input1, loc_DDB8 ;	Jump forward if	ODB stream not enabled

				ld	d, var_inj_pw_inj1
				add	d, var_inj_battery_adjust
				jsr	divide_rD_32_saturate

				st	b, dmatx_obd_inj
				ld	d, var_iscv_unk_198
				jsr	divide_rD_4_saturate

				st	b, dmatx_obd_iscv

loc_DDB8:							; CODE XREF: ROM:loc_DDA0j
				ld	a, unk_1CF
				st	a, var_flags_4E
				ld	a, unk_1D9
				st	a, var_flags_4F
				tbbc	bit2, var_flags_4F, loc_DE08

				cmp	#1Eh, var_rpm_x_5p12	; Check	RPM against 1500rpm
				bcs	loc_DE08		; Jump if it is	???

				cmp	#64h, var_speed_kph	; Check	if speed < 100kph
				bcc	loc_DE08

				cmp	#2Dh, var_pim_2
				bcs	loc_DE08

				ld	b, var_diag_errors_3
				cmpb	b, #40h
				bne	loc_DE08

				ld	b, var_diag_errors_1
				cmpb	b, #08h			; Check	if coolant temperature sensor error flag set
				bne	loc_DE08		; Jump if it isn't set

				ld	b, var_diag_errors_1
				cmpb	b, #40h
				bne	loc_DE08

				ld	b, var_diag_errors_1
				cmpb	b, #20h
				bne	loc_DE08

				ld	b, var_diag_errors_2
				cmpb	b, #40h
				bne	loc_DE08

				tbbc	bit7, var_flags_4F, loc_DE08

				ld	x, unk_187
				cmp	x, #0131h
				bcc	loc_DE08

				ld	a, var_adc_o2_heater
				cmp	a, #48h
				bcs	loc_DE08

				cmp	a, #8Fh
				bcs	loc_DE0A


loc_DE08:							; CODE XREF: ROM:DDC2j
								; ROM:DDC8j ...
				clr	var_cnt_EC

loc_DE0A:							; CODE XREF: ROM:DE06j
				cmp	#3Ch, var_cnt_EC
				bcs	loc_DE1C

				setb	bit5, var_error_flags2
				tbbc	bit2, unk_40, loc_DE1C

				ld	b, var_diag_errors_4
				or	b, #20h
				st	b, var_diag_errors_4
				setb	bit3, var_diag_errors_5

loc_DE1C:							; CODE XREF: ROM:DE0Dj
								; ROM:DE11j
				tbbc	bit1, var_flags_46, loc_DE50

				ld	b, unk_185
				cmp	#0Ah, var_cnt_ED
				bcc	loc_DE42

				ld	a, var_adc_o2_heater
				cmp	a, #48h
				bcc	loc_DE30

				setb	bit1, var_flags_4E

loc_DE30:							; CODE XREF: ROM:DE2Cj
				cmp	a, #8Fh
				bcs	loc_DE58

				tbbc	bit1, var_flags_4E, loc_DE58

				inc	b
				bne	loc_DE3B

				dec	b

loc_DE3B:							; CODE XREF: ROM:DE38j
				st	b, unk_185
				clrb	bit1, var_flags_4E
				bra	loc_DE58

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DE42:							; CODE XREF: ROM:DE25j
				cmp	b, #04h
				bcs	loc_DE50

				tbbs	bit2, unk_40, loc_DE50

				ld	a, #0DFh
				jsr	sub_DFAA

				clrb	bit5, var_error_flags2

loc_DE50:							; CODE XREF: ROM:loc_DE1Cj
								; ROM:DE44j ...
				clr	b
				st	b, unk_185
				clrb	bit1, var_flags_4E
				clr	var_cnt_ED

loc_DE58:							; CODE XREF: ROM:DE32j
								; ROM:DE34j ...
				bra	loc_DE7B


;  S U B	R O U T	I N E 


sub_DE5A:							; CODE XREF: sub_C59B+A38p
				clrb	bit7, var_flags_4F
				ld	x, unk_187
				cmp	x, #0003h
				bcs	loc_DE6B

				cmp	x, #0131h
				bcc	loc_DE6B

				setb	bit7, var_flags_4F

loc_DE6B:							; CODE XREF: sub_DE5A+8j
								; sub_DE5A+Dj
				clr	a
				clr	b
				st	d, unk_187
				ret

; End of function sub_DE5A


;  S U B	R O U T	I N E 


sub_DE71:							; CODE XREF: sub_C59B+C5Fp
				ld	x, unk_187
				inc	x
				beq	locret_DE7A

				st	x, unk_187

locret_DE7A:							; CODE XREF: sub_DE71+4j
				ret

; End of function sub_DE71

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DE7B:							; CODE XREF: ROM:loc_DE58j
				ld	a, var_flags_4E
				st	a, unk_1CF
				tbbs	bit6, unk_40, loc_DEC1

				ld	a, var_speed_kph
				bne	loc_DEAB

				cmp	#28h, var_rpm_x_5p12
				bcs	loc_DEAD

				cmp	#64h, var_rpm_x_5p12
				bcc	loc_DEAD

				cmp	#33h, var_pim_2
				bcs	loc_DEAD

				cmp	#0E4h, var_ect
				ble	loc_DEAD

				tbbs	bit6, var_limiter_flags, loc_DEAD

				ld	a, var_diag_errors_1
				cmpb	a, #08h
				bne	loc_DEAD

				ld	a, var_diag_errors_1
				cmpb	a, #20h
				beq	loc_DEAF

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DEAB:							; CODE XREF: ROM:DE85j
				clrb	bit6, var_error_flags1

loc_DEAD:							; CODE XREF: ROM:DE8Aj
								; ROM:DE8Fj ...
				clr	unk_E6

loc_DEAF:							; CODE XREF: ROM:DEA8j
				cmp	#7Ah, unk_E6
				bcs	loc_DEB6

				setb	bit6, var_error_flags1

loc_DEB6:							; CODE XREF: ROM:DEB2j
				cmp	#05h, var_speed_kph
				bcs	loc_DEC1

				ld	a, var_diag_errors_4
				and	a, #0FBh
				st	a, var_diag_errors_4

loc_DEC1:							; CODE XREF: ROM:DE80j
								; ROM:DEB9j
				tbbc	bit5, var_flags_4F, loc_DEE3

				cmp	#1Eh, var_rpm_x_5p12
				bcs	loc_DEE3

				cmp	#64h, var_speed_kph
				bcc	loc_DEE3

				cmp	#0DCh, var_ect
				bcs	loc_DEE3

				ld	a, var_diag_errors_1
				cmpb	a, #40h
				bne	loc_DEE3

				ld	a, var_diag_errors_1
				cmpb	a, #08h
				bne	loc_DEE3

				ld	a, var_adc_lambda
				bpz	loc_DEE5


loc_DEE3:							; CODE XREF: ROM:loc_DEC1j
								; ROM:DEC7j ...
				clr	var_cnt_EE

loc_DEE5:							; CODE XREF: ROM:DEE1j
				cmp	#5Ah, var_cnt_EE
				bcs	loc_DEF7

				setb	bit6, var_error_flags2
				tbbc	bit2, unk_40, loc_DEF7

				ld	a, var_diag_errors_4
				or	a, #40h
				st	a, var_diag_errors_4
				setb	bit3, var_diag_errors_5

loc_DEF7:							; CODE XREF: ROM:DEE8j
								; ROM:DEECj
				ld	a, var_adc_lambda
				bpz	loc_DF05

				tbbs	bit2, unk_40, loc_DF05

				clrb	bit6, var_error_flags2
				ld	a, #0BFh
				jsr	sub_DFAA


loc_DF05:							; CODE XREF: ROM:DEF9j
								; ROM:DEFBj
				tbbc	bit2, unk_40, loc_DF1F

				tbbc	bit5, var_io_input1, loc_DF1F

				tbbs	bit0, var_io_input1, loc_DF1F ;	Jump if	STA high (starter running)

				cmp	#5Ch, var_cnt_startup
				bcs	loc_DF16

				tbbc	bit1, var_io_input1, loc_DF1C


loc_DF16:							; CODE XREF: ROM:DF11j
				tbbs	bit3, var_io_input1, loc_DF1C

				tbbs	bit6, var_flags_42, loc_DF1F


loc_DF1C:							; CODE XREF: ROM:DF13j
								; ROM:loc_DF16j
				setb	bit5, var_diag_errors_5
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DF1F:							; CODE XREF: ROM:loc_DF05j
								; ROM:DF08j ...
				clrb	bit5, var_diag_errors_5
				tbbc	bit0, var_io_input1, loc_DF2A ;	Jump if	STA low	(starter not running)

				ld	a, var_diag_errors_4
				and	a, #0F7h		; Clear	Error 43
				st	a, var_diag_errors_4

loc_DF2A:							; CODE XREF: ROM:DF21j
				ld	a, unk_1D5
				st	a, var_flags_4E
				di
				ld	d, var_error_flags1
				tbbc	bit5, RAMST, loc_DF3A	; Built-in RAM status

				cmp	#7Ah, var_revcnt_BF
				bgt	loc_DF3F


loc_DF3A:							; CODE XREF: ROM:DF32j
				clrb	bit4, var_flags_4D	; Clear	IGT/IGF	flag
				clr	a
				bra	loc_DF60

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DF3F:							; CODE XREF: ROM:DF38j
				tbbs	bit5, IRQLL, loc_DF52	; Interrupt Request Flag LSB

				tbbs	bit5, PORTD_ASRIN, loc_DF52 ; Port D Data Register / ASR Input Data

				cmp	#7Ah, var_revcnt_BE
				ble	loc_DF52

				tbbs	bit0, var_io_input1, loc_DF52 ;	Jump if	STA high (starter running)

				cmp	#7Ah, var_revstarter_cnt_C0
				bgt	loc_DF66


loc_DF52:							; CODE XREF: ROM:loc_DF3Fj
								; ROM:DF42j ...
				and	a, #85h
				clrb	bit7, var_flags_4E
				clrb	bit4, var_diag_errors_5
				push	a
				ld	a, var_error_flags_6D
				and	a, #0FEh		; Clear	Error 16 flag
				st	a, var_error_flags_6D
				pull	a

loc_DF60:							; CODE XREF: ROM:DF3Dj
				and	b, #01h
				st	d, var_error_flags1
				clrb	bit3, var_diag_errors_5

loc_DF66:							; CODE XREF: ROM:DF50j
				st	d, var_temp_w
				tbbc	bit3, var_diag_errors_5, loc_DF6D

				setb	bit1, var_flags_4D

loc_DF6D:							; CODE XREF: ROM:DF68j
				ei
				jsr	check_IGF_error

				push	a
				mov	b, a
				and	b, #1Fh
				ld	x, #var_diag_errors_2
				or	b, x + 00h
				and	a, var_diag_errors_4
				and	a, #60h
				st	a, unk_7A
				or	b, unk_7A
				jsr	write_rB_nv_ram

				pull	b
				and	b, #0FFh
				ld	x, #var_diag_errors_1
				or	b, x + 00h
				jsr	write_rB_nv_ram

				ld	b, var_temp_b
				and	b, #60h
				or	b, var_diag_errors_3
				tbbc	bit7, var_flags_4E, loc_DF9B ; Jump if boost overpressure flag not set

				or	b, #01h			; Set boost over pressure error	flag

loc_DF9B:							; CODE XREF: ROM:DF96j
				ld	x, #var_diag_errors_3
				jsr	write_rB_nv_ram

				bra	loc_DFB8


;  S U B	R O U T	I N E 


copy_diag_errors_3_to_4:					; CODE XREF: sub_C59B+196p
				ld	a, var_diag_errors_3
				and	a, #60h
				st	a, var_diag_errors_4
				ret

; End of function copy_diag_errors_3_to_4


;  S U B	R O U T	I N E 


sub_DFAA:							; CODE XREF: ROM:DE4Bp
								; ROM:DF02p
				mov	a, b
				and	a, var_diag_errors_4
				st	a, var_diag_errors_4
				ld	x, #var_diag_errors_3
				and	b, x + 00h
				jsr	write_rB_nv_ram

				ret

; End of function sub_DFAA

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DFB8:							; CODE XREF: ROM:DFA1j
				ld	a, var_flags_4E
				st	a, unk_1D5
				clr	a
				jsr	check_diag_flags

				beq	loc_DFC6		; Jump if no diagnostic	error flags set

				setb	bit4, var_flags_46	; Set flag indicating diagnostic condition bad
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db 8Ch
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DFC6:							; CODE XREF: ROM:DFC1j
				clrb	bit4, var_flags_46	; Clear	flag indicating	diagnostic condition good
				tbbs	bit5, RAMST, loc_DFCE	; Built-in RAM status

				jmp	loc_E08D

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DFCE:							; CODE XREF: ROM:DFC8j
				tbbs	bit5, var_io_input1, loc_DFD4

				tbbc	bit0, var_flags_4D, loc_E03E

;Start of diagnostic MIL flashing code?

loc_DFD4:							; CODE XREF: ROM:loc_DFCEj
				ld	a, unk_A9
				inc	a
				beq	loc_DFFF

				ld	b, unk_183
				inc	b
				bne	loc_E00D

				ld	a, unk_A8
				beq	loc_DFFF

				dec	a
				beq	loc_DFF2

				ld	b, #78h
				cmpb	a, #0Fh
				bne	loc_E03A

				mul	a, #10h
				ld	b, #69h
				bra	loc_E03A

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DFF2:							; CODE XREF: ROM:DFE4j
				st	a, unk_A8
				ld	a, unk_A9
				jsr	check_diag_flags

				beq	loc_E008

				ld	b, #5Ah
				bra	loc_E02C

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_DFFF:							; CODE XREF: ROM:DFD7j
								; ROM:DFE1j
				jsr	check_diag_flags

				bne	loc_E008

				ld	b, #7Ch
				bra	loc_E02A

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E008:							; CODE XREF: ROM:DFF9j
								; ROM:E002j
				clr	a
				ld	b, #3Bh
				bra	loc_E02C

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E00D:							; CODE XREF: ROM:DFDDj
				bvs	loc_E012

				jmp	loc_E099

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E012:							; CODE XREF: ROM:loc_E00Dj
				ld	a, unk_A8
				bne	loc_E038

				st	a, unk_183
				tbbc	bit5, var_io_input1, loc_E03E

				setb	bit0, var_flags_4D
				ld	a, unk_A9
				bmi	loc_E028

				bne	loc_E030

				bsr	check_diag_flags

				bne	loc_E030


loc_E028:							; CODE XREF: ROM:E020j
				ld	b, #0FCh

loc_E02A:							; CODE XREF: ROM:E006j
				ld	a, #80h

loc_E02C:							; CODE XREF: ROM:DFFDj
								; ROM:E00Bj
				st	a, unk_A9
				bra	loc_E099

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E030:							; CODE XREF: ROM:E022j
								; ROM:E026j
				st	a, unk_A9
				ld	y, #loc_E0CC
				add	y, a
				ld	a, y + 02h

loc_E038:							; CODE XREF: ROM:E014j
				ld	b, #0F8h

loc_E03A:							; CODE XREF: ROM:DFEAj
								; ROM:DFF0j
				st	a, unk_A8
				bra	loc_E099

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E03E:							; CODE XREF: ROM:DFD1j
								; ROM:E019j
				tbbc	bit2, unk_40, loc_E05F

				tbbc	bit0, var_flags_46, loc_E05F

				ld	b, unk_183
				cmp	b, #7Eh
				bcc	loc_E04D

				ld	b, #7Fh

loc_E04D:							; CODE XREF: ROM:E049j
				cmp	b, #0FEh
				bgea	loc_E053

				ld	b, #0FFh

loc_E053:							; CODE XREF: ROM:E04Fj
				inc	b
				beq	loc_E05B

				bvc	loc_E05D

				ld	b, #0FEh
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E05B:							; CODE XREF: ROM:E054j
				ld	b, #7Eh

loc_E05D:							; CODE XREF: ROM:E056j
				bra	loc_E092

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E05F:							; CODE XREF: ROM:loc_E03Ej
								; ROM:E041j
				tbbc	bit2, unk_40, loc_E067

				ld	b, #0FEh
				tbbs	bit1, var_flags_4D, loc_E092


loc_E067:							; CODE XREF: ROM:loc_E05Fj
				ld	b, #0B4h
				ld	a, var_temp_w
				and	a, #0EFh
				bne	loc_E092

				ld	a, var_temp_b
				and	a, #01h
				bne	loc_E092

				ld	a, unk_1D5
				cmpb	a, #80h
				bne	loc_E092

				ld	a, var_error_flags_6D
				cmpb	a, #01h
				bne	loc_E092

				tbbs	bit4, var_diag_errors_5, loc_E092

				ld	b, unk_183
				inc	b
				bpz	loc_E08D

				bvc	loc_E092


loc_E08D:							; CODE XREF: ROM:DFCBj
								; ROM:E089j
				clr	b
				tbbc	bit0, var_flags_46, loc_E092

				dec	b

loc_E092:							; CODE XREF: ROM:loc_E05Dj
								; ROM:E064j ...
				clrb	bit0, var_flags_4D
				ld	#0FFh, unk_A9
				clr	unk_A8

loc_E099:							; CODE XREF: ROM:E00Fj
								; ROM:E02Ej ...
				st	b, unk_183
				bpz	loc_E0A1

				clrb	bit1, PORTD_ASRIN	; Turn MIL on
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E0A1:							; CODE XREF: ROM:E09Cj
				setb	bit1, PORTD_ASRIN	; Turn MIL off
				bra	locret_E111


;  S U B	R O U T	I N E 


check_diag_flags:						; CODE XREF: ROM:DFBEp
								; ROM:DFF6p ...
				ld	y, #table_diag-3
				add	a, #03h
				add	y, a
				cmp	a, #42h
				bgt	loc_E0CC

				ld	x, #0000h
				ld	b, y + 00h
				add	x, b
				ld	b, y + 01h
				cmpb	b, x + 00h
				beq	check_diag_flags


loc_E0BB:							; CODE XREF: check_diag_flags+25j
				cmp	a, #42h
				bcc	loc_E0CD

				ld	b, y + 02h
				cmp	b, y + 05h
				bne	loc_E0CD

				add	a, #03h
				inc	y
				inc	y
				inc	y
				bra	loc_E0BB

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E0CC:							; CODE XREF: check_diag_flags+8j
								; DATA XREF: ROM:E032o
				clr	a			; Clear	rA, which will set Z flag

loc_E0CD:							; CODE XREF: check_diag_flags+18j
								; check_diag_flags+1Ej
				cmpz	a			; Set Z	flag if	rA == 0
				ret				; Return

; End of function check_diag_flags

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
;Table for diagnostic error codes
;
;Each entry is 3 bytes:
;Offset	0 - Bit	to check for diagnostic	error.
;Offset	1 - Address of byte containing above bit to check.
;Offset	2 - Error code with nibbles swapped.
table_diag:			.db var_diag_errors_1		; DATA XREF: check_diag_flagst
				.db 01h
				.db 21h				; 12 RPM signal	1 (G1 or G2)
				.db var_diag_errors_1
				.db 80h
				.db 21h				; 12 RPM signal	1 (G1 or G2)
				.db var_diag_errors_1
				.db 02h
				.db 31h				; 13 RPM signal	2 (Ne)
				.db var_diag_errors_1
				.db 04h
				.db 41h				; 14 Ignition signal
				.db var_error_flags_6D
				.db 01h
				.db 61h				; 16 Sub-CPU failure
				.db var_diag_errors_2
				.db 20h
				.db 12h				; 21 O2	Sensor
				.db var_diag_errors_2
				.db 04h
				.db 12h				; 21 O2	Sensor
				.db var_diag_errors_1
				.db 08h
				.db 22h				; 22 Coolant temperature sensor
				.db var_diag_errors_2
				.db 10h
				.db 32h				; 23 Manifold air temperature sensor
				.db var_diag_errors_1
				.db 10h
				.db 42h				; 24 Intake air	temperature sensor
				.db var_diag_errors_2
				.db 40h
				.db 52h				; 25 Lean error
				.db var_diag_errors_1
				.db 20h
				.db 13h				; 31 Turbo pressure sensor
				.db var_diag_errors_3
				.db 01h
				.db 43h				; 34 Boost pressure
				.db var_diag_errors_2
				.db 02h
				.db 14h				; 41 Primary throttle position sensor
				.db var_diag_errors_1
				.db 40h
				.db 24h				; 42 Speed sensor signal
				.db var_diag_errors_4
				.db 04h
				.db 24h				; 42 Speed sensor signal
				.db var_diag_errors_4
				.db 08h
				.db 34h				; 43 Starter signal
				.db var_diag_errors_2
				.db 08h
				.db 74h				; 47 Secondary throttle	position
				.db var_diag_errors_5
				.db 20h
				.db 15h				; 51 Air-con switch signal
				.db var_diag_errors_2
				.db 01h
				.db 25h				; 52 Knock signal
				.db var_diag_errors_5
				.db 10h
				.db 35h				; 53 Knock management
				.db var_diag_errors_2
				.db 80h
				.db 45h				; 54 Chargecooler pump/level
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

locret_E111:							; CODE XREF: ROM:E0A3j
				ret

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_E112:							; CODE XREF: sub_C59B:loc_DD66j
				jmp	loc_E363

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_E115:							; CODE XREF: sub_C59B+1E08p

; FUNCTION CHUNK AT E2B5 SIZE 000000AE BYTES

				tbbc	bit5, var_io_input1, loc_E13D

				tbbc	bit0, var_io_input1, loc_E13F ;	Jump if	STA low	(starter not running)

				tbbc	bit3, var_io_input1, loc_E13F

				tbbc	bit2, var_io_input1, loc_E13F

				ld	a, var_adc_unk_154
				cmp	a, #9Ah
				bcs	loc_E13F

				ld	a, var_tps_raw
				cmp	a, #9Ah
				bcs	loc_E13F

				ld	d, var_rpm_x_5p12
				bne	loc_E13F

				cmp	#0B4h, var_speed_kph	; cmp #0FFh,$5Dh
				bcs	loc_E13F		; bra 0E13Fh

				tbbs	bit1, var_io_input1, loc_E142

				bra	loc_E13F

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E13D:							; CODE XREF: sub_E115j
				clrb	bit0, unk_40

loc_E13F:							; CODE XREF: sub_E115+3j
								; sub_E115+6j ...
				jmp	loc_E2B5

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E142:							; CODE XREF: sub_E115+23j
				clr	a
				ld	b, #04h
				st	d, IMASK		; Interrupt Request Mask MSB
				clr	DOM			; DOUT Control Register

loc_E149:							; CODE XREF: sub_E115+86j
				tbbs	bit7, var_io_input1, loc_E166

				tbbs	bit4, var_io_input1, loc_E152

				jmp	loc_E19D

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E152:							; CODE XREF: sub_E115+37j
				ld	a, #0Ah
				st	a, unk_223
				ld	b, #15h
				or	b, #0C0h
				st	b, word_224
				ld	#01h, PORTD_ASRIN	; Port D Data Register / ASR Input Data
				ld	#0Dh, DOUT		; DOUT Data Register
				bra	loc_E18C

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E166:							; CODE XREF: sub_E115:loc_E149j
				ld	a, #15h
				tbbc	bit5, PORTD_ASRIN, loc_E16D ; Port D Data Register / ASR Input Data

				xor	a, #01h

loc_E16D:							; CODE XREF: sub_E115+53j
				tbbs	bit7, PORTB, loc_E172	; Port B Data Register

				xor	a, #04h

loc_E172:							; CODE XREF: sub_E115:loc_E16Dj
				st	a, unk_223
				ld	a, #0Ah
				or	a, #0A0h
				tbbc	bit1, var_io_input2, loc_E17E

				xor	a, #04h

loc_E17E:							; CODE XREF: sub_E115+64j
				tbbc	bit0, var_io_input2, loc_E183

				xor	a, #08h

loc_E183:							; CODE XREF: sub_E115:loc_E17Ej
				st	a, word_224
				ld	#02h, PORTD_ASRIN	; Port D Data Register / ASR Input Data
				ld	#0Eh, DOUT		; DOUT Data Register

loc_E18C:							; CODE XREF: sub_E115+4Fj
				ld	x, #0F9C8h

loc_E18F:							; CODE XREF: sub_E115+7Bj
				inc	x
				bne	loc_E18F

				jsr	sub_E254

				ld	x, #0F9C0h

loc_E198:							; CODE XREF: sub_E115+84j
				inc	x
				bne	loc_E198

				bra	loc_E149

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E19D:							; CODE XREF: sub_E115+3Aj
				di
				clr	a
				clr	b
				st	d, IMASK		; Interrupt Request Mask MSB
				ld	a, #80h
				st	a, word_224
				ld	x, #0F9C8h		; Delay	loop

loc_E1AA:							; CODE XREF: sub_E115+96j
				inc	x
				bne	loc_E1AA

				jsr	sub_E254

				ld	x, #0F9C0h		; Delay	loop

loc_E1B3:							; CODE XREF: sub_E115+9Fj
				inc	x
				bne	loc_E1B3

				jsr	watchdog_kick

				ld	x, #0F9C0h		; Delay	loop

loc_E1BC:							; CODE XREF: sub_E115+A8j
				inc	x
				bne	loc_E1BC

				ld	#04h, PORTB		; Port B Data Register
				ld	#08h, DOUT		; DOUT Data Register
				div	d, #00h
				div	d, #00h
				clrb	bit2, DOM
				setb	bit2, DOUT
				ld	b, #2Fh			; Delay	loop

loc_E1CF:							; CODE XREF: sub_E115+BBj
				dec	b
				bne	loc_E1CF

				inc	b
				ld	#03h, PORTB		; Port B Data Register
				tbbc	bit5, PORTB, loc_E1DF	; Port B Data Register

				tbbs	bit4, PORTB, loc_E1DF	; Port B Data Register

				tbbs	bit3, PORTB, loc_E1E1	; Port B Data Register


loc_E1DF:							; CODE XREF: sub_E115+C1j
								; sub_E115+C4j
				bra	loc_E230

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
;Start of RAM test, writes to all of RAM (0x40-0x300) with values 0 to 255.

loc_E1E1:							; CODE XREF: sub_E115+C7j
								; sub_E115+13Cj
				clrb	bit1, PORTD_ASRIN	; Turn on MIL
				clr	a			; Clear	RAM value counter

loc_E1E4:							; CODE XREF: sub_E115+ECj
				mov	a, b			; Copy test value into b for checking later
				ld	y, #unk_40		; Get address of start of RAM

loc_E1E8:							; CODE XREF: sub_E115+D8j
				st	a, [y]			; Write	test value to RAM & increment y
				inc	a			; Increment test value
				cmp	y, #var_nv_tps		; Check	if reached end of RAM
				bcs	loc_E1E8		; Loop back if not there yet

				ld	y, #unk_40		; Get address of start of RAM again

loc_E1F2:							; CODE XREF: sub_E115+E5j
				ld	a, [y]			; Read value from RAM &	increment y
				cmp	a, b			; Check	value read matches test	value
				bne	loc_E22F		; Jump out of RAM test if failure

				inc	b			; Increment test value
				cmp	y, #var_nv_tps		; Check	if reached end of RAM
				bcs	loc_E1F2		; Loop back if not there yet

				jsr	watchdog_kick

				inc	b			; Increment test value
				mov	b, a			; Copy back into a for next iteration
				bne	loc_E1E4		; Loop back to test RAM	again with new starting	value

;Start of ROM test, checksums ROM to make sure it sums to 0xAA55

				ld	x, #unk_C000		; Load X with address of start of ROM
				clr	a			; Clear	16 bit checksum
				clr	b

loc_E208:							; CODE XREF: sub_E115+103j
				ld	y, #unk_100		; Checksum 256 words of	ROM

loc_E20B:							; CODE XREF: sub_E115+FBj
				add	d, x + 00h		; Add ROM 16 bit word to checksum
				inc	x			; Increment address
				inc	x			; Increment address
				dec	y			; Decrement word counter
				bne	loc_E20B		; Loop back if more words to checksum

				jsr	watchdog_kick

				cmp	x, #0000h		; Has the complete ROM been checksummed
				bne	loc_E208		; Jump back if not

				cmp	d, #0AA55h		; Is ROM checksum equal	to 0xAA55
				bne	loc_E22F		; Jump forward if ROM checksum error

				tbbs	bit5, PORTB, loc_E230	; Port B Data Register

				tbbc	bit4, PORTB, loc_E230	; Port B Data Register

				tbbs	bit3, PORTB, loc_E230	; Port B Data Register

				shl	b
				setb	bit1, PORTD_ASRIN	; Turn off MIL
				ld	a, #19h
				bra	loc_E242

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E22F:							; CODE XREF: sub_E115+DFj
								; sub_E115+108j
				clr	b

loc_E230:							; CODE XREF: sub_E115:loc_E1DFj
								; sub_E115+10Aj ...
				tbs	bit1, PORTD_ASRIN	; Check	if MIL is on
				beq	loc_E236		; Jump forward if so

				clrb	bit1, PORTD_ASRIN	; Turn on MIL

loc_E236:							; CODE XREF: sub_E115+11Dj
				ld	a, #7Dh
				cmpz	b
				beq	loc_E242

				cmp	b, #0FFh
				bne	loc_E241

				ld	a, #5Eh

loc_E241:							; CODE XREF: sub_E115+128j
				shl	a

loc_E242:							; CODE XREF: sub_E115+118j
								; sub_E115+124j ...
				ld	x, #0F7B5h

loc_E245:							; CODE XREF: sub_E115+131j
				inc	x
				bne	loc_E245

				bsr	watchdog_kick

				dec	a
				bne	loc_E242

				cmp	b, #0AAh
				bne	loc_E230

				jmp	loc_E1E1

; End of function sub_E115


;  S U B	R O U T	I N E 


sub_E254:							; CODE XREF: sub_E115+7Dp
								; sub_E115+98p
				push	d
				tbs	bit0, PORTA		; Port A Data Register
				beq	loc_E25B

				clrb	bit0, PORTA

loc_E25B:							; CODE XREF: sub_E254+3j
				jsr	check_io_inputs		; Read inputs

				jsr	start_dma

				tbbc	bit0, var_io_input1, loc_E282

				tbbc	bit3, var_io_input1, loc_E282

				tbbs	bit6, PORTB, loc_E282	; Check	for request for	diagnostic check on TE1

				tbbs	bit2, PORTA, loc_E282	; Port A Data Register

				pull	d
				ret

; End of function sub_E254


;  S U B	R O U T	I N E 


watchdog_kick:							; CODE XREF: sub_E115+A1p
								; sub_E115+E7p	...
				tbs	bit0, PORTA		; Port A Data Register
				beq	loc_E275

				clrb	bit0, PORTA

loc_E275:							; CODE XREF: watchdog_kick+2j
				tbbc	bit1, PORTA, loc_E282	; Port A Data Register

				tbbs	bit4, PORTA, loc_E282	; Port A Data Register

				tbbs	bit6, PORTB, loc_E282	; Check	for request for	diagnostic check on TE1

				tbbs	bit2, PORTA, loc_E282	; Port A Data Register

				ret

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E282:							; CODE XREF: sub_E254+Dj
								; sub_E254+10j	...
				ld	x, #0F9C0h

loc_E285:							; CODE XREF: watchdog_kick+17j
				inc	x
				bne	loc_E285

				tbs	bit0, PORTA		; Port A Data Register
				beq	loc_E28E

				clrb	bit0, PORTA

loc_E28E:							; CODE XREF: watchdog_kick+1Bj
				ld	x, #0F9C0h

loc_E291:							; CODE XREF: watchdog_kick+23j
				inc	x
				bne	loc_E291

				ld	y, #unk_40
				clr	a
				clr	b
				st	d, IRQL			; Interrupt Request Flag MSB

loc_E29B:							; CODE XREF: watchdog_kick+30j
				st	d, [y]
				cmp	y, #stack_top
				ble	loc_E29B

				ld	s, #stack_top
				ld	#0DDh, PORTA		; Port A Data Register
				ld	#0D9h, PORTB		; Port B Data Register
				ld	#03h, PORTD_ASRIN	; Port D Data Register / ASR Input Data
				ld	#08h, DOUT		; DOUT Data Register
				setb	bit0, unk_40
				jmp	loc_C67A

; End of function watchdog_kick

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_E115

loc_E2B5:							; CODE XREF: sub_E115:loc_E13Fj
				tbbs	bit0, unk_40, loc_E2BB

				jmp	locret_E362

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E2BB:							; CODE XREF: sub_E115:loc_E2B5j
				ld	a, #09h
				or	a, #0E0h
				st	a, word_224
				clr	a
				tbbs	bit1, var_io_input1, loc_E2DC

				tbbc	bit6, var_io_input2, loc_E2CB

				or	a, #01h

loc_E2CB:							; CODE XREF: sub_E115+1B1j
				tbbc	bit7, var_io_input2, loc_E2D0

				or	a, #02h

loc_E2D0:							; CODE XREF: sub_E115:loc_E2CBj
				tbbc	bit3, var_io_input2, loc_E2D5

				or	a, #04h

loc_E2D5:							; CODE XREF: sub_E115:loc_E2D0j
				tbbc	bit2, var_io_input2, loc_E2DA

				or	a, #08h

loc_E2DA:							; CODE XREF: sub_E115:loc_E2D5j
				bra	loc_E2F3

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E2DC:							; CODE XREF: sub_E115+1AEj
				tbbc	bit4, var_io_input2, loc_E2E1

				or	a, #01h

loc_E2E1:							; CODE XREF: sub_E115:loc_E2DCj
				tbbc	bit5, var_io_input2, loc_E2E6

				or	a, #02h

loc_E2E6:							; CODE XREF: sub_E115:loc_E2E1j
				tbbc	bit2, var_io_input1, loc_E2EB

				or	a, #04h

loc_E2EB:							; CODE XREF: sub_E115:loc_E2E6j
				ld	b, SMRC_SIR		; Serial Master	Register Control
				cmpb	b, #02h
				beq	loc_E2F3

				or	a, #08h

loc_E2F3:							; CODE XREF: sub_E115:loc_E2DAj
								; sub_E115+1DAj
				ld	b, var_ect
				cmp	b, #18h
				bcs	loc_E358

				ld	a, dmarx_unk_245
				cmp	b, #26h
				bcs	loc_E35D

				ld	a, damrx_unk_244
				cmp	b, #3Ah
				bcs	loc_E35A

				ld	a, var_adc_idle_unk_1CE
				tbbc	bit0, var_io_input1, loc_E31C

				ld	a, var_adc_idle_unk_1CD
				tbbc	bit1, var_io_input1, loc_E31C

				ld	a, var_adc_idle_unk_1CC
				tbbc	bit3, var_io_input1, loc_E31C

				ld	a, var_adc_idle_unk_1CB

loc_E31C:							; CODE XREF: sub_E115+1F5j
								; sub_E115+1FBj ...
				cmp	b, #6Bh
				bcs	loc_E35D

				ld	a, var_tha
				tbbc	bit1, var_io_input1, loc_E328

				ld	a, dmarx_rpm_x_5p12

loc_E328:							; CODE XREF: sub_E115+20Dj
				cmp	b, #92h
				bcs	loc_E35D

				ld	a, var_tps_raw
				cmp	b, #0A9h
				bcs	loc_E35D

				ld	a, var_adc_o2_heater
				cmp	b, #0BCh
				bcs	loc_E35D

				ld	a, #0B8h
				cmp	b, #0CBh
				bcs	loc_E35D

				ld	a, var_speed_kph
				cmp	b, #0DCh
				bcs	loc_E35D

				ld	a, var_adc_o2_sensor
				cmp	b, #0EAh
				bcs	loc_E35D

				ld	a, var_tham
				cmp	b, #0F3h		; 113.5	deg
				bcs	loc_E35D

				ld	a, var_adc_unk_154
				bra	loc_E35D

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E358:							; CODE XREF: sub_E115+1E2j
				add	a, #08h

loc_E35A:							; CODE XREF: sub_E115+1F0j
				shl	a
				shl	a
				shl	a

loc_E35D:							; CODE XREF: sub_E115+1E9j
								; sub_E115+209j ...
				mul	a, #04h
				st	d, var_iscv_unk_198

locret_E362:							; CODE XREF: sub_E115+1A3j
				ret

; END OF FUNCTION CHUNK	FOR sub_E115
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_E363:							; CODE XREF: sub_C59B:loc_E112j
				tbs	bit7, unk_41
				beq	loc_E36A

				jmp	loc_E3A6

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E36A:							; CODE XREF: sub_C59B+1DCAj
				ld	d, #0E107h
				jsr	increment_counters

				ld	a, unk_E8
				inc	a
				st	a, unk_E8
				cmpb	a, #01h
				bne	loc_E37F

				ld	d, #0E901h
				jsr	increment_counters


loc_E37F:							; CODE XREF: sub_C59B+1DDCj
				jsr	sub_E435

				jsr	sub_CB0B

				jsr	sub_EC1A

				jsr	sub_D376

				ld	a, unk_1D7
				st	a, var_flags_4E
				jsr	sub_D4BC

				ld	a, unk_1D1
				st	a, var_flags_4E
				jsr	loc_DA63

				ld	a, var_flags_4E
				st	a, unk_1D1
				jsr	loc_DD69

				jsr	sub_E115


loc_E3A6:							; CODE XREF: sub_C59B+1DCCj
				jsr	sub_E454

				jsr	sub_E551

				tbbs	bit0, var_flags_46, loc_E3B2

				jmp	loc_E452

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E3B2:							; CODE XREF: sub_C59B+1E11j
				ld	y, #table_C112
				jsr	table_ect_pair_interpolate

				st	d, unk_7A
				ld	d, var_rpm_x_5p12
				ld	y, #table_C12D
				jsr	sub_C434

				push	a
				ld	y, #table_C137
				jsr	table_ect_fixed_32_interpolate

				pull	b
				cmp	a, b
				bcc	loc_E3CE

				mov	a, b

loc_E3CE:							; CODE XREF: sub_C59B+1E30j
				tbbs	bit0, unk_40, loc_E3D9

				ld	a, unk_9F
				cmp	a, #7Ah
				bcs	loc_E3D9

				ld	b, #1Ah

loc_E3D9:							; CODE XREF: sub_C59B:loc_E3CEj
								; sub_C59B+1E3Aj
				clr	a
				ld	x, unk_7A
				jsr	mult_rDrX

				st	d, unk_7A
				ld	b, var_adc_battery
				ld	y, #table_battery_unk_C13C
				jsr	table_rB_fixed_16_interpolate

				mov	a, b
				ld	x, unk_7A
				jsr	mult_rBrX2

				st	d, unk_7A
				tbbc	bit7, var_flags_46, loc_E405

				ld	d, #0758h
				tbbs	bit0, var_io_input1, loc_E423

				ld	d, #0564h
				tbbc	bit2, var_flags_46, loc_E423

				ld	d, #014Ah
				bra	loc_E423

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E405:							; CODE XREF: sub_C59B+1E56j
				tbbs	bit3, var_flags_4D, loc_E41B ; Jump if using default PIM value

				clr	b
				ld	a, var_trim_unk_98
				tbbs	bit0, var_flags_42, loc_E410 ; Jump if trims valid

				ld	a, #50h

loc_E410:							; CODE XREF: sub_C59B+1E70j
				div	d, #61h
				bcc	loc_E416

				ld	b, #0FFh

loc_E416:							; CODE XREF: sub_C59B+1E77j
				ld	x, unk_7A
				jsr	mult_rBrX


loc_E41B:							; CODE XREF: sub_C59B:loc_E405j
				cmp	d, #62500
				ble	loc_E423

				ld	d, #62500

loc_E423:							; CODE XREF: sub_C59B+1E5Cj
								; sub_C59B+1E62j ...
				di
				st	d, var_inj_pw_inj1
				st	d, var_inj_pw_inj2
				st	d, var_inj_pw_inj3
				st	d, var_inj_pw_inj4
				clrb	bit7, var_ignition_flags
				ei
				bra	loc_E452

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_E435:							; CODE XREF: sub_C59B:loc_E37Fp
				ld	a, unk_9F
				tbbc	bit0, var_flags_46, loc_E440

				tbbc	bit0, var_io_input1, loc_E440

				inc	a
				beq	loc_E44E


loc_E440:							; CODE XREF: sub_E435+2j
								; sub_E435+5j
				cmp	#20h, var_rpm_div_25
				bcc	loc_E44E

				cmp	#3Dh, var_cnt_startup
				bcc	loc_E44E

				cmp	a, #0A8h
				bcs	loc_E44F


loc_E44E:							; CODE XREF: sub_E435+9j
								; sub_E435+Ej ...
				clr	a

loc_E44F:							; CODE XREF: sub_E435+17j
				st	a, unk_9F
				ret

; End of function sub_E435

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_E452:							; CODE XREF: sub_C59B+1E14j
								; sub_C59B+1E98j
				bra	loc_E4B9

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_E454:							; CODE XREF: sub_C59B+48Bp
								; sub_C59B:loc_E3A6p
				ld	x, var_scaled_ve_tham
				ld	a, dmarx_fuel_enrich
				beq	closed_loop		; Check	if open	or closed loop,	jump if	closed loop

				tbbc	bit2, unk_44, loc_E469

				tbbc	bit2, var_flags_4D, loc_E469

				mul	a, #80h
				shl	d
				bcc	loc_E469

				ld	a, #0FFh

loc_E469:							; CODE XREF: sub_E454+8j
								; sub_E454+Bj ...
				mov	a, b
				add	b, #80h
				bcc	loc_E470

				ld	b, #0FFh

loc_E470:							; CODE XREF: sub_E454+18j
				jsr	mult_rBrX2


closed_loop:							; CODE XREF: sub_E454+6j
				ld	b, var_fuel_enrich_rpm
				bmi	loc_E47B

				jsr	mult_rBrX2


loc_E47B:							; CODE XREF: sub_E454+22j
				push	x
				jsr	sub_D1A1

				clr	a
				add	b, unk_62
				addc	a, #00h
				add	d, #0100h
				st	d, var_temp_w
				mov	s, x
				ld	x, x + 00h
				jsr	sub_C4F5

				jsr	divide_rD_32_saturate

				st	b, unk_1CA
				ld	a, unk_1D1
				st	a, var_flags_4E
				jsr	sub_DBA3

				ld	a, var_flags_4E
				st	a, unk_1D1
				ld	d, unk_1C6
				jsr	divide_rD_128

				add	d, var_temp_w
				sub	d, #0199h
				bcc	loc_E4B1

				clr	a
				clr	b

loc_E4B1:							; CODE XREF: sub_E454+59j
				pull	x
				jsr	sub_C4F5

				st	d, unk_138
				ret

; End of function sub_E454

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_E4B9:							; CODE XREF: sub_C59B:loc_E452j
				ld	x, #0080h
				ld	a, dmarx_unk_230
				add	x, a			; rX = 128 + unk230
				ld	a, dmarx_unk_231
				add	x, a
				add	x, a			; rX = 128 + unk230 + 2*unk231
				ld	a, dmarx_unk_234
				add	x, a
				add	x, a
				add	x, a
				add	x, a			; rX = 128 + unk230 + 2*unk231 + 4*unk234
				tbbc	bit2, var_flags_46, loc_E4D4

				ld	a, dmarx_unk_233
				add	x, a
				add	x, a			; rX = 128 + unk230 + 2*unk231 + 4*unk234 + 2*unk233

loc_E4D4:							; CODE XREF: sub_C59B+1F31j
				ld	a, dmarx_unk_236
				add	x, a
				mov	x, d
				sub	b, unk_120
				subc	a, #00h
				shl	d
				mov	d, x
				ld	b, dmarx_max_retard_23B_unk
				cmp	b, #80h
				beq	loc_E4EB

				jsr	sub_C4F1

				mov	d, x

loc_E4EB:							; CODE XREF: sub_C59B+1F4Aj
				ld	d, dmarx_scaled_ve
				jsr	mult_rDrX

				mov	d, x
				tbbc	bit2, var_flags_46, loc_E4FA

				ld	b, unk_60
				jsr	mult_rBrX2


loc_E4FA:							; CODE XREF: sub_C59B+1F57j
				ld	b, dmarx_tham_enrich_unk
				jsr	sub_C4F1

				st	d, var_scaled_ve_tham
				clrb	bit0, var_diag_errors_5
				ld	a, var_nv_idle_trim
				tbbs	bit0, var_flags_42, loc_E50C ; Jump if idle trim valid

				ld	a, #66h

loc_E50C:							; CODE XREF: sub_C59B+1F6Cj
				mul	a, #04h
				st	d, var_temp_b
				ld	d, var_iscv_unk_198
				sub	d, var_temp_b
				bcc	loc_E51A

				jsr	set_knock_sensor_err_flag


loc_E51A:							; CODE XREF: sub_C59B+1F7Aj
				mov	d, x
				ld	a, #19h
				jsr	mult_rArX

				jsr	check_knock_sensor_err_flag

				tbbc	bit1, var_diag_errors_5, loc_E52B

				add	d, #0010h
				bvs	loc_E530


loc_E52B:							; CODE XREF: sub_C59B+1F88j
				cmpz	a
				bmi	loc_E533

				beq	loc_E534


loc_E530:							; CODE XREF: sub_C59B+1F8Ej
				ld	b, #0FFh
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  41h ; A
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E533:							; CODE XREF: sub_C59B+1F91j
				clr	b

loc_E534:							; CODE XREF: sub_C59B+1F93j
				st	b, unk_143
				bra	loc_E54E

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_E539:							; CODE XREF: sub_C59B+2018p
								; sub_E767p
				ld	d, var_tps
				cmpz	a
				bne	loc_E53F

				clr	b

loc_E53F:							; CODE XREF: sub_E539+3j
				st	d, var_temp_w
				ld	a, unk_143
				mul	a, #40h
				add	d, var_temp_w
				bcc	locret_E54D

				ld	d, #0FFFFh

locret_E54D:							; CODE XREF: sub_E539+Fj
				ret

; End of function sub_E539

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_E54E:							; CODE XREF: sub_C59B+1F9Cj
				jmp	loc_E7CD

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_E551:							; CODE XREF: sub_C59B+48Ep
								; sub_C59B+1E0Ep
				jsr	sub_E767

				st	a, unk_137
				mov	x, d
				st	a, unk_145
				ld	b, unk_144
				jsr	mult_rBrX2

				st	x, unk_131
				ld	d, var_pim_2
				tbbs	bit0, unk_40, loc_E56F

				tbbs	bit0, var_flags_46, loc_E56F

				tbbc	bit7, unk_47, loc_E572


loc_E56F:							; CODE XREF: sub_E551+15j
								; sub_E551+18j
				jmp	loc_E627

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E572:							; CODE XREF: sub_E551+1Bj
				ld	d, var_inj_pw_inj1
				add	d, #0591h
				bcc	loc_E57D

				ld	d, #0FFFFh

loc_E57D:							; CODE XREF: sub_E551+27j
				shr	d
				shr	d
				shr	d
				st	d, var_temp_w
				ld	a, unk_109
				mul	a, #0ABh
; End of function sub_E551

; START	OF FUNCTION CHUNK FOR sub_C59B
				add	d, #053Fh
				bcc	loc_E58F

				ld	d, #0FFFFh

loc_E58F:							; CODE XREF: sub_C59B+1FEFj
				sub	d, #0755h
				jsr	divide_rD_32_saturate

				mov	b, a
				ld	y, #var_ne_sum3
				mul	a, y + 00h
				add	d, #0100h
				bcs	loc_E5A4

				add	d, var_temp_w
				bcc	loc_E5A6


loc_E5A4:							; CODE XREF: sub_C59B+2003j
				ld	a, #0FFh

loc_E5A6:							; CODE XREF: sub_C59B+2007j
				cmp	a, #0Eh
				ble	loc_E5AC

				ld	a, #0Eh

loc_E5AC:							; CODE XREF: sub_C59B+200Dj
				push	a
				shr	a
				st	a, unk_7B
				tbbc	bit6, unk_47, loc_E5DC

				bsr	sub_E539

				jsr	divide_rD_64

				st	d, var_temp_w
				ld	a, var_tps_delta
				st	a, unk_7A
				mul	a, unk_7B
				cmp	#00h, unk_7A
				bpz	loc_E5CE

				sub	a, unk_7B
				add	d, var_temp_w
				bcs	loc_E5D0

				clr	a
				clr	b
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E5CE:							; CODE XREF: sub_C59B+2028j
				add	d, var_temp_w

loc_E5D0:							; CODE XREF: sub_C59B+202Ej
				shl	d
				shl	d
				shl	d
				jsr	sub_E76D

				ld	b, unk_144
				jsr	mult_rBrX2


loc_E5DC:							; CODE XREF: sub_C59B+2015j
				pull	a
				st	a, unk_7B
				ld	d, var_unk_knk_133
				st	d, var_temp_w

loc_E5E4:							; CODE XREF: sub_C59B+2055j
				push	x
				ld	y, #var_temp_w
				ld	b, unk_7A
				jsr	sub_C56D

				pull	x
				dec	unk_7B
				bne	loc_E5E4

				clrb	bit0, var_diag_errors_5
				sub	d, var_unk_knk_135
				bcc	loc_E5FC

				jsr	set_knock_sensor_err_flag


loc_E5FC:							; CODE XREF: sub_C59B+205Cj
				push	d
				ld	a, var_pim_2
				sub	a, #61h
				ble	loc_E611

				ld	x, #0000h
				jsr	mult_rArX

				add	d, #0100h
				pull	x
				jsr	mult_rDrX

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  41h ; A
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E611:							; CODE XREF: sub_C59B+2066j
				pull	d
				jsr	check_knock_sensor_err_flag

				tbbc	bit0, var_diag_errors_5, loc_E620

				add	d, var_pim_2
				bcs	loc_E627

				clr	a
				clr	b
				bra	loc_E627

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E620:							; CODE XREF: sub_C59B+207Aj
				add	d, var_pim_2
				bcc	loc_E627

				ld	d, #0FFFFh

loc_E627:							; CODE XREF: sub_E551:loc_E56Fj
								; sub_C59B+207Fj ...
				st	d, dmatx_pim
				ld	d, unk_131
				sub	d, var_unk_knk_135
				bcs	loc_E638

				bpz	loc_E63C

				ld	a, #7Fh
				bra	loc_E63C

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E638:							; CODE XREF: sub_C59B+2095j
				bmi	loc_E63C

				ld	a, #80h

loc_E63C:							; CODE XREF: sub_C59B+2097j
								; sub_C59B+209Bj ...
				st	a, unk_146
				ld	d, var_unk_knk_133
				sub	d, var_unk_knk_135
				bcs	loc_E64D

				bpz	loc_E651

				ld	a, #7Fh
				bra	loc_E651

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E64D:							; CODE XREF: sub_C59B+20AAj
				bmi	loc_E651

				ld	a, #80h

loc_E651:							; CODE XREF: sub_C59B+20ACj
								; sub_C59B+20B0j ...
				st	a, unk_147
				jsr	sub_EA22

				jsr	sub_E865

				ld	a, unk_1D6
				st	a, var_flags_4E
				tbbc	bit0, var_flags_46, loc_E665

				jmp	loc_E75E

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E665:							; CODE XREF: sub_C59B+20C4j
				ld	a, #61h
				sub	a, var_trim_unk_98
				bcc	loc_E66C

				clr	a

loc_E66C:							; CODE XREF: sub_C59B+20CEj
				mul	a, #12h
				push	d
				jsr	divide_rD_64_saturate

				st	b, unk_FC
				pull	d
				add	d, dmatx_pim
				bcc	loc_E67D

				ld	d, #0FFFFh

loc_E67D:							; CODE XREF: sub_C59B+20DDj
				cmp	d, #0000h
				bcc	loc_E688

				ld	d, #0000h
				setb	bit2, var_diag_errors_5
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E688:							; CODE XREF: sub_C59B+20E5j
				clrb	bit2, var_diag_errors_5
				jsr	divide_rD_16

				mov	d, x
				push	x
				ld	a, unk_1CA
				jsr	mult_rArX

				ld	x, #6400h
				tbbs	bit6, var_flags_46, loc_E69E

				ld	x, #6400h

loc_E69E:							; CODE XREF: sub_C59B+20FDj
				jsr	sub_C59B

				sub	d, #3333h
				bcc	loc_E6A8

				clr	a
				clr	b

loc_E6A8:							; CODE XREF: sub_C59B+2109j
				st	d, unk_1C8
				pull	x
				ld	d, unk_138
				jsr	divide_rD_16

				jsr	mult_rDrX

				tbbs	bit0, unk_40, loc_E6CE

				st	d, var_temp_w
				ld	d, unk_127
				bpz	loc_E6C7

				add	d, var_temp_w
				bcs	loc_E6CE

				clr	a
				clr	b
				bra	loc_E6CE

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E6C7:							; CODE XREF: sub_C59B+2122j
				add	d, var_temp_w
				bcc	loc_E6CE

				ld	d, #0FFFFh

loc_E6CE:							; CODE XREF: sub_C59B+211Aj
								; sub_C59B+2126j ...
				st	d, var_temp_w
				cmp	#30h, var_rpm_x_5p12
				bcc	loc_E6DD

				cmp	#2Ch, var_rpm_x_5p12
				bcc	loc_E6DF

				clrb	bit1, var_flags_4E
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E6DD:							; CODE XREF: sub_C59B+2138j
				setb	bit1, var_flags_4E

loc_E6DF:							; CODE XREF: sub_C59B+213Dj
				cmp	#39h, var_pim_2
				bcs	loc_E6F4

				tbbs	bit2, var_flags_46, loc_E6F4

				cmp	#0CAh, var_ect
				bcs	loc_E6F4

				cmp	#0D2h, var_ect
				bcs	loc_E6F6

				setb	bit0, var_flags_4E
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E6F4:							; CODE XREF: sub_C59B+2147j
								; sub_C59B+2149j ...
				clrb	bit0, var_flags_4E

loc_E6F6:							; CODE XREF: sub_C59B+2154j
				ld	y, #var_inj_pw_array
				ld	x, #table_unk_C25B
				tbbc	bit1, var_flags_4E, loc_E702

				ld	x, #table_unk_C25F

loc_E702:							; CODE XREF: sub_C59B+2161j
								; sub_C59B+218Cj
				push	x
				push	y
				ld	a, x + 00h
				ld	x, var_temp_w
				tbbs	bit0, unk_40, loc_E70E

				tbbs	bit0, var_flags_4E, loc_E70F


loc_E70E:							; CODE XREF: sub_C59B+216Dj
				clr	a

loc_E70F:							; CODE XREF: sub_C59B+2170j
				jsr	mult_rArX

				add	d, var_temp_w
				bcc	loc_E719

				ld	d, #0FFFFh

loc_E719:							; CODE XREF: sub_C59B+2179j
				ld	y, #unk_C3B9
				jsr	y + 27h			; jmp C3E0

				pull	y
				pull	x
				st	d, [y]
				cmp	y, #(var_inj_pw_array+6)
				bgt	loc_E729

				inc	x
				bra	loc_E702

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E729:							; CODE XREF: sub_C59B+2189j
				tbbs	bit7, var_flags_46, loc_E72F

				tbbc	bit3, var_flags_4D, loc_E74A ; Jump if not using default PIM value


loc_E72F:							; CODE XREF: sub_C59B:loc_E729j
				ld	d, #0294h		; Default injector PW
				tbbs	bit2, var_flags_46, loc_E738

				ld	d, #0AC8h		; Alternative default injector PW

loc_E738:							; CODE XREF: sub_C59B+2197j
				di
				st	d, var_inj_pw_inj1	; Update injector 1 pulse-width
				st	d, var_inj_pw_inj2	; Update injector 2 pulse-width
				st	d, var_inj_pw_inj3	; Update injector 3 pulse-width
				st	d, var_inj_pw_inj4	; Update injector 4 pulse-width
				setb	bit7, var_ignition_flags ; Set injector	pulsewidth updated flag
				ei
				bra	loc_E75E

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E74A:							; CODE XREF: sub_C59B+2191j
				ld	x, #var_inj_pw_inj1
				ld	y, #var_inj_pw_array
				di

loc_E751:							; CODE XREF: sub_C59B+21BEj
				ld	d, [y]
				st	d, x + 00h
				inc	x
				inc	x
				cmp	x, #var_inj_pw_inj4
				ble	loc_E751

				setb	bit7, var_ignition_flags ; Set injector	pulsewidth updated flag
				ei

loc_E75E:							; CODE XREF: sub_C59B+20C7j
								; sub_C59B+21ADj
				ld	a, var_flags_4E
				st	a, unk_1D6
				jsr	sub_F375

				ret

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_E767:							; CODE XREF: sub_E551p
				jsr	sub_E539

				shr	d
				shr	d
				shr	d
; End of function sub_E767


;  S U B	R O U T	I N E 


sub_E76D:							; CODE XREF: sub_C59B+2038p
				cmp	a, #05h
				bcs	loc_E77B

				add	a, #05h
				shr	d
				cmp	a, #08h
				bcs	loc_E77B

				add	a, #08h
				shr	d

loc_E77B:							; CODE XREF: sub_E76D+2j
								; sub_E76D+9j
				mov	d, x
				ld	d, var_rpm_x_5p12
				shr	d
				shr	d
				cmp	a, #06h
				bcs	loc_E787

				add	a, #06h
				shr	d

loc_E787:							; CODE XREF: sub_E76D+15j
				ld	y, #map_c006		; 3-D map address
				jsr	map_2d_interpolate

				push	d
				jsr	divide_rD_8

				mov	d, x
				ld	d, var_rpm_x_5p12
				ld	y, #map_c0c7
				jsr	sub_C485

				st	a, unk_7A
				pull	x
				ret

; End of function sub_E76D


;  S U B	R O U T	I N E 


knock_unk_E79E:							; CODE XREF: sub_F7C7+67p
				ld	x, unk_131
				tbbc	bit0, var_flags_46, loc_E7A7

				st	x, var_unk_knk_133

loc_E7A7:							; CODE XREF: knock_unk_E79E+3j
				ld	y, #var_unk_knk_133
				ld	b, unk_137
				jsr	sub_C56D

				ret

; End of function knock_unk_E79E


;  S U B	R O U T	I N E 


some_knock_averaging_calc:					; CODE XREF: sub_F7C7:loc_F831p
				ld	d, var_unk_knk_133
				tbbs	bit0, var_flags_46, loc_E7C9

				sub	d, var_unk_knk_135
				beq	locret_E7CC

				rorc	a
				rorc	b
				shra	a
				rorc	b
				cmp	d, #0000h
				bne	loc_E7C6

				inc	b

loc_E7C6:							; CODE XREF: some_knock_averaging_calc+12j
				add	d, var_unk_knk_135

loc_E7C9:							; CODE XREF: some_knock_averaging_calc+3j
				st	d, var_unk_knk_135

locret_E7CC:							; CODE XREF: some_knock_averaging_calc+9j
				ret

; End of function some_knock_averaging_calc

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_E7CD:							; CODE XREF: sub_C59B:loc_E54Ej
				ld	y, #table_C168
				ld	b, unk_129
				bpz	loc_E7D8

				ld	y, #table_C172

loc_E7D8:							; CODE XREF: sub_C59B+2238j
				ld	d, var_rpm_x_5p12
				jsr	sub_C430

				st	a, unk_13C
				tbbs	bit5, unk_44, loc_E7FD

				ld	y, #unk_C185
				jsr	table_ect_fixed_32_interpolate

				bsr	sub_E843

				st	d, var_temp_w
				ld	y, #table_C17C
				jsr	table_ect_fixed_32_interpolate

				add	d, var_temp_w
				bcc	loc_E7FA

				ld	d, #0FFFFh

loc_E7FA:							; CODE XREF: sub_C59B+225Aj
				st	d, unk_13D

loc_E7FD:							; CODE XREF: sub_C59B+2245j
				ld	y, #table_C18E
				jsr	table_ect_pair_interpolate

				st	d, var_temp_w
				ld	y, #table_C1B0
				jsr	table_ect_pair_interpolate

				bsr	sub_E843

				add	d, unk_13D
				bcc	loc_E815

				ld	d, #0FFFFh

loc_E815:							; CODE XREF: sub_C59B+2275j
				bsr	sub_E84F

				st	d, unk_13F
				ld	y, #table_C19F
				jsr	table_ect_pair_interpolate

				st	d, var_temp_w
				ld	y, #table_C1C1
				jsr	table_ect_pair_interpolate

				bsr	sub_E843

				bsr	sub_E84F

				st	d, unk_141
				jmp	loc_EA17

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_E832:							; CODE XREF: sub_E865+1A3p
				tbbc	bit5, unk_44, locret_E842

				ld	d, unk_13D
				sub	d, #000Ch
				bcc	loc_E83F

				clr	a
				clr	b

loc_E83F:							; CODE XREF: sub_E832+9j
				st	d, unk_13D

locret_E842:							; CODE XREF: sub_E832j
				ret

; End of function sub_E832


;  S U B	R O U T	I N E 


sub_E843:							; CODE XREF: sub_C59B+224Ep
								; sub_C59B+2270p ...
				mov	d, x
				ld	a, var_trim_unk_96
				tbbs	bit0, var_flags_42, loc_E84B ; Jump if trims valid

				ld	a, #00h

loc_E84B:							; CODE XREF: sub_E843+3j
				jsr	mult_rArX

				ret

; End of function sub_E843


;  S U B	R O U T	I N E 


sub_E84F:							; CODE XREF: sub_C59B:loc_E815p
								; sub_C59B+228Fp
				add	d, var_temp_w
				bcc	loc_E856

				ld	d, #0FFFFh

loc_E856:							; CODE XREF: sub_E84F+2j
				mov	d, x
				ld	a, dmarx_unk_241
				jsr	mult_rArX

				add	a, #04h
				bcc	locret_E864

				ld	d, #0FFFFh

locret_E864:							; CODE XREF: sub_E84F+10j
				ret

; End of function sub_E84F


;  S U B	R O U T	I N E 


sub_E865:							; CODE XREF: sub_C59B+D3Ap
								; sub_C59B+20BCp ...
				tbs	bit3, unk_41
				beq	loc_E86C

				jmp	locret_EA0B

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E86C:							; CODE XREF: sub_E865+2j
				ld	d, dmatx_pim
				ld	y, #table_pim_unk_C154
				jsr	sub_C430

				shr	d
				tbbs	bit5, unk_44, loc_E890

				st	d, var_unk_knock_12B
				st	d, unk_12D
				st	d, unk_12F
				clr	a
				clr	b
				st	d, unk_129
				st	d, unk_127
				ld	#0FFh, unk_AA
				jmp	locret_EA0B

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E890:							; CODE XREF: sub_E865+11j
				push	d
				ld	x, unk_12F
				cmp	d, unk_12F
				bcc	loc_E89D

				mov	d, x
				ld	d, unk_12F

loc_E89D:							; CODE XREF: sub_E865+32j
				st	d, var_temp_w
				st	x, unk_7A
				ld	y, #var_temp_w
				ld	d, var_unk_knock_12B
				jsr	clamp_rD

				push	d
				clrb	bit0, var_diag_errors_5
				sub	d, var_unk_knock_12B
				bcc	loc_E8B5

				jsr	set_knock_sensor_err_flag


loc_E8B5:							; CODE XREF: sub_E865+4Bj
				cmp	d, #0100h
				bcs	loc_E8E3

				mov	d, x
				ld	a, dmarx_unk_240
				tbbc	bit0, var_diag_errors_5, loc_E8C4

				ld	a, dmarx_ign_timing_unk

loc_E8C4:							; CODE XREF: sub_E865+59j
				neg	a
				cmp	a, #00h
				bne	loc_E8CA

				dec	a

loc_E8CA:							; CODE XREF: sub_E865+62j
				mul	a, #80h
				jsr	mult_rDrX

				mov	x, d
				jsr	check_knock_sensor_err_flag

				add	d, unk_129
				bvc	loc_E8E0

				ld	d, #7FFFh
				tbbc	bit0, var_diag_errors_5, loc_E8E0

				inc	a
				inc	b

loc_E8E0:							; CODE XREF: sub_E865+71j
								; sub_E865+76j
				st	d, unk_129

loc_E8E3:							; CODE XREF: sub_E865+53j
				pull	d
				st	d, var_unk_knock_12B
				ld	y, #var_temp_w
				ld	d, unk_12D
				jsr	clamp_rD

				st	d, unk_12D
				pull	d
				mov	d, y
				tbbc	bit0, var_limiter_flags, loc_E8FA

				clr	unk_AA

loc_E8FA:							; CODE XREF: sub_E865+90j
				cmp	#02h, unk_AA
				bcc	loc_E907

				inc	unk_AA
				tbbs	bit2, var_flags_46, loc_E907

				add	d, #01F4h

loc_E907:							; CODE XREF: sub_E865+98j
								; sub_E865+9Cj
				sub	d, unk_12D
				ld	x, unk_12D
				st	x, unk_12F
				ld	x, var_unk_knock_12B
				st	x, unk_12D
				xch	x, y
				st	x, var_unk_knock_12B
				clrb	bit0, var_diag_errors_5
				bcc	loc_E921

				jsr	set_knock_sensor_err_flag


loc_E921:							; CODE XREF: sub_E865+B7j
				mov	d, x
				ld	b, dmarx_ign_timing
				tbbc	bit0, var_diag_errors_5, loc_E92B ; Jump if no knock sensor error

				ld	b, dmarx_ign_timing_fallback1

loc_E92B:							; CODE XREF: sub_E865+C0j
				jsr	mult_rBrX2

				st	d, var_temp_w
				ld	y, #table_C163
				jsr	sub_C437

				st	a, unk_7A
				ld	a, dmarx_ign_timing_unk
				tbbc	bit0, var_diag_errors_5, loc_E941 ; Jump if no knock sensor error

				ld	a, dmarx_unk_240

loc_E941:							; CODE XREF: sub_E865+D6j
				mul	a, unk_7A
				shl	d
				bcc	loc_E948

				ld	a, #0FFh

loc_E948:							; CODE XREF: sub_E865+DFj
				mov	a, b
				neg	b
				cmp	b, #00h
				bne	loc_E94F

				dec	b

loc_E94F:							; CODE XREF: sub_E865+E7j
				push	b
				ld	x, var_temp_w
				jsr	mult_rArX

				cmpz	a
				bpz	loc_E95B

				ld	d, #7FFFh

loc_E95B:							; CODE XREF: sub_E865+F1j
				jsr	check_knock_sensor_err_flag

				st	d, unk_7A
				ld	x, var_temp_w
				pull	a
				mul	a, #80h
				jsr	mult_rDrX

				mov	x, d
				jsr	check_knock_sensor_err_flag

				st	d, var_temp_w
				clrb	bit0, var_diag_errors_5
				ld	d, unk_129
				bpz	loc_E978

				jsr	set_knock_sensor_err_flag


loc_E978:							; CODE XREF: sub_E865+10Ej
				mov	d, x
				push	d
				ld	a, unk_13C
				push	a
				mul	a, #80h
				shr	d
				shr	d
				neg	a
				neg	b
				subc	a, #00h
				cmp	d, #0000h
				bne	loc_E98D

				dec	a
				dec	b

loc_E98D:							; CODE XREF: sub_E865+124j
				jsr	mult_rDrX

				mov	x, d
				jsr	check_knock_sensor_err_flag

				add	d, var_temp_w
				bvc	loc_E9A0

				ld	d, #7FFFh
				tbbc	bit0, var_diag_errors_5, loc_E9A0

				inc	a
				inc	b

loc_E9A0:							; CODE XREF: sub_E865+131j
								; sub_E865+136j
				jsr	sub_EA0C

				st	d, unk_129
				pull	a
				pull	x
				jsr	mult_rArX

				shr	d
				shr	d
				jsr	check_knock_sensor_err_flag

				add	d, unk_7A
				bvc	loc_E9BC

				ld	d, #7FFFh
				tbbc	bit0, var_diag_errors_5, loc_E9BC

				inc	a
				inc	b

loc_E9BC:							; CODE XREF: sub_E865+14Dj
								; sub_E865+152j
				jsr	sub_EA0C

				mov	d, x
				clrb	bit0, var_diag_errors_5
				cmpz	a
				bpz	loc_E9C8

				jsr	set_knock_sensor_err_flag


loc_E9C8:							; CODE XREF: sub_E865+15Ej
				push	d
				cmp	d, #0020h
				bcc	loc_E9F0

				ld	d, #0040h
				st	a, var_temp_b
				st	b, unk_7B
				ld	a, unk_141
				st	a, unk_7A
				ld	a, unk_13F
				st	a, unk_7C
				ld	#02h, var_temp_w
				mov	x, d
				add	d, #0020h
				mov	b, a
				clr	b
				ld	y, #var_temp_w
				jsr	table_pair_interpolate

				bra	loc_E9F9

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_E9F0:							; CODE XREF: sub_E865+167j
				ld	d, unk_13F
				tbbc	bit0, var_diag_errors_5, loc_E9F9

				ld	d, unk_141

loc_E9F9:							; CODE XREF: sub_E865+189j
								; sub_E865+18Ej
				mov	d, x
				pull	d
				shl	d
				jsr	mult_rDrX

				jsr	sub_C539

				jsr	check_knock_sensor_err_flag

				st	d, unk_127
				jsr	sub_E832


locret_EA0B:							; CODE XREF: sub_E865+4j
								; sub_E865+28j
				ret

; End of function sub_E865


;  S U B	R O U T	I N E 


sub_EA0C:							; CODE XREF: sub_E865:loc_E9A0p
								; sub_E865:loc_E9BCp
				cmpz	a
				bpz	locret_EA16

				cmp	#7Ah, var_cnt_startup
				bcc	locret_EA16

				clr	a
				clr	b

locret_EA16:							; CODE XREF: sub_EA0C+1j
								; sub_EA0C+6j
				ret

; End of function sub_EA0C

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_C59B

loc_EA17:							; CODE XREF: sub_C59B+2294j
				bsr	sub_EA22

				jsr	sub_E865

				nop
				nop
				nop
				jmp	loc_C749

; END OF FUNCTION CHUNK	FOR sub_C59B

;  S U B	R O U T	I N E 


sub_EA22:							; CODE XREF: sub_C59B:loc_D2D2p
								; sub_C59B+20B9p ...

; FUNCTION CHUNK AT EAAC SIZE 000000AB BYTES
; FUNCTION CHUNK AT EC24 SIZE 000000EE BYTES
; FUNCTION CHUNK AT ED23 SIZE 000000A8 BYTES
; FUNCTION CHUNK AT EE14 SIZE 0000007F BYTES
; FUNCTION CHUNK AT EEBD SIZE 0000006F BYTES
; FUNCTION CHUNK AT EF48 SIZE 00000069 BYTES

				cmp	#3Dh, var_cnt_C7
				bcs	loc_EA2D

				setb	bit2, var_ignition_flags
				clrb	bit4, var_ignition_flags
				clrb	bit0, var_ignition_flags

loc_EA2D:							; CODE XREF: sub_EA22+3j
				ld	y, #table_battery_unk_C267
				ld	a, var_adc_battery
				clr	b
				jsr	table_pair_interpolate

				st	a, var_temp_w
				ld	y, #table_rpm_unk_C272
				jsr	table_rpm_pair_interpolate

				mul	a, var_temp_w
				jsr	divide_rD_32

				st	d, var_ign_unk_173
				ld	y, #table_rpm_unk_C27D
				jsr	table_rpm_pair_interpolate

				st	a, var_ign_unk_172
				ld	a, unk_1D2
				st	a, var_flags_4E
				ld	y, #unk_C2F2
				ld	b, var_rpm_div_25
				jsr	table_rB_fixed_32_interpolate

				st	a, unk_7A
				tbbs	bit2, var_flags_46, loc_EA6A

				ld	a, var_unk_knk_133
				add	a, #0Ah
				cmp	a, unk_7A
				bcc	loc_EA6E


loc_EA6A:							; CODE XREF: sub_EA22+3Cj
				setb	bit0, var_flags_4E
				clr	unk_A3

loc_EA6E:							; CODE XREF: sub_EA22+46j
				cmp	#0D2h, var_ect
				bcs	loc_EA78

				cmp	#78h, var_rpm_div_25
				bcs	loc_EA7A


loc_EA78:							; CODE XREF: sub_EA22+4Fj
				clrb	bit0, var_flags_4E

loc_EA7A:							; CODE XREF: sub_EA22+54j
				tbbc	bit0, var_flags_4E, loc_EA95

				ld	b, unk_147
				cmp	b, #06h
				blta	loc_EA95

				ld	a, var_unk_knk_133
				cmp	a, unk_7A
				bcs	loc_EA95

				ld	y, #unk_C2F7
				jsr	table_rpm_pair_interpolate

				st	a, unk_A3
				clrb	bit0, var_flags_4E

loc_EA95:							; CODE XREF: sub_EA22:loc_EA7Aj
								; sub_EA22+60j	...
				bra	loc_EAAC

; End of function sub_EA22


;  S U B	R O U T	I N E 


sub_EA97:							; CODE XREF: sub_EA22:loc_EC33p
				ld	a, unk_A3
				beq	locret_EAA2

				sub	a, #09h
				bcc	loc_EAA0

				clr	a

loc_EAA0:							; CODE XREF: sub_EA97+6j
				st	a, unk_A3

locret_EAA2:							; CODE XREF: sub_EA97+2j
				ret

; End of function sub_EA97


;  S U B	R O U T	I N E 


sub_EAA3:							; CODE XREF: sub_EA22:loc_EEBDp
				ld	a, unk_A3
				cmp	a, #2Bh
				ble	locret_EAAB

				ld	a, #2Bh

locret_EAAB:							; CODE XREF: sub_EAA3+4j
				ret

; End of function sub_EAA3

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_EA22

loc_EAAC:							; CODE XREF: sub_EA22:loc_EA95j
				ld	a, var_flags_4E
				st	a, unk_1D2
				ld	a, unk_1D3
				st	a, var_flags_4E
				tbbs	bit6, unk_40, loc_EAE0

				cmp	#5Ch, var_cnt_startup
				bcs	loc_EAE0

				ld	b, var_gearing
				ld	y, #table_gearing_unk_C2CD
				jsr	table_rB_fixed_32_interpolate

				cmp	a, var_rpm_div_25
				ble	loc_EAE0

				cmp	#28h, var_rpm_div_25
				bcs	loc_EAE0

				cmp	#03h, var_speed_kph
				bcs	loc_EAE0

				cmp	#0D2h, var_ect
				bcs	loc_EAE0

				cmp	#93h, var_adc_battery
				bcs	loc_EAE0

				setb	bit1, var_flags_4E

loc_EAE0:							; CODE XREF: sub_EA22+94j
								; sub_EA22+9Aj	...
				ld	a, unk_147
				ld	b, var_unk_knk_133
				st	d, var_temp_w
				tbbc	bit2, var_flags_46, loc_EAEF

				clr	var_cnt_D9
				clrb	bit1, var_flags_4E

loc_EAEF:							; CODE XREF: sub_EA22+C6j
				tbbc	bit1, var_io_input1, loc_EAF8

				clrb	bit0, var_flags_4E
				clrb	bit2, var_flags_4E
				bra	loc_EB32

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EAF8:							; CODE XREF: sub_EA22:loc_EAEFj
				cmp	a, #0FEh
				blta	loc_EB37

				tbbs	bit2, var_flags_4E, loc_EB0B

				cmp	a, #05h
				blta	loc_EB0B

				cmp	b, #21h
				bcs	loc_EB0B

				clr	var_revcnt_BD
				setb	bit2, var_flags_4E

loc_EB0B:							; CODE XREF: sub_EA22+DAj
								; sub_EA22+DFj	...
				ld	y, #table_gearing_unk_C2E7
				ld	b, var_gearing
				jsr	table_rB_fixed_32_interpolate

				cmp	a, var_revcnt_BD
				bcs	loc_EB37

				ld	d, var_temp_w
				tbbc	bit1, var_flags_4E, loc_EB39

				tbbs	bit0, var_flags_4E, loc_EB39

				cmp	a, #09h
				blta	loc_EB39

				cmp	b, #4Dh
				bcs	loc_EB39

				cmp	#1Fh, var_cnt_D9
				bcc	loc_EB39

				setb	bit3, var_flags_4E
				setb	bit0, var_flags_4E
				bra	loc_EB39

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EB32:							; CODE XREF: sub_EA22+D4j
				ld	a, #0FFh
				st	a, unk_15E

loc_EB37:							; CODE XREF: sub_EA22+D8j
								; sub_EA22+F3j
				clrb	bit3, var_flags_4E

loc_EB39:							; CODE XREF: sub_EA22+F7j
								; sub_EA22+FAj	...
				ld	d, var_temp_w
				tbbc	bit0, unk_44, loc_EB41

				tbbc	bit2, var_flags_46, loc_EB49


loc_EB41:							; CODE XREF: sub_EA22+119j
				cmp	a, #08h
				blta	loc_EB54

				cmp	b, #26h
				bcs	loc_EB54


loc_EB49:							; CODE XREF: sub_EA22+11Cj
				clr	a
				st	a, var_cnt_DA
				st	a, unk_162
				ld	a, var_rpm_div_25
				st	a, unk_167

loc_EB54:							; CODE XREF: sub_EA22+121j
								; sub_EA22+125j
				jmp	loc_EC24

; END OF FUNCTION CHUNK	FOR sub_EA22

;  S U B	R O U T	I N E 


sub_EB57:							; CODE XREF: sub_EA22+552p
				tbbc	bit3, var_flags_4E, loc_EB66

				ld	b, var_knock_unk_157
				ld	y, #table_knock_unk_C2D4
				jsr	table_rB_fixed_32_interpolate

				st	a, unk_15E

loc_EB66:							; CODE XREF: sub_EB57j
				ld	d, var_rpm_x_5p12
				cmp	d, #5400h
				bcc	loc_EB70

				jsr	calc_rpm


loc_EB70:							; CODE XREF: sub_EB57+14j
				st	d, unk_163
				mov	d, x
				sub	d, unk_165
				bcs	loc_EB7E

				jsr	divide_rD_2_saturate

				bra	loc_EB84

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EB7E:							; CODE XREF: sub_EB57+20j
				clr	b
				ld	a, var_rpm_div_25
				st	a, unk_167

loc_EB84:							; CODE XREF: sub_EB57+25j
				st	b, unk_161
				st	x, unk_165
				tbbs	bit2, var_flags_46, loc_EBAB

				ld	a, var_rpm_div_25
				sub	a, unk_167
				bcc	loc_EB95

				clr	a

loc_EB95:							; CODE XREF: sub_EB57+3Bj
				cmp	a, #0Eh
				bcc	loc_EBAB

				tbbc	bit1, var_flags_4E, loc_EBAB

				ld	a, var_gearing
				cmp	a, #20h
				bcs	loc_EBAB

				cmp	a, #8Dh
				bcc	loc_EBAB

				cmp	#99h, var_cnt_D9
				bcs	loc_EBB3


loc_EBAB:							; CODE XREF: sub_EB57+33j
								; sub_EB57+40j	...
				ld	d, #0FFFEh
				st	a, unk_162
				st	b, var_cnt_DA

loc_EBB3:							; CODE XREF: sub_EB57+52j
				ld	b, unk_161
				sub	b, unk_162
				bcc	loc_EBBC

				clr	b

loc_EBBC:							; CODE XREF: sub_EB57+62j
				ld	y, #table_unk_C2DB
				jsr	table_rB_fixed_32_interpolate

				push	d
				ld	y, #unk_C2EE
				ld	b, var_tps
				jsr	table_rB_fixed4_interpolate

				mov	a, b
				pull	x
				jsr	mult_rBrX2

				sub	a, var_knock_unk_157
				bcs	loc_EBD6

				clr	a

loc_EBD6:							; CODE XREF: sub_EB57+7Cj
				neg	a
				st	a, unk_15F
				cmp	a, unk_15E
				ble	loc_EBE2

				ld	a, unk_15E

loc_EBE2:							; CODE XREF: sub_EB57+86j
				add	a, unk_160
				bcc	loc_EBE9

				ld	a, #0FFh

loc_EBE9:							; CODE XREF: sub_EB57+8Ej
				cmp	a, #00h
				bcc	loc_EBEF

				ld	a, #00h

loc_EBEF:							; CODE XREF: sub_EB57+94j
				st	a, var_min_ign_timing
				ret

; End of function sub_EB57


;  S U B	R O U T	I N E 


sub_EBF3:							; CODE XREF: sub_F7C7+5Cp
				ld	b, unk_1D3
				cmpb	b, #08h
				bne	locret_EC06

				ld	b, #04h
				add	b, unk_15E
				bcc	loc_EC03

				ld	b, #0FFh

loc_EC03:							; CODE XREF: sub_EBF3+Cj
				st	b, unk_15E

locret_EC06:							; CODE XREF: sub_EBF3+5j
				ret

; End of function sub_EBF3


;  S U B	R O U T	I N E 


sub_EC07:							; CODE XREF: sub_C59B+C5Cp
				clr	a
				cmp	#14h, var_cnt_DA
				bcs	loc_EC16

				ld	a, unk_162
				add	a, #04h
				bcc	loc_EC16

				ld	a, #0FFh

loc_EC16:							; CODE XREF: sub_EC07+4j
								; sub_EC07+Bj
				st	a, unk_162
				ret

; End of function sub_EC07


;  S U B	R O U T	I N E 


sub_EC1A:							; CODE XREF: sub_C59B+1DEAp
				ld	y, #table_C2E2
				jsr	table_ect_pair_interpolate

				st	a, unk_160
				ret

; End of function sub_EC1A

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_EA22

loc_EC24:							; CODE XREF: sub_EA22:loc_EB54j
				ld	a, var_flags_4E
				st	a, unk_1D3
				jsr	sub_F6C5

				tbs	bit1, unk_41
				beq	loc_EC33

				jmp	locret_EFB0

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EC33:							; CODE XREF: sub_EA22+20Cj
				jsr	sub_EA97

				ld	a, var_ect
				cmp	#32h, var_rpm_x_5p12
				bcs	loc_EC41

				cmp	a, #86h
				bcc	loc_EC4D


loc_EC41:							; CODE XREF: sub_EA22+219j
				cmp	a, #0DCh
				bcc	loc_EC4D

				tbbs	bit2, var_flags_46, loc_EC8A

				cmp	#61h, var_pim_2
				ble	loc_EC62


loc_EC4D:							; CODE XREF: sub_EA22+21Dj
								; sub_EA22+221j
				ld	a, unk_156
				sub	a, #80h
				beq	loc_EC91

				bgt	loc_EC5A

				add	a, #01h
				bra	loc_EC5C

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EC5A:							; CODE XREF: sub_EA22+232j
				sub	a, #01h

loc_EC5C:							; CODE XREF: sub_EA22+236j
				bcs	loc_EC91

				add	a, #80h
				bra	loc_EC93

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EC62:							; CODE XREF: sub_EA22+229j
				st	a, var_temp_w
				ld	y, #table_unk_C284
				jsr	table_rA_pair_interpolate

				st	a, unk_7C
				ld	a, var_temp_w
				ld	y, #table_unk_C295
				jsr	table_rA_pair_interpolate

				st	a, unk_7A
				ld	d, #4E57h
				st	a, var_temp_b
				st	b, unk_7B
				ld	#02h, var_temp_w
				ld	d, var_pim_2
				ld	y, #var_temp_w
				jsr	table_pair_interpolate

				bra	loc_EC93

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EC8A:							; CODE XREF: sub_EA22+223j
				ld	y, #table_unk_C2A6
				jsr	table_rA_pair_interpolate

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EC91:							; CODE XREF: sub_EA22+230j
								; sub_EA22:loc_EC5Cj
				ld	a, #80h

loc_EC93:							; CODE XREF: sub_EA22+23Ej
								; sub_EA22+266j
				st	a, unk_156
				ld	a, unk_1D4
				st	a, var_flags_4E
				ld	a, #55h
				tbbc	bit2, var_flags_46, loc_ECBE

				cmp	#5Ch, var_cnt_startup
				bcs	loc_ECBE

				cmp	#3Dh, var_cnt_D2
				bcs	loc_ECBE

				ld	d, unk_74
				add	d, #00C0h
				sub	d, var_rpm_x_5p12
				bcc	loc_ECB5

				clr	a
				clr	b

loc_ECB5:							; CODE XREF: sub_EA22+28Fj
				jsr	divide_rD_2_saturate

				ld	y, #table_unk_C2B7
				jsr	table_rB_fixed_32_interpolate


loc_ECBE:							; CODE XREF: sub_EA22+27Bj
								; sub_EA22+281j ...
				st	a, var_temp_w
				clrb	bit0, var_flags_4E
				tbbs	bit6, var_flags_46, loc_ECCC

				tbbc	bit1, var_flags_4E, loc_ECD2

				clrb	bit1, var_flags_4E
				bra	loc_ECD0

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_ECCC:							; CODE XREF: sub_EA22+2A0j
				tbs	bit1, var_flags_4E
				bne	loc_ECD2


loc_ECD0:							; CODE XREF: sub_EA22+2A8j
				setb	bit0, var_flags_4E

loc_ECD2:							; CODE XREF: sub_EA22+2A3j
								; sub_EA22+2ACj
				tbbs	bit6, var_flags_42, loc_ECDC

				tbbc	bit2, var_flags_4E, loc_ECE2

				clrb	bit2, var_flags_4E
				bra	loc_ECE0

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_ECDC:							; CODE XREF: sub_EA22:loc_ECD2j
				tbs	bit2, var_flags_4E
				bne	loc_ECE2


loc_ECE0:							; CODE XREF: sub_EA22+2B8j
				setb	bit0, var_flags_4E

loc_ECE2:							; CODE XREF: sub_EA22+2B3j
								; sub_EA22+2BCj
				tbbs	bit0, var_flags_46, loc_ED01

				tbbc	bit2, var_flags_46, loc_ED09

				cmp	#28h, var_rpm_div_25
				bcc	loc_ED09

				cmp	#15h, var_rpm_div_25
				bcs	loc_ED09

				cmp	#02h, var_speed_kph
				bcc	loc_ED09

				cmp	#0E4h, var_ect
				bcs	loc_ED09

				tbbs	bit0, var_flags_4E, loc_ED09

				bra	loc_ED23

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_ED01:							; CODE XREF: sub_EA22:loc_ECE2j
				clr	a
				clr	b
				st	d, unk_17F
				st	d, unk_181

loc_ED09:							; CODE XREF: sub_EA22+2C3j
								; sub_EA22+2C9j ...
				clr	var_cnt_D8
				bsr	sub_ED19

				bsr	sub_ED12

				jmp	loc_ED6E

; END OF FUNCTION CHUNK	FOR sub_EA22

;  S U B	R O U T	I N E 


sub_ED12:							; CODE XREF: sub_EA22+2EBp
								; sub_EA22+308p ...
				di
				clr	a
				st	a, unk_178
				ei
				ret

; End of function sub_ED12


;  S U B	R O U T	I N E 


sub_ED19:							; CODE XREF: sub_EA22+2E9p
								; sub_EA22+32Fp ...
				ld	d, #8080h
				st	d, unk_17B
				st	d, unk_17D
				ret

; End of function sub_ED19

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_EA22

loc_ED23:							; CODE XREF: sub_EA22+2DDj
				ld	a, unk_178
				cmp	a, #20h
				bcs	loc_ED6E

				bsr	sub_ED12

				ld	y, #unk_17B

loc_ED2F:							; CODE XREF: sub_EA22+31Bj
				push	y
				pull	x

loc_ED31:							; CODE XREF: sub_EA22+319j
				inc	y
				cmp	y, #unk_17F
				bcc	loc_ED3F

				ld	a, x + 00h
				cmp	a, y + 00h
				bcc	loc_ED31

				bra	loc_ED2F

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_ED3F:							; CODE XREF: sub_EA22+313j
				ld	a, x + 00h
				cmp	a, #83h
				bcs	loc_ED53

				ld	a, x + 04h
				add	a, #09h
				cmp	a, #33h
				ble	loc_ED4F

				ld	a, #33h

loc_ED4F:							; CODE XREF: sub_EA22+329j
				st	a, x + 04h
				bsr	sub_ED19


loc_ED53:							; CODE XREF: sub_EA22+321j
				ld	y, #unk_17F

loc_ED56:							; CODE XREF: sub_EA22+33Aj
				ld	a, [y]
				beq	loc_ED6E

				cmp	y, #unk_183
				bcs	loc_ED56

				ld	y, #unk_17F

loc_ED61:							; CODE XREF: sub_EA22+34Aj
				ld	a, y + 00h
				sub	a, #09h
				bcc	loc_ED68

				clr	a

loc_ED68:							; CODE XREF: sub_EA22+343j
				st	a, [y]
				cmp	y, #unk_183
				bcs	loc_ED61


loc_ED6E:							; CODE XREF: sub_EA22+2EDj
								; sub_EA22+306j ...
				ld	a, var_cnt_D8
				bne	loc_ED85

				di
				ld	y, #017Fh
				ld	a, #2Bh

loc_ED78:							; CODE XREF: sub_EA22+360j
				cmp	a, y + 00h
				bcc	loc_ED7E

				st	a, y + 00h

loc_ED7E:							; CODE XREF: sub_EA22+358j
				inc	y
				cmp	y, #unk_183
				bcs	loc_ED78

				ei

loc_ED85:							; CODE XREF: sub_EA22+34Ej
				ld	b, var_temp_w
				cmp	#06h, var_cnt_D8
				bcs	loc_EDC1

				clr	a
				clr	b
				ld	y, #017Fh

loc_ED91:							; CODE XREF: sub_EA22+377j
				add	b, y + 00h
				addc	a, #00h
				inc	y
				cmp	y, #unk_183
				bcs	loc_ED91

				jsr	divide_rD_4_saturate

				st	b, var_temp_b
				ld	b, var_ne_count		; NE counter
								; Bits 0-3: Counter 0->5, corresponds crank position
								; Bits 4-7: Counter 0->3, corresponds to cylinder
				shr	b
				shr	b
				shr	b
				shr	b
				add	b, #02h
				and	b, #03h
				ld	y, #017Fh
				add	y, b
				clr	a
				ld	b, var_temp_w
				add	b, y + 00h
				addc	a, #00h
				sub	b, var_temp_b
				subc	a, #00h
				beq	loc_EDC1

				bcs	loc_EDC0

				ld	b, #0FFh
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  41h ; A
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EDC0:							; CODE XREF: sub_EA22+399j
				clr	b

loc_EDC1:							; CODE XREF: sub_EA22+368j
								; sub_EA22+397j
				ld	y, #unk_C3BF
				jsr	y + 18h

				st	b, var_ign_timing_unk_158
				bra	loc_EE1D

; END OF FUNCTION CHUNK	FOR sub_EA22
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EDCB:							; CODE XREF: ignition_timing_calc+36Dp
				cmp	#5Ch, var_cnt_D8
				bcs	loc_EE03

				ld	x, #unk_17B
				ld	a, va_ne_count_2
				shr	a
				shr	a
				shr	a
				shr	a
				and	a, #03h
				add	x, a
				ld	a, x + 00h
				mul	a, #07h
				push	d
				ld	d, var_ne_sum3
				sub	d, unk_179
				pull	y
				add	d, #0424h
				bpz	loc_EDEE

				clr	a
				clr	b

loc_EDEE:							; CODE XREF: ROM:EDEAj
				jsr	divide_rD_8_saturate

				cmp	b, #0B3h
				bcs	loc_EE09

				ld	a, x + 04h
				beq	loc_EE00

				sub	a, #1Ah
				bcc	loc_EDFE

				clr	a

loc_EDFE:							; CODE XREF: ROM:EDFBj
				st	a, x + 04h

loc_EE00:							; CODE XREF: ROM:EDF7j
				jsr	sub_ED19


loc_EE03:							; CODE XREF: ROM:EDCEj
				clr	a
				st	a, unk_178
				bra	loc_EE10

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EE09:							; CODE XREF: ROM:EDF3j
				add	y, b
				mov	y, d
				jsr	divide_rD_8_saturate

				st	b, x + 00h

loc_EE10:							; CODE XREF: ROM:EE07j
				ld	d, var_ne_sum3
				st	d, unk_179
				ld	a, unk_178
				inc	a
				st	a, unk_178
				ret

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EE1D:							; CODE XREF: sub_EA22+3A7j
				ld	a, var_flags_4E
				st	a, unk_1D4
				ld	a, dmarx_unk_23C
				tbbc	bit2, var_flags_46, loc_EE5F

				mov	a, b
				clr	a
				shl	d
				add	d, #0055h
				sub	b, var_ign_timing_unk_158
				subc	a, #00h
				bcc	loc_EE37

				clr	a
				clr	b

loc_EE37:							; CODE XREF: sub_EA22+411j
				jsr	divide_rD_2_saturate

				st	b, var_temp_w
				ld	y, #table_rpm_unk_C2C0
				ld	b, var_rpm_div_25
				jsr	table_rB_fixed_16_interpolate

				ld	x, #table_unk_C2C9
				tbbc	bit6, var_flags_46, loc_EE4B

				inc	x

loc_EE4B:							; CODE XREF: sub_EA22+425j
				tbbs	bit6, var_flags_42, loc_EE50

				inc	x
				inc	x

loc_EE50:							; CODE XREF: sub_EA22:loc_EE4Bj
				cmp	a, x + 00h
				bcc	loc_EE56

				ld	a, x + 00h

loc_EE56:							; CODE XREF: sub_EA22+430j
				cmp	a, var_temp_w
				ble	loc_EE5F

				jsr	sub_ED12

				ld	a, var_temp_w

loc_EE5F:							; CODE XREF: sub_EA22+403j
								; sub_EA22+436j
				st	a, unk_155
				ld	b, unk_15C
				ld	a, unk_A6
				cmp	a, #0FFh
				beq	loc_EE86

				cmpz	a
				bne	loc_EE78

				ld	b, #2Bh
				tbbs	bit2, var_limiter_flags, loc_EE8E

				tbbs	bit3, var_limiter_flags, loc_EE8E

				bra	loc_EE89

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EE78:							; CODE XREF: sub_EA22+44Aj
				cmp	a, #0Ch
				bcc	loc_EE82

				sub	b, #01h
				bcc	loc_EE89

				bra	loc_EE86

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EE82:							; CODE XREF: sub_EA22+458j
				sub	b, #09h
				bcc	loc_EE89


loc_EE86:							; CODE XREF: sub_EA22+447j
								; sub_EA22+45Ej
				clr	b
				ld	a, #0FEh

loc_EE89:							; CODE XREF: sub_EA22+454j
								; sub_EA22+45Cj ...
				inc	a
				beq	loc_EE8E

				st	a, unk_A6

loc_EE8E:							; CODE XREF: sub_EA22+44Ej
								; sub_EA22+451j ...
				st	b, unk_15C
				bra	loc_EEBD

; END OF FUNCTION CHUNK	FOR sub_EA22

;  S U B	R O U T	I N E 


sub_EE93:							; CODE XREF: sub_C59B:loc_CCD1p
				tbbc	bit3, var_limiter_flags, locret_EEA7

				cmp	#0Ah, var_speed_kph
				bcs	loc_EEA4

				cmp	#29h, var_tps
				bcs	loc_EEA4

				clr	unk_A6
				bra	locret_EEA7

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EEA4:							; CODE XREF: sub_EE93+6j
								; sub_EE93+Bj
				ld	#0FFh, unk_A6

locret_EEA7:							; CODE XREF: sub_EE93j
								; sub_EE93+Fj
				ret

; End of function sub_EE93


;  S U B	R O U T	I N E 


sub_EEA8:							; CODE XREF: sub_C59B:loc_CC9Cp
				tbbc	bit2, var_limiter_flags, locret_EEBC

				cmp	#0Ah, var_speed_kph
				bcs	loc_EEB9

				cmp	#29h, var_tps
				bcs	loc_EEB9

				clr	unk_A6
				bra	locret_EEBC

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EEB9:							; CODE XREF: sub_EEA8+6j
								; sub_EEA8+Bj
				ld	#0FFh, unk_A6

locret_EEBC:							; CODE XREF: sub_EEA8j
								; sub_EEA8+Fj
				ret

; End of function sub_EEA8

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_EA22

loc_EEBD:							; CODE XREF: sub_EA22+46Fj
				jsr	sub_EAA3

				add	a, dmatx_unk_216
				bcc	loc_EEC7

				ld	a, #0FFh

loc_EEC7:							; CODE XREF: sub_EA22+4A1j
				ld	b, dmarx_unk_243
				cmpb	b, #0Fh
				beq	loc_EED4

				add	a, #1Ah
				bcc	loc_EED4

				ld	a, #0FFh

loc_EED4:							; CODE XREF: sub_EA22+4AAj
								; sub_EA22+4AEj
				add	a, unk_15C
				bcc	loc_EEDB

				ld	a, #0FFh

loc_EEDB:							; CODE XREF: sub_EA22+4B5j
				st	a, dmatx_knock_ign_retard
				ld	a, unk_1D5
				st	a, var_flags_4E
				cmp	#87h, unk_5C
				bgt	loc_EEED

				cmp	#24h, var_rpm_div_25
				bcc	loc_EEF1


loc_EEED:							; CODE XREF: sub_EA22+4C4j
				clrb	bit6, var_flags_4E
				bra	loc_EF25

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EEF1:							; CODE XREF: sub_EA22+4C9j
				tbbs	bit6, unk_40, loc_EF25

				tbbc	bit6, var_flags_4E, loc_EEFE

				clrb	bit6, var_flags_4E
				ld	d, #0000h
				bra	loc_EF27

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EEFE:							; CODE XREF: sub_EA22+4D2j
				ld	d, var_ign_timing_unk_15A
				cmp	a, #0FEh
				bcc	loc_EF25

				tbbs	bit2, var_flags_46, loc_EF17

				cmp	d, #0056h
				bcs	loc_EF12

				add	d, #0009h
				bra	loc_EF27

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EF12:							; CODE XREF: sub_EA22+4E9j
				add	d, #0022h
				bra	loc_EF27

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EF17:							; CODE XREF: sub_EA22+4E3j
				cmp	d, #0010h
				bcs	loc_EF21

				add	d, #0009h
				bra	loc_EF27

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EF21:							; CODE XREF: sub_EA22+4F8j
				add	d, #0001h
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EF25:							; CODE XREF: sub_EA22+4CDj
								; sub_EA22:loc_EEF1j ...
				ld	a, #0FEh

loc_EF27:							; CODE XREF: sub_EA22+4DAj
								; sub_EA22+4EEj ...
				st	d, var_ign_timing_unk_15A
				bra	loc_EF48

; END OF FUNCTION CHUNK	FOR sub_EA22

;  S U B	R O U T	I N E 


sub_EF2C:							; CODE XREF: sub_C59B:loc_CB1Ep
				tbbs	bit6, unk_40, locret_EF47

				tbbs	bit0, var_limiter_flags, locret_EF47

				tbbc	bit3, unk_44, locret_EF47

				tbbc	bit5, var_flags_4E, locret_EF47

				tbbc	bit2, var_flags_46, locret_EF47

				cmp	#05h, var_speed_kph
				bcs	locret_EF47

				cmp	#0C4h, var_ect
				bcs	locret_EF47

				setb	bit6, var_flags_4E

locret_EF47:							; CODE XREF: sub_EF2Cj
								; sub_EF2C+3j ...
				ret

; End of function sub_EF2C

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR sub_EA22

loc_EF48:							; CODE XREF: sub_EA22+508j
				ld	a, var_flags_4E
				st	a, unk_1D5
				clr	a
				ld	b, unk_155
				add	b, unk_156
				rolc	a
				add	b, dmarx_unk_239
				addc	a, #00h
				sub	d, #0085h
				bmi	loc_EF6A

				cmp	d, #00E7h
				ble	loc_EF66

				ld	b, #0E7h

loc_EF66:							; CODE XREF: sub_EA22+540j
				cmp	b, #00h
				bcc	loc_EF6C


loc_EF6A:							; CODE XREF: sub_EA22+53Bj
				ld	b, #00h

loc_EF6C:							; CODE XREF: sub_EA22+546j
				st	b, var_knock_unk_157
				ld	a, unk_1D3
				st	a, var_flags_4E
				jsr	sub_EB57

				tbbs	bit5, unk_40, loc_EF83

				tbbs	bit7, var_flags_46, loc_EF83

				tbbs	bit0, unk_40, loc_EF95

				tbbc	bit3, var_flags_4D, loc_EF87 ; Jump if not using default PIM value


loc_EF83:							; CODE XREF: sub_EA22+555j
								; sub_EA22+558j
				ld	b, #40h
				bra	loc_EF8F

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EF87:							; CODE XREF: sub_EA22+55Ej
				tbbc	bit5, var_io_input1, loc_EF95

				tbbc	bit2, var_flags_46, loc_EF95

				ld	b, #40h

loc_EF8F:							; CODE XREF: sub_EA22+563j
				st	b, unk_159
				jmp	locret_EFB0

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EF95:							; CODE XREF: sub_EA22+55Bj
								; sub_EA22:loc_EF87j ...
				ld	b, unk_159
				add	b, #04h
				bcs	loc_EFA1

				cmp	b, var_knock_unk_157
				ble	loc_EFA4


loc_EFA1:							; CODE XREF: sub_EA22+578j
				ld	b, var_knock_unk_157

loc_EFA4:							; CODE XREF: sub_EA22+57Dj
				tbbc	bit0, var_io_input1, loc_EFAD

				cmp	b, #2Bh
				ble	loc_EFAD

				ld	b, #2Bh

loc_EFAD:							; CODE XREF: sub_EA22:loc_EFA4j
								; sub_EA22+587j
				st	b, unk_159

locret_EFB0:							; CODE XREF: sub_EA22+20Ej
								; sub_EA22+570j
				ret

; END OF FUNCTION CHUNK	FOR sub_EA22
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

				; public int_vector_e_ne
int_vector_e_ne:						; DATA XREF: ROM:FFFAo
				clrb	bit6, IRQLL
				push	x
				push	y
				ld	b, var_ne_count		; NE counter
								; Bits 0-3: Counter 0->5, corresponds crank position
								; Bits 4-7: Counter 0->3, corresponds to cylinder
				bmi	loc_EFD8

				cmp	#3Fh, var_revcnt_ne_C2
				bcs	loc_EFD8

				ld	a, unk_189
				tbbc	bit6, IRQL, loc_EFC8	; Interrupt Request Flag MSB

				inc	a
				bne	loc_EFC8

				dec	a

loc_EFC8:							; CODE XREF: ROM:EFC1j
								; ROM:EFC5j
				tbbs	bit6, PORTA, loc_EFD9	; Port A Data Register

				cmp	a, #02h
				beq	loc_EFD6

				cmp	a, #06h
				bcs	loc_EFD8

				setb	bit7, var_error_flags1
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_EFD6:							; CODE XREF: ROM:EFCDj
				clrb	bit7, var_error_flags1

loc_EFD8:							; CODE XREF: ROM:EFB7j
								; ROM:EFBCj ...
				clr	a

loc_EFD9:							; CODE XREF: ROM:loc_EFC8j
				st	a, unk_189
				clrb	bit6, IRQL
				ld	b, var_ne_count		; NE counter
								; Bits 0-3: Counter 0->5, corresponds crank position
								; Bits 4-7: Counter 0->3, corresponds to cylinder
				tbbc	bit7, PORTA, loc_F001	; Jump if PORTA.7 (G2) is low

				tbbc	bit6, PORTA, loc_F008	; Jump if PORTA.6 (G1) is low

				cmpz	b			; Compare NE counter against 0
				bmi	loc_F01C		; Jump if negative

				mov	b, a
				inc	b			; Increment NE counter
				and	a, #0Fh			; Only keep lower nibble (crank	position)
				cmp	a, #05h			; Check	if counter is less than	5...
				bcs	loc_F01C		; ... and jump to store	new counter value in B

				and	b, #0F0h		; Reset	lower nibble (crank position) back to 0
				add	b, #10h			; Increment cylinder counter
				mov	b, a
				cmp	b, #20h			; Check	if reached cylinder 3...
				beq	loc_F011		; ... and jump to store	new counter value in A

				cmp	b, #40h			; Check	if cylinder count reached limit...
				bne	loc_F01C		; ... and jump if not to store counter value in	B

				clr	a			; Reset	position and cylinder count both back to 0.
				bra	loc_F011		; Jump to store	new counter value in A

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
;G2 signal is low, check NE counter is correct,	reset counter if it's out of sync.

loc_F001:							; CODE XREF: ROM:EFE0j
				clr	a
				cmp	b, #35h
				beq	loc_F01B

				bra	loc_F00E

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
;G1 signal is low, check NE counter is correct,	reset counter if it's out of sync.

loc_F008:							; CODE XREF: ROM:EFE3j
				ld	a, #20h
				cmp	b, #15h
				beq	loc_F01B


loc_F00E:							; CODE XREF: ROM:F006j
				cmpz	b
				bmi	loc_F01B


loc_F011:							; CODE XREF: ROM:EFF8j
								; ROM:EFFFj
				tbbc	bit2, unk_40, loc_F01B

				tbbs	bit0, var_flags_46, loc_F01B

				setb	bit3, var_diag_errors_5	; Set G1 or G2 signal error flag
				setb	bit1, var_error_flags1	; Set G1 or G2 signal error

loc_F01B:							; CODE XREF: ROM:F004j
								; ROM:F00Cj ...
				mov	a, b

loc_F01C:							; CODE XREF: ROM:EFE7j
								; ROM:EFEFj ...
				st	b, var_ne_count		; NE counter
								; Bits 0-3: Counter 0->5, corresponds crank position
								; Bits 4-7: Counter 0->3, corresponds to cylinder
				bra	loc_F04F


;  S U B	R O U T	I N E 


init_ne_counters:						; CODE XREF: sub_C59B:loc_C67Ap
								; sub_C59B+2F7p
				ld	d, #5500h
				ld	y, #var_ne_0
				st	d, [y]
				st	d, [y]
				st	d, [y]
				ld	d, #0FFFFh
				st	d, var_ne_sum3
				st	a, var_ne_count		; NE counter
								; Bits 0-3: Counter 0->5, corresponds crank position
								; Bits 4-7: Counter 0->3, corresponds to cylinder
				st	a, va_ne_count_2
				ret

; End of function init_ne_counters


;  S U B	R O U T	I N E 


init_ne_on_start:						; CODE XREF: sub_F7C7+59p
				tbbc	bit0, var_io_input1, loc_F047 ;	Jump if	STA low	(starter not running)

				tbs	bit7, unk_44
				bne	locret_F04E

				cmp	#0Ch, var_revcnt_sta
				bcs	locret_F04E

				ld	a, #0FFh
				st	a, var_ne_count		; NE counter
								; Bits 0-3: Counter 0->5, corresponds crank position
								; Bits 4-7: Counter 0->3, corresponds to cylinder
				st	a, va_ne_count_2
				bra	locret_F04E

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F047:							; CODE XREF: init_ne_on_startj
				tbbc	bit7, unk_44, locret_F04E

				clrb	bit7, unk_44
				clr	var_revcnt_sta

locret_F04E:							; CODE XREF: init_ne_on_start+5j
								; init_ne_on_start+Aj ...
				ret

; End of function init_ne_on_start

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F04F:							; CODE XREF: ROM:F01Ej
				jsr	knock_mcu_update

				clrb	bit3, var_flags_42
				setb	bit1, IRQLL		; Trigger IV6
				pull	y
				pull	x
				reti


;  S U B	R O U T	I N E 


ignition_timing_calc:						; CODE XREF: int_vector_6_sw_int+8p

; FUNCTION CHUNK AT F26F SIZE 000000FA BYTES
; FUNCTION CHUNK AT F3AF SIZE 0000001E BYTES

				jsr	injector_cold_start

				jsr	sub_DD2A

				ld	x, ASR2			; ASR2 edge counter value MSB
				st	x, var_asr2_time
				clr	a
				ld	b, var_ne_count		; NE counter
								; Bits 0-3: Counter 0->5, corresponds crank position
								; Bits 4-7: Counter 0->3, corresponds to cylinder
				bpz	loc_F06B

				ld	a, #08h

loc_F06B:							; CODE XREF: ignition_timing_calc+Ej
				xch	a, var_cnt_C7
				xch	b, va_ne_count_2
				cmpz	b
				bmi	loc_F08E

				ld	b, va_ne_count_2
				and	b, #07h
				cmpb	b, #01h
				bne	loc_F099

				ld	y, #var_ne_0
				add	y, b
				cmp	a, #08h
				bcc	loc_F08A

				mov	x, d			; Copy current ASR2 time in rX to Rd
				sub	d, var_prev_asr2_time	; Subtract previous time to get	time between NE	pulses
				cmp	a, #55h			; Check	of differnce is	less than 0x5500
				bcs	loc_F08D		; Jump if so


loc_F08A:							; CODE XREF: ignition_timing_calc+27j
				ld	d, #5500h		; Set difference to 0x5500

loc_F08D:							; CODE XREF: ignition_timing_calc+2Fj
				st	d, [y]			; Store	difference in table

loc_F08E:							; CODE XREF: ignition_timing_calc+17j
				st	x, var_prev_asr2_time	; Update previous ASR2 time
				ld	d, var_ne_0		; Sum up last 3	NE periods
				add	d, var_ne_1
				add	d, var_ne_2
				st	d, var_ne_sum3		; Sum is equivilent to 90 degrees

loc_F099:							; CODE XREF: ignition_timing_calc+1Fj
				ld	b, va_ne_count_2
				bpz	loc_F0A0

				jmp	loc_F26F

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F0A0:							; CODE XREF: ignition_timing_calc+42j
				and	b, #07h
				push	b
				bne	loc_F0A7

				clrb	bit1, unk_41

loc_F0A7:							; CODE XREF: ignition_timing_calc+4Aj
				cmp	b, #04h
				bne	loc_F0DF

				tbbs	bit2, var_ignition_flags, loc_F0DF

				cmp	#3Ch, var_rpm_div_25
				bcc	loc_F0DF

				ld	a, #02h
				ld	b, #56h
				sub	d, var_ign_timing_unk_175
				shr	d
				st	a, var_ign_timing_temp_A4
				ld	x, var_ne_2
				jsr	mult_rBrX

				cmp	#00h, var_ign_timing_temp_A4
				beq	loc_F0C9

				add	d, var_ne_2

loc_F0C9:							; CODE XREF: ignition_timing_calc+6Cj
				sub	d, #0035h
				add	d, var_prev_asr2_time
				sub	d, var_ign_unk_173
				mov	d, x
				di
				cmp	d, CPR0			; Timer	comparison #0 MSB
				bpz	loc_F0DE

				tbbc	bit0, var_ignition_flags, loc_F0DE

				jsr	sub_F229


loc_F0DE:							; CODE XREF: ignition_timing_calc+7Dj
								; ignition_timing_calc+7Fj
				ei

loc_F0DF:							; CODE XREF: ignition_timing_calc+50j
								; ignition_timing_calc+52j ...
				pull	b
				tbbc	bit2, var_ignition_flags, loc_F10B

				cmp	b, #03h
				bne	loc_F0E9

				clrb	bit4, var_ignition_flags

loc_F0E9:							; CODE XREF: ignition_timing_calc+8Cj
				tbbs	bit4, var_ignition_flags, loc_F108

				ld	a, #2Bh			; 0 degree ignition timing
				st	a, var_ign_timing_div_2
				ld	a, #4Bh			; 0 degree ignition timing (OBD)
				st	a, dmatx_obd_ign
				cmpz	b
				bne	loc_F0FE

				di
				clrb	bit0, DOUT
				bra	loc_F105

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F0FE:							; CODE XREF: ignition_timing_calc+9Ej
				cmp	b, #05h
				bne	loc_F108

				di
				setb	bit0, DOUT

loc_F105:							; CODE XREF: ignition_timing_calc+A3j
				jsr	ignition_set_immediate


loc_F108:							; CODE XREF: ignition_timing_calc:loc_F0E9j
								; ignition_timing_calc+A7j
				jmp	loc_F26F

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F10B:							; CODE XREF: ignition_timing_calc+87j
				mov	d, y
				cmp	b, #01h
				beq	loc_F117

				cmp	b, #03h
				beq	loc_F11E

				jmp	loc_F1E7

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F117:							; CODE XREF: ignition_timing_calc+B5j
				ld	b, unk_159
				clrb	bit5, var_ignition_flags
				bra	loc_F121

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F11E:							; CODE XREF: ignition_timing_calc+B9j
				ld	b, var_ign_timing_div_2

loc_F121:							; CODE XREF: ignition_timing_calc+C3j
				clrb	bit4, var_ignition_flags
				tbbs	bit7, var_flags_46, loc_F137

				tbbs	bit0, unk_40, loc_F142

				tbbs	bit3, var_flags_4D, loc_F137 ; Jump if using default PIM value

				tbbc	bit2, var_flags_46, loc_F142

				tbbc	bit5, var_io_input1, loc_F142 ;	Jump forward if	not diagnostic check mode

				ld	d, #0080h		; Set fixed -10	ignition timing
				bra	loc_F13A

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F137:							; CODE XREF: ignition_timing_calc+CAj
								; ignition_timing_calc+D0j
				ld	d, #0056h		; Set fixed -5 ignition	timing

loc_F13A:							; CODE XREF: ignition_timing_calc+DCj
				mov	d, x
				shr	d
				st	b, var_ign_timing_div_2
				mov	x, d
				bra	loc_F189

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F142:							; CODE XREF: ignition_timing_calc+CDj
								; ignition_timing_calc+D3j ...
				cmp	b, var_min_ign_timing
				bcs	loc_F14A

				ld	b, var_min_ign_timing

loc_F14A:							; CODE XREF: ignition_timing_calc+ECj
				clr	a
				shl	d
				st	d, var_ign_timing_temp_A4
				clr	a
				ld	b, var_knock_unk_157
				shl	d
				sub	b, dmatx_knock_ign_retard
				subc	a, #00h
				bcc	loc_F15C

				clr	a
				clr	b

loc_F15C:							; CODE XREF: ignition_timing_calc+FFj
				cmp	d, var_ign_timing_temp_A4
				bcs	loc_F162

				ld	d, var_ign_timing_temp_A4

loc_F162:							; CODE XREF: ignition_timing_calc+105j
				cmp	d, var_ign_timing_unk_15A
				bcs	loc_F16A

				ld	d, var_ign_timing_unk_15A

loc_F16A:							; CODE XREF: ignition_timing_calc+10Cj
				mov	d, x
				shr	d
				st	b, var_ign_timing_div_2
				ld	a, var_ign_timing_unk_158
				add	x, a
				mov	x, d
				sub	d, #0055h
				bcc	loc_F17B

				clr	a
				clr	b

loc_F17B:							; CODE XREF: ignition_timing_calc+11Ej
				mov	d, x
				ld	a, dmarx_ign_timing_unk_246
				cmp	#30h, va_ne_count_2
				bcc	loc_F187

				ld	a, dmarx_ign_timing_unk_247

loc_F187:							; CODE XREF: ignition_timing_calc+129j
				add	x, a
				mov	x, d

loc_F189:							; CODE XREF: ignition_timing_calc+E7j
				cmp	d, #01CDh		; Check	if ignition timing is less than	90 BTDC
				ble	loc_F191

				ld	d, #01CDh		; Clamp	to 90 BTDC

loc_F191:							; CODE XREF: ignition_timing_calc+133j
				mov	d, x			; Save ignition	timing into X
				shr	d			; Convert raw ignition timing...
				shr	b			; ... into ODB1	format
				add	b, #35h
				st	b, dmatx_obd_ign	; Store	converted ignition timing value
				mov	x, d			; Restore ignition timing from X
				sub	d, #0007h
				bcc	loc_F1A1

				clr	a
				clr	b

loc_F1A1:							; CODE XREF: ignition_timing_calc+144j
				st	d, var_ign_timing_unk_175
				mov	y, d
				ld	a, #06h
				sub	a, b
				ld	b, #56h
				sub	d, var_ign_timing_unk_175
				mov	d, x
				ld	a, var_rpm_x_5p12
				mul	a, #0E9h
				st	a, var_ign_timing_temp_A4
				mov	x, d
				shr	b
				cmp	b, var_ign_timing_temp_A4
				bcc	loc_F1C3

				dec	a
				bpz	loc_F1C1

				clr	a
				ld	b, var_ign_timing_temp_A4
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F1C1:							; CODE XREF: ignition_timing_calc+162j
				add	b, #80h

loc_F1C3:							; CODE XREF: ignition_timing_calc+15Fj
				inc	a
				st	d, var_ign_timing_unk_16B
				mov	x, d
				st	b, var_ign_timing_temp_A4
				mov	a, b
				clr	a
				div	d, #06h
				xch	b, var_ign_timing_temp_A4
				div	d, #06h
				mov	b, a
				jsr	sub_F263

				cmp	#00h, var_ign_timing_temp_A4
				beq	loc_F1DD

				add	d, var_ne_sum3

loc_F1DD:							; CODE XREF: ignition_timing_calc+180j
				sub	d, #0035h
				add	d, var_asr2_time
				bsr	ignition_update_off_time

				setb	bit0, var_ignition_flags

loc_F1E7:							; CODE XREF: ignition_timing_calc+BBj
				ld	d, var_ign_timing_unk_16B
				dec	a
				st	a, var_ign_timing_unk_16B
				bne	loc_F26F

				mov	b, a
				bsr	sub_F263

				st	b, var_ign_timing_temp_A4
				mov	a, b
				clr	a
				div	d, #03h
				xch	b, var_ign_timing_temp_A4
				div	d, #03h
				ld	a, var_ign_timing_temp_A4
				sub	d, #0035h
				add	d, var_asr2_time
				bsr	sub_F240

				bra	loc_F26F

; End of function ignition_timing_calc


;  S U B	R O U T	I N E 


ignition_update_off_time:					; CODE XREF: ignition_timing_calc+18Ap
								; int_vector_9_ignition+A2p
				sub	d, var_ign_unk_173
				mov	d, x
				cmp	#1Dh, var_ne_sum3
				bcc	sub_F229

				sub	d, var_ign_on_time_from_CPR0
				bmi	loc_F220

				shr	d
				cmpz	a
				bne	sub_F229

				cmp	b, var_ign_unk_172
				bcc	sub_F229


loc_F220:							; CODE XREF: ignition_update_off_time+Cj
				clr	a
				ld	b, var_ign_unk_172
				shl	d
				add	d, var_ign_on_time_from_CPR0
				mov	d, x
; End of function ignition_update_off_time


;  S U B	R O U T	I N E 


sub_F229:							; CODE XREF: ignition_timing_calc+82p
								; ignition_update_off_time+7j ...
				st	x, var_ign_next_time
				di
				tbbc	bit0, DOUT, loc_F23C	; Jump if ignition on

				ld	d, TIMER		; Ignition already off,	get current time
				add	d, #0004h		; ...add a little bit
				cmp	d, CPR0			; Compare against CPR0
				bpz	ignition_done

				inc	a
				st	d, CPR0			; Timer	comparison #0 MSB

loc_F23C:							; CODE XREF: sub_F229+4j
				setb	bit0, DOUT		; Turn ignition	off at when TIMER matches CPR0
				bra	ignition_set_time

; End of function sub_F229


;  S U B	R O U T	I N E 


sub_F240:							; CODE XREF: ignition_timing_calc+1ACp
				st	d, var_ign_next_time
				di
				tbbs	bit3, var_ignition_flags, ignition_set_on_time

				setb	bit5, var_ignition_flags
				bra	ignition_done

; End of function sub_F240


;  S U B	R O U T	I N E 


ignition_set_on_time:						; CODE XREF: sub_F240+4j
								; int_vector_9_ignition+Ep
				di
				clrb	bit0, DOUT		; Clear	DOUT.0 to turn on igntion when TIMER matches CPR0
				clrb	bit1, var_ignition_flags

ignition_set_time:						; CODE XREF: sub_F229+15j
				ld	d, var_ign_next_time	; Get ignition on time in rD
				sub	d, #0004h		; Subtract 16uS	and...
				cmp	d, TIMER		; Check	on time	hasn't arrived yet
				bpz	loc_F25C		; Jump if so

; End of function ignition_set_on_time


;  S U B	R O U T	I N E 


ignition_set_immediate:						; CODE XREF: ignition_timing_calc:loc_F105p
				ld	d, TIMER		; Get current time in rD

loc_F25C:							; CODE XREF: ignition_set_on_time+Dj
				add	d, #0004h		; Add 16uS
				st	d, CPR0			; Set CPR0 register to trigger turning on ignition

ignition_done:							; CODE XREF: sub_F229+Ej
								; sub_F240+9j
				ei
				ret

; End of function ignition_set_immediate


;  S U B	R O U T	I N E 


sub_F263:							; CODE XREF: ignition_timing_calc+17Ap
								; ignition_timing_calc+198p
				mov	d, y
				mul	a, var_ne_sum3
				mov	d, x
				mov	y, d
				mul	a, unk_F7
				addc	a, #00h
				add	x, a
				mov	x, d
				ret

; End of function sub_F263

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR ignition_timing_calc

loc_F26F:							; CODE XREF: ignition_timing_calc+44j
								; ignition_timing_calc:loc_F108j ...
				ld	a, va_ne_count_2
				bpz	loc_F276

				jmp	loc_F3AF

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F276:							; CODE XREF: ignition_timing_calc+218j
				ld	d, var_inj_pw_inj1
				tbbs	bit0, var_flags_46, loc_F29D

				tbbs	bit5, unk_44, loc_F2D2

				cmp	#18h, var_rpm_div_25	; Check	if RPM >= 600rpm
				bcc	loc_F289		; Jump if so

				cmp	#1Fh, var_cnt_startup
				bcs	loc_F29D


loc_F289:							; CODE XREF: ignition_timing_calc+229j
				cmp	#11h, va_ne_count_2
				bne	loc_F29D

				shr	d
				setb	bit5, unk_44
				ld	x, #table_injector_control
				jsr	injector_update

				inc	x
				jsr	injector_update

				bra	loc_F2C6

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F29D:							; CODE XREF: ignition_timing_calc+220j
								; ignition_timing_calc+22Ej ...
				clrb	bit5, unk_44
				ld	x, #table_injector_control
				cmp	#12h, va_ne_count_2
				beq	loc_F2BA

				cmp	#32h, va_ne_count_2
				beq	loc_F2BA

				inc	x
				cmp	#02h, va_ne_count_2
				beq	loc_F2BA

				cmp	#22h, va_ne_count_2
				beq	loc_F2BA

				jmp	loc_F345

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F2BA:							; CODE XREF: ignition_timing_calc+24Cj
								; ignition_timing_calc+251j ...
				tbbc	bit7, var_ignition_flags, loc_F2BE ; Jump if injector pulsewidths not updated

				shr	d

loc_F2BE:							; CODE XREF: ignition_timing_calc:loc_F2BAj
				jsr	injector_update

				inc	x
				inc	x
				jsr	injector_update


loc_F2C6:							; CODE XREF: ignition_timing_calc+242j
								; ignition_timing_calc+27Fj ...
				ld	a, #02h
				st	a, var_inj_active
				ld	a, #10h
				st	a, unk_14D
				bra	loc_F326

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F2D2:							; CODE XREF: ignition_timing_calc+223j
				ld	b, unk_14E
				mov	b, a
				cmp	b, #35h
				bgt	loc_F2C6

				and	b, #0Fh
				cmp	b, #05h
				bgt	loc_F2C6

				cmp	a, va_ne_count_2
				bne	loc_F345

				ld	b, var_inj_active
				and	b, #03h
				ld	x, #table_injector_control
				add	x, b
				ld	y, #var_inj_pw_inj1
				add	y, b
				add	y, b
				ld	d, y + 00h
				jsr	injector_update

				ld	a, var_inj_active
				inc	a
				and	a, #03h
				st	a, var_inj_active
				ld	d, unk_14C
				sub	a, b
				bcs	loc_F30E

				cmp	a, #05h
				ble	loc_F322

				ld	a, #05h
				bra	loc_F322

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F30E:							; CODE XREF: ignition_timing_calc+2ABj
				cmp	a, #0FDh
				bcc	loc_F31C

				push	b
				ld	b, var_inj_active
				shr	b
				pull	b
				bcs	loc_F31C

				clrb	bit3, unk_41

loc_F31C:							; CODE XREF: ignition_timing_calc+2B7j
								; ignition_timing_calc+2BFj
				cmp	a, #0FBh
				bcc	loc_F322

				ld	a, #0FBh

loc_F322:							; CODE XREF: ignition_timing_calc+2AFj
								; ignition_timing_calc+2B3j ...
				add	a, b
				st	a, unk_14D

loc_F326:							; CODE XREF: ignition_timing_calc+277j
				ld	a, var_inj_active
				mul	a, #06h
				add	b, unk_14D
				sub	b, #0Ch
				bcc	loc_F334

				add	b, #18h

loc_F334:							; CODE XREF: ignition_timing_calc+2D7j
				cmp	b, #18h
				bcs	loc_F33A

				sub	b, #18h

loc_F33A:							; CODE XREF: ignition_timing_calc+2DDj
				clr	a
				div	d, #06h
				shl	b
				shl	b
				shl	b
				shl	b
				add	a, b
				st	a, unk_14E

loc_F345:							; CODE XREF: ignition_timing_calc+25Ej
								; ignition_timing_calc+289j
				tbbc	bit5, unk_44, loc_F365

				ld	a, unk_14E
				mov	a, b
				and	a, #07h
				and	b, #30h
				sub	a, #03h
				bcc	loc_F35A

				sub	b, #10h
				and	b, #30h
				add	a, #06h

loc_F35A:							; CODE XREF: ignition_timing_calc+2F9j
				add	a, b
				cmp	a, va_ne_count_2
				bne	loc_F367

				ld	a, var_inj_active
				shr	a
				bcs	loc_F367


loc_F365:							; CODE XREF: ignition_timing_calc:loc_F345j
				clrb	bit3, unk_41

loc_F367:							; CODE XREF: ignition_timing_calc+304j
								; ignition_timing_calc+30Aj
				bra	loc_F3AF

; END OF FUNCTION CHUNK	FOR ignition_timing_calc
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
;Some kind of table, used to check bits	in LDOUT
table_injector_control:		.db 10h, 40h, 80h, 20h		; DATA XREF: ignition_timing_calc+238o
								; ignition_timing_calc+246o ...
								; LDOUT	bit
				.db 0EFh, 0BFh,	7Fh, 0DFh	; LDOUT	mask
				.db CPR4, CPR6,	CPR7, CPR5	; CPRn register

;  S U B	R O U T	I N E 


sub_F375:							; CODE XREF: sub_C59B+21C8p
				ld	d, var_inj_pw_inj1
				add	d, #0591h
				rorc	a
				rorc	b
				jsr	divide_rD_16

				mov	d, x
				ld	d, var_rpm_x_5p12
				jsr	divide_rD_16

				jsr	mult_rDrX

				div	d, #31h
				ld	y, #table_unk_C263
				tbbs	bit2, var_flags_46, loc_F393

				inc	y
				inc	y

loc_F393:							; CODE XREF: sub_F375+19j
				cmp	#0B3h, var_ect
				bcs	loc_F399

				inc	y

loc_F399:							; CODE XREF: sub_F375+21j
				ld	a, y + 00h
				st	a, unk_109
				add	b, y + 00h
				cmp	b, #1Ah
				ble	loc_F3A6

				ld	b, #1Ah

loc_F3A6:							; CODE XREF: sub_F375+2Dj
				sub	b, #18h
				neg	b
				add	b, #0Ah
				st	b, unk_14C
				ret

; End of function sub_F375

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR ignition_timing_calc

loc_F3AF:							; CODE XREF: ignition_timing_calc+21Aj
								; ignition_timing_calc:loc_F367j
				jsr	loc_F52A

				ld	a, va_ne_count_2
				cmp	a, #00h
				beq	loc_F3BC

				cmp	a, #20h
				bne	loc_F3BE


loc_F3BC:							; CODE XREF: ignition_timing_calc+35Dj
				clrb	bit2, unk_41

loc_F3BE:							; CODE XREF: ignition_timing_calc+361j
				and	a, #07h
				bne	locret_F3CC

				clrb	bit0, unk_41
				clrb	bit1, unk_44
				jsr	loc_EDCB

				jsr	sub_CE29


locret_F3CC:							; CODE XREF: ignition_timing_calc+367j
				ret

; END OF FUNCTION CHUNK	FOR ignition_timing_calc
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				jsr	check_limiters_active_2

				bra	loc_F3D5


;  S U B	R O U T	I N E 

; *************************************************
; Update Injectors
;
; D = Injector pulse width
; *************************************************

injectors_batch_update:						; CODE XREF: sub_C59B+793p
								; injector_cold_start:loc_CD60p ...
				jsr	check_limiters_active


loc_F3D5:							; CODE XREF: ROM:F3D0j
				bcc	loc_F3DA		; Jump if carry	clear (limiter inactive)

				jmp	no_injector

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F3DA:							; CODE XREF: injectors_batch_update:loc_F3D5j
				ld	x, #table_injector_control ; Get address of injector control table

loc_F3DD:							; CODE XREF: injectors_batch_update+11j
				bsr	injector_drive		; ******************************************
								; Update injector timing
								;
								; D = injector duration
								; X = pointer to injector control table	entry
								; ******************************************

				inc	x			; Move to next injector
				cmp	x, #(table_injector_control+3) ; Check if we have done all injectors
				ble	loc_F3DD		; Loop back if not

				bra	no_injector

; End of function injectors_batch_update


;  S U B	R O U T	I N E 


injector_update:						; CODE XREF: ignition_timing_calc+23Bp
								; ignition_timing_calc+23Fp ...
				bsr	check_limiters_active_2

				bcs	no_injector

				cmp	d, #000Dh
				bcs	no_injector

				mov	d, y
				ld	a, unk_1DC
				or	a, #02h
				st	a, unk_1DC
				mov	y, d
				bra	loc_F405

; End of function injector_update

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				bsr	check_limiters_active

				bcs	no_injector

; Drive	injectors
; This routine loads up	the CPRx, LDOUT	and DOUT registers to drive the	injectors
; X - pointer to injector mask and register table
; D - Injector pulse width

;  S U B	R O U T	I N E 

; ******************************************
; Update injector timing
;
; D = injector duration
; X = pointer to injector control table	entry
; ******************************************

injector_drive:							; CODE XREF: injectors_batch_update:loc_F3DDp
				cmp	d, #000Dh
				bcs	no_injector


loc_F405:							; CODE XREF: injector_update+13j
				push	d			; Store	injector duration
				clr	a
				ld	b, x + 08h		; B = address of CPRx register
				mov	d, y			; Copy address of CPRx register	into Y
				di
				ld	a, LDOUT		; Get current injectors	state
				cmpb	a, x + 00h		; Check	if injector is on
				bne	injector_on		; Jump if it is

				pull	d			; Get injector duration	off stack
				push	d
				add	d, var_inj_battery_adjust ; Add	battery	voltage	adjustment
				push	x
				bra	loc_F427

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

injector_on:							; CODE XREF: injector_drive+Fj
				ld	d, y + 00h		; Get time when	injector will be turned	off
				sub	d, TIMER		; Subtract current time
				cmp	a, #0FFh		; Jump if not negative
				bne	loc_F423

				clr	a			; Injector switch off time has just passed, so
								; clear	D.
				clr	b

loc_F423:							; CODE XREF: injector_drive+1Fj
				push	x

loc_F424:
				mov	s, x
				add	d, x + 02h

loc_F427:							; CODE XREF: injector_drive+17j
				bcc	loc_F42C		; Jump foward if no overflow

				ld	d, #0FFFFh		; Set maximum pulse width

loc_F42C:							; CODE XREF: injector_drive:loc_F427j
				push	d			; Store	injector pulse width on	stack
				mov	s, x			; X is address of injector pulse width
				ld	d, var_ne_sum3		; Get sum of last 3 Ne periods
				cmp	d, #15625
				ble	loc_F438

				ld	d, #15625

loc_F438:							; CODE XREF: injector_drive+33j
				shl	d			; Multiple by 2
				shl	d			; Multiply by 2	again
				cmp	d, x + 00h
				bcs	loc_F440

				ld	d, x + 00h

loc_F440:							; CODE XREF: injector_drive+3Cj
				pull	x
				pull	x
				add	d, TIMER		; Timer	MSB (bit11~bit18)
				st	d, y + 00h
				ld	d, DOUT			; DOUT Data Register
				or	a, x + 00h
				and	b, x + 04h
				st	d, DOUT			; DOUT Data Register
				ld	d, DOUT			; DOUT Data Register
				and	a, x + 04h
				or	b, x + 00h
				st	b, DOM			; DOUT Control Register
				st	a, DOUT			; DOUT Data Register
				pull	d
				ei

no_injector:							; CODE XREF: injectors_batch_update+5j
								; injectors_batch_update+13j ...
				ret

; End of function injector_drive


;  S U B	R O U T	I N E 


check_limiters_active:						; CODE XREF: injectors_batch_updatep
								; ROM:F3FCp
				mov	d, y
				ld	a, #10011100b
				bra	loc_F463

; End of function check_limiters_active


;  S U B	R O U T	I N E 


check_limiters_active_2:					; CODE XREF: ROM:F3CDp
								; injector_updatep
				mov	d, y
				ld	a, #10011111b

loc_F463:							; CODE XREF: check_limiters_active+3j
				and	a, var_limiter_flags
				bne	loc_F46C

				tbbs	bit4, var_limiter_flags, loc_F46C

				clrc
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db 41h
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F46C:							; CODE XREF: check_limiters_active_2+5j
								; check_limiters_active_2+7j
				setc
				mov	y, d
				ret

; End of function check_limiters_active_2


;  S U B	R O U T	I N E 


knock_mcu_update:						; CODE XREF: ROM:loc_F04Fp
				ld	b, var_ne_count		; NE counter
								; Bits 0-3: Counter 0->5, corresponds crank position
								; Bits 4-7: Counter 0->3, corresponds to cylinder
				ld	a, var_knock_info	; Get current knock info in A
				cmpz	b
				bne	loc_F47B		; Jump if not TDC on 1st cylinder

				setb	bit1, PORTB		; Inform knock MCU of TDC on 1st cylinder
				bra	loc_F481

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F47B:							; CODE XREF: knock_mcu_update+6j
				and	b, #07h			; Check	which is active	cylinder
				bne	loc_F484		; Jump if not 1st cylinder

				clrb	bit1, PORTB		; Inform MCU not on 1st	cylinder

loc_F481:							; CODE XREF: knock_mcu_update+Aj
				jmp	loc_F515

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F484:							; CODE XREF: knock_mcu_update+Ej
				dec	b
				bne	loc_F48A

				jmp	loc_F50B

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F48A:							; CODE XREF: knock_mcu_update+16j
				dec	b
				beq	loc_F490

				jmp	locret_F529

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F490:							; CODE XREF: knock_mcu_update+1Cj
				tbbs	bit5, unk_40, loc_F508

				tbbc	bit2, DOUT, loc_F508	; Jump if knock	MCU is in reset

				tbbs	bit5, IRQLL, loc_F508	; Interrupt Request Flag LSB

				tbbs	bit5, PORTD_ASRIN, loc_F508 ; Port D Data Register / ASR Input Data

				cmp	#7Ah, var_revcnt_BE
				ble	loc_F508

				cmp	#7Ah, var_revstarter_cnt_C0
				ble	loc_F508

				mov	a, b			; Copy current knock info to B
				tbbc	bit5, PORTB, loc_F4AC	; Port B Data Register

				add	b, #04h

loc_F4AC:							; CODE XREF: knock_mcu_update+38j
				shr	b
				shr	b
				shr	b
				rorc	b
				bvc	loc_F4D0

				bcs	loc_F4FF

				cmp	#39h, var_rpm_x_5p12	; Check	RPM against 2850rpm
				bcs	loc_F508		; Jump if it is	<2850rpm

				cmp	#90h, var_rpm_x_5p12	; Check	RPM against 7249rpm
				bcc	loc_F508		; Jump if it is	>=7249rpm

				cmp	#03h, var_cnt_knock_signal ; Check counter against 03h
				bcc	loc_F4C7		; Jump if counter >=03h

				inc	var_cnt_knock_signal	; Increment counter
				bra	loc_F508

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F4C7:							; CODE XREF: knock_mcu_update+52j
				tbbc	bit7, var_diag_errors_5, loc_F508

				setb	bit5, var_flags_46	; Set knock sensor error flag
				setb	bit0, var_error_flags2	; Set knock sensor error flag
				bra	loc_F508

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F4D0:							; CODE XREF: knock_mcu_update+41j
				cmp	#0Eh, var_rpm_x_5p12	; Check	RPM against 700rpm
				bcs	loc_F508		; Jump if it is	<700rpm

				cmp	#90h, var_rpm_x_5p12	; Check	RPM against 7249rpm
				bcc	loc_F508		; Jump if it is	>=7249rpm

				ld	b, var_diag_errors_1
				cmpb	b, #80h			; Check	if G1 or G2 diag error flag
				bne	loc_F508		; Jump if it's set

				and	a, #0F0h
				add	a, #10h
				cmp	a, #0C0h
				bcs	loc_F4ED

				setb	bit4, var_diag_errors_5	; Set knock management diag error flag
				clr	a
				bra	knock_mcu_reset

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F4ED:							; CODE XREF: knock_mcu_update+77j
				cmp	a, #60h
				bne	loc_F509


knock_mcu_reset:						; CODE XREF: knock_mcu_update+7Cj
				clrb	bit2, DOUT
				div	d, #00h
				div	d, #00h
				div	d, #00h
				setb	bit2, DOUT
				setb	bit5, var_flags_46	; Set knock sensor error flag
				bra	loc_F509

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F4FF:							; CODE XREF: knock_mcu_update+43j
				tbbs	bit0, var_error_flags2,	loc_F508

				clrb	bit5, var_flags_46	; Clear	knock sensor error flag
				clrb	bit4, var_diag_errors_5	; Clear	knock management diag error flag
				clr	var_cnt_knock_signal	; Reset	knock signal counter

loc_F508:							; CODE XREF: knock_mcu_update:loc_F490j
								; knock_mcu_update+24j	...
				clr	a

loc_F509:							; CODE XREF: knock_mcu_update+80j
								; knock_mcu_update+8Ej
				bra	loc_F526

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F50B:							; CODE XREF: knock_mcu_update+18j
				clrb	bit1, PORTB
				bra	loc_F511

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				setb	bit1, PORTB

loc_F511:							; CODE XREF: knock_mcu_update+9Ej
				setb	bit0, PORTB
				bra	locret_F529

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F515:							; CODE XREF: knock_mcu_update:loc_F481j
				tbbc	bit5, PORTB, loc_F51A	; Port B Data Register

				or	a, #08h

loc_F51A:							; CODE XREF: knock_mcu_update:loc_F515j
				clrb	bit0, PORTB
				tbbs	bit4, PORTB, loc_F521	; Port B Data Register

				or	a, #02h

loc_F521:							; CODE XREF: knock_mcu_update+ADj
				tbbs	bit3, PORTB, loc_F526	; Port B Data Register

				or	a, #01h

loc_F526:							; CODE XREF: knock_mcu_update:loc_F509j
								; knock_mcu_update:loc_F521j
				st	a, var_knock_info

locret_F529:							; CODE XREF: knock_mcu_update+1Ej
								; knock_mcu_update+A4j
				ret

; End of function knock_mcu_update

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F52A:							; CODE XREF: ignition_timing_calc:loc_F3AFp
				ld	b, va_ne_count_2
				bpz	loc_F531

				jmp	locret_F6C4

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F531:							; CODE XREF: ROM:F52Cj
				and	b, #0Fh
				bne	loc_F537

				bra	loc_F53E

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F537:							; CODE XREF: ROM:F533j
				cmp	b, #01h
				bne	loc_F53B

loc_F53B:
				jmp	locret_F6C4

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F53E:							; CODE XREF: ROM:F535j
				ld	a, var_knock_unk_1B8
				inc	a
				beq	loc_F547

				st	a, var_knock_unk_1B8

loc_F547:							; CODE XREF: ROM:F542j
				ld	a, var_rpm_x_5p12
				cmp	a, #90h
				bcc	loc_F56A

				cmp	a, #10h
				bcs	loc_F573

				tbbs	bit2, var_flags_46, loc_F573

				ld	a, dmarx_knock_unk_23A
				cmp	a, #04h
				bcs	loc_F573

				cmp	#0D2h, var_ect
				bcs	loc_F573

				setb	bit7, var_diag_errors_5
				tbbc	bit5, var_flags_46, loc_F57C

				ld	a, var_knock_unk_1B9
				bra	loc_F577

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F56A:							; CODE XREF: ROM:F54Bj
				tbbc	bit7, var_diag_errors_5, loc_F573

				ld	a, var_knock_unk_1B3
				st	a, unk_1B5

loc_F573:							; CODE XREF: ROM:F54Fj
								; ROM:F551j ...
				clrb	bit7, var_diag_errors_5
				ld	a, #1Ah

loc_F577:							; CODE XREF: ROM:F568j
				clr	unk_E3
				jmp	loc_F600

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F57C:							; CODE XREF: ROM:F562j
				ld	a, var_knock_info
				and	a, #03h
				beq	loc_F5BD

				ld	y, #(table_knock_C395-1)
				add	y, a
				ld	a, y + 00h
				ld	b, var_knock_unk_1B8
				cmp	b, #04h
				bgt	loc_F59D

				shl	a
				cmp	b, #01h
				bgt	loc_F59D

				push	b
				ld	b, dmatx_unk_216
				pull	b
				bne	loc_F59D

				shl	a

loc_F59D:							; CODE XREF: ROM:F58Ej
								; ROM:F593j ...
				add	a, var_knock_unk_1B3
				bcc	loc_F5A4

				ld	a, #0FFh

loc_F5A4:							; CODE XREF: ROM:F5A0j
				st	a, var_knock_unk_1B3
				cmp	b, #04h
				bcs	loc_F5B9

				sub	a, var_knock_unk_1BA
				ble	loc_F5B9

				shr	a
				shr	a
				inc	a
				add	a, var_knock_unk_1BA
				st	a, var_knock_unk_1BA

loc_F5B9:							; CODE XREF: ROM:F5A9j
								; ROM:F5AEj
				clr	a
				st	a, var_knock_unk_1B8

loc_F5BD:							; CODE XREF: ROM:F581j
				ld	a, var_knock_unk_1B9
				mov	a, b
				sub	a, var_knock_unk_1BB
				bcc	loc_F5CE

				add	a, var_knock_unk_1B3
				bcs	loc_F5D3

				clr	a
				bra	loc_F5D3

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F5CE:							; CODE XREF: ROM:F5C4j
				add	a, var_knock_unk_1B3
				bcs	loc_F5D6


loc_F5D3:							; CODE XREF: ROM:F5C9j
								; ROM:F5CCj
				cmp	a, b
				ble	loc_F5D7


loc_F5D6:							; CODE XREF: ROM:F5D1j
				mov	b, a

loc_F5D7:							; CODE XREF: ROM:F5D4j
				ld	b, var_knock_unk_157
				shl	b
				bcs	loc_F5F4

				sub	b, dmarx_knock_unk_23A
				bcc	loc_F5F4

				add	b, var_knock_unk_1B9
				bcs	loc_F5E8

				clr	b

loc_F5E8:							; CODE XREF: ROM:F5E5j
				cmp	a, b
				ble	loc_F5F4

				mov	b, a
				cmp	a, #1Ah
				bcc	loc_F5F2

				ld	a, #1Ah

loc_F5F2:							; CODE XREF: ROM:F5EEj
				bra	loc_F600

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F5F4:							; CODE XREF: ROM:F5DBj
								; ROM:F5E0j ...
				ld	b, unk_168
				bne	loc_F600

				cmp	a, var_knock_unk_1BA
				bgt	loc_F605

				mov	a, b
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F600:							; CODE XREF: ROM:F579j
								; ROM:loc_F5F2j ...
				ld	b, #1Ah
				st	b, var_knock_unk_1BA

loc_F605:							; CODE XREF: ROM:F5FCj
				st	a, var_knock_unk_1B3
				ld	a, var_knock_unk_1B9
				st	a, var_knock_unk_1BB
				clr	a
				tbbs	bit2, var_flags_46, loc_F641

				ld	a, var_knock_unk_1B3
				cmp	#0D2h, var_ect
				bcc	loc_F61E

				add	a, #00h
				bra	loc_F631

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F61E:							; CODE XREF: ROM:F618j
				ld	b, #90h
				cmp	b, #91h
				bcc	loc_F631

				cmp	#90h, var_rpm_x_5p12
				bcs	loc_F631

				ld	a, unk_1B5
				sub	a, table_knock_info+2
				bra	loc_F634

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F631:							; CODE XREF: ROM:F61Cj
								; ROM:F622j ...
				sub	a, var_knock_unk_1B9

loc_F634:							; CODE XREF: ROM:F62Fj
				bcc	loc_F63E

				add	a, dmarx_knock_unk_23A
				bcs	loc_F641

				clr	a
				bra	loc_F641

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F63E:							; CODE XREF: ROM:loc_F634j
				ld	a, dmarx_knock_unk_23A

loc_F641:							; CODE XREF: ROM:F60Fj
								; ROM:F639j ...
				st	a, dmatx_unk_216
				cmp	#40h, var_cnt_CB
				bcc	loc_F64C

				jmp	locret_F6C4

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F64C:							; CODE XREF: ROM:F647j
				clr	var_cnt_CB
				ld	a, var_knock_unk_1B3
				sub	a, #02h
				bcc	loc_F656

				clr	a

loc_F656:							; CODE XREF: ROM:F653j
				ld	b, dmatx_unk_216
				bne	loc_F661

				cmp	a, #1Ah
				bcc	loc_F661

				ld	a, #1Ah

loc_F661:							; CODE XREF: ROM:F659j
								; ROM:F65Dj
				st	a, var_knock_unk_1B3
				ld	b, var_knock_unk_1B9
				beq	loc_F6A3

				ld	a, var_rpm_x_5p12
				cmp	a, #18h
				bcs	loc_F6A3

				cmp	a, #8Ch
				bcc	loc_F6A3

				ld	a, var_knock_unk_1BA
				sub	a, #11h
				bcc	loc_F68C

				ld	a, var_knock_unk_1BC
				ld	y, #table_C398
				add	y, a
				ld	a, y + 00h
				add	a, b
				cmp	a, #0ABh
				ble	loc_F68A

				ld	a, #0ABh

loc_F68A:							; CODE XREF: ROM:F686j
				bra	loc_F69A

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F68C:							; CODE XREF: ROM:F678j
				sub	a, #11h
				ble	loc_F6A3

				xch	a, b
				sub	a, b
				bcs	loc_F698

				cmp	a, #1Ah
				bcc	loc_F69A


loc_F698:							; CODE XREF: ROM:F692j
				ld	a, #1Ah

loc_F69A:							; CODE XREF: ROM:loc_F68Aj
								; ROM:F696j
				ld	y, #table_knock_info
				ld	b, var_knock_unk_1BC
				add	y, b
				st	a, y + 00h

loc_F6A3:							; CODE XREF: ROM:F667j
								; ROM:F66Dj ...
				ld	x, #table_C39B
				ld	b, var_knock_unk_1BC
				shl	b
				add	x, b
				ld	a, var_rpm_div_25
				clr	b
				cmp	a, x + 00h
				bcs	loc_F6B8

				inc	b
				cmp	a, x + 01h
				bcs	loc_F6B8

				inc	b

loc_F6B8:							; CODE XREF: ROM:F6B0j
								; ROM:F6B5j
				st	b, var_knock_unk_1BC
				ld	y, #table_knock_info
				add	y, b
				ld	a, y + 00h
				st	a, var_knock_unk_1B9

locret_F6C4:							; CODE XREF: ROM:F52Ej
								; ROM:loc_F53Bj ...
				ret


;  S U B	R O U T	I N E 


sub_F6C5:							; CODE XREF: sub_EA22+207p
				tbbc	bit5, var_flags_46, loc_F6D3

				di
				ld	d, #9A9Ah
				st	d, table_knock_info
				st	a, table_knock_info+2
				ei

loc_F6D3:							; CODE XREF: sub_F6C5j
				cmp	#0D2h, var_ect
				bcs	loc_F6E5

				tbbs	bit5, var_flags_46, loc_F6E5

				ld	a, unk_5C
				cmp	a, #96h
				bcc	loc_F6E7

				cmp	a, #6Ah
				ble	loc_F6E7


loc_F6E5:							; CODE XREF: sub_F6C5+11j
								; sub_F6C5+13j
				clr	var_cnt_CC

loc_F6E7:							; CODE XREF: sub_F6C5+1Aj
								; sub_F6C5+1Ej
				cmp	#06h, var_cnt_CC
				bcs	loc_F6EF

				setb	bit2, PORTB
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F6EF:							; CODE XREF: sub_F6C5+25j
				clrb	bit2, PORTB
				ret

; End of function sub_F6C5


;  S U B	R O U T	I N E 

; *********************************************************
; CPR0 interrupt, triggered when TIMER0	matches	CPR0
; Used for updating ignition.
; *********************************************************

				; public int_vector_9_ignition
int_vector_9_ignition:						; DATA XREF: ROM:FFF0o

; FUNCTION CHUNK AT F770 SIZE 0000002A BYTES

				push	x
				push	y
				clrb	bit0, IRQL
				tbbc	bit0, LDOUT, ignition_on ; Jump	if ignition just turned	on (LDOUT.0 is 0)

				clrb	bit0, var_ignition_flags
				tbbc	bit5, var_ignition_flags, fixed_dwell

				clrb	bit5, var_ignition_flags
				jsr	ignition_set_on_time

				bra	ignition_off

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

fixed_dwell:							; CODE XREF: int_vector_9_ignition+9j
				ld	d, CPR0			; Timer	comparison #0 MSB
				add	d, #16250
				st	d, CPR0			; Timer	comparison #0 MSB
				clrb	bit0, DOUT
				setb	bit1, var_ignition_flags

ignition_off:							; CODE XREF: int_vector_9_ignition+11j
				tbs	bit3, var_ignition_flags
				bne	loc_F770

				jsr	check_starter_and_set_flag

				tbbs	bit4, IRQLL, igf_detected ; Jump if ASR0 edge detected (IGF received)

				ld	d, var_igf_counter	; Get IGF missing counter and...
				inc	a			; ...increment MSB
				bne	igf_count_nz		; Jump if not 0

				dec	a			; Decrement to clamp to	0xFF

igf_count_nz:							; CODE XREF: int_vector_9_ignition+2Cj
				cmp	a, #05h			; Check	if less	than 5 IGF missing
				bcs	igf_count_lt_5		; Jump if so

				setb	bit4, var_limiter_flags	; Set flag indicating stop fuel	due to missing IGF

igf_count_lt_5:							; CODE XREF: int_vector_9_ignition+31j
				cmp	#3Fh, var_revcnt_ne_C2
				bcs	igf_reset_low_counter

				cmp	#3Ch, var_rpm_x_5p12	; Check	if less	than 3000rpm
				bcs	igf_count_rpm_lt_3000	; Jump if so

				cmp	#73h, var_adc_battery	; Check	if battery less	than 8.9v
				bcs	igf_reset_low_counter	; Jump if so

				tbbs	bit0, var_io_input1, igf_reset_low_counter ; Jump if STA high (starter running)


igf_count_rpm_lt_3000:						; CODE XREF: int_vector_9_ignition+3Dj
				cmp	b, #01h			; Check	IGF missing count for <3000rpm
				bgt	loc_F73F		; Jump if more than 1

				clr	var_revcnt_igf_timer	; Reset	IGF error timer

loc_F73F:							; CODE XREF: int_vector_9_ignition+49j
				inc	b			; Increment IGF	missing	count
				bne	igf_error_count_nz	; Jump if not 0

				dec	b			; Decrement to clamp to	0xFF

igf_error_count_nz:						; CODE XREF: int_vector_9_ignition+4Ej
				cmp	b, #09h			; Check	if less	than 9 IGF missing
				bcs	igf_store_counter	; Jump if so

				cmp	#3Fh, var_revcnt_igf_timer ; Check if IGF timer	has reached 0x3F
				bcs	igf_store_counter

				setb	bit2, var_error_flags1	; Set IGF missing error	flag
				setb	bit4, var_flags_4D	; Set flag to indicate too many	IGF signals missing
				bra	igf_store_counter

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

igf_detected:							; CODE XREF: int_vector_9_ignition+25j
				clrb	bit4, IRQLL		; Clear	interrupt latch	for ASR0
				clrb	bit4, var_limiter_flags	; Clear	IGF fuel cut flag
				clrb	bit2, var_error_flags1	; Clear	IGF error flag
				ld	a, #01h			; Reset	counter

igf_reset_low_counter:						; CODE XREF: int_vector_9_ignition+38j
								; int_vector_9_ignition+42j ...
				ld	b, #01h			; Reset	IGF missing less than 3000 rpm counter

igf_store_counter:						; CODE XREF: int_vector_9_ignition+53j
								; int_vector_9_ignition+58j ...
				st	d, var_igf_counter	; Store	updated	counter
				bra	loc_F770

; End of function int_vector_9_ignition


;  S U B	R O U T	I N E 


check_IGF_error:						; CODE XREF: ROM:DF6Ep
				tbbs	bit4, var_flags_4D, loc_F766 ; Jump if IGT flag	still set

				clr	var_igt_time		; Reset	IGT time

loc_F766:							; CODE XREF: check_IGF_errorj
				and	a, #0FBh
				cmp	#2Eh, var_igt_time	; Check	if IGT time has	exceeded limit
				ble	locret_F76F		; Jump if not

				or	a, #04h			; Set error flag for IGT/IGF missing

locret_F76F:							; CODE XREF: check_IGF_error+Aj
				ret

; End of function check_IGF_error

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR int_vector_9_ignition

loc_F770:							; CODE XREF: int_vector_9_ignition+20j
								; int_vector_9_ignition+6Dj
				bra	loc_F797

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

ignition_on:							; CODE XREF: int_vector_9_ignition+4j
				ld	d, CPR0			; Timer	comparison #0 MSB
				st	d, var_ign_on_time_from_CPR0
				tbbs	bit5, unk_40, loc_F780

				tbbs	bit0, var_io_input1, loc_F780 ;	Jump if	STA high (starter running)

				clrb	bit2, var_ignition_flags
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 			; Skip next instruction
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F780:							; CODE XREF: int_vector_9_ignition+85j
								; int_vector_9_ignition+88j
				setb	bit2, var_ignition_flags
				tbbc	bit3, var_ignition_flags, loc_F789

				clrb	bit3, var_ignition_flags
				setb	bit4, var_ignition_flags

loc_F789:							; CODE XREF: int_vector_9_ignition+90j
				tbbs	bit1, var_ignition_flags, loc_F797

				tbbs	bit2, var_ignition_flags, loc_F797

				ld	d, var_ne_sum3		; Get time of last 3 NE	periods...
				add	d, var_ign_on_time_from_CPR0 ; ...add to time ignition was turned on
				jsr	ignition_update_off_time ; Set estimated off ignition off time


loc_F797:							; CODE XREF: int_vector_9_ignition:loc_F770j
								; int_vector_9_ignition:loc_F789j ...
				pull	y
				pull	x
				reti

; END OF FUNCTION CHUNK	FOR int_vector_9_ignition

;  S U B	R O U T	I N E 


				; public int_watchdog
int_watchdog:							; DATA XREF: ROM:FFF6o
				clrb	bit4, IRQL		; Clear	interrupt
				push	x
				push	y
				ld	a, var_adc_index
				mov	a, b
				and	b, #03h
				beq	loc_F7AA

				add	a, #80h
				bcc	loc_F7B4

				clr	a

loc_F7AA:							; CODE XREF: int_watchdog+9j
				ld	b, #00h
				st	b, var_dac_command
				setb	bit1, SSD		; Set Parity=1 (ADC address)
				setc
				rolc	b
				st	b, SIDR_SODR		; Serial Input/Output Data Register

loc_F7B4:							; CODE XREF: int_watchdog+Dj
				st	a, var_adc_index
				jsr	drive_dout1

				ld	a, TIMER		; Timer	MSB (bit11~bit18)
				shr	a
				shr	a
				shr	a
				bcc	loc_F7C0

loc_F7C0:
				clrb	bit2, var_flags_42
				setb	bit1, IRQLL		; Generate IV6 interrupt
				pull	y
				pull	x
				reti

; End of function int_watchdog


;  S U B	R O U T	I N E 


sub_F7C7:							; CODE XREF: int_vector_6_sw_int+Fp
				ld	d, #(var_revcnt_AD << 8) | 19h
				jsr	increment_counters

				jsr	check_io_inputs

				ld	b, unk_AB
				tbs	bit3, DOUT		; DOUT Data Register
				beq	loc_F81D

				ld	a, dmarx_unk_242
				cmpb	a, #04h
				beq	loc_F7E4

				tbbs	bit3, unk_47, loc_F7FD

				setb	bit3, unk_47
				bra	loc_F7E9

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F7E4:							; CODE XREF: sub_F7C7+14j
				tbbc	bit3, unk_47, loc_F7FD

				clrb	bit3, unk_47

loc_F7E9:							; CODE XREF: sub_F7C7+1Bj
				clr	unk_AC
				add	b, #10h
				cmp	b, #20h
				bcs	loc_F81B

				ld	b, #20h
				ld	a, var_error_flags_6D
				and	a, #0FEh		; Clear	Error 16 flag
				st	a, var_error_flags_6D
				clrb	bit7, var_flags_46
				bra	loc_F81B

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F7FD:							; CODE XREF: sub_F7C7+16j
								; sub_F7C7:loc_F7E4j
				inc	unk_AC
				cmp	#16h, unk_AC
				bcs	loc_F81B

				clrb	bit3, unk_47
				clrb	bit3, DOUT
				clr	unk_AC
				and	b, #0Fh
				inc	b
				cmp	b, #03h
				bcs	loc_F81B

				ld	b, #03h
				ld	a, var_error_flags_6D
				or	a, #01h			; Set Error 16 flag
				st	a, var_error_flags_6D
				setb	bit7, var_flags_46

loc_F81B:							; CODE XREF: sub_F7C7+28j
								; sub_F7C7+34j	...
				st	b, unk_AB

loc_F81D:							; CODE XREF: sub_F7C7+Dj
				jsr	start_dma

				jsr	init_ne_on_start

				jsr	sub_EBF3

				inc	var_cnt_C6
				ld	a, #01h
				cmpb	a, var_cnt_C6
				beq	loc_F831

				jsr	knock_unk_E79E


loc_F831:							; CODE XREF: sub_F7C7+65j
				jsr	some_knock_averaging_calc

				cmp	#56h, var_revcnt_speed_update
				bcs	loc_F84D

				clr	var_revcnt_speed_update
				jsr	check_speed_limiter

				jsr	calc_speed_kph

				ld	d, var_rpm_x_5p12
				shr	d
				shr	d
				div	d, var_speed_kph
				bcc	loc_F84B

				ld	b, #0FFh

loc_F84B:							; CODE XREF: sub_F7C7+80j
				st	b, var_gearing

loc_F84D:							; CODE XREF: sub_F7C7+70j
				tbbc	bit1, var_flags_42, loc_F879

				ld	a, TIMER		; Timer	MSB (bit11~bit18)
				shr	a
				shr	a
				shr	a
				bcs	loc_F870

				shr	a
				bcs	loc_F86A

				shr	a
				bcs	loc_F866

				shr	a
				bcs	loc_F862

				bra	loc_F879

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F862:							; CODE XREF: sub_F7C7+97j
				clrb	bit7, unk_41
				bra	loc_F879

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F866:							; CODE XREF: sub_F7C7+94j
				clrb	bit6, unk_41
				bra	loc_F879

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F86A:							; CODE XREF: sub_F7C7+91j
				clrb	bit5, unk_41
				clrb	bit4, unk_41
				bra	loc_F879

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F870:							; CODE XREF: sub_F7C7+8Ej
				ld	d, #0C706h		; Increment counters at	0C7h - 0CCh
				jsr	increment_counters

				jsr	copy_dma_tx


loc_F879:							; CODE XREF: sub_F7C7:loc_F84Dj
								; sub_F7C7+99j	...
				setb	bit7, var_flags_42
				ret

; End of function sub_F7C7


;  S U B	R O U T	I N E 


start_dma:							; CODE XREF: sub_C59B+193p
								; sub_E254+Ap ...
				cmp	#04h, var_revcnt_C5
				ble	loc_F88D

				ld	a, unk_1DD
				and	a, #0BFh
				st	a, unk_1DD
				st	a, ASR0N		; ASR0 neg edge	counter	value MSB
				bra	loc_F897

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F88D:							; CODE XREF: start_dma+3j
				ld	a, TIMER3		; Timer	LSB (bit0~bit2)
				cmpb	a, #40h
				beq	loc_F8AB

				cmpb	a, #08h
				bne	loc_F899


loc_F897:							; CODE XREF: start_dma+Fj
				clr	var_revcnt_C5

loc_F899:							; CODE XREF: start_dma+19j
				ld	a, unk_1DD
				or	a, #40h
				st	a, unk_1DD
				st	a, ASR0N		; ASR0 neg edge	counter	value MSB
				ld	d, #9200h
				st	d, ASR3			; ASR3 edge counter value MSB
				ld	#0B7h, TIMER3		; Timer	LSB (bit0~bit2)

loc_F8AB:							; CODE XREF: start_dma+15j
				cmp	#24h, unk_76
				bcs	loc_F8C4

				clrb	bit2, IMASKL
				ld	a, unk_1DD
				and	a, #7Fh
				st	a, unk_1DD
				st	a, ASR0N		; ASR0 neg edge	counter	value MSB
				ld	a, TIMER3		; Timer	LSB (bit0~bit2)
				or	a, #80h
				st	a, TIMER3		; Timer	LSB (bit0~bit2)
				bra	loc_F8ED

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F8C4:							; CODE XREF: start_dma+32j
				setb	bit2, IMASKL
				cmp	#04h, var_revcnt_C4
				ble	locret_F8F3

				ld	a, unk_1DD
				and	a, #7Fh
				st	a, ASR0N		; ASR0 neg edge	counter	value MSB
				or	a, #80h
				st	a, unk_1DD
				st	a, ASR0N		; ASR0 neg edge	counter	value MSB
				ld	d, #81DEh
				st	d, ASR2			; ASR2 edge counter value MSB
				ld	#4Fh, TIMER3		; Timer	LSB (bit0~bit2)
				ld	b, unk_77
				inc	b
				bne	loc_F8E7

				dec	b

loc_F8E7:							; CODE XREF: start_dma+68j
				st	b, unk_77
				cmp	b, #03h
				bcs	loc_F8F1


loc_F8ED:							; CODE XREF: start_dma+46j
				setb	bit7, var_flags_46
				clrb	bit2, SSD

loc_F8F1:							; CODE XREF: start_dma+6Fj
				clr	var_revcnt_C4

locret_F8F3:							; CODE XREF: start_dma+4Dj
				ret

; End of function start_dma


;  S U B	R O U T	I N E 


				; public IV0
IV0:								; DATA XREF: ROM:FFDEo
				push	x
				push	y
				clrb	bit2, IRQLL
				ld	b, unk_76
				ld	a, TIMER3		; Timer	LSB (bit0~bit2)
				cmpb	a, #30h
				bne	loc_F90D

				tbbs	bit2, RAMST, loc_F90D	; Built-in RAM status

				jsr	copy_dma_rx

				clr	var_revcnt_C4
				clr	unk_77
				clr	b
				bra	loc_F911

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F90D:							; CODE XREF: IV0+Aj
								; IV0+Cj
				inc	b
				bne	loc_F911

				dec	b

loc_F911:							; CODE XREF: IV0+17j
								; IV0+1Aj
				st	b, unk_76
				ld	d, #81DEh
				st	d, ASR2			; ASR2 edge counter value MSB
				ld	#4Fh, TIMER3		; Timer	LSB (bit0~bit2)
				ld	b, RAMST		; Built-in RAM status
				ld	b, unk_1C
				pull	y
				pull	x
				reti

; End of function IV0


;  S U B	R O U T	I N E 


copy_dma_tx:							; CODE XREF: sub_C59B+186p
								; sub_F7C7+AFp
				ld	a, var_trim_unk_98
				tbbs	bit0, var_flags_42, loc_F929 ; Jump if trims valid

				ld	a, #50h

loc_F929:							; CODE XREF: copy_dma_tx+2j
				st	a, dmatx_trim_unk_20D
				ld	a, var_trim_unk_96
				tbbs	bit0, var_flags_42, loc_F933 ; Jump if trims valid

				ld	a, #00h

loc_F933:							; CODE XREF: copy_dma_tx+Cj
				st	a, dmatx_trim_unk_210
				ld	a, var_cnt_startup
				st	a, dmatx_cmd_startup_20E
				ld	a, var_cnt_EA
				st	a, dmatx_cnt_unk_20F
				ld	a, unk_60
				st	a, dmatx_unk_211
				ld	d, var_inj_pw_inj1
				st	d, dmatx_unk_206
				ld	d, table_knock_info
				st	d, dmatx_knock_info
				ld	a, table_knock_info+2
				st	a, dmatx_knock_info+2
				ld	a, unk_1BD
				st	a, dmatx_unk_21C
				ld	d, var_error_flags1
				st	d, dmatx_error_flags1
				ld	a, var_flags_46
				st	a, dmatx_flags_46
				clr	a
				ld	b, unk_1D5
				cmpb	b, #80h
				beq	loc_F971

				or	a, #01h

loc_F971:							; CODE XREF: copy_dma_tx+4Bj
				ld	b, unk_1D9
				cmpb	b, #04h
				beq	loc_F97A

				or	a, #02h

loc_F97A:							; CODE XREF: copy_dma_tx+54j
				tbbc	bit1, var_io_input1, loc_F97F

				or	a, #04h

loc_F97F:							; CODE XREF: copy_dma_tx:loc_F97Aj
				ld	b, unk_1D7
				cmpb	b, #01h
				beq	loc_F988

				or	a, #08h

loc_F988:							; CODE XREF: copy_dma_tx+62j
				tbbc	bit2, var_flags_4D, loc_F98D

				or	a, #10h

loc_F98D:							; CODE XREF: copy_dma_tx:loc_F988j
				tbbc	bit3, var_io_input1, loc_F992

				or	a, #20h

loc_F992:							; CODE XREF: copy_dma_tx:loc_F98Dj
				st	a, dmatx_flags_1
				ld	a, var_limiter_flags
				st	a, dmatx_limiter_flags
				ret

; End of function copy_dma_tx


;  S U B	R O U T	I N E 


copy_dma_rx:							; CODE XREF: IV0+Fp
				ld	x, #dmarx_unk_226
				ld	y, #var_dma_rx_buffer

loc_F9A1:							; CODE XREF: copy_dma_rx+Ej
				ld	d, [y]			; Copy 34 words
				st	d, x + 00h
				inc	x
				inc	x
				cmp	x, #unk_248
				bcs	loc_F9A1

				ret

; End of function copy_dma_rx


;  S U B	R O U T	I N E 


				; public int_vector_6_sw_int
int_vector_6_sw_int:						; DATA XREF: ROM:FFEAo
				clrb	bit1, IRQLL
				push	x
				push	y
				tbs	bit3, var_flags_42
				bne	loc_F9B7

				jsr	ignition_timing_calc


loc_F9B7:							; CODE XREF: int_vector_6_sw_int+6j
				tbs	bit2, var_flags_42
				bne	loc_F9BE

				jsr	sub_F7C7


loc_F9BE:							; CODE XREF: int_vector_6_sw_int+Dj
				pull	y
				pull	x
				reti

; End of function int_vector_6_sw_int


;  S U B	R O U T	I N E 


				; public int_vector_4_kph
int_vector_4_kph:						; DATA XREF: ROM:FFE6o

; FUNCTION CHUNK AT FA05 SIZE 00000003 BYTES

				clrb	bit7, IRQLL
				push	x
				push	y
				tbs	bit5, TAIT		; Check	if was interrupt triggered on falling edge of ASR3...
				beq	loc_F9CE		; ...jump forward if so

				clrb	bit5, TAIT
				ld	d, ASR3			; ASR3 edge counter value MSB
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_F9CE:							; CODE XREF: int_vector_4_kph+6j
				ld	d, unk_34
				cmp	#05h, var_revcnt_B3
				bgt	loc_F9DE

				sub	d, unk_71
				cmp	d, #00FAh
				ble	loc_F9EB

				add	d, unk_71

loc_F9DE:							; CODE XREF: int_vector_4_kph+12j
				st	d, unk_71
				di
				ld	a, var_kph_table
				inc	a
				beq	loc_F9E8

				st	a, var_kph_table

loc_F9E8:							; CODE XREF: int_vector_4_kph+23j
				ei
				clr	var_revcnt_B3

loc_F9EB:							; CODE XREF: int_vector_4_kph+19j
				bra	return_from_isr

; End of function int_vector_4_kph


;  S U B	R O U T	I N E 


calc_speed_kph:							; CODE XREF: sub_F7C7+77p
				clr	a
				ld	x, #var_kph_table
				xch	a, x + 00h
				xch	a, x + 01h
				add	a, x + 01h
				bcc	loc_F9FB

				ld	a, #0FFh

loc_F9FB:							; CODE XREF: calc_speed_kph+Aj
				cmp	a, #02h
				bgt	loc_FA00

				clr	a

loc_FA00:							; CODE XREF: calc_speed_kph+10j
				xch	a, var_speed_kph
				st	a, var_speed_kph_2
				ret

; End of function calc_speed_kph

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR int_vector_4_kph

return_from_isr:						; CODE XREF: int_vector_4_kph:loc_F9EBj
				pull	y
				pull	x
				reti

; END OF FUNCTION CHUNK	FOR int_vector_4_kph
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

				; public int_vector_1_serial_rx
int_vector_1_serial_rx:						; DATA XREF: ROM:FFE0o
				clrb	bit3, IRQLL		; Clear	interrupt
				push	x
				push	y
				tbbs	bit6, SSD, loc_FA1E	; Jump if buffer overflow

				ld	a, SIDR_SODR		; Read serial rx data (MSB)
				setb	bit1, SSD		; Set parity bit for serial tx data
				ld	#02h, SIDR_SODR		; Transmit 102h	now
				ld	b, #0Dh			; Set loop counter

loc_FA18:							; CODE XREF: ROM:FA1Cj
				tbbs	bit7, SSD, loc_FA24	; Check	if receive data	buffer,	jump if	so

				dec	b			; Decrement loop counter...
				bne	loc_FA18		; ..and	loop back if not zero


loc_FA1E:							; CODE XREF: ROM:FA0Cj
								; ROM:FA26j
				ld	b, SIDR_SODR		; Read serial rx data (parity bit set)
				ld	a, #0FFh
				bra	loc_FA41

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FA24:							; CODE XREF: ROM:loc_FA18j
				clrb	bit3, IRQLL		; Clear	interrupt
				tbbs	bit6, SSD, loc_FA1E	; Jump if buffer overflow

				ld	b, SIDR_SODR		; Read serial rx data (LSB)
				mov	d, x			; Copy 16 bits of serial data into X
				tbbc	bit1, var_flags_42, loc_FA32

				tbbc	bit7, var_flags_42, loc_FA3F


loc_FA32:							; CODE XREF: ROM:FA2Cj
				cmp	#18h, var_revcnt_AD
				bgt	loc_FA3F

				tbs	bit0, PORTA		; Port A Data Register
				beq	loc_FA3D

				clrb	bit0, PORTA

loc_FA3D:							; CODE XREF: ROM:FA39j
				clrb	bit7, var_flags_42

loc_FA3F:							; CODE XREF: ROM:FA2Fj
								; ROM:FA35j
				ld	a, var_dac_command	; Get last ADC command

loc_FA41:							; CODE XREF: ROM:FA22j
				push	a			; Store	for use	later
				tbbs	bit1, var_flags_42, adc_advance_index ;	Jump if	using ADC index	lookup table

; Scan through each ADC	channel

				clr	a
				ld	b, var_dac_command
				inc	b
				cmp	b, #0Eh
				bne	adc_send_command

				setb	bit1, var_flags_42	; Set flag so that ADC index lookup table is used
				jmp	loc_FAC9

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

adc_advance_index:						; CODE XREF: ROM:FA42j
				ld	a, var_adc_index	; Get index into DAC tables
				inc	a			; Increment index
				and	a, #7Fh			; Limit	index to 0..7fh
				mov	a, b			; Copy index into B
				and	b, #07h			; A is index from 0..7
				ld	y, #table_adc_channel	; Load address of DAC table
				tbbs	bit1, unk_40, loc_FA66

				tbbs	bit0, unk_40, loc_FA66

				ld	y, #table_adc_channel_2	; Load address of altenative DAC table

loc_FA66:							; CODE XREF: ROM:FA5Dj
								; ROM:FA60j
				add	y, b			; Get address of DAC command
				ld	b, y + 00h		; Get DAC command
				bpz	adc_send_command	; Jump if direct command (less than 80h)

				cmp	b, #81h			; Check	if 81h
				beq	adc_81h_command

				cmp	b, #80h			; Check	if 80h (send debug command 0DAh)
				beq	adc_debug_command

				bra	adc_skip_command	; 82h upwards, so just skip command

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

adc_81h_command:						; CODE XREF: ROM:FA6Dj
				mov	a, b
				shr	b
				shr	b
				shr	b
				and	b, #0Fh
				ld	y, #table_adc_channel_low_pri
				add	y, b
				ld	b, y + 00h

adc_send_command:						; CODE XREF: ROM:FA4Bj
								; ROM:FA69j
				setb	bit1, SSD
				st	b, var_dac_command	; Store	DAC command we're about to send
				setc
				rolc	b
				and	b, #1Fh
				st	b, SIDR_SODR		; Serial Input/Output Data Register
				bra	adc_skip_command

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.block  030h
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ				
adc_debug_command:						; CODE XREF: ROM:FA71j
				push	a
				jsr	serial_diag_extended

loc_FAC1:							; CODE XREF: ROM:FAA3j
				clrb	bit3, IRQLL
				pull	a
				inc	a
				and	a, #7Fh

adc_skip_command:						; CODE XREF: ROM:FA73j
								; ROM:FA8Bj
				st	a, var_adc_index	; Store	new DAC	index

loc_FAC9:							; CODE XREF: ROM:FA4Fj
				pull	b			; Get ADC command
				cmp	b, #0FFh
				bne	loc_FAD1

				jmp	adc_complete

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FAD1:							; CODE XREF: ROM:FACCj
				shl	b			; B = ADC command * 2
				and	b, #1Eh			; B = 0, 2, 4, .., 30
				ld	y, #table_adc_handler	; Get address of ADC handler routines table
				add	y, b			; Calculate address of ADC handler routine address
				ld	y, y + 00h		; Load Y with function address
				mov	x, d			; Copy 16 bits of serial data into D
				mov	a, b			; Copy ADC index into B
				jmp	y + 00h			; Jump to ADC handler routine

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
table_adc_handler:		.dw adc_handler_pim, adc_handler_tps ; DATA XREF: ROM:FAD4o
				.dw adc_handler_o2_heater, adc_handler_battery
				.dw adc_handler_ect, adc_handler_tha
				.dw adc_handler_unk_1CB, adc_handler_unk_1CC
				.dw adc_handler_trac_tps, adc_handler_unk_1CD
				.dw adc_handler_tham, adc_handler_complete
				.dw adc_handler_o2_sensor, adc_handler_unk_1CE
table_adc_channel:		.db 82h, 02h, 81h, 80h		; DATA XREF: ROM:FA5Ao
				.db 82h, 08h, 01h, 80h
table_adc_channel_2:		.db 82h, 03h, 81h, 80h		; DATA XREF: ROM:FA63o
				.db 82h, 08h, 01h, 80h
table_adc_channel_low_pri:	.db 04h, 0Ah, 03h, 06h		; DATA XREF: ROM:FA7Bo
				.db 04h, 05h, 03h, 07h
				.db 04h, 0Ah, 03h, 09h
				.db 04h, 0Dh, 03h, 0Ch
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
; START	OF FUNCTION CHUNK FOR adc_handler_pim

adc_complete:							; CODE XREF: ROM:FACEj
								; adc_handler_pim+D0j ...
				pull	y
				pull	x
				reti

; END OF FUNCTION CHUNK	FOR adc_handler_pim
;**************************************************************************************************************
;Read input ports and filter out any glitches
;**************************************************************************************************************

;  S U B	R O U T	I N E 


check_io_inputs:						; CODE XREF: sub_C59B+180p
								; sub_C59B+183p ...
				clr	a
				tbbc	bit1, PORTA, loc_FB23	; Check	PORTA.1	for STA	(active	high)

				or	a, #01h			; Set bit 0

loc_FB23:							; CODE XREF: check_io_inputs+1j
				tbbs	bit2, PORTA, loc_FB28	; Check	PORTA.2	for IDL	(active	low)

				or	a, #02h			; Set bit 1

loc_FB28:							; CODE XREF: check_io_inputs:loc_FB23j
				tbbs	bit3, PORTA, loc_FB2D	; Port A Data Register

				or	a, #04h			; Set bit 2

loc_FB2D:							; CODE XREF: check_io_inputs:loc_FB28j
				tbbs	bit4, PORTA, loc_FB32	; Port A Data Register

				or	a, #08h			; Set bit 3

loc_FB32:							; CODE XREF: check_io_inputs:loc_FB2Dj
				tbbc	bit5, PORTA, loc_FB37	; Port A Data Register

				or	a, #10h			; Set bit 4

loc_FB37:							; CODE XREF: check_io_inputs:loc_FB32j
				tbbs	bit6, PORTB, loc_FB3C	; Check	PORTB.6	for request for	diagnostic check on TE1	(active	low)

				or	a, #20h			; Set bit 5

loc_FB3C:							; CODE XREF: check_io_inputs:loc_FB37j
				tbbs	bit7, PORTB, loc_FB41	; Port B Data Register

				or	a, #40h			; Set bit 6

loc_FB41:							; CODE XREF: check_io_inputs:loc_FB3Cj
				tbbc	bit2, PORTD_ASRIN, loc_FB46 ; Port D Data Register / ASR Input Data

				or	a, #80h			; Set bit 7

loc_FB46:							; CODE XREF: check_io_inputs:loc_FB41j
				ld	x, #var_io_input1	; Store	de-bounced readings at 49h
				ld	y, #var_io_input1_tmp	; Intermediate storage at 103h
				bsr	deglitch_io_input	; De-bounce readings

				clr	a
				tbbc	bit3, PORTD_ASRIN, loc_FB54 ; Port D Data Register / ASR Input Data

				or	a, #01h			; Set bit 0

loc_FB54:							; CODE XREF: check_io_inputs+32j
				tbbc	bit0, PORTC, loc_FB59	; Port C Data Register

				or	a, #02h			; Set bit 1

loc_FB59:							; CODE XREF: check_io_inputs:loc_FB54j
				tbbs	bit1, PORTC, loc_FB5E	; Port C Data Register

				or	a, #04h			; Set bit 2

loc_FB5E:							; CODE XREF: check_io_inputs:loc_FB59j
				tbbs	bit2, PORTC, loc_FB63	; Port C Data Register

				or	a, #08h			; Set bit 3

loc_FB63:							; CODE XREF: check_io_inputs:loc_FB5Ej
				tbbs	bit6, PORTC, loc_FB68	; Port C Data Register

				or	a, #10h			; Set bit 4

loc_FB68:							; CODE XREF: check_io_inputs:loc_FB63j
				tbbs	bit7, PORTC, loc_FB6D	; Port C Data Register

				or	a, #20h			; Set bit 5

loc_FB6D:							; CODE XREF: check_io_inputs:loc_FB68j
				tbbs	bit0, IRQLL, loc_FB72	; Interrupt Request Flag LSB

				or	a, #40h			; Set bit 6

loc_FB72:							; CODE XREF: check_io_inputs:loc_FB6Dj
				tbbc	bit4, PBCS, loc_FB77	; Port B Control Register

				or	a, #80h			; Set bit 7

loc_FB77:							; CODE XREF: check_io_inputs:loc_FB72j
				ld	x, #var_io_input2	; Store	de-bounced readings at 4Ah
				ld	y, #var_io_input2_tmp	; Intermediate storage at 104h
; End of function check_io_inputs

;**************************************************************************************************************
;De-glitch inputs.
;**************************************************************************************************************

;  S U B	R O U T	I N E 


deglitch_io_input:						; CODE XREF: check_io_inputs+2Fp
				mov	a, b
				xor	a, x + 00h
				and	a, y + 00h
				st	b, y + 00h
				and	b, x + 00h
				add	a, b
				st	a, x + 00h
				ret

; End of function deglitch_io_input


;  S U B	R O U T	I N E 


adc_handler_pim:						; DATA XREF: ROM:table_adc_handlero

; FUNCTION CHUNK AT FB1A SIZE 00000003 BYTES

				ld	y, #byte_C3C7		; Get PIM limits
				jsr	y + 10h			; Check	and clamp

				ld	a, var_flags_18C	; Get flags
				bcc	adc_handler_pim_ok	; Jump if PIM value not	out of range

				ld	x, #6666h		; Default PIM value
				tbbc	bit2, unk_40, loc_FB9E

				setb	bit5, var_error_flags1	; Set PIM sensor error flag
				setb	bit3, var_diag_errors_5	; Set sensor error flag

loc_FB9E:							; CODE XREF: adc_handler_pim+Dj
				cmpb	a, #01h			; Check	if bit 0 set
				bne	loc_FBA8		; Jump if it is	already	(PIM sensor out	of range detected)

				or	a, #01h			; Set PIM out of range flag
				clr	var_cnt_sensor_error	; Reset	counter
				bra	loc_FBBF

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FBA8:							; CODE XREF: adc_handler_pim+16j
				cmp	#0Fh, var_cnt_sensor_error ; Check if less than	15 reads out of	range
				bcs	loc_FBAF		; Jump if so

				setb	bit5, var_error_flags1	; Set PIM sensor error flag

loc_FBAF:							; CODE XREF: adc_handler_pim+21j
				ld	x, #6666h		; Default PIM value
				setb	bit3, var_flags_4D	; Set PIM default value	flag
				bra	loc_FBBF

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

adc_handler_pim_ok:						; CODE XREF: adc_handler_pim+8j
				and	a, #0FEh		; Clear	bit 0 of flags
				tbbs	bit2, unk_40, loc_FBBD

				clrb	bit5, var_error_flags1	; Clear	PIM sensor error flag

loc_FBBD:							; CODE XREF: adc_handler_pim+2Ej
				clrb	bit3, var_flags_4D	; Clear	PIM default value flag

loc_FBBF:							; CODE XREF: adc_handler_pim+1Cj
								; adc_handler_pim+2Aj
				st	a, var_flags_18C	; Store	flags
				mov	x, d			; Copy PIM value in rX to rD
				sub	d, #2940h
				bcc	loc_FBCC

				clr	a
				clr	b
				bra	loc_FBE0

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FBCC:							; CODE XREF: adc_handler_pim+3Cj
				mov	d, x
				push	b
				mul	a, #49h
				st	d, unk_125
				pull	a
				mul	a, #49h
				add	x, a
				mov	x, d
				add	d, unk_125
				bcc	loc_FBE0

				ld	d, #0FFFFh

loc_FBE0:							; CODE XREF: adc_handler_pim+40j
								; adc_handler_pim+51j
				tbbs	bit0, unk_40, loc_FC30

				tbbs	bit1, unk_47, loc_FBF6

				cmp	#0Ch, TIMER		; Timer	MSB (bit11~bit18)
				bcs	loc_FC30

				setb	bit1, unk_47
				st	a, unk_FA
				tbbc	bit0, var_io_input1, loc_FC30


loc_FBF2:							; CODE XREF: adc_handler_pim+81j
				setb	bit2, unk_47
				bra	loc_FC30

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FBF6:							; CODE XREF: adc_handler_pim+59j
				sub	d, var_pim_2
				rorc	a
				rorc	b
				jsr	divide_rD_2_signed

				add	d, var_pim_2
				mov	d, y
				tbbs	bit2, unk_47, loc_FC19

				sub	a, unk_FA
				bcc	loc_FC08

				neg	a

loc_FC08:							; CODE XREF: adc_handler_pim+7Bj
				cmp	a, #01h
				mov	y, d
				bgt	loc_FBF2

				tbbc	bit0, var_io_input1, loc_FC19

				setb	bit2, unk_47
				cmp	#0FFh, var_cnt_C7
				bcs	loc_FC19

				setb	bit0, unk_47

loc_FC19:							; CODE XREF: adc_handler_pim+76j
								; adc_handler_pim+83j ...
				tbbc	bit0, unk_47, loc_FC30

				tbbc	bit5, RAMST, loc_FC30	; Built-in RAM status

				push	d
				ld	b, unk_FA
				ld	y, #unk_C3BD
				jsr	y + 1Ah

				ld	x, #var_trim_unk_98
				jsr	write_rB_nv_ram

				clrb	bit0, unk_47
				pull	d

loc_FC30:							; CODE XREF: adc_handler_pim:loc_FBE0j
								; adc_handler_pim+5Fj ...
				st	d, var_pim_2
				st	d, dmatx_map
				jmp	loc_FC57

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FC38:							; CODE XREF: sub_C59B+491p
				ld	b, var_trim_unk_98
				ld	y, #unk_C3BD
				jsr	y + 1Ah

				bcc	loc_FC44

				jsr	clear_nv_ram


loc_FC44:							; CODE XREF: adc_handler_pim+B5j
				ld	a, var_trim_unk_98
				tbbs	bit0, var_flags_42, loc_FC4B ; Jump if trims valid

				ld	a, #50h

loc_FC4B:							; CODE XREF: adc_handler_pim+BCj
				clr	b
				shr	d
				div	d, #61h
				bcc	loc_FC53

				ld	b, #0FFh

loc_FC53:							; CODE XREF: adc_handler_pim+C5j
				st	b, unk_144
				ret

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FC57:							; CODE XREF: adc_handler_pim+ABj
				jsr	check_boost_limit

				jmp	adc_complete

; End of function adc_handler_pim


;  S U B	R O U T	I N E 


adc_handler_o2_heater:						; DATA XREF: ROM:table_adc_handlero
				mov	x, d
				shl	d
				bcs	loc_FC64

				shl	d
				bcc	loc_FC66


loc_FC64:							; CODE XREF: adc_handler_o2_heater+2j
				ld	a, #0FFh

loc_FC66:							; CODE XREF: adc_handler_o2_heater+5j
				st	a, var_adc_o2_heater
				ld	b, var_adc_lambda
				ld	y, #table_adc_unk_C249
				tbbs	bit2, var_flags_46, loc_FC7B

				inc	y
				ld	a, var_adc_o2_sensor
				shl	a
				rolc	a
				rolc	a
				and	a, #03h
				add	y, a

loc_FC7B:							; CODE XREF: adc_handler_o2_heater+11j
				cmp	x, #170Ah
				bcs	loc_FC89

				ld	a, y + 05h
				dec	b
				bmi	loc_FC92

				beq	loc_FC90

				bra	loc_FC93

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FC89:							; CODE XREF: adc_handler_o2_heater+21j
				ld	a, y + 00h
				inc	b
				bmi	loc_FC93

				bne	loc_FC92


loc_FC90:							; CODE XREF: adc_handler_o2_heater+28j
				setb	bit4, unk_44

loc_FC92:							; CODE XREF: adc_handler_o2_heater+26j
								; adc_handler_o2_heater+31j
				mov	a, b

loc_FC93:							; CODE XREF: adc_handler_o2_heater+2Aj
								; adc_handler_o2_heater+2Fj
				st	b, var_adc_lambda
				st	b, dmatx_adc_lambda
				jmp	adc_complete

; End of function adc_handler_o2_heater

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

adc_handler_tps:						; DATA XREF: ROM:table_adc_handlero
				st	b, var_tps_raw
				ld	a, var_flags_18C
				cmp	b, #0Dh			; Check	TPS against lower bound
				bcs	adc_handler_tps_low	; Jump if out of range (throttle may also be shut)

				cmp	b, #0FBh		; Check	TPS against upper bound
				bgt	adc_handler_tps_high	; Jump if out of range

				tbbs	bit1, var_io_input1, loc_FCB1 ;	Jump if	IDL high

				tbbc	bit1, var_error_flags2,	loc_FCBE

				bra	loc_FCC7

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FCB1:							; CODE XREF: ROM:FCA9j
				cmp	b, #4Dh			; Check	TPS against upper bound	for IDL	set
				bcc	adc_handler_tps_high	; Jump if out of range

				cmp	b, #31h
				bgt	loc_FCC7

				tbbs	bit2, unk_40, loc_FCBE

				clrb	bit1, var_error_flags2

loc_FCBE:							; CODE XREF: ROM:FCACj
								; ROM:FCB9j
				cmpb	a, #20h
				beq	loc_FCC4

				clrb	bit7, unk_40

loc_FCC4:							; CODE XREF: ROM:FCC0j
				or	a, #20h
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db 8Ch
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FCC7:							; CODE XREF: ROM:FCAFj
								; ROM:FCB7j ...
				and	a, #0DFh
				and	a, #0F7h
				bra	loc_FCF0

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

adc_handler_tps_low:						; CODE XREF: ROM:FCA3j
				tbbs	bit1, var_io_input1, loc_FCC7 ;	Check if throttle shut


adc_handler_tps_high:						; CODE XREF: ROM:FCA7j
								; ROM:FCB3j
				setb	bit7, unk_40
				clrb	bit3, var_flags_46
				ld	b, #10h
				st	b, unk_101
				and	a, #0DFh
				cmpb	a, #08h
				bne	loc_FCE3

				clr	var_cnt_sensor_error
				or	a, #08h

loc_FCE3:							; CODE XREF: ROM:FCDDj
				tbbs	bit2, unk_40, loc_FCEC

				cmp	#0Fh, var_cnt_sensor_error
				bcs	loc_FCF0

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FCEC:							; CODE XREF: ROM:loc_FCE3j
				setb	bit3, var_diag_errors_5
				setb	bit1, var_error_flags2

loc_FCF0:							; CODE XREF: ROM:FCCBj
								; ROM:FCE9j
				st	a, var_flags_18C
				tbbc	bit7, unk_40, loc_FD03

				clr	unk_EF
				ld	d, #0000h
				st	d, var_tps
				st	d, dmatx_tps
				jmp	loc_FD9E

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FD03:							; CODE XREF: ROM:FCF3j
				tbbs	bit1, var_io_input1, loc_FD08

				clr	unk_EF

loc_FD08:							; CODE XREF: ROM:loc_FD03j
				ld	a, var_nv_tps
				ld	b, #0AEh
				tbbs	bit0, unk_40, loc_FD67

				tbbc	bit1, var_flags_42, loc_FD67

				tbbc	bit0, var_flags_42, loc_FD67 ; Jump if trims are not valid

				tbs	bit5, unk_47
				bne	loc_FD22

				add	a, #08h
				bcc	loc_FD20

				ld	a, #0FFh

loc_FD20:							; CODE XREF: ROM:FD1Cj
				bra	loc_FD57

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FD22:							; CODE XREF: ROM:FD18j
				ld	b, unk_EF

loc_FD24:							; CODE XREF: ROM:FD2Aj
				cmp	b, #40h
				bcs	loc_FD2C

				sub	b, #40h
				bra	loc_FD24

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FD2C:							; CODE XREF: ROM:FD26j
				cmp	b, #0Ah
				bne	loc_FD3A

				add	a, #01h
				bcc	loc_FD36

				ld	a, #0FFh

loc_FD36:							; CODE XREF: ROM:FD32j
				inc	unk_EF
				bra	loc_FD57

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FD3A:							; CODE XREF: ROM:FD2Ej
				cmp	#02h, unk_EF
				bcs	loc_FD68

				push	a
				mov	x, d
				jsr	divide_rD_64_saturate

				add	b, #01h
				bcc	loc_FD4A

				ld	b, #0FFh

loc_FD4A:							; CODE XREF: ROM:FD46j
				pull	a
				cmp	a, b
				ble	loc_FD68

				tbs	bit5, var_flags_42
				beq	loc_FD6A

				sub	a, #01h
				bcc	loc_FD57

				clr	a

loc_FD57:							; CODE XREF: ROM:loc_FD20j
								; ROM:FD38j ...
				mov	a, b
				ld	y, #byte_C3D3
				jsr	y + 04h

				push	x
				ld	x, #var_nv_tps
				jsr	write_rB_nv_ram

				pull	x
				bra	loc_FD6A

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FD67:							; CODE XREF: ROM:FD0Dj
								; ROM:FD10j ...
				mov	b, a

loc_FD68:							; CODE XREF: ROM:FD3Dj
								; ROM:FD4Cj
				clrb	bit5, var_flags_42

loc_FD6A:							; CODE XREF: ROM:FD50j
								; ROM:FD65j
				clr	b
				shr	d
				shr	d
				push	d
				mov	x, d
				mov	s, x
				sub	d, x + 00h
				bcc	loc_FD76

				clr	a
				clr	b

loc_FD76:							; CODE XREF: ROM:FD72j
				st	d, unk_150
				pull	x
				ld	d, unk_152
				add	d, #037Bh
				bcs	loc_FD87

				cmp	d, unk_150
				ble	loc_FD8A


loc_FD87:							; CODE XREF: ROM:FD80j
				ld	d, unk_150

loc_FD8A:							; CODE XREF: ROM:FD85j
				st	d, var_tps
				st	d, dmatx_tps
				ld	b, #4Ch
				tbbs	bit3, var_flags_46, loc_FD96

				ld	b, #52h

loc_FD96:							; CODE XREF: ROM:FD91j
				cmp	a, b
				bcs	loc_FD9C

				setb	bit3, var_flags_46
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FD9C:							; CODE XREF: ROM:FD97j
				clrb	bit3, var_flags_46

loc_FD9E:							; CODE XREF: ROM:FD00j
				tbbc	bit7, unk_40, loc_FDAA

				clr	a
				st	a, var_tps_delta
				clrb	bit6, unk_47
				setb	bit7, unk_47
				bra	loc_FE05

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FDAA:							; CODE XREF: ROM:loc_FD9Ej
				ld	x, var_tps_2
				ld	d, var_tps
				push	x
				mov	s, x
				sub	d, x + 00h
				pull	x
				bcc	loc_FDCC

				neg	a
				neg	b
				subc	a, #00h
				cmp	d, #3D71h
				bcs	loc_FDC0

				setb	bit7, unk_47

loc_FDC0:							; CODE XREF: ROM:FDBCj
				cmpb	a, #0E0h
				bne	loc_FDC8

				shl	d
				shl	d
				neg	a
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FDC8:							; CODE XREF: ROM:FDC2j
				ld	a, #80h
				bra	loc_FDDB

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FDCC:							; CODE XREF: ROM:FDB3j
				cmp	a, #33h
				bcs	loc_FDD2

				setb	bit5, var_limiter_flags

loc_FDD2:							; CODE XREF: ROM:FDCEj
				cmpb	a, #0E0h
				bne	loc_FDD9

				shl	d
				shl	d
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FDD9:							; CODE XREF: ROM:FDD4j
				ld	a, #7Fh

loc_FDDB:							; CODE XREF: ROM:FDCAj
				ld	b, unk_146
				bpz	loc_FDE1

				neg	b

loc_FDE1:							; CODE XREF: ROM:FDDEj
				cmp	b, #01h
				bcc	loc_FDE7

				clrb	bit7, unk_47

loc_FDE7:							; CODE XREF: ROM:FDE3j
				ld	b, var_tps_delta
				st	a, var_tps_delta
				tbbs	bit2, var_flags_46, loc_FE03

				cmp	#0A0h, var_rpm_div_25
				bcc	loc_FE03

				add	a, b
				bvs	loc_FE00

				cmpz	a
				beq	loc_FE03

				bpz	loc_FDFC

				neg	a

loc_FDFC:							; CODE XREF: ROM:FDF9j
				cmp	a, #02h
				bcs	loc_FE05


loc_FE00:							; CODE XREF: ROM:FDF4j
				setb	bit6, unk_47
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FE03:							; CODE XREF: ROM:FDEBj
								; ROM:FDF1j ...
				clrb	bit6, unk_47

loc_FE05:							; CODE XREF: ROM:FDA8j
								; ROM:FDFEj
				ld	d, var_tps
				st	d, var_tps_2
				jsr	sub_C996

				jsr	sub_CE3C

				jsr	transient_throttle_inject

				jmp	adc_complete

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

adc_handler_trac_tps:						; DATA XREF: ROM:table_adc_handlero
				st	b, var_adc_unk_154
				tbbc	bit6, var_ignition_flags, loc_FE24

				cmp	#18h, unk_B9
				bcs	loc_FE24

				cmp	b, #0F0h
				bcc	loc_FE2E


loc_FE24:							; CODE XREF: ROM:FE18j
								; ROM:FE1Ej
				ld	a, unk_1DC
				and	a, #0FBh
				st	a, unk_1DC
				bra	loc_FE49

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FE2E:							; CODE XREF: ROM:FE22j
				ld	a, unk_1DC
				or	a, #04h
				st	a, unk_1DC
				ld	d, #0FFFFh
				st	d, unk_152
				clrb	bit3, var_error_flags2
				ld	a, var_flags_18C
				and	a, #0BFh
				st	a, var_flags_18C
				jmp	loc_FEE7

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FE49:							; CODE XREF: ROM:FE2Cj
				ld	a, var_flags_18C
				cmp	b, #0Dh
				bcs	loc_FE6A

				cmp	b, #0FBh
				bgt	loc_FE6D

				tbbc	bit2, var_io_input1, loc_FE66

				cmp	b, #4Dh
				bgt	loc_FE6D

				cmp	b, #31h
				bgt	loc_FE66

				and	a, #0BFh
				tbbs	bit2, unk_40, loc_FE66

				clrb	bit3, var_error_flags2

loc_FE66:							; CODE XREF: ROM:FE54j
								; ROM:FE5Dj ...
				and	a, #7Fh
				bra	loc_FE84

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FE6A:							; CODE XREF: ROM:FE4Ej
				tbbs	bit2, var_io_input1, loc_FE66


loc_FE6D:							; CODE XREF: ROM:FE52j
								; ROM:FE59j
				or	a, #40h
				cmpb	a, #80h
				bne	loc_FE77

				clr	var_cnt_sensor_error
				or	a, #80h

loc_FE77:							; CODE XREF: ROM:FE71j
				tbbs	bit2, unk_40, loc_FE80

				cmp	#0Fh, var_cnt_sensor_error
				bcs	loc_FE84

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FE80:							; CODE XREF: ROM:loc_FE77j
				setb	bit3, var_diag_errors_5
				setb	bit3, var_error_flags2

loc_FE84:							; CODE XREF: ROM:FE68j
								; ROM:FE7Dj
				st	a, var_flags_18C
				cmpb	a, #40h
				beq	loc_FE92

				ld	d, #0A042h
				clrb	bit5, var_flags_4D
				bra	loc_FEE4

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FE92:							; CODE XREF: ROM:FE89j
				ld	a, #0AEh
				tbbs	bit0, var_flags_42, loc_FE9B ; Jump if trims valid

				clrb	bit5, var_flags_4D
				bra	loc_FED7

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FE9B:							; CODE XREF: ROM:FE94j
				tbbc	bit6, var_ignition_flags, loc_FED2

				mov	x, d
				jsr	divide_rD_64

				add	b, unk_302
				addc	a, #00h
				shr	d
				add	b, unk_302
				addc	a, #00h
				shr	d
				cmpz	a
				beq	loc_FEB3

				ld	b, #0FFh

loc_FEB3:							; CODE XREF: ROM:FEAFj
				ld	a, unk_302
				tbs	bit5, var_flags_4D
				bne	loc_FEC0

				add	a, #01h
				bcc	loc_FEC0

				ld	a, #0FFh

loc_FEC0:							; CODE XREF: ROM:FEB8j
								; ROM:FEBCj
				cmp	a, b
				bgt	loc_FEC4

				mov	a, b

loc_FEC4:							; CODE XREF: ROM:FEC1j
				ld	y, #byte_C3D5
				jsr	y + 02h

				push	x
				ld	x, #unk_302
				jsr	write_rB_nv_ram

				pull	x
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FED2:							; CODE XREF: ROM:loc_FE9Bj
				clrb	bit5, var_flags_4D
				ld	a, unk_302

loc_FED7:							; CODE XREF: ROM:FE99j
				clr	b
				shr	d
				shr	d
				push	d
				mov	x, d
				mov	s, x
				sub	d, x + 00h
				pull	x
				bcc	loc_FEE4

				clr	a
				clr	b

loc_FEE4:							; CODE XREF: ROM:FE90j
								; ROM:FEE0j
				st	d, unk_152

loc_FEE7:							; CODE XREF: ROM:FE46j
				jmp	adc_complete

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

adc_handler_tha:						; DATA XREF: ROM:table_adc_handlero
				ld	y, #byte_C3C9		; Get THA limits
				jsr	y + 0Eh			; Check	and clamp

				ld	a, var_flags_18C	; Get flags
				bcc	loc_FF0D		; Jump if THA value not	out of range

				cmpb	a, #04h			; Check	if bit 2 set
				bne	loc_FEFC		; Jump if it is	already	(THA sensor out	of range detected)

				or	a, #04h			; Set THA out of range flag
				clr	var_cnt_sensor_error	; Reset	counter

loc_FEFC:							; CODE XREF: ROM:FEF6j
				tbbs	bit2, unk_40, loc_FF05

				cmp	#0Fh, var_cnt_sensor_error ; Check if less than	15 reads out of	range
				bcs	loc_FF09		; Jump if so

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 			; Skip next instruction
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FF05:							; CODE XREF: ROM:loc_FEFCj
				setb	bit3, var_diag_errors_5	; Set sensor error flag
				setb	bit4, var_error_flags1	; Set THA sensor error flag

loc_FF09:							; CODE XREF: ROM:FF02j
				ld	b, #79h			; 79h ^	0FFh = 86h - Default to	20 deg
				bra	loc_FF14

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FF0D:							; CODE XREF: ROM:FEF2j
				tbbs	bit2, unk_40, loc_FF12

				clrb	bit4, var_error_flags1	; Clear	THA sensor error flag

loc_FF12:							; CODE XREF: ROM:loc_FF0Dj
				and	a, #0FBh		; Clear	bit 2 of flags

loc_FF14:							; CODE XREF: ROM:FF0Bj
				st	a, var_flags_18C	; Store	flags
				xor	b, #0FFh		; Invert reading
				st	b, var_tha		; Store	value locally...
				st	b, dmatx_tha		; ...and for sending to	other CPU
				jmp	adc_complete		; ADC read complete

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

adc_handler_tham:						; DATA XREF: ROM:table_adc_handlero
				ld	y, #byte_C3CB		; Get THAM limits
				jsr	y + 0Ch			; Check	and clamp

				ld	a, var_flags_18D	; Get flags
				bcc	loc_FF44		; Jump if THAM value not out of	range

				cmpb	a, #01h			; Check	if bit 0 set
				bne	loc_FF33		; Jump if it is	already	(THAM sensor out of range detected)

				or	a, #01h			; Set THAM out of range	flag
				clr	var_cnt_sensor_error	; Reset	counter

loc_FF33:							; CODE XREF: ROM:FF2Dj
				tbbs	bit2, unk_40, loc_FF3C

				cmp	#0Fh, var_cnt_sensor_error ; Check if less than	15 reads out of	range
				bcs	loc_FF40		; Jump if so

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 			; Skip next instruction
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FF3C:							; CODE XREF: ROM:loc_FF33j
				setb	bit3, var_diag_errors_5	; Set sensor error flag
				setb	bit4, var_error_flags2	; Set THAM sensor error	flag

loc_FF40:							; CODE XREF: ROM:FF39j
				ld	b, #79h			; 79h ^	0FFh = 86h - Default to	20 deg
				bra	loc_FF4B

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FF44:							; CODE XREF: ROM:FF29j
				tbbs	bit2, unk_40, loc_FF49

				clrb	bit4, var_error_flags2	; Clear	THAM sensor error flag

loc_FF49:							; CODE XREF: ROM:loc_FF44j
				and	a, #0FEh		; Clear	bit 0 of flags

loc_FF4B:							; CODE XREF: ROM:FF42j
				st	a, var_flags_18D	; Store	flags
				xor	b, #0FFh		; Invert reading
				st	b, var_tham		; Store	value locally...
				st	b, dmatx_tham		; ...and for sending to	other CPU
				jmp	adc_complete		; ADC read complete


;  S U B	R O U T	I N E 


adc_handler_battery:						; DATA XREF: ROM:table_adc_handlero
				st	b, var_adc_battery	; Store	ADC value locally...
				st	b, dmatx_battery	; ...and for sending to	other CPU
				tbbc	bit5, RAMST, loc_FF6A	; Built-in RAM status

				cmp	b, #53h			; Check	if battery voltage less	than 6.5v
				bcs	loc_FF6A		; Jump if it is

				tbs	bit6, unk_44
				beq	loc_FF6A

				setb	bit2, DOUT		; Release Knock	MCU reset

loc_FF6A:							; CODE XREF: adc_handler_battery+5j
								; adc_handler_battery+Aj ...
				ld	b, var_adc_battery	; Redundant!!
				ld	y, #table_inj_battery_adjust
				jsr	table_rB_fixed_32_interpolate

				jsr	divide_rD_64

				st	d, var_inj_battery_adjust
				jmp	adc_complete

; End of function adc_handler_battery

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

adc_handler_ect:						; DATA XREF: ROM:table_adc_handlero
				ld	y, #byte_C3CD		; Get ECT limits
				jsr	y + 0Ah			; Check	and clamp

				ld	a, var_flags_18C	; Get flags
				bcc	loc_FF9F

				cmpb	a, #02h
				bne	loc_FF8D

				or	a, #02h
				clr	var_cnt_sensor_error

loc_FF8D:							; CODE XREF: ROM:FF87j
				tbbs	bit2, unk_40, loc_FF96

				cmp	#0Fh, var_cnt_sensor_error
				bcs	loc_FF9A

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  8Ch ; 
; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FF96:							; CODE XREF: ROM:loc_FF8Dj
				setb	bit3, var_diag_errors_5
				setb	bit3, var_error_flags1

loc_FF9A:							; CODE XREF: ROM:FF93j
				ld	x, #1B00h		; Default to 82	deg
				bra	loc_FFA6

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

loc_FF9F:							; CODE XREF: ROM:FF83j
				tbbs	bit2, unk_40, loc_FFA4

				clrb	bit3, var_error_flags1

loc_FFA4:							; CODE XREF: ROM:loc_FF9Fj
				and	a, #0FDh

loc_FFA6:							; CODE XREF: ROM:FF9Dj
				st	a, var_flags_18C
				mov	x, d
				xor	a, #0FFh
				xor	b, #0FFh
				and	b, #0C0h
				st	d, var_ect
				st	d, dmatx_ect
				jmp	adc_complete


;  S U B	R O U T	I N E 


adc_handler_o2_sensor:						; DATA XREF: ROM:table_adc_handlero
				st	b, var_adc_o2_sensor
				jmp	adc_complete

; End of function adc_handler_o2_sensor


;  S U B	R O U T	I N E 


adc_handler_unk_1CB:						; DATA XREF: ROM:table_adc_handlero
				st	b, var_adc_idle_unk_1CB
				jmp	adc_complete

; End of function adc_handler_unk_1CB


;  S U B	R O U T	I N E 


adc_handler_unk_1CC:						; DATA XREF: ROM:table_adc_handlero
				st	b, var_adc_idle_unk_1CC
				jmp	adc_complete

; End of function adc_handler_unk_1CC


;  S U B	R O U T	I N E 


adc_handler_unk_1CD:						; DATA XREF: ROM:table_adc_handlero
				st	b, var_adc_idle_unk_1CD
				jmp	adc_complete

; End of function adc_handler_unk_1CD


;  S U B	R O U T	I N E 


adc_handler_unk_1CE:						; DATA XREF: ROM:table_adc_handlero
				st	b, var_adc_idle_unk_1CE
				jmp	adc_complete

; End of function adc_handler_unk_1CE


;  S U B	R O U T	I N E 

; Attributes: thunk

adc_handler_complete:						; DATA XREF: ROM:table_adc_handlero
				jmp	adc_complete

; End of function adc_handler_complete

; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				.db  5Fh ; _
				.db  5Fh ; _
				.db 0C4h ; ฤ
unk_FFDC:			.db  82h ; 			; DATA XREF: ROM:FAB0o
				.db  88h ; 
				.dw IV0				; External interrupt 0
				.dw int_vector_1_serial_rx	; External interrupt 1
				.dw IVf				; External interrupt 2
				.dw IVf				; External interrupt 3
				.dw int_vector_4_kph		; External interrupt 4
				.dw IVf				; External interrupt 5
				.dw int_vector_6_sw_int		; External interrupt 6
				.dw IVf				; External interrupt 7
				.dw IVf				; External interrupt 8
				.dw int_vector_9_ignition	; External interrupt 9
				.dw IVf				; External interrupt a
				.dw IVf				; External interrupt b
				.dw int_watchdog		; External interrupt c
				.dw IVf				; External interrupt d
				.dw int_vector_e_ne		; External interrupt e
				.dw IVf				; External interrupt f
				.dw __RESET			; Processor reset
; end of 'ROM'


				.end
